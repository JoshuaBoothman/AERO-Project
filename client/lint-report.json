[{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\scripts\\create_real_admin.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\scripts\\create_real_admin.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":31},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":2,"column":16,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { sql, query } = require('../../api/src/lib/db');\r\nconst bcrypt = require('bcryptjs');\r\n\r\nasync function createRealAdmin() {\r\n    try {\r\n        const email = 'admin@test.com';\r\n        const password = 'password123';\r\n        const hashedPassword = await bcrypt.hash(password, 10);\r\n\r\n        console.log(`Creating admin: ${email}`);\r\n\r\n        // Check if exists\r\n        const check = await query(\"SELECT admin_user_id FROM admin_users WHERE email = @email\", [\r\n            { name: 'email', type: sql.NVarChar, value: email }\r\n        ]);\r\n\r\n        if (check.length > 0) {\r\n            console.log('Admin already exists.');\r\n            return;\r\n        }\r\n\r\n        // Insert\r\n        await query(`\r\n            INSERT INTO admin_users (first_name, last_name, email, password_hash, role, is_active)\r\n            VALUES ('Admin', 'User', @email, @hash, 'admin', 1)\r\n        `, [\r\n            { name: 'email', type: sql.NVarChar, value: email },\r\n            { name: 'hash', type: sql.NVarChar, value: hashedPassword }\r\n        ]);\r\n\r\n        console.log('Admin user created successfully.');\r\n\r\n    } catch (error) {\r\n        console.error('Error creating admin:', error);\r\n    }\r\n}\r\n\r\ncreateRealAdmin();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\scripts\\create_test_users.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const fetch = require('node-fetch');\r\n\r\nasync function registerUser(email, password, first, last) {\r\n    try {\r\n        const res = await fetch('http://localhost:5173/api/auth/register', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                email,\r\n                password,\r\n                firstName: first,\r\n                lastName: last\r\n            })\r\n        });\r\n\r\n        if (res.ok) {\r\n            console.log(`Success: Created ${email}`);\r\n        } else if (res.status === 409) {\r\n            console.log(`Info: User ${email} already exists.`);\r\n        } else {\r\n            console.error(`Error creating ${email}:`, await res.text());\r\n        }\r\n    } catch (e) {\r\n        console.error(`Network Error for ${email}:`, e.message);\r\n    }\r\n}\r\n\r\nasync function main() {\r\n    console.log('Creating Test Users...');\r\n    // \"Admin\" User (Functionally same as regular for now, but used for Admin Tool test)\r\n    await registerUser('admin@test.com', 'admin123', 'Adam', 'Admin');\r\n\r\n    // Regular Camper\r\n    await registerUser('camper@test.com', 'camper123', 'Chris', 'Camper');\r\n\r\n    console.log('Done.');\r\n}\r\n\r\nmain();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\App.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\components\\AssetSelectionModal.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAvailability'. Either include it or remove the dependency array.","line":35,"column":8,"nodeType":"ArrayExpression","endLine":35,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [asset, hireDates, pricingMode, eventDates, fetchAvailability]","fix":{"range":[1233,1276],"text":"[asset, hireDates, pricingMode, eventDates, fetchAvailability]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { X } from 'lucide-react';\r\n\r\n\r\n\r\n// Helper to determine initial mode\r\nfunction getInitialMode(asset) {\r\n    if (asset.show_daily_cost && !asset.show_full_event_cost) return 'daily';\r\n    if (!asset.show_daily_cost && asset.show_full_event_cost) return 'full';\r\n    return 'daily'; // Default if both or neither (though neither shouldn't happen)\r\n}\r\n\r\nfunction AssetSelectionModal({ asset, hireDates, setHireDates, eventDates, onClose, onAddToCart }) {\r\n    const [loading, setLoading] = useState(false);\r\n    const [availableItems, setAvailableItems] = useState([]);\r\n    const [error, setError] = useState(null);\r\n\r\n    // Pricing Mode State\r\n    const [pricingMode, setPricingMode] = useState(getInitialMode(asset));\r\n\r\n    // Update mode if asset changes\r\n    useEffect(() => {\r\n        setPricingMode(getInitialMode(asset));\r\n    }, [asset]);\r\n\r\n    useEffect(() => {\r\n        const targetDates = pricingMode === 'full' ? eventDates : hireDates;\r\n\r\n        if (asset && targetDates && targetDates.start && targetDates.end) {\r\n            fetchAvailability(targetDates);\r\n        } else {\r\n            setAvailableItems([]);\r\n            setLoading(false);\r\n        }\r\n    }, [asset, hireDates, pricingMode, eventDates]);\r\n\r\n    const fetchAvailability = async (dates) => {\r\n        setLoading(true);\r\n        setError(null);\r\n        try {\r\n            const query = new URLSearchParams({\r\n                typeId: asset.id,\r\n                start: dates.start,\r\n                end: dates.end\r\n            });\r\n            const res = await fetch(`/api/assets/availability?${query}`);\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setAvailableItems(data);\r\n            } else {\r\n                setError(\"Failed to check availability.\");\r\n            }\r\n        } catch {\r\n            setError(\"Error checking availability.\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleSelect = (item) => {\r\n        // Construct item with correct price based on mode\r\n        const costInfo = calculateCost(); // Re-calc to be safe\r\n        const finalPrice = costInfo.rawTotal; // Float\r\n\r\n        // Determine correct dates based on mode\r\n        const selectedDates = pricingMode === 'full' ? eventDates : hireDates;\r\n\r\n        // Make sure we pass the 'price' to onAddToCart so the cart knows what to charge\r\n        // Modifying the asset object passed to cart? Or the item?\r\n        // onAddToCart(asset, item, dates) -> usually creates a cart item.\r\n        // We might need to override the price in the cart item.\r\n        // Assuming onAddToCart handles an override or we pass a constructed object.\r\n        // Let's attach the price to the asset clone or item.\r\n        const assetWithPrice = { ...asset, price: finalPrice };\r\n        onAddToCart(assetWithPrice, item, selectedDates);\r\n        onClose();\r\n    };\r\n\r\n    // Calculate Costs\r\n    const calculateCost = () => {\r\n        if (pricingMode === 'full') {\r\n            const price = parseFloat(asset.full_event_cost || 0);\r\n            return {\r\n                label: 'Full Event',\r\n                total: price.toFixed(2),\r\n                rawTotal: price,\r\n                detail: 'Event Package'\r\n            };\r\n        }\r\n\r\n        // Daily Mode\r\n        if (!hireDates.start || !hireDates.end) return { days: 0, total: 0, rawTotal: 0, label: '', detail: '' };\r\n        const start = new Date(hireDates.start);\r\n        const end = new Date(hireDates.end);\r\n        const diffTime = Math.abs(end - start);\r\n        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n        const days = diffDays + 1; // Inclusive\r\n\r\n        // Allow fallback to 'price' if base_hire_cost is missing (StorePage mapping legacy vs new)\r\n        const pricePerDay = parseFloat(asset.base_hire_cost || asset.price || 0);\r\n        const total = days * pricePerDay;\r\n\r\n        return {\r\n            days,\r\n            label: `${days} Day${days !== 1 ? 's' : ''}`,\r\n            total: total.toFixed(2),\r\n            rawTotal: total,\r\n            detail: `@ $${pricePerDay}/day`\r\n        };\r\n    };\r\n\r\n    const { label, total, detail } = calculateCost();\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4\">\r\n            <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden\">\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b border-gray-100 flex justify-between items-start\">\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold text-gray-800\">{asset.name}</h2>\r\n                        <div className=\"mt-2 flex flex-col gap-2\">\r\n                            {/* Pricing Toggle */}\r\n                            {(asset.show_daily_cost && asset.show_full_event_cost) && (\r\n                                <div className=\"flex bg-gray-100 p-1 rounded-lg w-fit\">\r\n                                    <button\r\n                                        onClick={() => setPricingMode('daily')}\r\n                                        className={`px-3 py-1 rounded-md text-sm font-medium transition-all ${pricingMode === 'daily' ? 'bg-white shadow text-black' : 'text-gray-500 hover:text-black'}`}\r\n                                    >\r\n                                        Daily Hire\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => setPricingMode('full')}\r\n                                        className={`px-3 py-1 rounded-md text-sm font-medium transition-all ${pricingMode === 'full' ? 'bg-white shadow text-black' : 'text-gray-500 hover:text-black'}`}\r\n                                    >\r\n                                        Full Event Pkg\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div className=\"flex items-center gap-2 text-gray-500 text-sm\">\r\n                                <div>\r\n                                    <span className=\"font-semibold text-gray-700\">\r\n                                        {pricingMode === 'full' && eventDates && eventDates.start ? (\r\n                                            <>\r\n                                                {new Date(eventDates.start).toLocaleDateString()} - {new Date(eventDates.end).toLocaleDateString()}\r\n                                                <span className=\"ml-1 text-xs text-primary bg-primary/10 px-1 rounded\">Event Dates</span>\r\n                                            </>\r\n                                        ) : (\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <input\r\n                                                    type=\"date\"\r\n                                                    className=\"p-1 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-primary outline-none\"\r\n                                                    value={hireDates.start || ''}\r\n                                                    min={eventDates?.start ? new Date(eventDates.start).toISOString().split('T')[0] : undefined}\r\n                                                    max={eventDates?.end ? new Date(eventDates.end).toISOString().split('T')[0] : undefined}\r\n                                                    onChange={e => setHireDates ? setHireDates({ ...hireDates, start: e.target.value }) : null}\r\n                                                />\r\n                                                <span>to</span>\r\n                                                <input\r\n                                                    type=\"date\"\r\n                                                    className=\"p-1 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-primary outline-none\"\r\n                                                    value={hireDates.end || ''}\r\n                                                    min={eventDates?.start ? new Date(eventDates.start).toISOString().split('T')[0] : undefined}\r\n                                                    max={eventDates?.end ? new Date(eventDates.end).toISOString().split('T')[0] : undefined}\r\n                                                    onChange={e => setHireDates ? setHireDates({ ...hireDates, end: e.target.value }) : null}\r\n                                                />\r\n                                            </div>\r\n                                        )}\r\n                                    </span>\r\n                                </div>\r\n                                <span>|</span>\r\n                                <div className=\"font-medium text-primary bg-primary/5 px-2 py-0.5 rounded\">\r\n                                    {label} {detail} = <span className=\"font-bold text-xl text-black\">${total}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\">\r\n                        <X size={24} className=\"text-gray-500\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"flex-1 overflow-y-auto p-6 bg-gray-50\">\r\n                    {loading ? (\r\n                        <div className=\"flex justify-center py-20 text-gray-500\">Checking availability...</div>\r\n                    ) : error ? (\r\n                        <div className=\"text-red-500 text-center py-10\">{error}</div>\r\n                    ) : availableItems.length === 0 || availableItems[0].available_count <= 0 ? (\r\n                        <div className=\"text-center py-20\">\r\n                            <p className=\"text-xl font-bold text-gray-400 mb-2\">Unavailable</p>\r\n                            <p className=\"text-gray-500\">No stock available for the selected dates.</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"text-center py-10\">\r\n                            <div className=\"mb-8\">\r\n                                <h3 className=\"text-2xl font-bold text-gray-800 mb-2\">{asset.name}</h3>\r\n                                <p className=\"text-gray-600\">\r\n                                    <span className=\"font-bold text-green-600\">{availableItems[0].available_count}</span> available for your dates.\r\n                                </p>\r\n                            </div>\r\n\r\n                            <div className=\"flex justify-center gap-4\">\r\n                                <button\r\n                                    onClick={() => handleSelect(availableItems[0])} // Pass the \"virtual\" item (contains typeId)\r\n                                    className=\"bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105\"\r\n                                >\r\n                                    Add to Cart for ${total}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default AssetSelectionModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\components\\AttendeeModal.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  55 |                 }\n  56 |             });\n> 57 |             setDetails(initial);\n     |             ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  58 |         }\n  59 |         // eslint-disable-next-line\n  60 |     }, [cart, user]); // Run once when cart changes","line":57,"column":13,"nodeType":null,"endLine":57,"endColumn":23}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'details'. Either include it or remove the dependency array.","line":60,"column":8,"nodeType":"ArrayExpression","endLine":60,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [cart, details, user]","fix":{"range":[2048,2060],"text":"[cart, details, user]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useNotification } from '../context/NotificationContext';\r\nimport { formatDateForDisplay } from '../utils/dateHelpers';\r\n\r\n/**\r\n * Reusable Modal for collecting Attendee Details (Pilots, Crew, etc.)\r\n * \r\n * Props:\r\n * - show: boolean\r\n * - onClose: function\r\n * - onConfirm: function(attendeeDetailsMap)\r\n * - tickets: Array of ticket definitions [{ ticket_type_id, name, is_pilot, ... }]\r\n * - cart: Object { ticket_type_id: quantity } defining the slots\r\n * - initialDetails: Object (optional)\r\n * - user: Object (currentUser)\r\n * - myPilots: Array (optional, list of previous pilots)\r\n * - event: Object (optional, for MOP/rules)\r\n */\r\nfunction AttendeeModal({\r\n    show,\r\n    onClose,\r\n    onConfirm,\r\n    tickets,\r\n    cart,\r\n    initialDetails = {},\r\n    user,\r\n    myPilots = [],\r\n    event,\r\n    confirmLabel = \"Confirm\"\r\n}) {\r\n\r\n\r\n    const { notify } = useNotification();\r\n    const [details, setDetails] = useState(initialDetails);\r\n    const [productsMap, setProductsMap] = useState({}); // Cache for product details\r\n\r\n    // Initialize slots if empty\r\n    useEffect(() => {\r\n        if (Object.keys(details).length === 0 && Object.keys(cart).length > 0) {\r\n            const initial = {};\r\n            Object.entries(cart).forEach(([ticketId, qty]) => {\r\n                for (let i = 0; i < qty; i++) {\r\n                    const tempId = Math.random().toString(36).substr(2, 9);\r\n                    initial[`${ticketId}_${i}`] = {\r\n                        firstName: '',\r\n                        lastName: '',\r\n                        email: user?.email || '',\r\n                        phoneNumber: user?.phone || '',\r\n                        country: 'Australia',\r\n                        state: '',\r\n                        tempId: tempId,\r\n                        arrivalDate: '',\r\n                        departureDate: ''\r\n                    };\r\n                }\r\n            });\r\n            setDetails(initial);\r\n        }\r\n        // eslint-disable-next-line\r\n    }, [cart, user]); // Run once when cart changes\r\n\r\n    // Fetch Linked Products\r\n    useEffect(() => {\r\n        const fetchLinkedProducts = async () => {\r\n            const neededIds = new Set();\r\n            tickets.forEach(t => {\r\n                if (t.includes_merch && t.linkedProductIds && Array.isArray(t.linkedProductIds)) {\r\n                    t.linkedProductIds.forEach(pid => neededIds.add(pid));\r\n                }\r\n            });\r\n\r\n            const newIds = [...neededIds].filter(id => !productsMap[id]);\r\n            if (newIds.length === 0) return;\r\n\r\n            const newProducts = {};\r\n            await Promise.all(newIds.map(async (id) => {\r\n                try {\r\n                    const res = await fetch(`/api/products/${id}`);\r\n                    if (res.ok) {\r\n                        const data = await res.json();\r\n                        newProducts[id] = data;\r\n                    }\r\n                } catch (err) {\r\n                    console.error(\"Failed to load product\", id, err);\r\n                }\r\n            }));\r\n\r\n            if (Object.keys(newProducts).length > 0) {\r\n                setProductsMap(prev => ({ ...prev, ...newProducts }));\r\n            }\r\n        };\r\n        fetchLinkedProducts();\r\n    }, [tickets, productsMap]);\r\n\r\n    const handleChange = (key, field, value) => {\r\n        setDetails(prev => ({\r\n            ...prev,\r\n            [key]: { ...prev[key], [field]: value }\r\n        }));\r\n    };\r\n\r\n    const handleUpload = async (file) => {\r\n        const formData = new FormData();\r\n        formData.append('file', file);\r\n        const res = await fetch('/api/upload', { method: 'POST', body: formData });\r\n        if (!res.ok) throw new Error('Upload failed');\r\n        const data = await res.json();\r\n        return data.url;\r\n    };\r\n\r\n    // Plane Actions\r\n    const updatePlane = (key, index, field, value) => {\r\n        setDetails(prev => {\r\n            const currentPlanes = prev[key]?.planes || [{ isHeavy: true }];\r\n            const newPlanes = [...currentPlanes];\r\n            if (!newPlanes[index]) newPlanes[index] = {};\r\n            newPlanes[index] = { ...newPlanes[index], [field]: value };\r\n            return {\r\n                ...prev,\r\n                [key]: { ...prev[key], planes: newPlanes }\r\n            };\r\n        });\r\n    };\r\n\r\n    const addPlane = (key) => {\r\n        setDetails(prev => {\r\n            const currentPlanes = prev[key]?.planes || [];\r\n            return {\r\n                ...prev,\r\n                [key]: {\r\n                    ...prev[key],\r\n                    planes: [...currentPlanes, { make: '', model: '', rego: '', isHeavy: true }]\r\n                }\r\n            };\r\n        });\r\n    };\r\n\r\n    const removePlane = (key, index) => {\r\n        setDetails(prev => {\r\n            const currentPlanes = prev[key]?.planes || [];\r\n            const newPlanes = currentPlanes.filter((_, i) => i !== index);\r\n            return {\r\n                ...prev,\r\n                [key]: { ...prev[key], planes: newPlanes }\r\n            };\r\n        });\r\n    };\r\n\r\n    // Validation & Submit\r\n    const handleSubmit = () => {\r\n        // Validate\r\n        for (const [ticketTypeId, quantity] of Object.entries(cart)) {\r\n            const ticket = tickets.find(t => (t.ticket_type_id || t.id) === parseInt(ticketTypeId));\r\n\r\n            for (let i = 0; i < quantity; i++) {\r\n                const key = `${ticketTypeId}_${i}`;\r\n                const d = details[key] || {};\r\n                const label = d.firstName ? `${d.firstName} ${d.lastName}` : `Attendee #${i + 1}`;\r\n\r\n                // Common Mandatory Fields for ALL Tickets\r\n                const requiredFields = [\r\n                    { field: 'firstName', name: 'First Name' },\r\n                    { field: 'lastName', name: 'Last Name' },\r\n                    { field: 'dateOfBirth', name: 'Date of Birth' },\r\n                    { field: 'address', name: 'Address' },\r\n                    { field: 'city', name: 'City' },\r\n                    { field: 'state', name: 'State' },\r\n                    { field: 'postcode', name: 'Postcode' },\r\n                    { field: 'country', name: 'Country' },\r\n                    { field: 'emergencyName', name: 'Emergency Contact Name' },\r\n                    { field: 'emergencyPhone', name: 'Emergency Contact Phone' },\r\n                    { field: 'phoneNumber', name: 'Phone Number' },\r\n                    { field: 'arrivalDate', name: 'Arrival Date' },\r\n                    { field: 'departureDate', name: 'Departure Date' }\r\n                ];\r\n\r\n                for (const req of requiredFields) {\r\n                    if (!d[req.field] || !d[req.field].trim()) {\r\n                        notify(`${label}: Please enter ${req.name}.`, \"error\");\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                // Date Range Validation (Strict)\r\n                if (event && event.eventStartDate && event.eventEndDate) {\r\n                    const eventStart = event.eventStartDate.split('T')[0];\r\n                    const eventEnd = event.eventEndDate.split('T')[0];\r\n\r\n                    if (d.arrivalDate < eventStart) {\r\n                        notify(`${label}: Arrival date cannot be before ${formatDateForDisplay(event.eventStartDate)}`, \"error\");\r\n                        return;\r\n                    }\r\n                    if (d.departureDate > eventEnd) {\r\n                        notify(`${label}: Departure date cannot be after ${formatDateForDisplay(event.eventEndDate)}`, \"error\");\r\n                        return;\r\n                    }\r\n                    if (d.arrivalDate > d.departureDate) {\r\n                        notify(`${label}: Arrival date cannot be after Departure date.`, \"error\");\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                // Email Validation\r\n                const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n                if (!emailRegex.test(d.email)) {\r\n                    notify(`${label}: Please enter a valid Email Address.`, \"error\");\r\n                    return;\r\n                }\r\n\r\n                // DOB Validation (Future Date Check)\r\n                const dobDate = new Date(d.dateOfBirth);\r\n                const today = new Date();\r\n                if (dobDate > today) {\r\n                    notify(`${label}: Date of Birth cannot be in the future.`, \"error\");\r\n                    return;\r\n                }\r\n\r\n                // Merch Check\r\n                if (ticket.includes_merch) {\r\n                    if (!d.merchSkuId) {\r\n                        notify(`${label}: Please select your included Merchandise option.`, \"error\");\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                // Pilot Specific Validation\r\n                if (['pilot', 'junior_pilot'].includes(ticket?.system_role)) {\r\n                    if (!d.hasReadMop) {\r\n                        notify(`${label}: You must read and agree to the pilot declaration.`, \"error\");\r\n                        return;\r\n                    }\r\n\r\n                    if (!d.licenseNumber || !d.licenseNumber.trim()) {\r\n                        notify(`${label}: Please enter AUS Number.`, \"error\");\r\n                        return;\r\n                    }\r\n\r\n                    if (d.bringingHeavyModels && !d.isHeavyModelInspector) {\r\n                        const planes = d.planes || [{}];\r\n                        for (const p of planes) {\r\n                            if (!p.heavyCertNumber) {\r\n                                notify(`${label}: Heavy Model requires a Certificate Number.`, \"error\");\r\n                                return;\r\n                            }\r\n                            if (!p.heavyCertFile) {\r\n                                notify(`${label}: Heavy Model requires a Certificate File Upload.`, \"error\");\r\n                                return;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Pit Crew Specific Validation\r\n                if (ticket?.system_role === 'pit_crew') {\r\n                    if (d.pilotEntryMode === 'manual') {\r\n                        if (!d.pilotName || !d.pilotName.trim()) {\r\n                            notify(`${label}: Please enter Pilot Name.`, \"error\");\r\n                            return;\r\n                        }\r\n                    } else {\r\n                        if (!d.linkedPilotAttendeeId && !d.linkedPilotTempId) {\r\n                            notify(`${label}: Please select a Pilot to crew for.`, \"error\");\r\n                            return;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        onConfirm(details);\r\n    };\r\n\r\n    // Reusable styles\r\n    const inputStyle = { width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px' };\r\n\r\n    if (!show) return null;\r\n\r\n    return (\r\n        <div className=\"modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n            <div className=\"modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6\">\r\n                <div className=\"flex justify-between items-center mb-4\">\r\n                    <h2 className=\"text-2xl font-bold\">Attendee Details</h2>\r\n                    <button onClick={onClose} className=\"text-gray-500 hover:text-gray-700 text-2xl\">&times;</button>\r\n                </div>\r\n\r\n                {Object.entries(cart).map(([ticketId, qty]) => {\r\n                    const ticket = tickets.find(t => (t.ticket_type_id || t.id) === parseInt(ticketId));\r\n                    const ticketName = ticket?.name;\r\n\r\n                    return Array.from({ length: qty }).map((_, idx) => {\r\n                        const key = `${ticketId}_${idx}`;\r\n                        const data = details[key] || {};\r\n\r\n                        return (\r\n                            <div key={key} className=\"mb-6 p-4 bg-gray-50 rounded border border-gray-100\">\r\n                                <h4 className=\"font-bold mb-3 border-b pb-2\">{ticketName} #{idx + 1}</h4>\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n                                    <input\r\n                                        placeholder=\"First Name\"\r\n                                        value={data.firstName || ''}\r\n                                        onChange={e => handleChange(key, 'firstName', e.target.value)}\r\n                                        style={inputStyle}\r\n                                    />\r\n                                    <input\r\n                                        placeholder=\"Last Name\"\r\n                                        value={data.lastName || ''}\r\n                                        onChange={e => handleChange(key, 'lastName', e.target.value)}\r\n                                        style={inputStyle}\r\n                                    />\r\n\r\n                                    <input\r\n                                        type=\"date\"\r\n                                        placeholder=\"Date of Birth\"\r\n                                        title=\"Date of Birth\"\r\n                                        value={data.dateOfBirth || ''}\r\n                                        onChange={e => handleChange(key, 'dateOfBirth', e.target.value)}\r\n                                        style={inputStyle}\r\n                                    />\r\n                                </div>\r\n                                <input\r\n                                    type=\"email\" placeholder=\"Email\"\r\n                                    value={data.email || ''}\r\n                                    onChange={e => handleChange(key, 'email', e.target.value)}\r\n                                    style={inputStyle}\r\n                                />\r\n                                <input\r\n                                    type=\"tel\" placeholder=\"Phone Number\"\r\n                                    value={data.phoneNumber || ''}\r\n                                    onChange={e => handleChange(key, 'phoneNumber', e.target.value)}\r\n                                    style={inputStyle}\r\n                                />\r\n\r\n\r\n                                <h5 className=\"font-bold text-sm mb-2 mt-4 text-gray-700\">Address & Contact</h5>\r\n                                <div className=\"mb-4 space-y-3\">\r\n                                    <input\r\n                                        placeholder=\"Address Line 1\"\r\n                                        value={data.address || ''}\r\n                                        onChange={e => handleChange(key, 'address', e.target.value)}\r\n                                        style={inputStyle}\r\n                                    />\r\n                                    <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\r\n                                        <input placeholder=\"City\" value={data.city || ''} onChange={e => handleChange(key, 'city', e.target.value)} style={inputStyle} />\r\n\r\n                                        {/* State Dropdown with Custom Input */}\r\n                                        <div className=\"relative\">\r\n                                            <input\r\n                                                list={`states-${key}`}\r\n                                                placeholder=\"State\"\r\n                                                value={data.state || ''}\r\n                                                onChange={e => handleChange(key, 'state', e.target.value)}\r\n                                                style={inputStyle}\r\n                                            />\r\n                                            <datalist id={`states-${key}`}>\r\n                                                {['ACT', 'NSW', 'NT', 'QLD', 'SA', 'TAS', 'VIC', 'WA'].map(s => (\r\n                                                    <option key={s} value={s} />\r\n                                                ))}\r\n                                            </datalist>\r\n                                        </div>\r\n\r\n                                        <input placeholder=\"Postcode\" value={data.postcode || ''} onChange={e => handleChange(key, 'postcode', e.target.value)} style={inputStyle} />\r\n                                    </div>\r\n                                    <div className=\"mb-2\">\r\n                                        <input placeholder=\"Country\" value={data.country || 'Australia'} onChange={e => handleChange(key, 'country', e.target.value)} style={inputStyle} />\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\r\n                                        <input placeholder=\"Emergency Contact Name\" value={data.emergencyName || ''} onChange={e => handleChange(key, 'emergencyName', e.target.value)} style={inputStyle} />\r\n                                        <input placeholder=\"Emergency Phone\" value={data.emergencyPhone || ''} onChange={e => handleChange(key, 'emergencyPhone', e.target.value)} style={inputStyle} />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <h5 className=\"font-bold text-sm mb-2 mt-4 text-gray-700\">Attendance Dates</h5>\r\n                                <div className=\"grid grid-cols-2 gap-4 mb-4\">\r\n                                    <div>\r\n                                        <label className=\"text-xs text-gray-500\">Arrival Date</label>\r\n                                        <input\r\n                                            type=\"date\"\r\n                                            value={data.arrivalDate || ''}\r\n                                            min={event?.eventStartDate ? event.eventStartDate.split('T')[0] : undefined}\r\n                                            max={event?.eventEndDate ? event.eventEndDate.split('T')[0] : undefined}\r\n                                            onChange={e => handleChange(key, 'arrivalDate', e.target.value)}\r\n                                            style={inputStyle}\r\n                                        />\r\n                                    </div>\r\n                                    <div>\r\n                                        <label className=\"text-xs text-gray-500\">Departure Date</label>\r\n                                        <input\r\n                                            type=\"date\"\r\n                                            value={data.departureDate || ''}\r\n                                            min={event?.eventStartDate ? event.eventStartDate.split('T')[0] : undefined}\r\n                                            max={event?.eventEndDate ? event.eventEndDate.split('T')[0] : undefined}\r\n                                            onChange={e => handleChange(key, 'departureDate', e.target.value)}\r\n                                            style={inputStyle}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Day Pass Price Preview */}\r\n                                {(() => {\r\n                                    if (!ticket.is_day_pass || !data.arrivalDate || !data.departureDate) {\r\n                                        return null;\r\n                                    }\r\n\r\n                                    const arrival = new Date(data.arrivalDate);\r\n                                    const departure = new Date(data.departureDate);\r\n                                    const dayCount = Math.ceil((departure - arrival) / (1000 * 60 * 60 * 24)) + 1;\r\n                                    const totalPrice = ticket.price * dayCount;\r\n\r\n                                    return (\r\n                                        <div className=\"mb-4 p-3 bg-green-50 border border-green-200 rounded\">\r\n                                            <h5 className=\"font-bold text-sm mb-1 text-green-900\">üí∞ Day Pass Pricing</h5>\r\n                                            <div className=\"text-sm text-green-800\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <span className=\"font-medium\">{dayCount} {dayCount === 1 ? 'day' : 'days'}</span>\r\n                                                    <span>√ó</span>\r\n                                                    <span className=\"font-medium\">${Number(ticket.price).toFixed(2)}/day</span>\r\n                                                    <span>=</span>\r\n                                                    <span className=\"font-bold text-green-900 text-base\">${totalPrice.toFixed(2)}</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                })()}\r\n\r\n\r\n                                {event?.dinner_date && !ticket.is_day_pass && (\r\n                                    <div className=\"mb-4 p-3 bg-indigo-50 border border-indigo-100 rounded\">\r\n                                        <h5 className=\"font-bold text-sm mb-2 text-indigo-900\">üçΩÔ∏è Official Dinner</h5>\r\n                                        <label className=\"flex items-center gap-2 cursor-pointer text-indigo-900 font-medium\">\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                checked={data.attendingDinner || false}\r\n                                                onChange={e => handleChange(key, 'attendingDinner', e.target.checked)}\r\n                                            />\r\n                                            I will be attending (tick if yes) - Official Dinner on {new Date(event.dinner_date).toLocaleDateString('en-GB', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })} (free with this ticket)\r\n                                        </label>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {!ticket.is_day_pass && data.attendingDinner && (\r\n                                    <div className=\"mb-4\">\r\n                                        <h5 className=\"font-bold text-sm mb-2 text-gray-700\">Dietary Requirements</h5>\r\n                                        <textarea\r\n                                            placeholder=\"e.g. Vegetarian, Gluten Free, Nut Allergy...\"\r\n                                            value={data.dietaryRequirements || ''}\r\n                                            onChange={e => handleChange(key, 'dietaryRequirements', e.target.value)}\r\n                                            style={{ ...inputStyle, height: '80px' }}\r\n                                        />\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Included Merchandise Selection */}\r\n                                {(() => {\r\n                                    if (ticket.includes_merch && ticket.linkedProductIds && ticket.linkedProductIds.length > 0) {\r\n                                        const linkedProducts = ticket.linkedProductIds\r\n                                            .map(pid => productsMap[pid])\r\n                                            .filter(p => p && p.product);\r\n\r\n                                        if (linkedProducts.length === 0) return null;\r\n\r\n                                        const selectedPid = data.selectedProductId || (linkedProducts.length === 1 ? linkedProducts[0].product.product_id : null);\r\n\r\n                                        // Auto-select single option logic for render\r\n                                        // Ideally we sync state, but for display we assume if 1, it's that one.\r\n\r\n                                        return (\r\n                                            <div className=\"mb-6 p-4 bg-purple-50 border border-purple-200 rounded\">\r\n                                                <h5 className=\"font-bold text-sm mb-2 text-purple-900\">üéÅ Included Merchandise (free with this ticket)</h5>\r\n\r\n                                                {/* Product Selection (Radio) */}\r\n                                                {linkedProducts.length > 1 && (\r\n                                                    <div style={{ marginBottom: '0.75rem' }}>\r\n                                                        <p style={{ fontSize: '0.85rem', fontWeight: 'bold', marginBottom: '0.25rem', color: '#4a148c' }}>Select Item:</p>\r\n                                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\r\n                                                            {linkedProducts.map(p => (\r\n                                                                <label key={p.product.product_id} style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer', fontSize: '0.9rem' }}>\r\n                                                                    <input\r\n                                                                        type=\"radio\"\r\n                                                                        name={`merch_prod_${key}`}\r\n                                                                        checked={selectedPid === p.product.product_id}\r\n                                                                        onChange={() => {\r\n                                                                            handleChange(key, 'selectedProductId', p.product.product_id);\r\n                                                                            handleChange(key, 'merchSkuId', '');\r\n                                                                        }}\r\n                                                                    />\r\n                                                                    <span style={{ fontWeight: selectedPid === p.product.product_id ? 'bold' : 'normal' }}>\r\n                                                                        {p.product.name}\r\n                                                                    </span>\r\n                                                                </label>\r\n                                                            ))}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                )}\r\n\r\n                                                {/* SKU Selection */}\r\n                                                {selectedPid && productsMap[selectedPid] && (\r\n                                                    <div>\r\n                                                        {linkedProducts.length === 1 && (\r\n                                                            <p className=\"text-xs text-purple-700 mb-2\">Included Item: <strong>{productsMap[selectedPid].product.name}</strong></p>\r\n                                                        )}\r\n                                                        <p className=\"text-xs text-purple-700 mb-1\">Select Option:</p>\r\n                                                        <select\r\n                                                            style={inputStyle}\r\n                                                            value={data.merchSkuId || ''}\r\n                                                            onChange={e => {\r\n                                                                if (!data.selectedProductId && linkedProducts.length === 1) {\r\n                                                                    handleChange(key, 'selectedProductId', selectedPid);\r\n                                                                }\r\n                                                                handleChange(key, 'merchSkuId', e.target.value);\r\n                                                            }}\r\n                                                        >\r\n                                                            <option value=\"\">-- Select Option --</option>\r\n                                                            {productsMap[selectedPid].skus\r\n                                                                .filter(sku => sku.active)\r\n                                                                .map(sku => (\r\n                                                                    <option key={sku.id} value={sku.id}>\r\n                                                                        {sku.description || sku.code}\r\n                                                                    </option>\r\n                                                                ))}\r\n                                                        </select>\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        );\r\n                                    }\r\n                                    return null;\r\n                                })()}\r\n\r\n                                {/* Pilot Fields */}\r\n                                {\r\n                                    ['pilot', 'junior_pilot'].includes(ticket?.system_role) && (\r\n                                        <div className=\"mt-4 p-4 bg-white border border-gray-200 rounded\">\r\n                                            <h5 className=\"font-bold mb-2\">‚úàÔ∏è Pilot & Aircraft Registration</h5>\r\n\r\n                                            {/* MOP */}\r\n                                            <div className=\"mb-4 p-3 bg-blue-50 border border-blue-100 rounded text-sm\">\r\n                                                <p className=\"mb-2 text-blue-800\">\r\n                                                    Please read the Agreement.\r\n                                                    {event && event.mop_url ? (\r\n                                                        <a href={event.mop_url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"underline ml-1 font-bold\">\r\n                                                            Read Pilot Declaration\r\n                                                        </a>\r\n                                                    ) : null}\r\n                                                </p>\r\n                                                <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                                    <input\r\n                                                        type=\"checkbox\"\r\n                                                        checked={data.hasReadMop || false}\r\n                                                        onChange={e => handleChange(key, 'hasReadMop', e.target.checked)}\r\n                                                    />\r\n                                                    <span className=\"font-medium\">I have read and agree to the pilot declaration</span>\r\n                                                </label>\r\n                                            </div>\r\n\r\n                                            <input\r\n                                                placeholder=\"AUS Number\"\r\n                                                value={data.licenseNumber || ''}\r\n                                                onChange={e => handleChange(key, 'licenseNumber', e.target.value)}\r\n                                                style={{ ...inputStyle, marginBottom: '1rem' }}\r\n                                            />\r\n\r\n                                            {/* Flight Line Duties (New) */}\r\n                                            {/* Flight Line Duties - ONLY FOR PILOTS, NOT JUNIOR PILOTS */}\r\n                                            {/* For Day Pass: only show if duration >= 3 days. For regular tickets: always show. */}\r\n                                            {ticket.system_role === 'pilot' && (() => {\r\n                                                // Calculate duration if dates are set\r\n                                                let showFlightLine = true;\r\n                                                if (ticket.is_day_pass && data.arrivalDate && data.departureDate) {\r\n                                                    const arrival = new Date(data.arrivalDate);\r\n                                                    const departure = new Date(data.departureDate);\r\n                                                    const daysDiff = Math.ceil((departure - arrival) / (1000 * 60 * 60 * 24)) + 1; // +1 for inclusive\r\n                                                    showFlightLine = daysDiff >= 3;\r\n                                                }\r\n\r\n                                                if (!showFlightLine) return null;\r\n\r\n                                                return (\r\n                                                    <div className=\"mb-4\">\r\n                                                        <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                                            <input\r\n                                                                type=\"checkbox\"\r\n                                                                checked={data.flightLineDuties || false}\r\n                                                                onChange={e => handleChange(key, 'flightLineDuties', e.target.checked)}\r\n                                                            />\r\n                                                            <div>\r\n                                                                <span className=\"font-medium text-sm\">I agree to perform flight line duties</span>\r\n                                                                {ticket.price_no_flight_line && !ticket.is_day_pass && (\r\n                                                                    <div className=\"text-xs mt-1\">\r\n                                                                        {data.flightLineDuties ? (\r\n                                                                            <span className=\"text-green-600 font-bold\">Price: ${Number(ticket.price).toFixed(2)} (Standard)</span>\r\n                                                                        ) : (\r\n                                                                            <span className=\"text-amber-600 font-bold\">Price: ${Number(ticket.price_no_flight_line).toFixed(2)} (No Duties Surcharge)</span>\r\n                                                                        )}\r\n                                                                    </div>\r\n                                                                )}\r\n                                                                {ticket.is_day_pass && (\r\n                                                                    <div className=\"text-xs mt-1 text-gray-600\">\r\n                                                                        Day Pass tickets have fixed per-day pricing regardless of flight line duty selection.\r\n                                                                    </div>\r\n                                                                )}\r\n                                                            </div>\r\n                                                        </label>\r\n                                                    </div>\r\n                                                );\r\n                                            })()}\r\n\r\n                                            {/* Heavy Models Toggle */}\r\n                                            <div className=\"mb-4 space-y-3\">\r\n                                                {/* Are you bringing heavy models? */}\r\n                                                <div className=\"p-3 bg-yellow-50 border border-yellow-200 rounded text-sm\">\r\n                                                    <label className=\"flex items-center gap-2 cursor-pointer font-bold text-gray-800\">\r\n                                                        <input\r\n                                                            type=\"checkbox\"\r\n                                                            checked={data.bringingHeavyModels || false}\r\n                                                            onChange={e => {\r\n                                                                const newVal = e.target.checked;\r\n                                                                handleChange(key, 'bringingHeavyModels', newVal);\r\n                                                                if (newVal) {\r\n                                                                    handleChange(key, 'isHeavyModelInspector', false); // Mutually exclusive UI flow usually\r\n                                                                }\r\n                                                            }}\r\n                                                        />\r\n                                                        I am bringing Heavy Models\r\n                                                    </label>\r\n                                                </div>\r\n\r\n                                                {/* Are you a heavy model inspector? */}\r\n                                                <div className=\"p-3 bg-blue-50 border border-blue-200 rounded text-sm\">\r\n                                                    <label className=\"block text-xs font-bold text-blue-900 mb-1\">Are you a Heavy Model Inspector?</label>\r\n                                                    <select\r\n                                                        style={inputStyle}\r\n                                                        value={data.isHeavyModelInspector ? \"Yes\" : \"No\"}\r\n                                                        onChange={e => {\r\n                                                            const isInspector = e.target.value === \"Yes\";\r\n                                                            handleChange(key, 'isHeavyModelInspector', isInspector);\r\n                                                            // Logic Update: We longer uncheck bringingHeavyModels here.\r\n                                                            // The UI below simply hides the plane list if inspector is true.\r\n                                                        }}\r\n                                                    >\r\n                                                        <option value=\"No\">No</option>\r\n                                                        <option value=\"Yes\">Yes</option>\r\n                                                    </select>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {/* Aircraft List - Only if Bringing Heavy Models AND Not Inspector (Logic implies hidden if Inspector) */}\r\n                                            {data.bringingHeavyModels && !data.isHeavyModelInspector && (\r\n                                                <div>\r\n                                                    <h6 className=\"font-bold text-sm mb-2\">Heavy Aircraft List</h6>\r\n                                                    {(data.planes || [{}]).map((plane, pIdx) => (\r\n                                                        <div key={pIdx} className=\"mb-4 pb-4 border-b border-gray-100 last:border-0\">\r\n                                                            <div className=\"grid grid-cols-3 gap-2 mb-2\">\r\n                                                                <input placeholder=\"Make\" value={plane.make || ''} onChange={e => updatePlane(key, pIdx, 'make', e.target.value)} style={inputStyle} />\r\n                                                                <input placeholder=\"Model\" value={plane.model || ''} onChange={e => updatePlane(key, pIdx, 'model', e.target.value)} style={inputStyle} />\r\n                                                                <input placeholder=\"Rego\" value={plane.rego || ''} onChange={e => updatePlane(key, pIdx, 'rego', e.target.value)} style={inputStyle} />\r\n                                                            </div>\r\n\r\n                                                            {/* Forced Heavy Fields */}\r\n                                                            <div className=\"p-3 bg-gray-50 border border-gray-200 rounded text-sm\">\r\n                                                                <div className=\"mb-2\">\r\n                                                                    <label className=\"block text-xs font-bold mb-1\">Heavy Model Cert #</label>\r\n                                                                    <input placeholder=\"Cert #\" value={plane.heavyCertNumber || ''} onChange={e => updatePlane(key, pIdx, 'heavyCertNumber', e.target.value)} style={inputStyle} />\r\n                                                                </div>\r\n                                                                <div>\r\n                                                                    <label className=\"block text-xs font-bold mb-1\">Upload Certificate</label>\r\n                                                                    {plane.heavyCertFile ? (\r\n                                                                        <div className=\"text-green-600\">‚úì Uploaded <span className=\"text-red-500 cursor-pointer ml-2 hover:underline\" onClick={() => updatePlane(key, pIdx, 'heavyCertFile', null)}>Remove</span></div>\r\n                                                                    ) : (\r\n                                                                        <input type=\"file\" onChange={e => {\r\n                                                                            if (e.target.files?.[0]) handleUpload(e.target.files[0]).then(url => updatePlane(key, pIdx, 'heavyCertFile', url));\r\n                                                                        }} />\r\n                                                                    )}\r\n                                                                </div>\r\n                                                            </div>\r\n\r\n                                                            {(data.planes || []).length > 1 && (\r\n                                                                <button onClick={() => removePlane(key, pIdx)} className=\"text-red-500 text-xs underline mt-1\">Remove Plane</button>\r\n                                                            )}\r\n                                                        </div>\r\n                                                    ))}\r\n                                                    <button onClick={() => addPlane(key)} className=\"text-primary text-sm font-bold\">+ Add Aircraft</button>\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    )\r\n                                }\r\n\r\n                                {\r\n                                    ticket?.system_role === 'pit_crew' && (\r\n                                        <div className=\"mt-4 p-4 bg-white border border-gray-200 rounded\">\r\n                                            <h5 className=\"font-bold mb-2\">üèÅ Pit Crew Registration</h5>\r\n\r\n                                            {/* AUS Number & Flight Line Duties */}\r\n                                            <div className=\"mb-4\">\r\n                                                <label className=\"block text-sm font-bold text-gray-700 mb-1\">AUS Number (Optional)</label>\r\n                                                <input\r\n                                                    placeholder=\"AUS Number\"\r\n                                                    value={data.licenseNumber || ''}\r\n                                                    onChange={e => handleChange(key, 'licenseNumber', e.target.value)}\r\n                                                    style={inputStyle}\r\n                                                />\r\n                                            </div>\r\n\r\n                                            {data.licenseNumber && data.licenseNumber.trim().length > 0 && (\r\n                                                <div className=\"mb-4 bg-green-50 p-3 rounded border border-green-100\">\r\n                                                    <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                                        <input\r\n                                                            type=\"checkbox\"\r\n                                                            checked={data.flightLineDuties || false}\r\n                                                            onChange={e => handleChange(key, 'flightLineDuties', e.target.checked)}\r\n                                                        />\r\n                                                        <div>\r\n                                                            <span className=\"font-medium text-sm text-green-900\">I agree to perform flight line duties</span>\r\n                                                            <div className=\"text-xs mt-1 text-green-700\">\r\n                                                                Thank you for volunteering! This helps us run a safe event.\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </label>\r\n                                                </div>\r\n                                            )}\r\n\r\n                                            <div className=\"border-t border-gray-100 my-4 pt-2\"></div>\r\n                                            <label className=\"block text-sm font-bold text-gray-700 mb-2\">Pilot Association</label>\r\n                                            <div className=\"flex gap-4 mb-3 text-sm\">\r\n                                                <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                                    <input\r\n                                                        type=\"radio\"\r\n                                                        name={`pilot_mode_${key}`}\r\n                                                        checked={data.pilotEntryMode !== 'manual'}\r\n                                                        onChange={() => {\r\n                                                            handleChange(key, 'pilotEntryMode', 'link');\r\n                                                            handleChange(key, 'pilotName', '');\r\n                                                        }}\r\n                                                    />\r\n                                                    Link to Registered Pilot\r\n                                                </label>\r\n                                                <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                                    <input\r\n                                                        type=\"radio\"\r\n                                                        name={`pilot_mode_${key}`}\r\n                                                        checked={data.pilotEntryMode === 'manual'}\r\n                                                        onChange={() => {\r\n                                                            handleChange(key, 'pilotEntryMode', 'manual');\r\n                                                            handleChange(key, 'linkedPilotAttendeeId', null);\r\n                                                            handleChange(key, 'linkedPilotTempId', null);\r\n                                                        }}\r\n                                                    />\r\n                                                    Enter Pilot Name Manually\r\n                                                </label>\r\n                                            </div>\r\n\r\n                                            {data.pilotEntryMode === 'manual' ? (\r\n                                                <div className=\"mb-4\">\r\n                                                    <label className=\"block text-sm font-bold text-gray-700 mb-1\">Pilot Name *</label>\r\n                                                    <input\r\n                                                        style={inputStyle}\r\n                                                        placeholder=\"Enter Pilot's Name\"\r\n                                                        value={data.pilotName || ''}\r\n                                                        onChange={e => handleChange(key, 'pilotName', e.target.value)}\r\n                                                    />\r\n                                                    <p className=\"text-xs text-gray-500 mt-1\">\r\n                                                        Enter the name of the pilot you are crewing for.\r\n                                                    </p>\r\n                                                </div>\r\n                                            ) : (\r\n                                                (() => {\r\n                                                    // Calculate available pilots (Existing + In Cart)\r\n                                                    // 1. Existing Pilots\r\n                                                    const existingPilots = myPilots.map(p => ({\r\n                                                        id: p.attendee_id,\r\n                                                        name: `${p.first_name} ${p.last_name}`,\r\n                                                        isNew: false\r\n                                                    }));\r\n\r\n                                                    // 2. Pilots in Cart\r\n                                                    const newPilots = [];\r\n                                                    Object.entries(cart).forEach(([tId, q]) => {\r\n                                                        const t = tickets.find(ticket => (ticket.ticket_type_id || ticket.id) === parseInt(tId));\r\n                                                        if (['pilot', 'junior_pilot'].includes(t?.system_role)) {\r\n                                                            for (let i = 0; i < q; i++) {\r\n                                                                const pKey = `${tId}_${i}`;\r\n                                                                const pDetails = details[pKey];\r\n                                                                if (pDetails) {\r\n                                                                    const pName = (pDetails.firstName || pDetails.lastName)\r\n                                                                        ? `${pDetails.firstName} ${pDetails.lastName}`.trim()\r\n                                                                        : `Pilot #${i + 1}`;\r\n                                                                    newPilots.push({\r\n                                                                        tempId: pDetails.tempId,\r\n                                                                        name: `${pName} (In Cart)`,\r\n                                                                        isNew: true\r\n                                                                    });\r\n                                                                }\r\n                                                            }\r\n                                                        }\r\n                                                    });\r\n\r\n                                                    const allPilots = [...existingPilots, ...newPilots];\r\n\r\n                                                    if (allPilots.length === 0) {\r\n                                                        return (\r\n                                                            <div className=\"p-3 bg-red-50 border border-red-200 text-red-700 rounded text-sm\">\r\n                                                                <strong>Warning:</strong> No registered pilots found.\r\n                                                                Please add a Pilot ticket to your cart or select \"Enter Pilot Name Manually\".\r\n                                                            </div>\r\n                                                        );\r\n                                                    }\r\n\r\n                                                    return (\r\n                                                        <div className=\"mb-4\">\r\n                                                            <label className=\"block text-sm font-bold text-gray-700 mb-1\">Select Pilot *</label>\r\n                                                            <select\r\n                                                                style={inputStyle}\r\n                                                                value={\r\n                                                                    data.linkedPilotTempId ? `new:${data.linkedPilotTempId}` :\r\n                                                                        data.linkedPilotAttendeeId ? `existing:${data.linkedPilotAttendeeId}` :\r\n                                                                            \"\"\r\n                                                                }\r\n                                                                onChange={e => {\r\n                                                                    const val = e.target.value;\r\n                                                                    if (!val) {\r\n                                                                        handleChange(key, 'linkedPilotAttendeeId', null);\r\n                                                                        handleChange(key, 'linkedPilotTempId', null);\r\n                                                                        return;\r\n                                                                    }\r\n                                                                    const [type, id] = val.split(':');\r\n                                                                    if (type === 'existing') {\r\n                                                                        handleChange(key, 'linkedPilotAttendeeId', parseInt(id));\r\n                                                                        handleChange(key, 'linkedPilotTempId', null);\r\n                                                                    } else {\r\n                                                                        handleChange(key, 'linkedPilotAttendeeId', null);\r\n                                                                        handleChange(key, 'linkedPilotTempId', id);\r\n                                                                    }\r\n                                                                }}\r\n                                                            >\r\n                                                                <option value=\"\">-- Select Pilot --</option>\r\n                                                                {allPilots.map(p => (\r\n                                                                    <option key={p.isNew ? `new:${p.tempId}` : `existing:${p.id}`} value={p.isNew ? `new:${p.tempId}` : `existing:${p.id}`}>\r\n                                                                        {p.name}\r\n                                                                    </option>\r\n                                                                ))}\r\n                                                            </select>\r\n                                                        </div>\r\n                                                    );\r\n                                                })()\r\n                                            )}\r\n                                        </div>\r\n                                    )\r\n                                }\r\n                            </div>\r\n                        );\r\n                    });\r\n                })}\r\n\r\n                <div className=\"mt-6 flex justify-end gap-3\">\r\n                    <button onClick={onClose} className=\"px-4 py-2 text-gray-600 hover:text-gray-800\">Cancel</button>\r\n                    <button onClick={handleSubmit} className=\"px-6 py-2 bg-primary text-white rounded font-bold hover:brightness-110\">{confirmLabel}</button>\r\n                </div>\r\n            </div>\r\n        </div >\r\n    );\r\n}\r\n\r\nexport default AttendeeModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\components\\CampingListView.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\components\\CampsiteModal.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  57 |     useEffect(() => {\n  58 |         if (campgrounds.length > 0 && !selectedCampgroundId) {\n> 59 |             setSelectedCampgroundId(campgrounds[0].campground_id);\n     |             ^^^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  60 |         }\n  61 |     }, [campgrounds, selectedCampgroundId]);\n  62 |","line":59,"column":13,"nodeType":null,"endLine":59,"endColumn":36},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  64 |     useEffect(() => {\n  65 |         if (selectedCampgroundId && startDate && endDate) {\n> 66 |             setLoading(true);\n     |             ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  67 |             fetch(`/api/campgrounds/${selectedCampgroundId}/sites?startDate=${startDate}&endDate=${endDate}`)\n  68 |                 .then(res => res.json())\n  69 |                 .then(data => {","line":66,"column":13,"nodeType":null,"endLine":66,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":250,"column":90,"nodeType":"Identifier","messageId":"unusedVar","endLine":250,"endColumn":91}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { X } from 'lucide-react';\r\n\r\nfunction CampsiteModal({ event, onClose, onAddToCart, orgSettings }) {\r\n    // DEBUG LOG\r\n    console.log('[Modal] Render', { cid: event?.event_id });\r\n\r\n    const [campgrounds, setCampgrounds] = useState([]);\r\n    const [selectedCampgroundId, setSelectedCampgroundId] = useState(null);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Selection Dates (Default to Event Dates)\r\n    // Adjust logic: If event start is in future, use it. \r\n    // Format YYYY-MM-DD\r\n    const formatDate = (dateStr) => {\r\n        if (!dateStr) return '';\r\n        const d = new Date(dateStr);\r\n        return d.toISOString().split('T')[0];\r\n    };\r\n\r\n    const [startDate, setStartDate] = useState(formatDate(event?.start_date));\r\n    const [endDate, setEndDate] = useState(formatDate(event?.end_date));\r\n    const [useFullEventPrice, setUseFullEventPrice] = useState(false);\r\n    const [adults, setAdults] = useState(1);\r\n    const [children, setChildren] = useState(0);\r\n\r\n    // Toggle Full Event Logic\r\n    const handleFullEventToggle = (checked) => {\r\n        setUseFullEventPrice(checked);\r\n        if (checked) {\r\n            setStartDate(formatDate(event?.start_date));\r\n            setEndDate(formatDate(event?.end_date));\r\n        }\r\n    };\r\n\r\n    // Data State\r\n    const [campground, setCampground] = useState(null);\r\n    const [sites, setSites] = useState([]);\r\n    const [selectedSites, setSelectedSites] = useState([]); // Array of site objects\r\n\r\n    // Fetch campgrounds for this event\r\n    useEffect(() => {\r\n        // Assuming we fetch all and filter, or fetch by event. \r\n        // Admin tool used /api/campgrounds. Let's stick to that for now or consistent with Admin.\r\n        // Ideally: /api/events/:id/campgrounds. \r\n        // Let's use the one that works: /api/campgrounds and filter.\r\n        fetch('/api/campgrounds')\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                const filtered = data.filter(c => c.event_id === event.event_id);\r\n                setCampgrounds(filtered);\r\n            })\r\n            .catch(err => console.error(err));\r\n    }, [event?.event_id]);\r\n\r\n    // Auto-select first campground if none selected\r\n    useEffect(() => {\r\n        if (campgrounds.length > 0 && !selectedCampgroundId) {\r\n            setSelectedCampgroundId(campgrounds[0].campground_id);\r\n        }\r\n    }, [campgrounds, selectedCampgroundId]);\r\n\r\n    // Fetch sites when campground or dates change\r\n    useEffect(() => {\r\n        if (selectedCampgroundId && startDate && endDate) {\r\n            setLoading(true);\r\n            fetch(`/api/campgrounds/${selectedCampgroundId}/sites?startDate=${startDate}&endDate=${endDate}`)\r\n                .then(res => res.json())\r\n                .then(data => {\r\n                    setCampground(data.campground);\r\n                    setSites(data.sites);\r\n                })\r\n                .catch(err => console.error(err))\r\n                .finally(() => setLoading(false));\r\n        }\r\n    }, [selectedCampgroundId, startDate, endDate]);\r\n\r\n    const toggleSiteSelection = (site) => {\r\n        if (site.is_booked) return;\r\n\r\n        setSelectedSites(prev => {\r\n            const exists = prev.find(s => s.campsite_id === site.campsite_id);\r\n            if (exists) {\r\n                return prev.filter(s => s.campsite_id !== site.campsite_id);\r\n            } else {\r\n                return [...prev, site];\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleConfirm = () => {\r\n        // Pass selected sites back to parent\r\n        // Attach the dates to the selection\r\n        const nights = Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24));\r\n        const extraAdults = Math.max(0, adults - 1);\r\n\r\n        const selection = selectedSites.map(s => {\r\n            // Calculate correct price for the item based on selection\r\n            let finalPrice = 0;\r\n            if (useFullEventPrice && s.full_event_price) {\r\n                finalPrice = s.full_event_price + (extraAdults * (s.extra_adult_full_event_price || 0));\r\n            } else {\r\n                finalPrice = (s.price_per_night * nights) + (extraAdults * (s.extra_adult_price_per_night || 0) * nights);\r\n            }\r\n\r\n            return {\r\n                ...s,\r\n                checkIn: startDate,\r\n                checkOut: endDate,\r\n                campgroundName: campground?.name,\r\n                price: finalPrice,\r\n                adults: adults,\r\n                children: children\r\n            };\r\n        });\r\n        onAddToCart(selection);\r\n        onClose();\r\n    };\r\n\r\n    return (\r\n        <div className=\"modal-overlay\">\r\n            <div className=\"modal-content\" style={{ maxWidth: '900px', width: '95%', height: '90vh', display: 'flex', flexDirection: 'column', padding: 0, overflow: 'hidden' }}>\r\n\r\n                {/* Header */}\r\n                <div style={{ padding: '15px', borderBottom: '1px solid #eee', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                    <h2 style={{ margin: 0 }}>Book Campsite</h2>\r\n                    <button onClick={onClose} style={{ background: 'none', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', color: '#666' }}>\r\n                        <X size={24} />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Toolbar */}\r\n                <div style={{ padding: '15px', background: '#f9f9f9', borderBottom: '1px solid #eee', display: 'flex', gap: '15px', flexWrap: 'wrap', alignItems: 'center' }}>\r\n\r\n                    {/* Campground Selector */}\r\n                    <div>\r\n                        <label style={{ display: 'block', fontSize: '0.8rem', fontWeight: 'bold' }}>Campground</label>\r\n                        <select\r\n                            value={selectedCampgroundId || ''}\r\n                            onChange={e => setSelectedCampgroundId(e.target.value)}\r\n                            style={{ padding: '5px' }}\r\n                        >\r\n                            {campgrounds.map(cg => (\r\n                                <option key={cg.campground_id} value={cg.campground_id}>{cg.name}</option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n\r\n                    {/* Date Pickers */}\r\n                    <div style={{ display: 'flex', gap: '15px', alignItems: 'center' }}>\r\n                        <div>\r\n                            <label style={{ display: 'block', fontSize: '0.8rem', fontWeight: 'bold' }}>Check In</label>\r\n                            <input\r\n                                type=\"date\"\r\n                                value={startDate}\r\n                                min={formatDate(event?.start_date)}\r\n                                max={formatDate(event?.end_date)}\r\n                                onChange={e => !useFullEventPrice && setStartDate(e.target.value)}\r\n                                disabled={useFullEventPrice}\r\n                                style={{ padding: '4px', background: useFullEventPrice ? '#eee' : 'white' }}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label style={{ display: 'block', fontSize: '0.8rem', fontWeight: 'bold' }}>Check Out</label>\r\n                            <input\r\n                                type=\"date\"\r\n                                value={endDate}\r\n                                min={formatDate(event?.start_date)}\r\n                                max={formatDate(event?.end_date)}\r\n                                onChange={e => !useFullEventPrice && setEndDate(e.target.value)}\r\n                                disabled={useFullEventPrice}\r\n                                style={{ padding: '4px', background: useFullEventPrice ? '#eee' : 'white' }}\r\n                            />\r\n                        </div>\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '5px', marginTop: '15px' }}>\r\n                            <input\r\n                                type=\"checkbox\"\r\n                                id=\"fullEventCheck\"\r\n                                checked={useFullEventPrice}\r\n                                onChange={e => handleFullEventToggle(e.target.checked)}\r\n                            />\r\n                            <label htmlFor=\"fullEventCheck\" style={{ fontSize: '0.9rem', cursor: 'pointer' }}>\r\n                                Full Event Package\r\n                            </label>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Guest Selection */}\r\n                    <div style={{ display: 'flex', gap: '15px', alignItems: 'center' }}>\r\n                        <div>\r\n                            <label style={{ display: 'block', fontSize: '0.8rem', fontWeight: 'bold' }}>Adults</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                min=\"1\"\r\n                                value={adults}\r\n                                onChange={e => setAdults(parseInt(e.target.value) || 1)}\r\n                                style={{ padding: '4px', width: '60px' }}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label style={{ display: 'block', fontSize: '0.8rem', fontWeight: 'bold' }}>Children</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                min=\"0\"\r\n                                value={children}\r\n                                onChange={e => setChildren(parseInt(e.target.value) || 0)}\r\n                                style={{ padding: '4px', width: '60px' }}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Summary */}\r\n                    <div style={{ marginLeft: 'auto', textAlign: 'right' }}>\r\n                        <div style={{ fontWeight: 'bold' }}>{selectedSites.length} sites selected</div>\r\n                        <div style={{ fontSize: '0.9rem', color: '#666' }}>\r\n                            Total: ${selectedSites.reduce((sum, s) => {\r\n                                const extraAdults = Math.max(0, adults - 1);\r\n                                if (useFullEventPrice && s.full_event_price) {\r\n                                    const extraFee = extraAdults * (s.extra_adult_full_event_price || 0);\r\n                                    return sum + s.full_event_price + extraFee;\r\n                                }\r\n                                const nights = Math.max(1, Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24)));\r\n                                const extraFee = extraAdults * (s.extra_adult_price_per_night || 0) * nights;\r\n                                return sum + (s.price_per_night * nights) + extraFee;\r\n                            }, 0).toFixed(2)}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Map Area */}\r\n                <div style={{ flex: 1, position: 'relative', overflow: 'hidden', background: '#ccc' }}>\r\n                    {loading && (\r\n                        <div style={{ position: 'absolute', inset: 0, background: 'rgba(255,255,255,0.7)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10 }}>\r\n                            Loading availability...\r\n                        </div>\r\n                    )}\r\n\r\n                    {campground ? (\r\n                        <div style={{ width: '100%', height: '100%', overflow: 'auto' }}>\r\n                            <div style={{ position: 'relative', display: 'inline-block' }}>\r\n                                <img\r\n                                    src={campground.map_image_url}\r\n                                    alt=\"Map\"\r\n                                    style={{ display: 'block', maxWidth: '100%' }}\r\n                                />\r\n\r\n                                {sites.map(site => {\r\n                                    if (!site.map_coordinates) return null;\r\n                                    let c;\r\n                                    try { c = JSON.parse(site.map_coordinates); } catch (e) { return null; }\r\n\r\n                                    const isSelected = selectedSites.some(s => s.campsite_id === site.campsite_id);\r\n\r\n                                    // Style Logic\r\n                                    let bg = '#28a745'; // Available (Green)\r\n                                    let border = '2px solid white';\r\n                                    let cursor = 'pointer';\r\n\r\n                                    if (site.is_booked) {\r\n                                        bg = '#dc3545'; // Booked (Red)\r\n                                        cursor = 'not-allowed';\r\n                                    } else if (isSelected) {\r\n                                        bg = orgSettings?.primary_color || 'blue';\r\n                                        border = '2px solid yellow';\r\n                                    }\r\n\r\n                                    return (\r\n                                        <div\r\n                                            key={site.campsite_id}\r\n                                            onClick={() => toggleSiteSelection(site)}\r\n                                            style={{\r\n                                                position: 'absolute',\r\n                                                left: `${c.x}%`,\r\n                                                top: `${c.y}%`,\r\n                                                width: '24px',\r\n                                                height: '24px',\r\n                                                background: bg,\r\n                                                borderRadius: '50%',\r\n                                                transform: 'translate(-50%, -50%)',\r\n                                                border: border,\r\n                                                cursor: cursor,\r\n                                                display: 'flex',\r\n                                                alignItems: 'center',\r\n                                                justifyContent: 'center',\r\n                                                color: 'white',\r\n                                                fontSize: '10px',\r\n                                                fontWeight: 'bold',\r\n                                                boxShadow: '0 2px 4px rgba(0,0,0,0.3)'\r\n                                            }}\r\n                                            title={`${site.site_number} - ${site.full_event_price ? `Event: $${site.full_event_price}` : `$${site.price_per_night}/n`}`}\r\n                                        >\r\n                                            {isSelected && '‚úì'}\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div style={{ padding: '50px', textAlign: 'center' }}>No campground selected</div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div style={{ padding: '15px', background: 'white', borderTop: '1px solid #eee', display: 'flex', justifyContent: 'flex-end', gap: '10px' }}>\r\n                    <button className=\"secondary-button\" onClick={onClose}>Cancel</button>\r\n                    <button\r\n                        className=\"primary-button\"\r\n                        onClick={handleConfirm}\r\n                        disabled={selectedSites.length === 0}\r\n                    >\r\n                        Add {selectedSites.length} Sites to Order\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default CampsiteModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\components\\Layout.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'hasPlanes' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":13,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"hasPlanes"},"fix":{"range":[580,589],"text":""},"desc":"Remove unused variable 'hasPlanes'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setHasPlanes' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":13,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":33,"suggestions":[{"messageId":"removeVar","data":{"varName":"setHasPlanes"},"fix":{"range":[589,603],"text":""},"desc":"Remove unused variable 'setHasPlanes'."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  30 |   // Close mobile menu when route changes\n  31 |   useEffect(() => {\n> 32 |     setIsMobileMenuOpen(false);\n     |     ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  33 |   }, [location.pathname]);\n  34 |\n  35 |   // Check if user has planes (for My Planes menu) - REMOVED: Always show for authenticated users","line":32,"column":5,"nodeType":null,"endLine":32,"endColumn":24},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  103 |               /* ================= ADMIN NAVIGATION ================= */\n  104 |               <div className=\"flex items-center gap-4\">\n> 105 |                 <NavLink to=\"/admin\">Home</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  106 |                 <NavLink to=\"/events\">Events</NavLink>\n  107 |                 <NavLink to=\"/admin/merchandise\">Merchandise</NavLink>\n  108 |                 <NavLink to=\"/admin/assets\">Assets</NavLink>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":105,"column":18,"nodeType":null,"endLine":105,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  104 |               <div className=\"flex items-center gap-4\">\n  105 |                 <NavLink to=\"/admin\">Home</NavLink>\n> 106 |                 <NavLink to=\"/events\">Events</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  107 |                 <NavLink to=\"/admin/merchandise\">Merchandise</NavLink>\n  108 |                 <NavLink to=\"/admin/assets\">Assets</NavLink>\n  109 |                 <NavLink to=\"/admin/subevents\">Subevents</NavLink>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":106,"column":18,"nodeType":null,"endLine":106,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  105 |                 <NavLink to=\"/admin\">Home</NavLink>\n  106 |                 <NavLink to=\"/events\">Events</NavLink>\n> 107 |                 <NavLink to=\"/admin/merchandise\">Merchandise</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  108 |                 <NavLink to=\"/admin/assets\">Assets</NavLink>\n  109 |                 <NavLink to=\"/admin/subevents\">Subevents</NavLink>\n  110 |                 <NavLink to=\"/admin/map\">Camping</NavLink>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":107,"column":18,"nodeType":null,"endLine":107,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  106 |                 <NavLink to=\"/events\">Events</NavLink>\n  107 |                 <NavLink to=\"/admin/merchandise\">Merchandise</NavLink>\n> 108 |                 <NavLink to=\"/admin/assets\">Assets</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  109 |                 <NavLink to=\"/admin/subevents\">Subevents</NavLink>\n  110 |                 <NavLink to=\"/admin/map\">Camping</NavLink>\n  111 |                 <NavLink to=\"/admin/orders\">Orders</NavLink>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":108,"column":18,"nodeType":null,"endLine":108,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  107 |                 <NavLink to=\"/admin/merchandise\">Merchandise</NavLink>\n  108 |                 <NavLink to=\"/admin/assets\">Assets</NavLink>\n> 109 |                 <NavLink to=\"/admin/subevents\">Subevents</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  110 |                 <NavLink to=\"/admin/map\">Camping</NavLink>\n  111 |                 <NavLink to=\"/admin/orders\">Orders</NavLink>\n  112 |                 <NavLink to=\"/admin/settings\">Settings</NavLink>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":109,"column":18,"nodeType":null,"endLine":109,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  108 |                 <NavLink to=\"/admin/assets\">Assets</NavLink>\n  109 |                 <NavLink to=\"/admin/subevents\">Subevents</NavLink>\n> 110 |                 <NavLink to=\"/admin/map\">Camping</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  111 |                 <NavLink to=\"/admin/orders\">Orders</NavLink>\n  112 |                 <NavLink to=\"/admin/settings\">Settings</NavLink>\n  113 |\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":110,"column":18,"nodeType":null,"endLine":110,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  109 |                 <NavLink to=\"/admin/subevents\">Subevents</NavLink>\n  110 |                 <NavLink to=\"/admin/map\">Camping</NavLink>\n> 111 |                 <NavLink to=\"/admin/orders\">Orders</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  112 |                 <NavLink to=\"/admin/settings\">Settings</NavLink>\n  113 |\n  114 |                 <button\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":111,"column":18,"nodeType":null,"endLine":111,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  110 |                 <NavLink to=\"/admin/map\">Camping</NavLink>\n  111 |                 <NavLink to=\"/admin/orders\">Orders</NavLink>\n> 112 |                 <NavLink to=\"/admin/settings\">Settings</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  113 |\n  114 |                 <button\n  115 |                   onClick={handleLogout}\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":112,"column":18,"nodeType":null,"endLine":112,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  123 |               <>\n  124 |                 {/* Public Nav - Only show Home/Events if not logged in. Show rest if User. */}\n> 125 |                 <NavLink to=\"/\">Home</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  126 |                 <NavLink to=\"/events\">Events</NavLink>\n  127 |\n  128 |\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":125,"column":18,"nodeType":null,"endLine":125,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  124 |                 {/* Public Nav - Only show Home/Events if not logged in. Show rest if User. */}\n  125 |                 <NavLink to=\"/\">Home</NavLink>\n> 126 |                 <NavLink to=\"/events\">Events</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  127 |\n  128 |\n  129 |                 {/* Protected Menus */}\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":126,"column":18,"nodeType":null,"endLine":126,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  159 |                     </div>\n  160 |\n> 161 |                     <NavLink to=\"/shop\">Shop</NavLink>\n      |                      ^^^^^^^ This component is created during render\n  162 |\n  163 |                     {/* Cart Icon - Desktop */}\n  164 |                     <Link to=\"/checkout\" className=\"flex items-center gap-2 hover:text-accent relative px-2\">\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":161,"column":22,"nodeType":null,"endLine":161,"endColumn":29},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  174 |                       <span className=\"font-medium\">Hi, {user.firstName}</span>\n  175 |\n> 176 |                       <NavLink to=\"/my-orders\">My Orders</NavLink>\n      |                        ^^^^^^^ This component is created during render\n  177 |                       <NavLink to=\"/my-planes\">My Planes</NavLink>\n  178 |\n  179 |                       <button\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":176,"column":24,"nodeType":null,"endLine":176,"endColumn":31},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  175 |\n  176 |                       <NavLink to=\"/my-orders\">My Orders</NavLink>\n> 177 |                       <NavLink to=\"/my-planes\">My Planes</NavLink>\n      |                        ^^^^^^^ This component is created during render\n  178 |\n  179 |                       <button\n  180 |                         onClick={handleLogout}\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":177,"column":24,"nodeType":null,"endLine":177,"endColumn":31},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  204 |             {user && user.role === 'admin' ? (\n  205 |               <>\n> 206 |                 <NavLink to=\"/admin\" className=\"text-2xl\">Home</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  207 |                 <NavLink to=\"/events\" className=\"text-2xl\">Events</NavLink>\n  208 |                 <NavLink to=\"/admin/merchandise\" className=\"text-2xl\">Merchandise</NavLink>\n  209 |                 <NavLink to=\"/admin/assets\" className=\"text-2xl\">Assets</NavLink>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":206,"column":18,"nodeType":null,"endLine":206,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  205 |               <>\n  206 |                 <NavLink to=\"/admin\" className=\"text-2xl\">Home</NavLink>\n> 207 |                 <NavLink to=\"/events\" className=\"text-2xl\">Events</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  208 |                 <NavLink to=\"/admin/merchandise\" className=\"text-2xl\">Merchandise</NavLink>\n  209 |                 <NavLink to=\"/admin/assets\" className=\"text-2xl\">Assets</NavLink>\n  210 |                 <NavLink to=\"/admin/subevents\" className=\"text-2xl\">Subevents</NavLink>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":207,"column":18,"nodeType":null,"endLine":207,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  206 |                 <NavLink to=\"/admin\" className=\"text-2xl\">Home</NavLink>\n  207 |                 <NavLink to=\"/events\" className=\"text-2xl\">Events</NavLink>\n> 208 |                 <NavLink to=\"/admin/merchandise\" className=\"text-2xl\">Merchandise</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  209 |                 <NavLink to=\"/admin/assets\" className=\"text-2xl\">Assets</NavLink>\n  210 |                 <NavLink to=\"/admin/subevents\" className=\"text-2xl\">Subevents</NavLink>\n  211 |                 <NavLink to=\"/admin/map\" className=\"text-2xl\">Camping</NavLink>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":208,"column":18,"nodeType":null,"endLine":208,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  207 |                 <NavLink to=\"/events\" className=\"text-2xl\">Events</NavLink>\n  208 |                 <NavLink to=\"/admin/merchandise\" className=\"text-2xl\">Merchandise</NavLink>\n> 209 |                 <NavLink to=\"/admin/assets\" className=\"text-2xl\">Assets</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  210 |                 <NavLink to=\"/admin/subevents\" className=\"text-2xl\">Subevents</NavLink>\n  211 |                 <NavLink to=\"/admin/map\" className=\"text-2xl\">Camping</NavLink>\n  212 |                 <NavLink to=\"/admin/orders\" className=\"text-2xl\">Orders</NavLink>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":209,"column":18,"nodeType":null,"endLine":209,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  208 |                 <NavLink to=\"/admin/merchandise\" className=\"text-2xl\">Merchandise</NavLink>\n  209 |                 <NavLink to=\"/admin/assets\" className=\"text-2xl\">Assets</NavLink>\n> 210 |                 <NavLink to=\"/admin/subevents\" className=\"text-2xl\">Subevents</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  211 |                 <NavLink to=\"/admin/map\" className=\"text-2xl\">Camping</NavLink>\n  212 |                 <NavLink to=\"/admin/orders\" className=\"text-2xl\">Orders</NavLink>\n  213 |                 <NavLink to=\"/admin/settings\" className=\"text-2xl\">Settings</NavLink>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":210,"column":18,"nodeType":null,"endLine":210,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  209 |                 <NavLink to=\"/admin/assets\" className=\"text-2xl\">Assets</NavLink>\n  210 |                 <NavLink to=\"/admin/subevents\" className=\"text-2xl\">Subevents</NavLink>\n> 211 |                 <NavLink to=\"/admin/map\" className=\"text-2xl\">Camping</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  212 |                 <NavLink to=\"/admin/orders\" className=\"text-2xl\">Orders</NavLink>\n  213 |                 <NavLink to=\"/admin/settings\" className=\"text-2xl\">Settings</NavLink>\n  214 |                 <button onClick={handleLogout} className=\"text-2xl text-accent font-bold mt-4\">Logout</button>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":211,"column":18,"nodeType":null,"endLine":211,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  210 |                 <NavLink to=\"/admin/subevents\" className=\"text-2xl\">Subevents</NavLink>\n  211 |                 <NavLink to=\"/admin/map\" className=\"text-2xl\">Camping</NavLink>\n> 212 |                 <NavLink to=\"/admin/orders\" className=\"text-2xl\">Orders</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  213 |                 <NavLink to=\"/admin/settings\" className=\"text-2xl\">Settings</NavLink>\n  214 |                 <button onClick={handleLogout} className=\"text-2xl text-accent font-bold mt-4\">Logout</button>\n  215 |               </>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":212,"column":18,"nodeType":null,"endLine":212,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  211 |                 <NavLink to=\"/admin/map\" className=\"text-2xl\">Camping</NavLink>\n  212 |                 <NavLink to=\"/admin/orders\" className=\"text-2xl\">Orders</NavLink>\n> 213 |                 <NavLink to=\"/admin/settings\" className=\"text-2xl\">Settings</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  214 |                 <button onClick={handleLogout} className=\"text-2xl text-accent font-bold mt-4\">Logout</button>\n  215 |               </>\n  216 |             ) : (\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":213,"column":18,"nodeType":null,"endLine":213,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  216 |             ) : (\n  217 |               <>\n> 218 |                 <NavLink to=\"/\" className=\"text-2xl\">Home</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  219 |                 <NavLink to=\"/events\" className=\"text-2xl\">Events</NavLink>\n  220 |\n  221 |                 {user && (\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":218,"column":18,"nodeType":null,"endLine":218,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  217 |               <>\n  218 |                 <NavLink to=\"/\" className=\"text-2xl\">Home</NavLink>\n> 219 |                 <NavLink to=\"/events\" className=\"text-2xl\">Events</NavLink>\n      |                  ^^^^^^^ This component is created during render\n  220 |\n  221 |                 {user && (\n  222 |                   <>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":219,"column":18,"nodeType":null,"endLine":219,"endColumn":25},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  221 |                 {user && (\n  222 |                   <>\n> 223 |                     <NavLink to=\"/shop\" className=\"text-2xl\">Shop</NavLink>\n      |                      ^^^^^^^ This component is created during render\n  224 |\n  225 |                     <div className=\"w-16 h-1 bg-white/10 my-1\"></div>\n  226 |                     <span className=\"text-sm font-bold text-accent uppercase tracking-wider\">Information</span>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":223,"column":22,"nodeType":null,"endLine":223,"endColumn":29},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  225 |                     <div className=\"w-16 h-1 bg-white/10 my-1\"></div>\n  226 |                     <span className=\"text-sm font-bold text-accent uppercase tracking-wider\">Information</span>\n> 227 |                     <NavLink to=\"/my-roster-events\" className=\"text-xl\">Flight Line Duties</NavLink>\n      |                      ^^^^^^^ This component is created during render\n  228 |                     <NavLink to=\"/faq\" className=\"text-xl\">FAQ</NavLink>\n  229 |                     <NavLink to=\"#\" className=\"text-xl\">Event Schedule</NavLink>\n  230 |\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":227,"column":22,"nodeType":null,"endLine":227,"endColumn":29},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  226 |                     <span className=\"text-sm font-bold text-accent uppercase tracking-wider\">Information</span>\n  227 |                     <NavLink to=\"/my-roster-events\" className=\"text-xl\">Flight Line Duties</NavLink>\n> 228 |                     <NavLink to=\"/faq\" className=\"text-xl\">FAQ</NavLink>\n      |                      ^^^^^^^ This component is created during render\n  229 |                     <NavLink to=\"#\" className=\"text-xl\">Event Schedule</NavLink>\n  230 |\n  231 |                     <div className=\"w-16 h-1 bg-white/20 my-2\"></div>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":228,"column":22,"nodeType":null,"endLine":228,"endColumn":29},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  227 |                     <NavLink to=\"/my-roster-events\" className=\"text-xl\">Flight Line Duties</NavLink>\n  228 |                     <NavLink to=\"/faq\" className=\"text-xl\">FAQ</NavLink>\n> 229 |                     <NavLink to=\"#\" className=\"text-xl\">Event Schedule</NavLink>\n      |                      ^^^^^^^ This component is created during render\n  230 |\n  231 |                     <div className=\"w-16 h-1 bg-white/20 my-2\"></div>\n  232 |                     <span className=\"text-xl opacity-75\">Hi, {user.firstName}</span>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":229,"column":22,"nodeType":null,"endLine":229,"endColumn":29},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  231 |                     <div className=\"w-16 h-1 bg-white/20 my-2\"></div>\n  232 |                     <span className=\"text-xl opacity-75\">Hi, {user.firstName}</span>\n> 233 |                     <NavLink to=\"/my-orders\" className=\"text-2xl\">My Orders</NavLink>\n      |                      ^^^^^^^ This component is created during render\n  234 |                     <NavLink to=\"/my-planes\" className=\"text-2xl\">My Planes</NavLink>\n  235 |                     <button onClick={handleLogout} className=\"text-2xl text-accent font-bold mt-4\">Logout</button>\n  236 |                   </>\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":233,"column":22,"nodeType":null,"endLine":233,"endColumn":29},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n  232 |                     <span className=\"text-xl opacity-75\">Hi, {user.firstName}</span>\n  233 |                     <NavLink to=\"/my-orders\" className=\"text-2xl\">My Orders</NavLink>\n> 234 |                     <NavLink to=\"/my-planes\" className=\"text-2xl\">My Planes</NavLink>\n      |                      ^^^^^^^ This component is created during render\n  235 |                     <button onClick={handleLogout} className=\"text-2xl text-accent font-bold mt-4\">Logout</button>\n  236 |                   </>\n  237 |                 )}\n\n  39 |   if (error) return <div>Error: {error}</div>;\n  40 |\n> 41 |   const NavLink = ({ to, children, className = \"\" }) => (\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |     <Link\n     | ^^^^^^^^^\n> 43 |       to={to}\n     | ^^^^^^^^^\n> 44 |       className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\n     | ^^^^^^^^^\n> 45 |       onClick={() => setIsMobileMenuOpen(false)}\n     | ^^^^^^^^^\n> 46 |     >\n     | ^^^^^^^^^\n> 47 |       {children}\n     | ^^^^^^^^^\n> 48 |     </Link>\n     | ^^^^^^^^^\n> 49 |   );\n     | ^^^^ The component is created during render here\n  50 |\n  51 |   return (\n  52 |     <div className=\"min-h-screen bg-gray-50 flex flex-col\">","line":234,"column":22,"nodeType":null,"endLine":234,"endColumn":29}],"suppressedMessages":[],"errorCount":32,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\r\nimport { Outlet, Link, useNavigate, useLocation } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useCart } from '../context/CartContext';\r\nimport { Menu, X, ShoppingCart, ChevronDown } from 'lucide-react';\r\n\r\nfunction Layout({ orgSettings, loading, error, refreshSettings }) {\r\n  const { user, logout } = useAuth();\r\n  const { cart } = useCart();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\r\n  const [hasPlanes, setHasPlanes] = useState(false);\r\n\r\n  const handleLogout = () => {\r\n    logout();\r\n    setIsMobileMenuOpen(false);\r\n    navigate('/');\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (orgSettings) {\r\n      const root = document.documentElement;\r\n      root.style.setProperty('--primary-color', orgSettings.primary_color || '#000000');\r\n      root.style.setProperty('--secondary-color', orgSettings.secondary_color || '#FFFFFF');\r\n      root.style.setProperty('--accent-color', orgSettings.accent_color || '#FFD700');\r\n    }\r\n  }, [orgSettings]);\r\n\r\n  // Close mobile menu when route changes\r\n  useEffect(() => {\r\n    setIsMobileMenuOpen(false);\r\n  }, [location.pathname]);\r\n\r\n  // Check if user has planes (for My Planes menu) - REMOVED: Always show for authenticated users\r\n  // useEffect(() => { ... }, [user]);\r\n\r\n  if (loading) return <div>Loading settings...</div>;\r\n  if (error) return <div>Error: {error}</div>;\r\n\r\n  const NavLink = ({ to, children, className = \"\" }) => (\r\n    <Link\r\n      to={to}\r\n      className={`hover:text-accent transition-colors font-medium ${className} ${location.pathname === to ? 'text-accent' : ''}`}\r\n      onClick={() => setIsMobileMenuOpen(false)}\r\n    >\r\n      {children}\r\n    </Link>\r\n  );\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 flex flex-col\">\r\n      <header className=\"bg-primary text-secondary p-4 shadow-md sticky top-0 z-50 transition-colors duration-300\">\r\n        <div className=\"container mx-auto flex flex-wrap justify-between items-center\">\r\n\r\n          {/* Logo - Always Left */}\r\n          <Link to=\"/\" className=\"flex items-center hover:opacity-90 transition-opacity z-50\" onClick={() => setIsMobileMenuOpen(false)}>\r\n            {orgSettings?.logo_url && (\r\n              <img\r\n                src={orgSettings.logo_url}\r\n                alt=\"Logo\"\r\n                className=\"h-10 w-auto object-contain bg-white/10 rounded-sm\"\r\n              />\r\n            )}\r\n            {!orgSettings?.logo_url && (\r\n              <span className=\"text-2xl font-bold\">Logo</span>\r\n            )}\r\n          </Link>\r\n\r\n          {/* Mobile Actions (Cart & Toggle) - Always Right on Mobile */}\r\n          <div className=\"flex items-center gap-4 md:hidden z-50\">\r\n            {(!user || user.role !== 'admin') && (\r\n              <Link to=\"/checkout\" className=\"flex items-center hover:text-accent relative\" onClick={() => setIsMobileMenuOpen(false)}>\r\n                <ShoppingCart size={24} />\r\n                {cart.length > 0 && (\r\n                  <span className=\"bg-accent text-primary rounded-full px-1.5 py-0.5 text-[10px] font-bold absolute -top-2 -right-2 min-w-[16px] text-center\">\r\n                    {cart.length}\r\n                  </span>\r\n                )}\r\n              </Link>\r\n            )}\r\n\r\n            <button\r\n              onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\r\n              className=\"p-1 hover:text-accent transition-colors\"\r\n            >\r\n              {isMobileMenuOpen ? <X size={28} /> : <Menu size={28} />}\r\n            </button>\r\n          </div>\r\n\r\n          {/* Organization Name - Full Width on Mobile (Row 2), Next to Logo on Desktop */}\r\n          <div className=\"w-full md:w-auto md:flex-1 md:ml-6 text-center md:text-left mt-3 md:mt-0 order-last md:order-none\">\r\n            <Link to=\"/\" onClick={() => setIsMobileMenuOpen(false)}>\r\n              <h1 className=\"text-xl md:text-2xl font-bold leading-tight hover:text-accent transition-colors\">\r\n                {orgSettings?.organization_name}\r\n              </h1>\r\n            </Link>\r\n          </div>\r\n\r\n          {/* Desktop Navigation */}\r\n          <nav className=\"hidden md:flex gap-6 items-center\">\r\n            {user && user.role === 'admin' ? (\r\n              /* ================= ADMIN NAVIGATION ================= */\r\n              <div className=\"flex items-center gap-4\">\r\n                <NavLink to=\"/admin\">Home</NavLink>\r\n                <NavLink to=\"/events\">Events</NavLink>\r\n                <NavLink to=\"/admin/merchandise\">Merchandise</NavLink>\r\n                <NavLink to=\"/admin/assets\">Assets</NavLink>\r\n                <NavLink to=\"/admin/subevents\">Subevents</NavLink>\r\n                <NavLink to=\"/admin/map\">Camping</NavLink>\r\n                <NavLink to=\"/admin/orders\">Orders</NavLink>\r\n                <NavLink to=\"/admin/settings\">Settings</NavLink>\r\n\r\n                <button\r\n                  onClick={handleLogout}\r\n                  className=\"bg-accent text-primary px-4 py-2 rounded font-bold hover:brightness-110 transition-all shadow-sm ml-4 cursor-pointer\"\r\n                >\r\n                  Logout\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              /* ================= PUBLIC / USER NAVIGATION ================= */\r\n              <>\r\n                {/* Public Nav - Only show Home/Events if not logged in. Show rest if User. */}\r\n                <NavLink to=\"/\">Home</NavLink>\r\n                <NavLink to=\"/events\">Events</NavLink>\r\n\r\n\r\n                {/* Protected Menus */}\r\n                {user && (\r\n                  <>\r\n                    {/* Information Dropdown */}\r\n                    <div className=\"relative group z-50\">\r\n                      <button className=\"flex items-center hover:text-accent transition-colors font-medium h-full px-1\">\r\n                        Information\r\n                      </button>\r\n                      <div className=\"absolute top-full left-0 mt-0 w-56 bg-white text-gray-800 rounded-md shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 overflow-hidden border border-gray-100 transform origin-top scale-95 group-hover:scale-100\">\r\n                        <div className=\"py-1 flex flex-col\">\r\n                          <Link\r\n                            to=\"/my-roster-events\"\r\n                            className=\"px-4 py-3 hover:bg-gray-50 text-sm border-b border-gray-50 last:border-0 hover:text-accent font-medium\"\r\n                          >\r\n                            Flight Line Duties\r\n                          </Link>\r\n                          <Link\r\n                            to=\"/faq\"\r\n                            className=\"px-4 py-3 hover:bg-gray-50 text-sm border-b border-gray-50 last:border-0 hover:text-accent font-medium\"\r\n                          >\r\n                            FAQ\r\n                          </Link>\r\n                          <Link\r\n                            to=\"#\"\r\n                            className=\"px-4 py-3 hover:bg-gray-50 text-sm border-b border-gray-50 last:border-0 hover:text-accent font-medium\"\r\n                          >\r\n                            Event Schedule\r\n                          </Link>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <NavLink to=\"/shop\">Shop</NavLink>\r\n\r\n                    {/* Cart Icon - Desktop */}\r\n                    <Link to=\"/checkout\" className=\"flex items-center gap-2 hover:text-accent relative px-2\">\r\n                      <ShoppingCart size={20} />\r\n                      {cart.length > 0 && (\r\n                        <span className=\"bg-accent text-primary rounded-full px-1.5 py-0.5 text-xs font-bold absolute -top-2 -right-2 min-w-[18px] text-center\">\r\n                          {cart.length}\r\n                        </span>\r\n                      )}\r\n                    </Link>\r\n\r\n                    <div className=\"flex gap-4 items-center pl-6 border-l border-white/20\">\r\n                      <span className=\"font-medium\">Hi, {user.firstName}</span>\r\n\r\n                      <NavLink to=\"/my-orders\">My Orders</NavLink>\r\n                      <NavLink to=\"/my-planes\">My Planes</NavLink>\r\n\r\n                      <button\r\n                        onClick={handleLogout}\r\n                        className=\"bg-black/20 hover:bg-black/30 text-inherit px-3 py-1.5 rounded text-sm transition-colors cursor-pointer\"\r\n                      >\r\n                        Logout\r\n                      </button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n\r\n                {!user && (\r\n                  <Link\r\n                    to=\"/login\"\r\n                    className=\"bg-accent text-primary px-4 py-2 rounded font-bold hover:brightness-110 transition-all shadow-sm ml-4\"\r\n                  >\r\n                    Login\r\n                  </Link>\r\n                )}\r\n              </>\r\n            )}\r\n          </nav>\r\n\r\n          {/* Mobile Navigation Overlay */}\r\n          <div className={`fixed inset-0 bg-primary/95 z-40 flex flex-col items-center justify-center gap-8 transition-transform duration-300 md:hidden ${isMobileMenuOpen ? 'translate-x-0' : 'translate-x-full'}`}>\r\n\r\n            {user && user.role === 'admin' ? (\r\n              <>\r\n                <NavLink to=\"/admin\" className=\"text-2xl\">Home</NavLink>\r\n                <NavLink to=\"/events\" className=\"text-2xl\">Events</NavLink>\r\n                <NavLink to=\"/admin/merchandise\" className=\"text-2xl\">Merchandise</NavLink>\r\n                <NavLink to=\"/admin/assets\" className=\"text-2xl\">Assets</NavLink>\r\n                <NavLink to=\"/admin/subevents\" className=\"text-2xl\">Subevents</NavLink>\r\n                <NavLink to=\"/admin/map\" className=\"text-2xl\">Camping</NavLink>\r\n                <NavLink to=\"/admin/orders\" className=\"text-2xl\">Orders</NavLink>\r\n                <NavLink to=\"/admin/settings\" className=\"text-2xl\">Settings</NavLink>\r\n                <button onClick={handleLogout} className=\"text-2xl text-accent font-bold mt-4\">Logout</button>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <NavLink to=\"/\" className=\"text-2xl\">Home</NavLink>\r\n                <NavLink to=\"/events\" className=\"text-2xl\">Events</NavLink>\r\n\r\n                {user && (\r\n                  <>\r\n                    <NavLink to=\"/shop\" className=\"text-2xl\">Shop</NavLink>\r\n\r\n                    <div className=\"w-16 h-1 bg-white/10 my-1\"></div>\r\n                    <span className=\"text-sm font-bold text-accent uppercase tracking-wider\">Information</span>\r\n                    <NavLink to=\"/my-roster-events\" className=\"text-xl\">Flight Line Duties</NavLink>\r\n                    <NavLink to=\"/faq\" className=\"text-xl\">FAQ</NavLink>\r\n                    <NavLink to=\"#\" className=\"text-xl\">Event Schedule</NavLink>\r\n\r\n                    <div className=\"w-16 h-1 bg-white/20 my-2\"></div>\r\n                    <span className=\"text-xl opacity-75\">Hi, {user.firstName}</span>\r\n                    <NavLink to=\"/my-orders\" className=\"text-2xl\">My Orders</NavLink>\r\n                    <NavLink to=\"/my-planes\" className=\"text-2xl\">My Planes</NavLink>\r\n                    <button onClick={handleLogout} className=\"text-2xl text-accent font-bold mt-4\">Logout</button>\r\n                  </>\r\n                )}\r\n\r\n                {!user && (\r\n                  <Link\r\n                    to=\"/login\"\r\n                    onClick={() => setIsMobileMenuOpen(false)}\r\n                    className=\"bg-accent text-primary px-8 py-3 rounded text-xl font-bold hover:brightness-110 transition-all shadow-sm mt-4\"\r\n                  >\r\n                    Login\r\n                  </Link>\r\n                )}\r\n              </>\r\n            )}\r\n          </div>\r\n\r\n        </div>\r\n      </header>\r\n\r\n      <main className=\"flex-grow container mx-auto p-4 md:p-8\">\r\n        <Outlet context={{ refreshSettings }} />\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Layout;","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\components\\ProductCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\components\\ProductModal.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  16 |             if (opt.values.length > 0) defaults[opt.name] = opt.values[0];\n  17 |         });\n> 18 |         setSelectedOptions(defaults);\n     |         ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  19 |     }, [product]);\n  20 |\n  21 |     // Resolve SKU based on selection","line":18,"column":9,"nodeType":null,"endLine":18,"endColumn":27},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  33 |         });\n  34 |\n> 35 |         setMatchedSku(found || null);\n     |         ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  36 |\n  37 |         // Update Image if SKU has one\n  38 |         if (found && found.image) {","line":35,"column":9,"nodeType":null,"endLine":35,"endColumn":22}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useNotification } from '../context/NotificationContext';\r\nimport { X } from 'lucide-react';\r\n\r\nfunction ProductModal({ product, onClose, onAddToCart }) {\r\n    const [selectedOptions, setSelectedOptions] = useState({});\r\n    const [matchedSku, setMatchedSku] = useState(null);\r\n    const [displayImage, setDisplayImage] = useState(product.image);\r\n\r\n    // Initialize defaults\r\n    useEffect(() => {\r\n        // Pre-select first values? Or wait for user?\r\n        // Let's pre-select the first value of each option to simulate a \"default\" selection\r\n        const defaults = {};\r\n        product.options.forEach(opt => {\r\n            if (opt.values.length > 0) defaults[opt.name] = opt.values[0];\r\n        });\r\n        setSelectedOptions(defaults);\r\n    }, [product]);\r\n\r\n    // Resolve SKU based on selection\r\n    useEffect(() => {\r\n        if (!product.skus) return;\r\n\r\n        const found = product.skus.find(sku => {\r\n            // Check if every selected option matches the sku's variant_map\r\n            // Loop through all product-level option categories\r\n            return product.options.every(opt => {\r\n                const selectedVal = selectedOptions[opt.name];\r\n                const skuVal = sku.variant_map[opt.name];\r\n                return selectedVal === skuVal;\r\n            });\r\n        });\r\n\r\n        setMatchedSku(found || null);\r\n\r\n        // Update Image if SKU has one\r\n        if (found && found.image) {\r\n            setDisplayImage(found.image);\r\n        } else {\r\n            setDisplayImage(product.image); // Revert to base if SKU has none\r\n        }\r\n\r\n    }, [selectedOptions, product]);\r\n\r\n\r\n    const handleOptionChange = (category, value) => {\r\n        setSelectedOptions(prev => ({ ...prev, [category]: value }));\r\n    };\r\n\r\n    const { notify } = useNotification();\r\n\r\n    const handleAdd = () => {\r\n        if (!matchedSku) return notify(\"Unavailable combination\", \"error\");\r\n        // if (matchedSku.stock <= 0) return notify(\"Out of stock\", \"error\");\r\n        onAddToCart(product, matchedSku);\r\n        onClose();\r\n    };\r\n\r\n    if (!product) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm\" onClick={onClose}>\r\n            <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-4xl overflow-hidden flex flex-col md:flex-row max-h-[90vh]\" onClick={e => e.stopPropagation()}>\r\n\r\n                {/* Image Section */}\r\n                <div className=\"w-full md:w-1/2 bg-gray-100 p-6 flex items-center justify-center relative\">\r\n                    {displayImage ? (\r\n                        <img src={displayImage} alt={product.name} className=\"max-h-[400px] object-contain drop-shadow-md\" />\r\n                    ) : (\r\n                        <div className=\"text-gray-400\">No Image</div>\r\n                    )}\r\n                    {/* Tiny Thumbnails for other variants could go here? MVP: No. */}\r\n                </div>\r\n\r\n                {/* Details Section */}\r\n                <div className=\"w-full md:w-1/2 p-5 md:p-8 flex flex-col overflow-y-auto\">\r\n                    <div className=\"flex justify-between items-start mb-4\">\r\n                        <h2 className=\"text-3xl font-bold text-gray-800\">{product.name}</h2>\r\n                        <button onClick={onClose} className=\"text-gray-400 hover:text-black transition-colors rounded-full hover:bg-gray-100 p-1\">\r\n                            <X size={24} />\r\n                        </button>\r\n                    </div>\r\n\r\n                    <p className=\"text-gray-600 mb-6 text-sm leading-relaxed\">{product.description}</p>\r\n\r\n                    <div className=\"mb-6\">\r\n                        <div className=\"text-3xl font-bold text-primary mb-1\">\r\n                            {matchedSku ? `$${matchedSku.price}` : <span className=\"text-gray-400 text-xl font-normal\">Select options</span>}\r\n                        </div>\r\n                        {/* Stock status hidden from customers */}\r\n                    </div>\r\n\r\n                    <div className=\"space-y-5 mb-8 flex-grow\">\r\n                        {product.options.map(opt => (\r\n                            <div key={opt.name}>\r\n                                <label className=\"block text-sm font-bold text-gray-700 mb-2 uppercase tracking-wide\">{opt.name}</label>\r\n                                <div className=\"flex flex-wrap gap-2\">\r\n                                    {opt.values.map(val => (\r\n                                        <button\r\n                                            key={val}\r\n                                            onClick={() => handleOptionChange(opt.name, val)}\r\n                                            className={`px-4 py-2 rounded-md text-sm font-medium border transition-all\r\n                                                ${selectedOptions[opt.name] === val\r\n                                                    ? 'bg-black text-white border-black shadow-md'\r\n                                                    : 'bg-white text-gray-700 border-gray-200 hover:border-gray-400'\r\n                                                }\r\n                                            `}\r\n                                        >\r\n                                            {val}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    <div className=\"mt-auto\">\r\n                        <button\r\n                            onClick={handleAdd}\r\n                            disabled={!matchedSku}\r\n                            className={`w-full py-4 text-lg font-bold rounded-lg transition-all transform active:scale-[0.99]\r\n                                ${matchedSku\r\n                                    ? 'bg-primary text-secondary hover:brightness-110 shadow-lg'\r\n                                    : 'bg-gray-200 text-gray-400 cursor-not-allowed'\r\n                                }\r\n                            `}\r\n                        >\r\n                            Add to Cart\r\n                        </button>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ProductModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\components\\Public\\PublicRegistrationModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'displayTime' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":58,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"displayTime"},"fix":{"range":[1864,2040],"text":""},"desc":"Remove unused variable 'displayTime'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { X, Calendar, Clock, Ticket } from 'lucide-react';\r\n\r\nconst PublicRegistrationModal = ({ isOpen, onClose, publicDay, onRegister }) => {\r\n    const [formData, setFormData] = useState({\r\n        firstName: '',\r\n        lastName: '',\r\n        email: '',\r\n        adults: 1,\r\n        children: 0,\r\n        subscribeToEmails: false\r\n    });\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState(null);\r\n    const [success, setSuccess] = useState(false);\r\n    const [ticketCode, setTicketCode] = useState(null);\r\n\r\n    if (!isOpen || !publicDay) return null;\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const response = await fetch('/api/public/register', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    public_event_day_id: publicDay.id,\r\n                    ...formData\r\n                })\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(data.error || 'Registration failed');\r\n            }\r\n\r\n            setSuccess(true);\r\n            setTicketCode(data.ticketCode);\r\n            if (onRegister) onRegister();\r\n        } catch (err) {\r\n            setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const formatTime = (timeString) => {\r\n        if (!timeString) return '';\r\n        const date = new Date(timeString);\r\n        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n    };\r\n\r\n    // If time is string \"09:00:00\" from SQL simple time, we need to handle it or just substring\r\n    const displayTime = (t) => {\r\n        if (!t) return '';\r\n        if (t.includes('T')) return formatTime(t); // ISO\r\n        return t.substring(0, 5); // Simple \"HH:MM\"\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\">\r\n            <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden relative animate-fade-in-up\">\r\n\r\n                {/* Header */}\r\n                <div className=\"bg-[#0f172a] text-white p-6 relative\">\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"absolute top-4 right-4 text-white/70 hover:text-white transition-colors\"\r\n                    >\r\n                        <X size={24} />\r\n                    </button>\r\n                    <h2 className=\"text-xl font-bold\">{publicDay.title}</h2>\r\n                    <div className=\"flex items-center gap-2 text-blue-200 mt-1 text-sm\">\r\n                        <Calendar size={14} />\r\n                        <span>\r\n                            {new Date(publicDay.date).toLocaleDateString('en-AU', { weekday: 'long', day: 'numeric', month: 'long' })}\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"p-6\">\r\n                    {success ? (\r\n                        <div className=\"text-center py-6\">\r\n                            <div className=\"w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                                <Ticket size={32} />\r\n                            </div>\r\n                            <h3 className=\"text-xl font-bold text-gray-900 mb-2\">You're Registered!</h3>\r\n                            <p className=\"text-gray-600 mb-4\">We've sent your ticket code to <strong>{formData.email}</strong>.</p>\r\n\r\n                            <div className=\"bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6\">\r\n                                <span className=\"text-xs text-gray-500 uppercase tracking-widest font-semibold\">Your Ticket Code</span>\r\n                                <div className=\"text-2xl font-mono font-bold text-[#0f172a] tracking-wider mt-1\">{ticketCode}</div>\r\n                            </div>\r\n\r\n                            <button\r\n                                onClick={onClose}\r\n                                className=\"w-full bg-[#0f172a] text-white py-3 rounded-lg font-semibold hover:bg-slate-800 transition-colors\"\r\n                            >\r\n                                Done\r\n                            </button>\r\n                        </div>\r\n                    ) : (\r\n                        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                            {error && (\r\n                                <div className=\"bg-red-50 text-red-600 p-3 rounded-lg text-sm border border-red-200\">\r\n                                    {error}\r\n                                </div>\r\n                            )}\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">First Name</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        required\r\n                                        className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0f172a] focus:border-transparent outline-none\"\r\n                                        value={formData.firstName}\r\n                                        onChange={e => setFormData({ ...formData, firstName: e.target.value })}\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Last Name</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        required\r\n                                        className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0f172a] focus:border-transparent outline-none\"\r\n                                        value={formData.lastName}\r\n                                        onChange={e => setFormData({ ...formData, lastName: e.target.value })}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Email Address</label>\r\n                                <input\r\n                                    type=\"email\"\r\n                                    required\r\n                                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0f172a] focus:border-transparent outline-none\"\r\n                                    value={formData.email}\r\n                                    onChange={e => setFormData({ ...formData, email: e.target.value })}\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Adults</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        min=\"1\"\r\n                                        max=\"10\"\r\n                                        required\r\n                                        className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0f172a] focus:border-transparent outline-none\"\r\n                                        value={formData.adults}\r\n                                        onChange={e => setFormData({ ...formData, adults: parseInt(e.target.value) })}\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Children</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        min=\"0\"\r\n                                        max=\"10\"\r\n                                        className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0f172a] focus:border-transparent outline-none\"\r\n                                        value={formData.children}\r\n                                        onChange={e => setFormData({ ...formData, children: parseInt(e.target.value) })}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-start gap-3 mt-4\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    id=\"subscribeToEmails\"\r\n                                    className=\"mt-1 h-4 w-4 text-[#0f172a] border-gray-300 rounded focus:ring-[#0f172a]\"\r\n                                    checked={formData.subscribeToEmails}\r\n                                    onChange={e => setFormData({ ...formData, subscribeToEmails: e.target.checked })}\r\n                                />\r\n                                <label htmlFor=\"subscribeToEmails\" className=\"text-sm text-gray-700\">\r\n                                    Would you like to be notified of future air shows?\r\n                                </label>\r\n                            </div>\r\n\r\n                            <div className=\"pt-2\">\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    disabled={loading}\r\n                                    className=\"w-full bg-[#e11d48] text-white py-3 rounded-lg font-bold text-lg hover:bg-rose-700 transition-colors shadow-lg shadow-rose-900/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                                >\r\n                                    {loading ? 'Processing...' : 'Complete Registration'}\r\n                                </button>\r\n                                <p className=\"text-center text-xs text-gray-500 mt-3\">\r\n                                    It's free! We just need numbers for catering and safety.\r\n                                </p>\r\n                            </div>\r\n                        </form>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default PublicRegistrationModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\components\\SubeventModal.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  48 |             }\n  49 |         });\n> 50 |         setDefaultOptions(list);\n     |         ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  51 |     }, [myPilots, cart]);\n  52 |\n  53 |     // Close dropdown on click outside","line":50,"column":9,"nodeType":null,"endLine":50,"endColumn":26}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport { X, Check, Search, User, UserPlus } from 'lucide-react';\r\n\r\nexport default function SubeventModal({ subevent, onClose, onAddToCart, myPilots = [], cart = [], onSearchAttendees }) {\r\n    const [selections, setSelections] = useState({});\r\n\r\n    // Combobox State\r\n    const [inputValue, setInputValue] = useState(\"\");\r\n    const [selectedOption, setSelectedOption] = useState(null);\r\n    const [isDropdownOpen, setIsDropdownOpen] = useState(false);\r\n    const [searchResults, setSearchResults] = useState([]);\r\n    const [isSearching, setIsSearching] = useState(false);\r\n    const dropdownRef = useRef(null);\r\n\r\n    // Initial Defaults (My Pilots + Cart)\r\n    const [defaultOptions, setDefaultOptions] = useState([]);\r\n\r\n    useEffect(() => {\r\n        const list = [];\r\n        // Existing Attendees\r\n        myPilots.forEach(p => {\r\n            const label = p.pilot_name || `${p.first_name} ${p.last_name}`;\r\n            list.push({\r\n                key: `existing-${p.attendee_id}`,\r\n                label: `${label} (My Attendee)`,\r\n                value: { attendeeId: p.attendee_id, name: label },\r\n                type: 'existing'\r\n            });\r\n        });\r\n\r\n        // Cart Tickets\r\n        cart.filter(item => item.type === 'TICKET').forEach((ticket) => {\r\n            let label = ticket.name;\r\n            if (ticket.attendees && ticket.attendees[0]) {\r\n                const att = ticket.attendees[0];\r\n                if (att.firstName && att.lastName) {\r\n                    label = `${att.firstName} ${att.lastName} (${ticket.name})`;\r\n                }\r\n            }\r\n            const tempId = ticket.attendees?.[0]?.tempId;\r\n            if (tempId) {\r\n                list.push({\r\n                    key: `cart-${tempId}`,\r\n                    label: `New Ticket: ${label}`,\r\n                    value: { attendeeTempId: tempId, name: label },\r\n                    type: 'cart'\r\n                });\r\n            }\r\n        });\r\n        setDefaultOptions(list);\r\n    }, [myPilots, cart]);\r\n\r\n    // Close dropdown on click outside\r\n    useEffect(() => {\r\n        const handleClickOutside = (event) => {\r\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\r\n                setIsDropdownOpen(false);\r\n            }\r\n        };\r\n        document.addEventListener(\"mousedown\", handleClickOutside);\r\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    }, []);\r\n\r\n    // Search Debounce\r\n    useEffect(() => {\r\n        const timer = setTimeout(async () => {\r\n            if (inputValue.length >= 2 && onSearchAttendees) {\r\n                setIsSearching(true);\r\n                const results = await onSearchAttendees(inputValue);\r\n                setSearchResults(results.map(r => ({\r\n                    key: `search-${r.attendee_id}`,\r\n                    label: `${r.name} (${r.ticketType})`,\r\n                    value: { attendeeId: r.attendee_id, name: r.name },\r\n                    type: 'search'\r\n                })));\r\n                setIsSearching(false);\r\n            } else {\r\n                setSearchResults([]);\r\n            }\r\n        }, 500);\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [inputValue, onSearchAttendees]);\r\n\r\n    const handleSelectOption = (opt) => {\r\n        setSelectedOption(opt);\r\n        setInputValue(opt.label); // Or just name?\r\n        setIsDropdownOpen(false);\r\n    };\r\n\r\n    const handleGuestNameSelect = () => {\r\n        const guestName = inputValue.trim();\r\n        if (!guestName) return;\r\n        const opt = {\r\n            key: `guest-${Date.now()}`,\r\n            label: `${guestName} (Guest Name)`,\r\n            value: { guestName: guestName, name: `${guestName} (Guest)` },\r\n            type: 'guest'\r\n        };\r\n        setSelectedOption(opt);\r\n        setIsDropdownOpen(false);\r\n    };\r\n\r\n    // Calculate variations price\r\n    const calculateTotal = () => {\r\n        let total = subevent.price;\r\n        Object.values(selections).forEach(optId => {\r\n            if (subevent.variations) {\r\n                for (const v of subevent.variations) {\r\n                    const opt = v.options.find(o => o.id === optId);\r\n                    if (opt) {\r\n                        total += opt.priceAdjustment;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return total;\r\n    };\r\n\r\n    const handleSelectionChange = (variationId, optionId) => {\r\n        setSelections(prev => ({ ...prev, [variationId]: optionId }));\r\n    };\r\n\r\n    const isValid = () => {\r\n        if (!selectedOption) return false;\r\n        if (!subevent.variations) return true;\r\n        return subevent.variations.every(v => {\r\n            if (!v.isRequired) return true;\r\n            return selections[v.id] !== undefined;\r\n        });\r\n    };\r\n\r\n    const handleSubmit = () => {\r\n        if (isValid()) {\r\n            onAddToCart(subevent, selections, calculateTotal(), selectedOption.value);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n            <div className=\"bg-white rounded-xl shadow-2xl max-w-lg w-full overflow-hidden flex flex-col max-h-[90dvh]\">\r\n\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b border-gray-100 flex justify-between items-start\">\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold text-gray-900\">{subevent.name}</h2>\r\n                        <p className=\"text-gray-500 mt-1\">{subevent.description}</p>\r\n                    </div>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-full hover:bg-gray-100\"\r\n                    >\r\n                        <X size={24} />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"p-6 overflow-y-auto min-h-0 flex-1\">\r\n                    <div className=\"space-y-6\">\r\n\r\n                        {/* Custom Combobox */}\r\n                        <div className=\"space-y-3 relative\" ref={dropdownRef}>\r\n                            <label className=\"block text-sm font-semibold text-gray-700\">\r\n                                Who is this for? <span className=\"text-red-500 ml-1\">*</span>\r\n                            </label>\r\n\r\n                            <div className=\"relative\">\r\n                                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" size={18} />\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all\"\r\n                                    placeholder=\"Search attendees or enter Guest Name...\"\r\n                                    value={inputValue}\r\n                                    onChange={(e) => {\r\n                                        setInputValue(e.target.value);\r\n                                        setSelectedOption(null); // Clear selection on edit\r\n                                        setIsDropdownOpen(true);\r\n                                    }}\r\n                                    onFocus={() => setIsDropdownOpen(true)}\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Dropdown Menu */}\r\n                            {isDropdownOpen && (\r\n                                <div className=\"absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-xl border border-gray-100 max-h-60 overflow-y-auto z-10\">\r\n                                    {/* Default Options (My Pilots + Cart) */}\r\n                                    {defaultOptions.length > 0 && searchResults.length === 0 && inputValue.length < 2 && (\r\n                                        <div className=\"py-2\">\r\n                                            <div className=\"px-3 py-1 text-xs font-bold text-gray-400 uppercase tracking-wider\">My Attendees / Cart</div>\r\n                                            {defaultOptions.map(opt => (\r\n                                                <button\r\n                                                    key={opt.key}\r\n                                                    onClick={() => handleSelectOption(opt)}\r\n                                                    className=\"w-full text-left px-4 py-2 hover:bg-gray-50 flex items-center gap-2\"\r\n                                                >\r\n                                                    <User size={16} className=\"text-primary\" />\r\n                                                    <span className=\"truncate\">{opt.label}</span>\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {/* Search Results */}\r\n                                    {searchResults.length > 0 && (\r\n                                        <div className=\"py-2 border-t border-gray-50\">\r\n                                            <div className=\"px-3 py-1 text-xs font-bold text-gray-400 uppercase tracking-wider\">Search Results</div>\r\n                                            {searchResults.map(opt => (\r\n                                                <button\r\n                                                    key={opt.key}\r\n                                                    onClick={() => handleSelectOption(opt)}\r\n                                                    className=\"w-full text-left px-4 py-2 hover:bg-gray-50 flex items-center gap-2\"\r\n                                                >\r\n                                                    <User size={16} className=\"text-blue-500\" />\r\n                                                    <span className=\"truncate\">{opt.label}</span>\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {/* Guest Option */}\r\n                                    {inputValue.length > 0 && (\r\n                                        <div className=\"py-2 border-t border-gray-50\">\r\n                                            <button\r\n                                                onClick={handleGuestNameSelect}\r\n                                                className=\"w-full text-left px-4 py-3 hover:bg-amber-50 flex items-center gap-2 text-amber-700 font-medium\"\r\n                                            >\r\n                                                <UserPlus size={16} />\r\n                                                <span>Use \"{inputValue}\" as Guest Name</span>\r\n                                            </button>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {/* Loading State */}\r\n                                    {isSearching && (\r\n                                        <div className=\"p-4 text-center text-gray-400 text-sm\">Searching...</div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Selected Indicator */}\r\n                            {selectedOption && (\r\n                                <div className=\"mt-2 text-sm text-green-600 flex items-center gap-1 font-medium bg-green-50 px-3 py-2 rounded\">\r\n                                    <Check size={16} />\r\n                                    Selected: {selectedOption.label}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {subevent.variations && subevent.variations.length > 0 && <hr className=\"border-gray-100\" />}\r\n\r\n                        {/* Variations Logic (Preserved) */}\r\n                        {subevent.variations && subevent.variations.map(variation => (\r\n                            <div key={variation.id} className=\"space-y-3\">\r\n                                <label className=\"block text-sm font-semibold text-gray-700\">\r\n                                    {variation.name}\r\n                                    {variation.isRequired && <span className=\"text-red-500 ml-1\">*</span>}\r\n                                </label>\r\n                                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                                    {variation.options.map(option => {\r\n                                        const isSelected = selections[variation.id] === option.id;\r\n                                        return (\r\n                                            <div\r\n                                                key={option.id}\r\n                                                onClick={() => handleSelectionChange(variation.id, option.id)}\r\n                                                className={`\r\n                                                    cursor-pointer p-3 rounded-lg border-2 transition-all flex justify-between items-center\r\n                                                    ${isSelected\r\n                                                        ? 'border-accent bg-accent/5 text-primary'\r\n                                                        : 'border-gray-200 hover:border-gray-300'\r\n                                                    }\r\n                                                `}\r\n                                            >\r\n                                                <span className=\"font-medium\">{option.name}</span>\r\n                                                {option.priceAdjustment !== 0 && (\r\n                                                    <span className=\"text-sm text-gray-500\">\r\n                                                        {option.priceAdjustment > 0 ? '+' : ''}${option.priceAdjustment.toFixed(2)}\r\n                                                    </span>\r\n                                                )}\r\n                                                {isSelected && <Check size={16} className=\"text-primary\" />}\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"p-6 border-t border-gray-100 bg-gray-50\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <span className=\"text-gray-600 font-medium\">Total Price:</span>\r\n                        <span className=\"text-2xl font-bold text-primary\">${calculateTotal().toFixed(2)}</span>\r\n                    </div>\r\n                    <button\r\n                        onClick={handleSubmit}\r\n                        disabled={!isValid()}\r\n                        className={`\r\n                            w-full py-3 rounded-lg font-bold text-lg shadow-sm transition-all\r\n                            ${isValid()\r\n                                ? 'bg-accent text-primary hover:brightness-105 hover:shadow-md'\r\n                                : 'bg-gray-300 text-gray-500 cursor-not-allowed'\r\n                            }\r\n                        `}\r\n                    >\r\n                        Add to Cart\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\components\\admin\\SubeventForm.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\components\\admin\\SubeventVariationManager.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchVariations'. Either include it or remove the dependency array.","line":37,"column":8,"nodeType":"ArrayExpression","endLine":37,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [fetchVariations, subevent]","fix":{"range":[1363,1373],"text":"[fetchVariations, subevent]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":59,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":59,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":73,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":97,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":97,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":111,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":111,"endColumn":23}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { X, Plus, Trash2 } from 'lucide-react';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { useNotification } from '../../context/NotificationContext';\r\n\r\nexport default function SubeventVariationManager({ subevent, onClose }) {\r\n    const { token } = useAuth();\r\n    const { notify, confirm } = useNotification();\r\n    const [variations, setVariations] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Form States\r\n    const [newVarName, setNewVarName] = useState('');\r\n    const [newVarRequired, setNewVarRequired] = useState(true);\r\n    const [newOptionState, setNewOptionState] = useState({}); // { [varId]: { name: '', price: '' } }\r\n\r\n\r\n    const fetchVariations = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch(`/api/subevents/${subevent.subevent_id}/variations`, {\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (res.ok) {\r\n                setVariations(await res.json());\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            notify(\"Failed to load variations\", \"error\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchVariations();\r\n    }, [subevent]);\r\n\r\n    const handleAddVariation = async () => {\r\n        if (!newVarName) return;\r\n        try {\r\n            const res = await fetch(`/api/subevents/${subevent.subevent_id}/variations`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({ name: newVarName, isRequired: newVarRequired })\r\n            });\r\n\r\n            if (res.ok) {\r\n                setNewVarName('');\r\n                fetchVariations();\r\n                notify(\"Variation Category added\", \"success\");\r\n            } else {\r\n                notify(\"Failed to add category\", \"error\");\r\n            }\r\n        } catch (e) { notify(\"Error adding category\", \"error\"); }\r\n    };\r\n\r\n    const handleDeleteVariation = async (id) => {\r\n        confirm(\"Delete this category and all its options?\", async () => {\r\n            try {\r\n                const res = await fetch(`/api/variations/${id}`, {\r\n                    method: 'DELETE',\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n                if (res.ok) {\r\n                    setVariations(prev => prev.filter(v => v.id !== id));\r\n                    notify(\"Deleted\", \"success\");\r\n                }\r\n            } catch (e) { notify(\"Error deleting\", \"error\"); }\r\n        });\r\n    };\r\n\r\n    const handleAddOption = async (varId) => {\r\n        const state = newOptionState[varId] || {};\r\n        if (!state.name) return;\r\n\r\n        try {\r\n            const res = await fetch(`/api/variations/${varId}/options`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({ name: state.name, priceAdjustment: parseFloat(state.price) || 0 })\r\n            });\r\n\r\n            if (res.ok) {\r\n                setNewOptionState(prev => ({ ...prev, [varId]: { name: '', price: '' } }));\r\n                fetchVariations(); // Refresh to show new option\r\n                notify(\"Option added\", \"success\");\r\n            }\r\n        } catch (e) { notify(\"Error adding option\", \"error\"); }\r\n    };\r\n\r\n    const handleDeleteOption = async (optId) => {\r\n        confirm(\"Delete this option?\", async () => {\r\n            try {\r\n                const res = await fetch(`/api/variation-options/${optId}`, {\r\n                    method: 'DELETE',\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n                if (res.ok) {\r\n                    fetchVariations();\r\n                    notify(\"Option deleted\", \"success\");\r\n                }\r\n            } catch (e) { notify(\"Error deleting option\", \"error\"); }\r\n        });\r\n    };\r\n\r\n    const updateOptionState = (varId, field, value) => {\r\n        setNewOptionState(prev => ({\r\n            ...prev,\r\n            [varId]: { ...prev[varId], [field]: value }\r\n        }));\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n            <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden\">\r\n                <div className=\"p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50\">\r\n                    <div>\r\n                        <h2 className=\"text-xl font-bold text-gray-900\">Manage Variations</h2>\r\n                        <p className=\"text-sm text-gray-500\">For {subevent.name}</p>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"p-2 hover:bg-gray-200 rounded-full transition-colors\">\r\n                        <X size={20} className=\"text-gray-500\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"p-6 overflow-y-auto flex-1 bg-gray-50/50\">\r\n\r\n                    {/* List Existing Variations */}\r\n                    <div className=\"space-y-6\">\r\n                        {loading ? <p>Loading...</p> : variations.map(v => (\r\n                            <div key={v.id} className=\"bg-white border border-gray-200 rounded-lg shadow-sm\">\r\n                                <div className=\"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <h3 className=\"font-bold text-gray-800\">{v.name}</h3>\r\n                                        {v.isRequired ? (\r\n                                            <span className=\"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full font-medium\">Required</span>\r\n                                        ) : (\r\n                                            <span className=\"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full font-medium\">Optional</span>\r\n                                        )}\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={() => handleDeleteVariation(v.id)}\r\n                                        className=\"text-gray-400 hover:text-red-500 transition-colors\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                    </button>\r\n                                </div>\r\n                                <div className=\"p-4\">\r\n                                    <div className=\"flex flex-wrap gap-2 mb-4\">\r\n                                        {v.options.map(opt => (\r\n                                            <div key={opt.id} className=\"flex items-center gap-2 bg-gray-100 px-3 py-1.5 rounded-lg border border-gray-200\">\r\n                                                <span className=\"font-medium\">{opt.name}</span>\r\n                                                {opt.priceAdjustment !== 0 && (\r\n                                                    <span className={`text-xs font-bold ${opt.priceAdjustment > 0 ? 'text-green-600' : 'text-red-600'}`}>\r\n                                                        {opt.priceAdjustment > 0 ? '+' : ''}${opt.priceAdjustment.toFixed(2)}\r\n                                                    </span>\r\n                                                )}\r\n                                                <button\r\n                                                    onClick={() => handleDeleteOption(opt.id)}\r\n                                                    className=\"pl-2 text-gray-400 hover:text-red-500\"\r\n                                                >\r\n                                                    &times;\r\n                                                </button>\r\n                                            </div>\r\n                                        ))}\r\n                                        {v.options.length === 0 && <span className=\"text-sm text-gray-400 italic\">No options yet.</span>}\r\n                                    </div>\r\n\r\n                                    {/* Add Option Form */}\r\n                                    <div className=\"flex gap-2 items-center\">\r\n                                        <input\r\n                                            placeholder=\"Option Name (e.g. Medium)\"\r\n                                            className=\"flex-1 p-2 border border-gray-200 rounded text-sm\"\r\n                                            value={newOptionState[v.id]?.name || ''}\r\n                                            onChange={e => updateOptionState(v.id, 'name', e.target.value)}\r\n                                        />\r\n                                        <input\r\n                                            placeholder=\"Price Adj (optional)\"\r\n                                            type=\"number\"\r\n                                            className=\"w-24 p-2 border border-gray-200 rounded text-sm\"\r\n                                            value={newOptionState[v.id]?.price || ''}\r\n                                            onChange={e => updateOptionState(v.id, 'price', e.target.value)}\r\n                                        />\r\n                                        <button\r\n                                            onClick={() => handleAddOption(v.id)}\r\n                                            className=\"bg-gray-800 text-white p-2 rounded hover:bg-black transition-colors\"\r\n                                        >\r\n                                            <Plus size={16} />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Add New Variation Category */}\r\n                    <div className=\"mt-8 pt-6 border-t border-gray-200\">\r\n                        <h4 className=\"font-bold text-gray-700 mb-3\">Add New Variation Category</h4>\r\n                        <div className=\"flex gap-3 items-end\">\r\n                            <div className=\"flex-1\">\r\n                                <label className=\"block text-xs text-gray-500 mb-1 uppercase font-bold tracking-wider\">Name</label>\r\n                                <input\r\n                                    className=\"w-full p-2 border border-gray-300 rounded\"\r\n                                    placeholder=\"e.g. Cook Time\"\r\n                                    value={newVarName}\r\n                                    onChange={e => setNewVarName(e.target.value)}\r\n                                />\r\n                            </div>\r\n                            <div className=\"pb-2\">\r\n                                <label className=\"flex items-center gap-2 cursor-pointer select-none\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={newVarRequired}\r\n                                        onChange={e => setNewVarRequired(e.target.checked)}\r\n                                        className=\"w-4 h-4 text-purple-600 rounded\"\r\n                                    />\r\n                                    <span className=\"text-sm font-medium text-gray-700\">Required Selection</span>\r\n                                </label>\r\n                            </div>\r\n                            <button\r\n                                onClick={handleAddVariation}\r\n                                disabled={!newVarName}\r\n                                className=\"bg-primary text-secondary px-4 py-2 rounded font-bold hover:brightness-110 disabled:opacity-50 h-[42px]\"\r\n                            >\r\n                                Create\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"p-4 border-t border-gray-200 bg-white flex justify-end\">\r\n                    <button onClick={onClose} className=\"px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded font-medium transition-colors\">\r\n                        Done\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\components\\ui\\ConfirmationModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\components\\ui\\ToastContainer.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\context\\AuthContext.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  14 |\n  15 |     if (storedToken && savedUser) {\n> 16 |       setToken(storedToken);\n     |       ^^^^^^^^ Avoid calling setState() directly within an effect\n  17 |       setUser(JSON.parse(savedUser));\n  18 |     }\n  19 |     setLoading(false);","line":16,"column":7,"nodeType":null,"endLine":16,"endColumn":15},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":43,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":43,"endColumn":21}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useState, useEffect, useContext } from 'react';\r\n\r\nconst AuthContext = createContext(null);\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [token, setToken] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // 1. Check local storage on initial load\r\n    const storedToken = localStorage.getItem('token');\r\n    const savedUser = localStorage.getItem('user');\r\n\r\n    if (storedToken && savedUser) {\r\n      setToken(storedToken);\r\n      setUser(JSON.parse(savedUser));\r\n    }\r\n    setLoading(false);\r\n  }, []);\r\n\r\n  const login = (newToken, userData) => {\r\n    localStorage.setItem('token', newToken);\r\n    localStorage.setItem('user', JSON.stringify(userData));\r\n    setToken(newToken);\r\n    setUser(userData);\r\n  };\r\n\r\n  const logout = () => {\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('user');\r\n    setToken(null);\r\n    setUser(null);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, token, login, logout, loading }}>\r\n      {!loading && children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => useContext(AuthContext);","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\context\\CartContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":5,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":5,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, useEffect } from 'react';\r\n\r\nconst CartContext = createContext();\r\n\r\nexport function useCart() {\r\n    return useContext(CartContext);\r\n}\r\n\r\nexport function CartProvider({ children }) {\r\n    const [cart, setCart] = useState(() => {\r\n        try {\r\n            const saved = localStorage.getItem('cart');\r\n            return saved ? JSON.parse(saved) : [];\r\n        } catch (e) {\r\n            console.error(e);\r\n            return [];\r\n        }\r\n    });\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem('cart', JSON.stringify(cart));\r\n    }, [cart]);\r\n\r\n    const addToCart = (item) => {\r\n        setCart(prev => [...prev, item]);\r\n    };\r\n\r\n    const removeFromCart = (index) => {\r\n        setCart(prev => prev.filter((_, i) => i !== index));\r\n    };\r\n\r\n    const clearCart = () => setCart([]);\r\n\r\n    const cartTotal = cart.reduce((sum, item) => sum + Number(item.price || 0), 0);\r\n\r\n    return (\r\n        <CartContext.Provider value={{ cart, addToCart, removeFromCart, clearCart, cartTotal }}>\r\n            {children}\r\n        </CartContext.Provider>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\context\\NotificationContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":7,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":7,"endColumn":29},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`closeConfirm` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\n  36 |             onConfirm: () => {\n  37 |                 if (onConfirm) onConfirm();\n> 38 |                 closeConfirm();\n     |                 ^^^^^^^^^^^^ `closeConfirm` accessed before it is declared\n  39 |             },\n  40 |             onCancel: () => {\n  41 |                 closeConfirm();\n\n  44 |     }, []);\n  45 |\n> 46 |     const closeConfirm = () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 47 |         setConfirmState(prev => ({ ...prev, isOpen: false }));\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 48 |     };\n     | ^^^^^^^ `closeConfirm` is declared here\n  49 |\n  50 |     return (\n  51 |         <NotificationContext.Provider value={{ notify, confirm }}>","line":38,"column":17,"nodeType":null,"endLine":38,"endColumn":29}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useCallback } from 'react';\r\nimport ToastContainer from '../components/ui/ToastContainer';\r\nimport ConfirmationModal from '../components/ui/ConfirmationModal';\r\n\r\nconst NotificationContext = createContext();\r\n\r\nexport const useNotification = () => useContext(NotificationContext);\r\n\r\nexport const NotificationProvider = ({ children }) => {\r\n    // Toast State\r\n    const [toasts, setToasts] = useState([]);\r\n\r\n    // Confirmation State\r\n    const [confirmState, setConfirmState] = useState({\r\n        isOpen: false,\r\n        message: '',\r\n        onConfirm: null,\r\n        onCancel: null\r\n    });\r\n\r\n    // --- Toast Logic ---\r\n    const notify = useCallback((message, type = 'info') => {\r\n        const id = Date.now() + Math.random();\r\n        setToasts(prev => [...prev, { id, message, type }]);\r\n    }, []);\r\n\r\n    const removeToast = useCallback((id) => {\r\n        setToasts(prev => prev.filter(t => t.id !== id));\r\n    }, []);\r\n\r\n    // --- Confirm Logic ---\r\n    const confirm = useCallback((message, onConfirm) => {\r\n        setConfirmState({\r\n            isOpen: true,\r\n            message,\r\n            onConfirm: () => {\r\n                if (onConfirm) onConfirm();\r\n                closeConfirm();\r\n            },\r\n            onCancel: () => {\r\n                closeConfirm();\r\n            }\r\n        });\r\n    }, []);\r\n\r\n    const closeConfirm = () => {\r\n        setConfirmState(prev => ({ ...prev, isOpen: false }));\r\n    };\r\n\r\n    return (\r\n        <NotificationContext.Provider value={{ notify, confirm }}>\r\n            {children}\r\n            <ToastContainer toasts={toasts} removeToast={removeToast} />\r\n            <ConfirmationModal\r\n                isOpen={confirmState.isOpen}\r\n                message={confirmState.message}\r\n                onConfirm={confirmState.onConfirm}\r\n                onCancel={confirmState.onCancel}\r\n            />\r\n        </NotificationContext.Provider>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\main.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\Checkout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\EventDetails.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":11,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"navigate"},"fix":{"range":[518,549],"text":""},"desc":"Remove unused variable 'navigate'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'location' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":12,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"location"},"fix":{"range":[555,586],"text":""},"desc":"Remove unused variable 'location'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":13,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":17,"suggestions":[{"messageId":"removeVar","data":{"varName":"user"},"fix":{"range":[592,619],"text":""},"desc":"Remove unused variable 'user'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'notify' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":14,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"notify"},"fix":{"range":[625,662],"text":""},"desc":"Remove unused variable 'notify'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'tickets' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":44,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":36,"suggestions":[{"messageId":"removeVar","data":{"varName":"tickets"},"fix":{"range":[2181,2189],"text":""},"desc":"Remove unused variable 'tickets'."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useParams, Link, useNavigate, useLocation } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useNotification } from '../context/NotificationContext';\r\nimport CampsiteModal from '../components/CampsiteModal';\r\nimport PublicRegistrationModal from '../components/Public/PublicRegistrationModal';\r\n\r\nfunction EventDetails({ propSlug }) {\r\n    const { slug: paramSlug } = useParams();\r\n    const slug = propSlug || paramSlug;\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n    const { user } = useAuth();\r\n    const { notify } = useNotification();\r\n\r\n    const [event, setEvent] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n\r\n    // Purchase State (Legacy - Moved to StorePage.jsx)\r\n    // Only Public Registration Modal kept here\r\n    const [showPublicModal, setShowPublicModal] = useState(false);\r\n    const [selectedPublicDay, setSelectedPublicDay] = useState(null);\r\n\r\n    // Products Map Cache (Still used? If tickets are displayed for info only, maybe. \r\n    // But tickets are usually hidden if we don't want people buying here. \r\n    // The user said \"This is the main \"brochure\" style page\".\r\n    // Let's remove tickets state if it's not needed for Public Reg, \r\n    // BUT the page might list tickets for information? \r\n    // Code inspection says it renders tickets in a modal 'showTicketModal'.\r\n    // If we remove that modal, we don't need tickets state for that purpose.\r\n    // We'll keep 'event' and 'loading' obviously.\r\n\r\n    useEffect(() => {\r\n        async function fetchEvent() {\r\n            try {\r\n                // Cache: no-store to ensure updates (e.g. description changes) appear immediately\r\n                const response = await fetch(`/api/events/${slug}`, { cache: 'no-store' });\r\n                if (response.status === 404) throw new Error('Event not found');\r\n                const data = await response.json();\r\n\r\n                // We just need the event data. Tickets are for the Store.\r\n                if (data.tickets) {\r\n                    const { tickets, ...eventData } = data;\r\n                    setEvent(eventData);\r\n                } else {\r\n                    setEvent(data);\r\n                }\r\n\r\n            } catch (err) {\r\n                setError(err.message);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        }\r\n        fetchEvent();\r\n    }, [slug]);\r\n\r\n    // Removed: My Pilots Fetch (Only needed for purchasing/managing)\r\n    // Removed: Linked Products Fetch (Only needed for purchasing)\r\n    // Removed: Cart/Checkout Handlers\r\n\r\n    if (loading) return <div className=\"container\">Loading...</div>;\r\n    if (error) return <div className=\"container error\">{error}</div>;\r\n    if (!event) return <div className=\"container\">Event not found</div>;\r\n\r\n    return (\r\n        <div className=\"container mx-auto px-4 py-6\">\r\n            {event.banner_url && (\r\n                <div className=\"w-full h-48 md:h-[350px] rounded-xl overflow-hidden mb-8 shadow-md bg-gray-200\">\r\n                    <img\r\n                        src={event.banner_url}\r\n                        alt={event.name}\r\n                        className=\"w-full h-full object-cover object-center\"\r\n                    />\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"max-w-3xl mx-auto text-center\">\r\n                <h1 className=\"text-3xl md:text-5xl font-bold my-6 text-gray-900\">{event.name}</h1>\r\n                <p className=\"whitespace-pre-wrap mb-8 text-gray-700 leading-relaxed text-lg text-left md:text-center\">{event.description}</p>\r\n\r\n                <div className=\"flex flex-col sm:flex-row justify-center gap-4\">\r\n                    {/* Links to Store if logged in? Or just rely on Nav. */}\r\n                    {/* Maybe a \"Buy Tickets\" button that goes to the store? user didn't ask, but it's helpful. */}\r\n                    {/* For now, just removing the dead buttons as requested. */}\r\n                </div>\r\n\r\n                {/* Public Event Days Section */}\r\n                {event.public_days && event.public_days.length > 0 && (\r\n                    <div className=\"mt-12 bg-white rounded-xl shadow-sm border border-gray-100 p-8 text-left\">\r\n                        <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-6\">\r\n                            <div>\r\n                                <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Air Show Registration (Public Attendance)</h2>\r\n                                <p className=\"text-gray-600\">Register your attendance for the public air show days. It's free!</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid gap-4 mt-6\">\r\n                            {event.public_days.map(day => (\r\n                                <div key={day.id} className=\"border border-gray-200 rounded-lg p-5 hover:border-blue-300 transition-colors bg-blue-50/30\">\r\n                                    <div className=\"flex flex-col gap-4\">\r\n                                        <div>\r\n                                            <h3 className=\"text-lg font-bold text-[#0f172a]\">{day.title}</h3>\r\n                                            <div className=\"text-sm text-gray-600 mt-1 flex flex-wrap gap-x-4 gap-y-1\">\r\n                                                <span>\r\n                                                    üìÖ {new Date(day.date).toLocaleDateString('en-AU', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}\r\n                                                </span>\r\n                                                {day.start_time && (\r\n                                                    <span>\r\n                                                        ‚è∞ {day.start_time.substring(0, 5)} - {day.end_time?.substring(0, 5)}\r\n                                                    </span>\r\n                                                )}\r\n                                            </div>\r\n                                            {day.description && <p className=\"text-sm text-gray-500 mt-2 whitespace-pre-wrap\">{day.description}</p>}\r\n                                        </div>\r\n                                        <div className=\"self-start\">\r\n                                            <button\r\n                                                onClick={() => {\r\n                                                    setSelectedPublicDay(day);\r\n                                                    setShowPublicModal(true);\r\n                                                }}\r\n                                                className=\"bg-[#0f172a] text-white hover:bg-[#1e293b] font-medium py-2 px-6 rounded-lg transition-colors whitespace-nowrap shadow-md hover:shadow-lg\"\r\n                                            >\r\n                                                Register for Air Show\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Public Registration Modal */}\r\n                <PublicRegistrationModal\r\n                    isOpen={showPublicModal}\r\n                    onClose={() => setShowPublicModal(false)}\r\n                    publicDay={selectedPublicDay}\r\n                />\r\n\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default EventDetails;","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\EventPurchase.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\Events.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\FAQ.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":20,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { ChevronDown, ChevronUp } from 'lucide-react';\r\n\r\nfunction FAQ() {\r\n    const [faqs, setFaqs] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n    const [openIndex, setOpenIndex] = useState(null);\r\n\r\n    useEffect(() => {\r\n        const fetchFaqs = async () => {\r\n            try {\r\n                const res = await fetch('/api/public/faqs');\r\n                if (res.ok) {\r\n                    const data = await res.json();\r\n                    setFaqs(data);\r\n                } else {\r\n                    setError('Failed to load FAQs');\r\n                }\r\n            } catch (e) {\r\n                setError('Error loading FAQs');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchFaqs();\r\n    }, []);\r\n\r\n    const toggleOpen = (index) => {\r\n        setOpenIndex(openIndex === index ? null : index);\r\n    };\r\n\r\n    if (loading) return <div className=\"container mx-auto p-8 text-center\">Loading FAQs...</div>;\r\n    if (error) return <div className=\"container mx-auto p-8 text-center text-red-500\">{error}</div>;\r\n\r\n    return (\r\n        <div className=\"container mx-auto max-w-4xl p-4 md:p-8\">\r\n            <h1 className=\"text-3xl font-bold mb-8 text-center\">Frequently Asked Questions</h1>\r\n\r\n            {faqs.length === 0 ? (\r\n                <div className=\"text-center text-gray-500\">No questions have been posted yet.</div>\r\n            ) : (\r\n                <div className=\"space-y-4\">\r\n                    {faqs.map((faq, index) => (\r\n                        <div\r\n                            key={faq.id}\r\n                            className=\"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden transition-all duration-200\"\r\n                        >\r\n                            <button\r\n                                onClick={() => toggleOpen(index)}\r\n                                className=\"w-full text-left p-5 flex justify-between items-center bg-white hover:bg-gray-50 transition-colors focus:outline-none\"\r\n                            >\r\n                                <span className=\"font-bold text-lg text-gray-800 pr-4\">{faq.question}</span>\r\n                                {openIndex === index ? (\r\n                                    <ChevronUp className=\"flex-shrink-0 text-accent\" />\r\n                                ) : (\r\n                                    <ChevronDown className=\"flex-shrink-0 text-gray-400\" />\r\n                                )}\r\n                            </button>\r\n\r\n                            {openIndex === index && (\r\n                                <div className=\"p-5 pt-0 text-gray-600 border-t border-gray-100 bg-gray-50/50\">\r\n                                    <div className=\"flex flex-col md:flex-row gap-6\">\r\n                                        <div className=\"prose max-w-none whitespace-pre-line leading-relaxed flex-1\">\r\n                                            {faq.answer}\r\n                                        </div>\r\n                                        {faq.image_url && (\r\n                                            <div className=\"md:w-1/3 flex-shrink-0 relative\">\r\n                                                <img\r\n                                                    src={faq.image_url}\r\n                                                    alt=\"Reference\"\r\n                                                    className=\"w-full h-full object-cover rounded-lg shadow-sm\"\r\n                                                    style={{ minHeight: '200px' }}\r\n                                                />\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default FAQ;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\Home.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\Invoice.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\Login.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\MyFlightLineDuties.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'notify'. Either include it or remove the dependency array.","line":32,"column":8,"nodeType":"ArrayExpression","endLine":32,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [notify, slug, token]","fix":{"range":[1190,1203],"text":"[notify, slug, token]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchDuties'. Either include it or remove the dependency array.","line":38,"column":8,"nodeType":"ArrayExpression","endLine":38,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [event, fetchDuties]","fix":{"range":[1313,1320],"text":"[event, fetchDuties]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { useNotification } from '../context/NotificationContext';\r\n\r\nfunction MyFlightLineDuties() {\r\n    const { slug } = useParams();\r\n    const { notify } = useNotification();\r\n    const token = localStorage.getItem('token');\r\n\r\n    const [loading, setLoading] = useState(true);\r\n    const [event, setEvent] = useState(null);\r\n    const [pilots, setPilots] = useState([]);\r\n    const [duties, setDuties] = useState([]);\r\n    const [selectedPilot, setSelectedPilot] = useState('all');\r\n\r\n    // Fetch event details\r\n    useEffect(() => {\r\n        const fetchEvent = async () => {\r\n            try {\r\n                const res = await fetch(`/api/events/${slug}`, {\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n                if (!res.ok) throw new Error('Event not found');\r\n                const data = await res.json();\r\n                setEvent(data);\r\n            } catch (err) {\r\n                notify(err.message, 'error');\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchEvent();\r\n    }, [slug, token]);\r\n\r\n    // Fetch duties\r\n    useEffect(() => {\r\n        if (!event) return;\r\n        fetchDuties();\r\n    }, [event]);\r\n\r\n    const fetchDuties = async () => {\r\n        try {\r\n            const res = await fetch(`/api/events/${slug}/my-flight-line-duties`, {\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (!res.ok) throw new Error('Failed to fetch duties');\r\n            const data = await res.json();\r\n            setPilots(data.pilots);\r\n            setDuties(data.duties);\r\n            setLoading(false);\r\n        } catch (err) {\r\n            notify(err.message, 'error');\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const formatTime = (timeValue) => {\r\n        if (!timeValue) return '';\r\n        if (typeof timeValue === 'string' && timeValue.includes('T')) {\r\n            const timePart = timeValue.split('T')[1];\r\n            return timePart.substring(0, 5);\r\n        }\r\n        if (typeof timeValue === 'string') {\r\n            return timeValue.substring(0, 5);\r\n        }\r\n        return timeValue;\r\n    };\r\n\r\n    const formatDate = (dateStr) => {\r\n        const date = new Date(dateStr);\r\n        return date.toLocaleDateString('en-US', {\r\n            weekday: 'long',\r\n            year: 'numeric',\r\n            month: 'long',\r\n            day: 'numeric'\r\n        });\r\n    };\r\n\r\n    // Filter duties by selected pilot\r\n    const filteredDuties = selectedPilot === 'all'\r\n        ? duties\r\n        : duties.filter(d => d.attendee_id === parseInt(selectedPilot));\r\n\r\n    // Group duties by date\r\n    const groupedDuties = filteredDuties.reduce((acc, duty) => {\r\n        const date = duty.roster_date;\r\n        if (!acc[date]) acc[date] = [];\r\n        acc[date].push(duty);\r\n        return acc;\r\n    }, {});\r\n\r\n    // Get pilot with flight line duties enabled\r\n    const pilotsWithDuties = pilots.filter(p => p.flight_line_duties);\r\n\r\n    if (loading) return <div className=\"container\">Loading...</div>;\r\n    if (!event) return <div className=\"container\">Event not found</div>;\r\n\r\n    return (\r\n        <div className=\"container\" style={{ maxWidth: '900px', margin: '2rem auto' }}>\r\n            <div style={{ marginBottom: '2rem' }}>\r\n                <h1>My Flight Line Duties</h1>\r\n                <p style={{ color: '#666', margin: '0.5rem 0 0' }}>Event: {event.name}</p>\r\n            </div>\r\n\r\n            {/* Pilot Filter */}\r\n            {pilotsWithDuties.length > 1 && (\r\n                <div className=\"card\" style={{ padding: '1.5rem', marginBottom: '2rem' }}>\r\n                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>\r\n                        Select Pilot:\r\n                    </label>\r\n                    <select\r\n                        value={selectedPilot}\r\n                        onChange={(e) => setSelectedPilot(e.target.value)}\r\n                        className=\"form-control\"\r\n                        style={{ width: '100%', maxWidth: '400px' }}\r\n                    >\r\n                        <option value=\"all\">All My Pilots</option>\r\n                        {pilotsWithDuties.map(pilot => (\r\n                            <option key={pilot.attendee_id} value={pilot.attendee_id}>\r\n                                {pilot.first_name} {pilot.last_name}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n            )}\r\n\r\n            {/* No Duties Message */}\r\n            {pilotsWithDuties.length === 0 && (\r\n                <div className=\"card\" style={{ padding: '2rem', textAlign: 'center' }}>\r\n                    <p style={{ color: '#666', fontSize: '1.1rem' }}>\r\n                        None of your registered pilots have flight line duties enabled.\r\n                    </p>\r\n                </div>\r\n            )}\r\n\r\n            {pilotsWithDuties.length > 0 && filteredDuties.length === 0 && (\r\n                <div className=\"card\" style={{ padding: '2rem', textAlign: 'center' }}>\r\n                    <p style={{ color: '#666', fontSize: '1.1rem' }}>\r\n                        No flight line duties assigned yet.\r\n                    </p>\r\n                    <p style={{ color: '#999', fontSize: '0.9rem', marginTop: '0.5rem' }}>\r\n                        Duties will appear here once the event organizer assigns them.\r\n                    </p>\r\n                </div>\r\n            )}\r\n\r\n            {/* Duties List */}\r\n            {filteredDuties.length > 0 && (\r\n                <div>\r\n                    {Object.keys(groupedDuties).sort().map(date => (\r\n                        <div key={date} className=\"card\" style={{ padding: '2rem', marginBottom: '1.5rem' }}>\r\n                            <h2 style={{ marginTop: 0, marginBottom: '1.5rem', fontSize: '1.3rem', borderBottom: '2px solid #e5e7eb', paddingBottom: '0.5rem' }}>\r\n                                {formatDate(date)}\r\n                            </h2>\r\n\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n                                {groupedDuties[date].map(duty => {\r\n                                    const pilot = pilots.find(p => p.attendee_id === duty.attendee_id);\r\n                                    return (\r\n                                        <div\r\n                                            key={duty.roster_id}\r\n                                            style={{\r\n                                                padding: '1rem',\r\n                                                background: '#f9fafb',\r\n                                                borderRadius: '8px',\r\n                                                borderLeft: '4px solid #2563eb'\r\n                                            }}\r\n                                        >\r\n                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '1rem' }}>\r\n                                                <div style={{ flex: '1', minWidth: '200px' }}>\r\n                                                    <div style={{ fontSize: '1.1rem', fontWeight: 'bold', color: '#111', marginBottom: '0.25rem' }}>\r\n                                                        {duty.flight_line_name}\r\n                                                    </div>\r\n                                                    {pilotsWithDuties.length > 1 && selectedPilot === 'all' && (\r\n                                                        <div style={{ fontSize: '0.9rem', color: '#666', marginBottom: '0.25rem' }}>\r\n                                                            Pilot: {pilot?.first_name} {pilot?.last_name}\r\n                                                        </div>\r\n                                                    )}\r\n                                                    <div style={{ fontSize: '1rem', color: '#444' }}>\r\n                                                        ‚è∞ {formatTime(duty.start_time)} - {formatTime(duty.end_time)}\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div style={{\r\n                                                    padding: '0.5rem 1rem',\r\n                                                    background: '#dbeafe',\r\n                                                    color: '#1e40af',\r\n                                                    borderRadius: '6px',\r\n                                                    fontSize: '0.9rem',\r\n                                                    fontWeight: '500'\r\n                                                }}>\r\n                                                    Duration: {calculateDuration(duty.start_time, duty.end_time)}\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Summary */}\r\n            {filteredDuties.length > 0 && (\r\n                <div className=\"card\" style={{ padding: '1.5rem', background: '#f0fdf4', border: '1px solid #bbf7d0' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-around', textAlign: 'center', flexWrap: 'wrap', gap: '1rem' }}>\r\n                        <div>\r\n                            <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#059669' }}>\r\n                                {filteredDuties.length}\r\n                            </div>\r\n                            <div style={{ fontSize: '0.9rem', color: '#047857' }}>\r\n                                Total Duties\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#059669' }}>\r\n                                {Object.keys(groupedDuties).length}\r\n                            </div>\r\n                            <div style={{ fontSize: '0.9rem', color: '#047857' }}>\r\n                                Days Scheduled\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#059669' }}>\r\n                                {calculateTotalHours(filteredDuties)}\r\n                            </div>\r\n                            <div style={{ fontSize: '0.9rem', color: '#047857' }}>\r\n                                Total Hours\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n// Helper to extract minutes from any time format (ISO string, HH:MM:SS, etc)\r\nfunction getTimeMinutes(timeValue) {\r\n    if (!timeValue) return 0;\r\n\r\n    let timeStr = '';\r\n\r\n    // Handle Date object\r\n    if (timeValue instanceof Date) {\r\n        timeStr = timeValue.toTimeString().substring(0, 5);\r\n    }\r\n    // Handle ISO string (2026-01-01T10:00:00)\r\n    else if (typeof timeValue === 'string' && timeValue.includes('T')) {\r\n        timeStr = timeValue.split('T')[1].substring(0, 5);\r\n    }\r\n    // Handle simple string (10:00:00)\r\n    else if (typeof timeValue === 'string') {\r\n        timeStr = timeValue.substring(0, 5);\r\n    }\r\n\r\n    if (!timeStr.includes(':')) return 0;\r\n\r\n    const [hours, minutes] = timeStr.split(':').map(Number);\r\n    return (hours * 60) + minutes;\r\n}\r\n\r\n// Helper function to calculate duration between two times\r\nfunction calculateDuration(startTime, endTime) {\r\n    const startMinutes = getTimeMinutes(startTime);\r\n    const endMinutes = getTimeMinutes(endTime);\r\n\r\n    let duration = endMinutes - startMinutes;\r\n\r\n    // Handle simplified case where end time is next day (though usually we have dates)\r\n    // For flight lines usually same day, but just in case of negative duration (midnight crossing)\r\n    if (duration < 0) duration += 24 * 60;\r\n\r\n    const hours = Math.floor(duration / 60);\r\n    const minutes = duration % 60;\r\n\r\n    if (hours === 0 && minutes === 0) return '0m';\r\n    if (hours === 0) return `${minutes}m`;\r\n    if (minutes === 0) return `${hours}h`;\r\n    return `${hours}h ${minutes}m`;\r\n}\r\n\r\n// Helper function to calculate total hours\r\nfunction calculateTotalHours(duties) {\r\n    let totalMinutes = 0;\r\n\r\n    duties.forEach(duty => {\r\n        const startMinutes = getTimeMinutes(duty.start_time);\r\n        const endMinutes = getTimeMinutes(duty.end_time);\r\n\r\n        let duration = endMinutes - startMinutes;\r\n        if (duration < 0) duration += 24 * 60;\r\n\r\n        totalMinutes += duration;\r\n    });\r\n\r\n    const hours = Math.floor(totalMinutes / 60);\r\n    const minutes = totalMinutes % 60;\r\n\r\n    if (hours === 0 && minutes === 0) return '0m';\r\n    if (hours === 0) return `${minutes}m`;\r\n    if (minutes === 0) return `${hours}h`;\r\n    return `${hours}h ${minutes}m`;\r\n}\r\n\r\nexport default MyFlightLineDuties;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\MyOrders.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\MyPlanes.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'selectedEventSlug' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":19,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":29,"suggestions":[{"messageId":"removeVar","data":{"varName":"selectedEventSlug"},"fix":{"range":[905,922],"text":""},"desc":"Remove unused variable 'selectedEventSlug'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPlanes'. Either include it or remove the dependency array.","line":36,"column":8,"nodeType":"ArrayExpression","endLine":36,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchPlanes]","fix":{"range":[1469,1471],"text":"[fetchPlanes]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useNotification } from '../context/NotificationContext';\r\nimport { Plane, Trash2, Edit2, Upload, FileText, Scale, Tag, ChevronRight, User, Calendar, ArrowLeft } from 'lucide-react';\r\n\r\nfunction MyPlanes() {\r\n    const { token } = useAuth();\r\n    const { notify, confirm } = useNotification();\r\n    const [loading, setLoading] = useState(true);\r\n    const [planes, setPlanes] = useState([]);\r\n\r\n    // Modal State\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n    const [modalStep, setModalStep] = useState(1); // 1: Event, 2: Pilot, 3: Details\r\n    const [editingPlane, setEditingPlane] = useState(null); // If set, we skip steps 1 & 2 (edit mode)\r\n\r\n    // Data for Selection Steps\r\n    const [pilotEvents, setPilotEvents] = useState([]); // Events where user is a pilot\r\n    const [selectedEventSlug, setSelectedEventSlug] = useState('');\r\n    const [eligiblePilots, setEligiblePilots] = useState([]); // Persons from selected event\r\n    const [selectedPersonId, setSelectedPersonId] = useState('');\r\n\r\n    // Form State\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        model_type: '',\r\n        registration_number: '',\r\n        is_heavy_model: true,\r\n        heavy_model_cert_number: '',\r\n        heavy_model_cert_image_url: '',\r\n        weight_kg: ''\r\n    });\r\n\r\n    useEffect(() => {\r\n        fetchPlanes();\r\n    }, []);\r\n\r\n    const fetchPlanes = async () => {\r\n        try {\r\n            const res = await fetch('/api/planes', {\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                }\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setPlanes(data);\r\n            } else {\r\n                notify('Failed to load planes', 'error');\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            notify('Error loading planes', 'error');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setFormData({\r\n            name: '',\r\n            model_type: '',\r\n            registration_number: '',\r\n            is_heavy_model: true,\r\n            heavy_model_cert_number: '',\r\n            heavy_model_cert_image_url: '',\r\n            weight_kg: ''\r\n        });\r\n        setSelectedEventSlug('');\r\n        setSelectedPersonId('');\r\n        setModalStep(1);\r\n    }\r\n\r\n    const handleEditClick = (plane) => {\r\n        setEditingPlane(plane);\r\n        setFormData({\r\n            name: plane.name || '',\r\n            model_type: plane.model_type || '',\r\n            registration_number: plane.registration_number || '',\r\n            is_heavy_model: true,\r\n            heavy_model_cert_number: plane.heavy_model_cert_number || '',\r\n            heavy_model_cert_image_url: plane.heavy_model_cert_image_url || '',\r\n            weight_kg: plane.weight_kg || ''\r\n        });\r\n        setIsModalOpen(true);\r\n    };\r\n\r\n    const handleCreateClick = async () => {\r\n        // Fetch Pilot Events first\r\n        try {\r\n            const res = await fetch('/api/user/pilot-events', {\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (res.ok) {\r\n                const events = await res.json();\r\n                if (events.length === 0) {\r\n                    notify(\"You must be a registered Pilot for an upcoming event to add a plane.\", \"warning\");\r\n                    return;\r\n                }\r\n                setPilotEvents(events);\r\n                setEditingPlane(null);\r\n                resetForm();\r\n                setIsModalOpen(true);\r\n            } else {\r\n                notify(\"Failed to check pilot eligibility\", \"error\");\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            notify(\"Error checking pilot eligibility\", \"error\");\r\n        }\r\n    };\r\n\r\n    const handleEventSelect = async (slug) => {\r\n        setSelectedEventSlug(slug);\r\n        // Fetch Pilots for this event\r\n        try {\r\n            const res = await fetch(`/api/events/${slug}/my-attendees`, {\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (res.ok) {\r\n                const attendees = await res.json();\r\n                // Filter is handled by API but double check? API only returns pilot role attendees.\r\n                setEligiblePilots(attendees);\r\n                setModalStep(2);\r\n            } else {\r\n                notify(\"Failed to load pilots\", \"error\");\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            notify(\"Error loading pilots\", \"error\");\r\n        }\r\n    };\r\n\r\n    const handlePilotSelect = (personId) => {\r\n        setSelectedPersonId(personId);\r\n        setModalStep(3);\r\n    };\r\n\r\n    const handleDeleteClick = (id) => {\r\n        confirm('Are you sure you want to delete this plane? This cannot be undone.', async () => {\r\n            try {\r\n                const res = await fetch(`/api/planes/${id}`, {\r\n                    method: 'DELETE',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${token}`,\r\n                        'X-Auth-Token': token\r\n                    }\r\n                });\r\n\r\n                if (res.ok) {\r\n                    notify('Plane deleted successfully', 'success');\r\n                    setPlanes(prev => prev.filter(p => p.plane_id !== id));\r\n                } else {\r\n                    const data = await res.json();\r\n                    notify(data.error || 'Failed to delete plane', 'error');\r\n                }\r\n            } catch (e) {\r\n                console.error(e);\r\n                notify('Error deleting plane', 'error');\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleFileUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        const uploadData = new FormData();\r\n        uploadData.append('file', file);\r\n\r\n        try {\r\n            notify('Uploading certificate...', 'info');\r\n            const res = await fetch('/api/upload', {\r\n                method: 'POST',\r\n                body: uploadData,\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setFormData({ ...formData, heavy_model_cert_image_url: data.url });\r\n                notify('Certificate uploaded!', 'success');\r\n            } else {\r\n                notify('Upload failed', 'error');\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            notify('Upload error', 'error');\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n\r\n        const url = editingPlane ? `/api/planes/${editingPlane.plane_id}` : '/api/planes';\r\n        const method = editingPlane ? 'PUT' : 'POST';\r\n\r\n        const payload = { ...formData };\r\n        if (!editingPlane) {\r\n            payload.person_id = selectedPersonId;\r\n        }\r\n\r\n        try {\r\n            const res = await fetch(url, {\r\n                method: method,\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify(payload)\r\n            });\r\n\r\n            if (res.ok) {\r\n                notify(editingPlane ? 'Plane updated successfully' : 'Plane registered successfully', 'success');\r\n                setIsModalOpen(false);\r\n                fetchPlanes();\r\n            } else {\r\n                const data = await res.json();\r\n                notify(data.error || 'Failed to save plane', 'error');\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            notify('Error saving plane', 'error');\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"p-8 text-center text-gray-500\">Loading hangar...</div>;\r\n\r\n    return (\r\n        <div className=\"max-w-6xl mx-auto p-4 md:p-8\">\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold text-gray-900 flex items-center gap-2\">\r\n                        <Plane className=\"text-accent\" /> My Hangar\r\n                    </h1>\r\n                    <p className=\"text-gray-600 mt-1\">Manage your aircraft and heavy model certificates.</p>\r\n                </div>\r\n                {/* Only allow adding if we are not loading. Logic inside handles validation */}\r\n                <button\r\n                    onClick={handleCreateClick}\r\n                    className=\"bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg font-bold shadow-md transition-all flex items-center gap-2\"\r\n                >\r\n                    <Plane size={18} /> Register New Plane\r\n                </button>\r\n            </div>\r\n\r\n            {planes.length === 0 ? (\r\n                <div className=\"bg-white rounded-lg shadow-sm p-8 text-center border border-gray-100\">\r\n                    <Plane className=\"mx-auto h-12 w-12 text-gray-300 mb-4\" />\r\n                    <h3 className=\"text-lg font-medium text-gray-900\">No planes found</h3>\r\n                    <p className=\"text-gray-500 mt-2\">You haven't registered any planes yet.</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                    {planes.map(plane => (\r\n                        <div key={plane.plane_id} className=\"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-md transition-shadow group\">\r\n                            <div className=\"p-6\">\r\n                                <div className=\"flex justify-between items-start mb-4\">\r\n                                    <div>\r\n                                        <h3 className=\"text-xl font-bold text-gray-900\">{plane.name || 'Unknown Aircraft'}</h3>\r\n                                        <p className=\"text-sm text-gray-500\">{plane.model_type}</p>\r\n                                    </div>\r\n                                    {plane.is_heavy_model && (\r\n                                        <span className=\"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full font-bold flex items-center gap-1\">\r\n                                            <Scale size={12} /> Heavy Model\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <div className=\"space-y-3 text-sm text-gray-600\">\r\n                                    <div className=\"flex items-center gap-2 mt-2 pt-2 border-t border-gray-50\">\r\n                                        <User size={14} className=\"text-gray-400\" />\r\n                                        <span className=\"font-medium text-xs text-gray-500 uppercase tracking-wide\">Flown By:</span>\r\n                                        <span className=\"font-semibold\">{plane.first_name || 'My'} {plane.last_name || 'Pilot'}</span>\r\n                                    </div>\r\n\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <Tag size={16} className=\"text-gray-400\" />\r\n                                        <span className=\"font-medium\">Rego:</span> {plane.registration_number || 'N/A'}\r\n                                    </div>\r\n\r\n                                    {plane.is_heavy_model && (\r\n                                        <>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <Scale size={16} className=\"text-gray-400\" />\r\n                                                <span className=\"font-medium\">Weight:</span> {plane.weight_kg} kg\r\n                                            </div>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <FileText size={16} className=\"text-gray-400\" />\r\n                                                <span className=\"font-medium\">Cert #:</span> {plane.heavy_model_cert_number || 'Pending'}\r\n                                            </div>\r\n                                            {plane.heavy_model_cert_image_url && (\r\n                                                <div className=\"mt-2 text-blue-600\">\r\n                                                    <a href={plane.heavy_model_cert_image_url} target=\"_blank\" rel=\"noreferrer\" className=\"flex items-center gap-1 hover:underline\">\r\n                                                        <FileText size={14} /> View Certificate\r\n                                                    </a>\r\n                                                </div>\r\n                                            )}\r\n                                        </>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-gray-50 px-6 py-3 border-t border-gray-100 flex justify-end gap-2\">\r\n                                <button\r\n                                    onClick={() => handleEditClick(plane)}\r\n                                    className=\"p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\"\r\n                                    title=\"Edit\"\r\n                                >\r\n                                    <Edit2 size={18} />\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => handleDeleteClick(plane.plane_id)}\r\n                                    className=\"p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors\"\r\n                                    title=\"Delete\"\r\n                                >\r\n                                    <Trash2 size={18} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Modal */}\r\n            {isModalOpen && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 animate-fade-in\">\r\n                    <div className=\"bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden animate-slide-up\">\r\n                        <div className=\"bg-primary/5 p-6 border-b border-gray-100\">\r\n                            <h2 className=\"text-xl font-bold flex items-center gap-2\">\r\n                                {editingPlane ? 'Edit Plane Details' : (\r\n                                    <>\r\n                                        {modalStep === 1 && 'Step 1: Select Event'}\r\n                                        {modalStep === 2 && 'Step 2: Select Pilot'}\r\n                                        {modalStep === 3 && 'Step 3: Plane Details'}\r\n                                    </>\r\n                                )}\r\n                            </h2>\r\n                            {/* Progress Dots if adding */}\r\n                            {!editingPlane && (\r\n                                <div className=\"flex gap-2 mt-2\">\r\n                                    <div className={`h-1.5 flex-1 rounded-full ${modalStep >= 1 ? 'bg-accent' : 'bg-gray-200'}`}></div>\r\n                                    <div className={`h-1.5 flex-1 rounded-full ${modalStep >= 2 ? 'bg-accent' : 'bg-gray-200'}`}></div>\r\n                                    <div className={`h-1.5 flex-1 rounded-full ${modalStep >= 3 ? 'bg-accent' : 'bg-gray-200'}`}></div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* STEP 1: EVENT SELECTION */}\r\n                        {!editingPlane && modalStep === 1 && (\r\n                            <div className=\"p-6 space-y-4\">\r\n                                <p className=\"text-gray-600 text-sm\">Select the event you have registered for as a Pilot.</p>\r\n                                <div className=\"space-y-2\">\r\n                                    {pilotEvents.map(event => (\r\n                                        <button\r\n                                            key={event.event_id}\r\n                                            onClick={() => handleEventSelect(event.slug)}\r\n                                            className=\"w-full text-left p-4 border border-gray-200 rounded-xl hover:border-accent hover:bg-accent/5 transition-all flex justify-between items-center group\"\r\n                                        >\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"bg-primary/10 p-2 rounded-lg text-primary\">\r\n                                                    <Calendar size={20} />\r\n                                                </div>\r\n                                                <span className=\"font-semibold text-gray-800\">{event.name}</span>\r\n                                            </div>\r\n                                            <ChevronRight className=\"text-gray-400 group-hover:text-accent\" />\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                                <div className=\"flex justify-start pt-4\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => setIsModalOpen(false)}\r\n                                        className=\"text-gray-500 hover:text-gray-700\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* STEP 2: PILOT SELECTION */}\r\n                        {!editingPlane && modalStep === 2 && (\r\n                            <div className=\"p-6 space-y-4\">\r\n                                <p className=\"text-gray-600 text-sm\">Select which Pilot profile owns this aircraft.</p>\r\n                                <div className=\"space-y-2\">\r\n                                    {eligiblePilots.length === 0 ? (\r\n                                        <div className=\"text-center py-6 text-gray-500 bg-gray-50 rounded-lg\">\r\n                                            No eligible pilot profiles found for this event.\r\n                                        </div>\r\n                                    ) : (\r\n                                        eligiblePilots.map(p => (\r\n                                            <button\r\n                                                key={p.attendee_id}\r\n                                                // Assuming we want the person_id, but the array has person_id now thanks to backend update\r\n                                                onClick={() => handlePilotSelect(p.person_id)}\r\n                                                className=\"w-full text-left p-4 border border-gray-200 rounded-xl hover:border-accent hover:bg-accent/5 transition-all flex justify-between items-center group\"\r\n                                            >\r\n                                                <div className=\"flex items-center gap-3\">\r\n                                                    <div className=\"bg-primary/10 p-2 rounded-lg text-primary\">\r\n                                                        <User size={20} />\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <div className=\"font-semibold text-gray-800\">{p.first_name} {p.last_name}</div>\r\n                                                        <div className=\"text-xs text-gray-500\">{p.ticket_name}</div>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <ChevronRight className=\"text-gray-400 group-hover:text-accent\" />\r\n                                            </button>\r\n                                        ))\r\n                                    )}\r\n                                </div>\r\n                                <div className=\"flex justify-between pt-4\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => setModalStep(1)}\r\n                                        className=\"flex items-center gap-1 text-gray-600 hover:text-gray-800\"\r\n                                    >\r\n                                        <ArrowLeft size={16} /> Back\r\n                                    </button>\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => setIsModalOpen(false)}\r\n                                        className=\"text-gray-500 hover:text-gray-700\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* STEP 3 (or EDIT): PLANE DETAILS */}\r\n                        {(editingPlane || modalStep === 3) && (\r\n                            <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\r\n                                <div className=\"grid grid-cols-2 gap-4\">\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Make / Name</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            className=\"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent outline-none transition-all\"\r\n                                            value={formData.name}\r\n                                            onChange={e => setFormData({ ...formData, name: e.target.value })}\r\n                                            required\r\n                                        />\r\n                                    </div>\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Model</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            className=\"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent outline-none transition-all\"\r\n                                            value={formData.model_type}\r\n                                            onChange={e => setFormData({ ...formData, model_type: e.target.value })}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Registration Number</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        className=\"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent outline-none transition-all\"\r\n                                        value={formData.registration_number}\r\n                                        onChange={e => setFormData({ ...formData, registration_number: e.target.value })}\r\n                                        required\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"bg-gray-50 p-4 rounded-xl space-y-4 border border-gray-200 animate-fade-in pl-1\">\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Weight (kg) *</label>\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            step=\"0.01\"\r\n                                            className=\"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent outline-none transition-all\"\r\n                                            value={formData.weight_kg}\r\n                                            onChange={e => setFormData({ ...formData, weight_kg: e.target.value })}\r\n                                            required\r\n                                        />\r\n                                    </div>\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Heavy Model Certificate #</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            className=\"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent outline-none transition-all\"\r\n                                            value={formData.heavy_model_cert_number}\r\n                                            onChange={e => setFormData({ ...formData, heavy_model_cert_number: e.target.value })}\r\n                                            required // Now required if heavy model\r\n                                        />\r\n                                    </div>\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Certificate Image / PDF</label>\r\n                                        <div className=\"flex gap-2 items-center\">\r\n                                            {formData.heavy_model_cert_image_url && (\r\n                                                <a href={formData.heavy_model_cert_image_url} target=\"_blank\" rel=\"noreferrer\" className=\"text-blue-600 text-sm hover:underline\">\r\n                                                    Current\r\n                                                </a>\r\n                                            )}\r\n                                            <label className=\"cursor-pointer bg-white border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2 shadow-sm text-sm\">\r\n                                                <Upload size={16} /> {formData.heavy_model_cert_image_url ? 'Change File' : 'Upload File'}\r\n                                                <input type=\"file\" className=\"hidden\" onChange={handleFileUpload} accept=\"image/*,.pdf\" />\r\n                                            </label>\r\n                                        </div>\r\n                                        {!formData.heavy_model_cert_image_url && <p className=\"text-xs text-red-500 mt-1\">Certificate file is required.</p>}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex gap-3 justify-end pt-4\">\r\n                                    {!editingPlane && (\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={() => setModalStep(2)}\r\n                                            className=\"px-4 py-2 text-gray-600 font-medium hover:bg-gray-100 rounded-lg transition-colors cursor-pointer mr-auto\"\r\n                                        >\r\n                                            Back\r\n                                        </button>\r\n                                    )}\r\n\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => setIsModalOpen(false)}\r\n                                        className=\"px-4 py-2 text-gray-600 font-medium hover:bg-gray-100 rounded-lg transition-colors cursor-pointer\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        type=\"submit\"\r\n                                        className=\"px-6 py-2 bg-primary text-white font-bold rounded-lg hover:bg-primary/90 shadow-md transition-all transform active:scale-95 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                                        disabled={!formData.weight_kg || !formData.heavy_model_cert_number || !formData.heavy_model_cert_image_url}\r\n                                    >\r\n                                        {editingPlane ? 'Save Changes' : 'Register Plane'}\r\n                                    </button>\r\n                                </div>\r\n                            </form>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default MyPlanes;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\OrderDetail.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\RecoverLogin.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\Register.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":13,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":17,"suggestions":[{"messageId":"removeVar","data":{"varName":"navigate"},"fix":{"range":[306,337],"text":""},"desc":"Remove unused variable 'navigate'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { useNavigate, Link } from 'react-router-dom';\r\n\r\nfunction Register() {\r\n  const [formData, setFormData] = useState({\r\n    firstName: '',\r\n    lastName: '',\r\n    email: '',\r\n    ausNumber: '',\r\n    password: ''\r\n  });\r\n  const [error, setError] = useState('');\r\n  const navigate = useNavigate();\r\n\r\n  const [success, setSuccess] = useState(false);\r\n\r\n  const handleChange = (e) => {\r\n    setFormData({ ...formData, [e.target.name]: e.target.value });\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n\r\n    try {\r\n      const res = await fetch('/api/authRegister', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(formData),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const text = await res.text();\r\n        throw new Error(text || 'Registration failed');\r\n      }\r\n\r\n      // On success, show message\r\n      setSuccess(true);\r\n    } catch (err) {\r\n      setError(err.message);\r\n    }\r\n  };\r\n\r\n  if (success) {\r\n    return (\r\n      <div className=\"auth-container\" style={{ maxWidth: '400px', margin: '2rem auto', padding: '2rem', textAlign: 'center' }}>\r\n        <h1>Registration Successful!</h1>\r\n        <p>Please check your email ({formData.email}) to verify your account.</p>\r\n        <p style={{ marginTop: '1rem' }}>\r\n          <Link to=\"/login\">Go to Login</Link>\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"auth-container\" style={{ maxWidth: '400px', margin: '2rem auto', padding: '2rem' }}>\r\n      <h1>Register</h1>\r\n      {error && <p style={{ color: 'red' }}>{error}</p>}\r\n      <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '1rem', textAlign: 'left' }}>\r\n\r\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '5px' }}>\r\n          <label style={{ fontWeight: 600, fontSize: '0.9rem' }}>First Name</label>\r\n          <input name=\"firstName\" onChange={handleChange} required autoFocus style={{ padding: '0.75rem', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n        </div>\r\n\r\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '5px' }}>\r\n          <label style={{ fontWeight: 600, fontSize: '0.9rem' }}>Last Name</label>\r\n          <input name=\"lastName\" onChange={handleChange} required style={{ padding: '0.75rem', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n        </div>\r\n\r\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '5px' }}>\r\n          <label style={{ fontWeight: 600, fontSize: '0.9rem' }}>AUS Number (Pilot ID)</label>\r\n          <input name=\"ausNumber\" onChange={handleChange} required style={{ padding: '0.75rem', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n        </div>\r\n\r\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '5px' }}>\r\n          <label style={{ fontWeight: 600, fontSize: '0.9rem' }}>Email</label>\r\n          <input name=\"email\" type=\"email\" onChange={handleChange} required style={{ padding: '0.75rem', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n        </div>\r\n\r\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '5px' }}>\r\n          <label style={{ fontWeight: 600, fontSize: '0.9rem' }}>Password</label>\r\n          <input name=\"password\" type=\"password\" onChange={handleChange} required style={{ padding: '0.75rem', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n        </div>\r\n\r\n        <button type=\"submit\" className=\"primary-button\" style={{ marginTop: '1rem', padding: '0.75rem' }}>Create Account</button>\r\n      </form>\r\n      <p style={{ marginTop: '1rem' }}>\r\n        Already have an account? <Link to=\"/login\">Log in here</Link>\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Register;","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\ResetPassword.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\RosterEventSelector.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'notify'. Either include it or remove the dependency array.","line":27,"column":8,"nodeType":"ArrayExpression","endLine":27,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [notify]","fix":{"range":[1040,1042],"text":"[notify]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useNotification } from '../context/NotificationContext';\r\n\r\nfunction RosterEventSelector() {\r\n    const navigate = useNavigate();\r\n    const { notify } = useNotification();\r\n    const [events, setEvents] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const fetchEvents = async () => {\r\n            try {\r\n                const res = await fetch('/api/events');\r\n                if (!res.ok) throw new Error('Failed to fetch events');\r\n                const data = await res.json();\r\n                // Filter for active/upcoming events only\r\n                const activeEvents = data.filter(e => new Date(e.end_date) >= new Date());\r\n                setEvents(activeEvents);\r\n                setLoading(false);\r\n            } catch (err) {\r\n                notify(err.message, 'error');\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchEvents();\r\n    }, []);\r\n\r\n    if (loading) return <div className=\"container\">Loading events...</div>;\r\n\r\n    return (\r\n        <div className=\"container\" style={{ maxWidth: '800px', margin: '2rem auto' }}>\r\n            <h1 style={{ marginBottom: '1.5rem', textAlign: 'center' }}>Select Event</h1>\r\n            <p style={{ textAlign: 'center', marginBottom: '2rem', color: '#666' }}>\r\n                Please select an event to view your flight line duties.\r\n            </p>\r\n\r\n            {events.length === 0 ? (\r\n                <div className=\"card\" style={{ padding: '2rem', textAlign: 'center' }}>\r\n                    <p>No active events found.</p>\r\n                </div>\r\n            ) : (\r\n                <div style={{ display: 'grid', gap: '1.5rem' }}>\r\n                    {events.map(event => (\r\n                        <div\r\n                            key={event.event_id}\r\n                            className=\"card\"\r\n                            style={{\r\n                                padding: '1.5rem',\r\n                                cursor: 'pointer',\r\n                                transition: 'transform 0.2s, box-shadow 0.2s',\r\n                                borderLeft: `6px solid ${event.primary_color || '#2563eb'}`\r\n                            }}\r\n                            onClick={() => navigate(`/events/${event.slug}/my-duties`)}\r\n                            onMouseOver={(e) => {\r\n                                e.currentTarget.style.transform = 'translateY(-2px)';\r\n                                e.currentTarget.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.1)';\r\n                            }}\r\n                            onMouseOut={(e) => {\r\n                                e.currentTarget.style.transform = 'translateY(0)';\r\n                                e.currentTarget.style.boxShadow = '0 1px 3px 0 rgba(0, 0, 0, 0.1)';\r\n                            }}\r\n                        >\r\n                            <h2 style={{ marginTop: 0, marginBottom: '0.5rem', fontSize: '1.25rem' }}>{event.name}</h2>\r\n                            <div style={{ display: 'flex', gap: '1rem', color: '#666', fontSize: '0.9rem' }}>\r\n                                <span>üìÖ {new Date(event.start_date).toLocaleDateString()} - {new Date(event.end_date).toLocaleDateString()}</span>\r\n                                {event.venue_name && <span>üìç {event.venue_name}</span>}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default RosterEventSelector;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\ShopIndex.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\StorePage.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'orgSettings' is defined but never used.","line":14,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":33,"suggestions":[{"messageId":"removeVar","data":{"varName":"orgSettings"},"fix":{"range":[712,727],"text":""},"desc":"Remove unused variable 'orgSettings'."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  28 |\n  29 |     useEffect(() => {\n> 30 |         setLoading(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  31 |         const headers = {};\n  32 |         if (token) {\n  33 |             headers['Authorization'] = `Bearer ${token}`;","line":30,"column":9,"nodeType":null,"endLine":30,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useCart } from '../context/CartContext';\r\nimport { useNotification } from '../context/NotificationContext';\r\nimport CampingPage from './camping/CampingPage';\r\nimport ProductCard from '../components/ProductCard';\r\nimport ProductModal from '../components/ProductModal';\r\nimport AssetSelectionModal from '../components/AssetSelectionModal';\r\nimport AttendeeModal from '../components/AttendeeModal';\r\nimport SubeventModal from '../components/SubeventModal';\r\nimport { formatDateTimeRange, formatDateForDisplay } from '../utils/dateHelpers';\r\n\r\nfunction StorePage({ orgSettings }) {\r\n    const { slug } = useParams();\r\n    const { addToCart, cart } = useCart();\r\n    const { notify } = useNotification();\r\n    const { user, token } = useAuth(); // Get token from AuthContext\r\n\r\n    const [data, setData] = useState({ merchandise: [], assets: [], subevents: [], tickets: [] });\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n    const [activeTab, setActiveTab] = useState('tickets'); // Default to tickets if available\r\n\r\n    // Attendee Check\r\n    const [isAttendee, setIsAttendee] = useState(false);\r\n    const [myPilots, setMyPilots] = useState([]); // For dropdown in modal\r\n\r\n    useEffect(() => {\r\n        setLoading(true);\r\n        const headers = {};\r\n        if (token) {\r\n            headers['Authorization'] = `Bearer ${token}`;\r\n            headers['X-Auth-Token'] = token;\r\n        }\r\n\r\n        fetch(`/api/getStoreItems?slug=${slug}`, { headers })\r\n            .then(res => {\r\n                if (res.status === 401) throw new Error(\"Unauthorized\");\r\n                if (!res.ok) throw new Error(\"Failed to load store.\");\r\n                return res.json();\r\n            })\r\n            .then(data => {\r\n                setData(data);\r\n                setIsAttendee(data.isAttendee); // DB Check from API\r\n\r\n                // Default Tab Logic\r\n                if (data.tickets && data.tickets.length > 0) setActiveTab('tickets');\r\n                else if (data.merchandise.length > 0) setActiveTab('merch');\r\n                else if (data.assets.length > 0) setActiveTab('hire');\r\n                else if (data.subevents.length > 0) setActiveTab('program');\r\n            })\r\n            .catch(err => {\r\n                if (err.message === \"Unauthorized\") {\r\n                    setError(\"You must be logged in to access the store.\");\r\n                } else {\r\n                    setError(err.message);\r\n                }\r\n            })\r\n            .finally(() => setLoading(false));\r\n    }, [slug, token]);\r\n\r\n    // Fetch My Pilots\r\n    useEffect(() => {\r\n        if (user && slug && token) {\r\n            fetch(`/api/events/${slug}/my-attendees`, {\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                }\r\n            })\r\n                .then(res => {\r\n                    if (res.ok) return res.json();\r\n                    throw new Error('Failed to fetch attendees');\r\n                })\r\n                .then(data => {\r\n                    if (Array.isArray(data)) {\r\n                        setMyPilots(data);\r\n                    }\r\n                })\r\n                .catch(err => console.error(\"Failed to fetch my pilots\", err));\r\n        }\r\n    }, [user, slug, token]);\r\n\r\n    const hasTicketInCart = cart.some(item => item.type === 'TICKET');\r\n    const isLocked = !isAttendee && !hasTicketInCart;\r\n\r\n    // Tab Handler\r\n    const handleTabClick = (tabId) => {\r\n        // Tickets are always accessible (to buy)\r\n        if (isLocked && tabId !== 'tickets' && tabId !== 'merch') {\r\n            notify(\"Please purchase an Event Ticket first to access Camping, Assets, or Subevents.\", \"error\");\r\n            return;\r\n        }\r\n        setActiveTab(tabId);\r\n    };\r\n\r\n\r\n    // UI State for Modals\r\n    const [selectedProduct, setSelectedProduct] = useState(null);\r\n    const [selectedAssetType, setSelectedAssetType] = useState(null);\r\n    const [hireDates, setHireDates] = useState({ start: null, end: null });\r\n\r\n    // Ticket Modal State\r\n    const [selectedTicketForModal, setSelectedTicketForModal] = useState(null);\r\n\r\n    // Subevent Modal State\r\n    const [selectedSubevent, setSelectedSubevent] = useState(null);\r\n\r\n    // Handlers\r\n    const handleAddMerch = (product, sku) => {\r\n        // Construct cart item\r\n        const item = {\r\n            ...product,\r\n            id: sku.product_sku_id || sku.id, // Use SKU ID as the primary ID for the cart\r\n            productId: product.id,\r\n            skuCode: sku.sku_code || sku.code,\r\n            quantity: 1, // Default to 1\r\n            price: sku.price, // Use SKU price\r\n            eventId: data.eventId,\r\n            type: 'MERCH',\r\n            // Store specific variant options for display if needed, though SKU code often suffices\r\n            variantValues: sku.variant_map || {}\r\n        };\r\n        addToCart(item);\r\n        setSelectedProduct(null);\r\n        notify(`${product.name} added to cart!`, 'success');\r\n    };\r\n\r\n    const handleOpenAssetModal = (asset) => {\r\n        setSelectedAssetType(asset);\r\n    };\r\n\r\n    const handleAddAssetToCart = (asset, specificItem, dates) => {\r\n        // specificItem is now the \"Virtual\" item containing asset_type_id and basic stats.\r\n        // It does NOT have a specific asset_item_id (or it is -1).\r\n\r\n        const item = {\r\n            uniqueId: Date.now(), // Front-end unique ID\r\n            type: 'ASSET',\r\n            name: asset.name, // Use Type Name (e.g. \"Golf Cart\")\r\n            price: specificItem.price || asset.price, // Fallback to category price\r\n            details: `Dates: ${formatDateForDisplay(dates.start)} - ${formatDateForDisplay(dates.end)}`,\r\n            checkIn: dates.start,\r\n            checkOut: dates.end,\r\n            // Key Change: Store Type ID.\r\n            id: asset.id,\r\n            assetTypeId: asset.id,\r\n            assetId: asset.id, // Legacy/Fallback compatibility\r\n            // We don't store specificItem.asset_item_id (it's -1)\r\n            item_reference_id: asset.id // For uniform handling\r\n        };\r\n\r\n        addToCart(item);\r\n        setSelectedAssetType(null);\r\n        notify(`${asset.name} added to cart!`, 'success');\r\n    };\r\n\r\n    const handleAddSubevent = (subevent) => {\r\n        // ALWAYS open modal to select Attendee\r\n        setSelectedSubevent(subevent);\r\n    };\r\n\r\n    const searchAttendees = async (query) => {\r\n        if (!query || query.length < 2) return [];\r\n        try {\r\n            const headers = {};\r\n            if (token) {\r\n                headers['Authorization'] = `Bearer ${token}`;\r\n                headers['X-Auth-Token'] = token;\r\n            }\r\n            const res = await fetch(`/api/events/${slug}/attendees/search?q=${encodeURIComponent(query)}`, { headers });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                return data.attendees || [];\r\n            }\r\n            return [];\r\n        } catch (err) {\r\n            console.error(\"Search failed\", err);\r\n            return [];\r\n        }\r\n    };\r\n\r\n    const handleConfirmSubevent = (subevent, selections, totalPrice, attendeeLink) => {\r\n        addToCart({\r\n            ...subevent,\r\n            eventId: data.eventId,\r\n            type: 'SUBEVENT',\r\n            price: totalPrice,\r\n            selectedOptions: selections,\r\n            attendeeId: attendeeLink.attendeeId, // Existing\r\n            attendeeTempId: attendeeLink.attendeeTempId, // New (Cart)\r\n            guestName: attendeeLink.guestName, // [NEW] Guest Name\r\n            attendeeName: attendeeLink.name // For display in cart if needed\r\n        });\r\n        setSelectedSubevent(null);\r\n        notify(`${subevent.name} added to cart!`, 'success');\r\n    };\r\n\r\n    const handleOpenTicketModal = (ticket) => {\r\n        setSelectedTicketForModal(ticket);\r\n    };\r\n\r\n    const handleConfirmTicket = (details) => {\r\n        if (!selectedTicketForModal) return;\r\n\r\n        // Convert details map to array\r\n        // Key is `${ticketId}_0` since we assume qty 1 for this flow\r\n        const attendees = Object.values(details);\r\n\r\n        // Calculate price based on first attendee's choice (assuming single ticket flow here)\r\n        // Store Page currently adds 1 qty at a time via modal.\r\n        let finalPrice = selectedTicketForModal.price;\r\n\r\n        // Day Pass Pricing: Calculate based on date range\r\n        if (selectedTicketForModal.is_day_pass) {\r\n            const attendee = attendees[0];\r\n            if (attendee && attendee.arrivalDate && attendee.departureDate) {\r\n                const arrival = new Date(attendee.arrivalDate);\r\n                const departure = new Date(attendee.departureDate);\r\n                const dayCount = Math.ceil((departure - arrival) / (1000 * 60 * 60 * 24)) + 1; // +1 for inclusive\r\n                finalPrice = selectedTicketForModal.price * dayCount;\r\n            }\r\n            // Note: Flight line duties checkbox doesn't affect Day Pass pricing\r\n        }\r\n        // Standard Pilot Pricing: Apply flight line surcharge if applicable\r\n        else if (selectedTicketForModal.system_role === 'pilot' && selectedTicketForModal.price_no_flight_line) {\r\n            const attendee = attendees[0];\r\n            if (attendee && !attendee.flightLineDuties) {\r\n                finalPrice = selectedTicketForModal.price_no_flight_line;\r\n            }\r\n        }\r\n\r\n        // Generate a Temp ID for linking subevents\r\n        if (attendees.length > 0) {\r\n            attendees[0].tempId = `TEMP-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n        }\r\n\r\n        const item = {\r\n            ...selectedTicketForModal,\r\n            type: 'TICKET',\r\n            quantity: 1,\r\n            price: finalPrice, // Override base price\r\n            eventId: data.eventId, // Ensure eventId is passed\r\n            attendees: attendees\r\n        };\r\n\r\n        addToCart(item);\r\n\r\n        // [NEW] Add Official Dinner Subevent if applicable\r\n        if (selectedTicketForModal.includes_official_dinner && data.official_dinner_subevent_id) {\r\n            // Check if the attendee opted in\r\n            // Since we only process one ticket/attendee at a time in this modal flow:\r\n            const attendee = attendees[0];\r\n            if (attendee && attendee.attendingDinner) {\r\n                const dinnerSubevent = data.subevents.find(s => s.id === data.official_dinner_subevent_id);\r\n                if (dinnerSubevent) {\r\n                    addToCart({\r\n                        type: 'SUBEVENT',\r\n                        id: dinnerSubevent.id,\r\n                        name: dinnerSubevent.name,\r\n                        price: 0,\r\n                        quantity: 1,\r\n                        description: 'Official Dinner Entry (Included with Ticket)',\r\n                        startTime: dinnerSubevent.startTime,\r\n                        eventId: data.eventId,\r\n                        attendeeTempId: attendee.tempId // Link to the new attendee if needed\r\n                    });\r\n                    notify(\"Official Dinner Entry added to cart\", \"success\");\r\n                }\r\n            }\r\n        }\r\n\r\n        setSelectedTicketForModal(null);\r\n        notify(`${selectedTicketForModal.name} added to cart!`, 'success');\r\n    };\r\n\r\n    if (loading) return <div className=\"p-10 text-center\">Loading Store...</div>;\r\n    if (error) {\r\n        if (error.includes(\"logged in\")) {\r\n            // Redirect or show login link\r\n            return (\r\n                <div className=\"max-w-4xl mx-auto p-8 text-center\">\r\n                    <h2 className=\"text-2xl font-bold mb-4\">Access Restricted</h2>\r\n                    <p className=\"mb-4 text-gray-600\">{error}</p>\r\n                    <a href=\"/login\" className=\"bg-primary text-white px-6 py-2 rounded\">Login</a>\r\n                </div>\r\n            );\r\n        }\r\n        return <div className=\"p-10 text-center text-red-500\">Error: {error}</div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-6xl mx-auto p-4 md:p-8\">\r\n            <h1 className=\"text-3xl font-bold mb-8 text-primary\">Event Store: {data.eventName || slug}</h1>\r\n\r\n            {/* Banner for Non-Attendees */}\r\n            {isLocked && (\r\n                <div className=\"bg-amber-50 border-l-4 border-amber-500 p-4 mb-6 text-amber-800\">\r\n                    <p className=\"font-bold\">Pilot Access Restricted</p>\r\n                    <p>You can purchase merchandise, but you must be a registered Event Attendee (have a valid ticket) to book Camping, Assets, or Subevents.</p>\r\n                </div>\r\n            )}\r\n\r\n            {/* Tabs */}\r\n            <div className=\"flex border-b border-gray-200 mb-8 overflow-x-auto -mx-4 px-4 md:mx-0 md:px-0 scrollbar-hide\">\r\n                <button\r\n                    className={`px-6 py-3 font-semibold transition-colors whitespace-nowrap flex-shrink-0 ${activeTab === 'tickets' ? 'border-b-2 border-primary text-primary' : 'text-gray-500 hover:text-primary'}`}\r\n                    onClick={() => handleTabClick('tickets')}\r\n                >\r\n                    Event Tickets\r\n                </button>\r\n                <button\r\n                    className={`px-6 py-3 font-semibold transition-colors whitespace-nowrap flex-shrink-0 ${activeTab === 'merch' ? 'border-b-2 border-primary text-primary' : 'text-gray-500 hover:text-primary'}`}\r\n                    onClick={() => handleTabClick('merch')}\r\n                >\r\n                    Merchandise\r\n                </button>\r\n                <button\r\n                    className={`px-6 py-3 font-semibold transition-colors whitespace-nowrap flex-shrink-0 ${activeTab === 'hire' ? 'border-b-2 border-primary text-primary' : isLocked ? 'text-gray-300 cursor-not-allowed' : 'text-gray-500 hover:text-primary'}`}\r\n                    onClick={() => handleTabClick('hire')}\r\n                >\r\n                    Hire Assets {isLocked && 'üîí'}\r\n                </button>\r\n                <button\r\n                    className={`px-6 py-3 font-semibold transition-colors whitespace-nowrap flex-shrink-0 ${activeTab === 'program' ? 'border-b-2 border-primary text-primary' : isLocked ? 'text-gray-300 cursor-not-allowed' : 'text-gray-500 hover:text-primary'}`}\r\n                    onClick={() => handleTabClick('program')}\r\n                >\r\n                    Program / Subevents {isLocked && 'üîí'}\r\n                </button>\r\n                <button\r\n                    className={`px-6 py-3 font-semibold transition-colors whitespace-nowrap flex-shrink-0 ${activeTab === 'camping' ? 'border-b-2 border-primary text-primary' : isLocked ? 'text-gray-300 cursor-not-allowed' : 'text-gray-500 hover:text-primary'}`}\r\n                    onClick={() => handleTabClick('camping')}\r\n                >\r\n                    Camping {isLocked && 'üîí'}\r\n                </button>\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"min-h-[400px]\">\r\n\r\n                {/* TICKETS */}\r\n                {activeTab === 'tickets' && (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                        {data.tickets && data.tickets.length === 0 && <p className=\"text-gray-500 italic\">No tickets available.</p>}\r\n                        {data.tickets && data.tickets.map(ticket => (\r\n                            <div key={ticket.id} className=\"bg-white border border-gray-100 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow flex flex-col justify-between\">\r\n                                <div>\r\n                                    <h3 className=\"font-bold text-xl text-primary mb-2\">{ticket.name}</h3>\r\n                                    <p className=\"text-gray-600 mb-4\">{ticket.description}</p>\r\n                                    <div className=\"flex items-center gap-2 mb-4\">\r\n                                        {ticket.isPitCrew && <span className=\"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-bold\">Pit Crew</span>}\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"text-2xl font-bold mb-4 text-gray-800\">${(ticket.price || 0).toFixed(2)}</div>\r\n                                    <button\r\n                                        onClick={() => handleOpenTicketModal(ticket)}\r\n                                        className=\"w-full bg-accent text-primary py-2 rounded hover:brightness-110 transition-all font-bold shadow-sm\"\r\n                                    >\r\n                                        Add to Cart\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                {/* MERCHANDISE */}\r\n                {activeTab === 'merch' && (\r\n                    <>\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8\">\r\n                            {data.merchandise.length === 0 && <p className=\"text-gray-500 italic\">No merchandise available.</p>}\r\n                            {data.merchandise.map(prod => (\r\n                                <ProductCard\r\n                                    key={prod.id}\r\n                                    product={prod}\r\n                                    onSelect={setSelectedProduct}\r\n                                />\r\n                            ))}\r\n                        </div>\r\n\r\n                        {selectedProduct && (\r\n                            <ProductModal\r\n                                product={selectedProduct}\r\n                                onClose={() => setSelectedProduct(null)}\r\n                                onAddToCart={handleAddMerch}\r\n                            />\r\n                        )}\r\n                    </>\r\n                )}\r\n\r\n                {/* ASSETS */}\r\n                {activeTab === 'hire' && (\r\n                    <div>\r\n                        {(() => {\r\n                            if (!data.assets || data.assets.length === 0) {\r\n                                return <p className=\"text-gray-500 italic\">No assets available for hire.</p>;\r\n                            }\r\n\r\n                            // Group assets\r\n                            const groups = {};\r\n                            const groupOrder = []; // To preserve category order from SQL\r\n\r\n                            data.assets.forEach(asset => {\r\n                                const catName = asset.category_name || 'Other';\r\n                                if (!groups[catName]) {\r\n                                    groups[catName] = [];\r\n                                    groupOrder.push(catName);\r\n                                }\r\n                                groups[catName].push(asset);\r\n                            });\r\n\r\n                            return groupOrder.map(catName => (\r\n                                <div key={catName} className=\"mb-12\">\r\n                                    <h2 className=\"text-2xl font-bold mb-6 text-gray-800 border-b pb-2\">{catName}</h2>\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                                        {groups[catName].map(asset => (\r\n                                            <div key={asset.id} className=\"bg-white border border-gray-100 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow flex flex-col justify-between\">\r\n                                                <div className=\"mb-4\">\r\n                                                    <div className=\"w-full h-48 bg-gray-50 rounded mb-4 overflow-hidden border border-gray-100\">\r\n                                                        {asset.image ? (\r\n                                                            <img src={asset.image} alt={asset.name} className=\"w-full h-full object-cover\" />\r\n                                                        ) : (\r\n                                                            <div className=\"w-full h-full flex items-center justify-center text-gray-200\">No Image</div>\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <h3 className=\"font-bold text-lg text-gray-800 mb-1\">{asset.name}</h3>\r\n                                                    <p className=\"text-sm text-gray-600\">{asset.description}</p>\r\n                                                </div>\r\n                                                <div>\r\n                                                    <div className=\"mb-4\">\r\n                                                        {asset.show_daily_cost && asset.show_full_event_cost ? (\r\n                                                            <div>\r\n                                                                <p className=\"font-bold text-xl text-primary\">${asset.price} <span className=\"text-sm font-normal text-gray-500\">/ day</span></p>\r\n                                                                <p className=\"text-sm text-gray-500\">or ${asset.full_event_cost} Full Event</p>\r\n                                                            </div>\r\n                                                        ) : asset.show_full_event_cost ? (\r\n                                                            <p className=\"font-bold text-xl text-primary\">${asset.full_event_cost} <span className=\"text-sm font-normal text-gray-500\">Full Event</span></p>\r\n                                                        ) : (\r\n                                                            <p className=\"font-bold text-xl text-primary\">${asset.price} <span className=\"text-sm font-normal text-gray-500\">/ day</span></p>\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <button\r\n                                                        onClick={() => handleOpenAssetModal(asset)}\r\n                                                        className=\"w-full bg-primary text-secondary py-2 rounded hover:brightness-110 transition-all font-bold\"\r\n                                                    >\r\n                                                        View Available Items\r\n                                                    </button>\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            ));\r\n                        })()}\r\n                    </div>\r\n                )}\r\n\r\n                {/* SUBEVENTS */}\r\n                {activeTab === 'program' && (\r\n                    <div className=\"space-y-4 max-w-3xl\">\r\n                        {data.subevents.length === 0 && <p className=\"text-gray-500 italic\">No program items available.</p>}\r\n                        {data.subevents.map(sub => (\r\n                            <div key={sub.id} className=\"bg-white border border-gray-100 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow flex flex-col md:flex-row justify-between items-start md:items-center\">\r\n                                <div>\r\n                                    <h3 className=\"font-bold text-xl text-primary\">{sub.name}</h3>\r\n                                    <p className=\"text-gray-600 mb-2\">{sub.description}</p>\r\n                                    <div className=\"text-sm font-medium bg-gray-100 inline-block px-2 py-1 rounded text-gray-700\">\r\n                                        {formatDateTimeRange(sub.startTime, sub.endTime)}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"mt-4 md:mt-0 text-right min-w-[120px]\">\r\n                                    <div className=\"text-2xl font-bold mb-2 text-gray-800\">${sub.price}</div>\r\n                                    <button\r\n                                        onClick={() => handleAddSubevent(sub)}\r\n                                        className=\"w-full bg-accent text-primary px-6 py-2 rounded hover:brightness-110 transition-all font-bold shadow-sm\"\r\n                                    >\r\n                                        Register\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                {/* CAMPING */}\r\n                {activeTab === 'camping' && (\r\n                    <div className=\"mt-4\">\r\n                        <CampingPage embedded={true} event={data} />\r\n                    </div>\r\n                )}\r\n\r\n            </div>\r\n\r\n            {/* Asset Modal */}\r\n            {selectedAssetType && (\r\n                <AssetSelectionModal\r\n                    asset={selectedAssetType}\r\n                    hireDates={hireDates}\r\n                    setHireDates={setHireDates}\r\n                    eventDates={{ start: data.eventStartDate, end: data.eventEndDate }}\r\n                    onClose={() => setSelectedAssetType(null)}\r\n                    onAddToCart={handleAddAssetToCart}\r\n                />\r\n            )}\r\n\r\n            {/* Subevent Modal */}\r\n            {selectedSubevent && (\r\n                <SubeventModal\r\n                    subevent={selectedSubevent}\r\n                    onClose={() => setSelectedSubevent(null)}\r\n                    onAddToCart={handleConfirmSubevent}\r\n                    myPilots={myPilots}\r\n                    cart={cart}\r\n                    onSearchAttendees={searchAttendees}\r\n                />\r\n            )}\r\n\r\n            {/* Ticket Attendee Modal */}\r\n            <AttendeeModal\r\n                key={selectedTicketForModal ? selectedTicketForModal.id : 'closed'}\r\n                show={!!selectedTicketForModal}\r\n                onClose={() => setSelectedTicketForModal(null)}\r\n                onConfirm={handleConfirmTicket}\r\n                tickets={selectedTicketForModal ? [selectedTicketForModal] : []}\r\n                cart={selectedTicketForModal ? { [selectedTicketForModal.id]: 1 } : {}}\r\n                user={user}\r\n                myPilots={myPilots}\r\n                event={data}\r\n                confirmLabel=\"Add to Cart\"\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default StorePage;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\VerifyEmail.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\AdminDashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":12,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":17,"suggestions":[{"messageId":"removeVar","data":{"varName":"user"},"fix":{"range":[477,504],"text":""},"desc":"Remove unused variable 'user'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":13,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"navigate"},"fix":{"range":[510,541],"text":""},"desc":"Remove unused variable 'navigate'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchStats'. Either include it or remove the dependency array.","line":17,"column":8,"nodeType":"ArrayExpression","endLine":17,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [fetchStats, selectedEventId]","fix":{"range":[598,615],"text":"[fetchStats, selectedEventId]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'selectedCampgroundId'. Either include it or remove the dependency array.","line":24,"column":8,"nodeType":"ArrayExpression","endLine":24,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [selectedCampgroundId, stats]","fix":{"range":[882,889],"text":"[selectedCampgroundId, stats]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'totalSites' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":75,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"totalSites"},"fix":{"range":[2798,2865],"text":""},"desc":"Remove unused variable 'totalSites'."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useNavigate, Link } from 'react-router-dom';\r\nimport { useAuth } from '../../context/AuthContext';\r\n\r\nfunction AdminDashboard() {\r\n    const [stats, setStats] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n    const [selectedEventId, setSelectedEventId] = useState('');\r\n    const [selectedCampgroundId, setSelectedCampgroundId] = useState('');\r\n\r\n    const { user } = useAuth();\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        fetchStats();\r\n    }, [selectedEventId]);\r\n\r\n    // When stats load, set default campground if needed\r\n    useEffect(() => {\r\n        if (stats && stats.camping && stats.camping.length > 0 && !selectedCampgroundId) {\r\n            setSelectedCampgroundId(stats.camping[0].campground_id);\r\n        }\r\n    }, [stats]);\r\n\r\n    async function fetchStats() {\r\n        setLoading(true);\r\n        try {\r\n            let url = '/api/dashboard/admin-stats';\r\n            if (selectedEventId) {\r\n                url += `?eventId=${selectedEventId}`;\r\n            }\r\n\r\n            const res = await fetch(url, {\r\n                headers: {\r\n                    'Authorization': `Bearer ${localStorage.getItem('token')}`,\r\n                    'X-Auth-Token': localStorage.getItem('token') // Bypass Azure EasyAuth\r\n                }\r\n            });\r\n\r\n            if (!res.ok) throw new Error('Failed to fetch dashboard stats');\r\n            const data = await res.json();\r\n            setStats(data);\r\n\r\n            // If we didn't have an event selected, update state to match what API returned\r\n            if (!selectedEventId && data.event) {\r\n                setSelectedEventId(data.event.event_id);\r\n            }\r\n        } catch (err) {\r\n            console.error(err);\r\n            setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    const handleEventChange = (e) => {\r\n        setSelectedEventId(e.target.value);\r\n        // Reset campground selection so it defaults to first of new event\r\n        setSelectedCampgroundId('');\r\n    };\r\n\r\n    if (loading && !stats) return <div className=\"json-container p-8\">Loading Dashboard...</div>;\r\n    if (error) return <div className=\"json-container p-8 text-red-500\">Error: {error}</div>;\r\n\r\n    if (!stats || !stats.event) return <div className=\"json-container p-8\">No events found.</div>;\r\n\r\n    const { event, attendees, camping, subevents, merch, assets } = stats;\r\n\r\n    // Helpers\r\n    const totalAttendees = attendees.reduce((acc, curr) => acc + curr.count, 0);\r\n\r\n    // Camping Calc\r\n    const selectedCampground = camping.find(c => c.campground_id == selectedCampgroundId) || (camping.length > 0 ? camping[0] : null);\r\n    const totalSites = camping.reduce((acc, c) => acc + c.capacity, 0);\r\n    // Simple \"booked\" metric for summary (sum of unique sites booked? backend didn't send that explicitly, it sent daily. \r\n    // Let's use max daily occupancy as a rough proxy for \"peak booking\" or just show capacity on the card)\r\n    // Actually, let's just show Total Capacity for now on the card, and leave booking detail to the chart.\r\n\r\n\r\n\r\n    return (\r\n        <div className=\"json-container max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 space-y-8 animate-in fade-in duration-500\">\r\n\r\n            {/* Header & Controls */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white p-6 rounded-2xl border border-gray-200 shadow-sm\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold text-[var(--accent-color)]\">\r\n                        Admin Dashboard\r\n                    </h1>\r\n                    <div className=\"flex items-center gap-4 mt-1\">\r\n                        <p className=\"text-gray-500\">\r\n                            Overview for <span className=\"font-semibold text-gray-900\">{event.name}</span>\r\n                        </p>\r\n                        {/* Public Reports Link */}\r\n\r\n\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                    <label className=\"text-sm font-medium text-zinc-400\">Switch Event:</label>\r\n                    <select\r\n                        value={selectedEventId}\r\n                        onChange={handleEventChange}\r\n                        className=\"bg-gray-50 border border-gray-300 rounded-lg px-4 py-2 text-gray-900 focus:ring-2 focus:ring-[var(--accent-color)] focus:border-transparent outline-none transition-all\"\r\n                    >\r\n                        {stats.eventsList.map(e => (\r\n                            <option key={e.event_id} value={e.event_id}>\r\n                                {e.name} ({new Date(e.start_date).getFullYear()})\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Grid */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n\r\n                {/* 1. ATTENDEES (Donut/List) */}\r\n                <div className=\"bg-white rounded-2xl p-6 border border-gray-200 shadow-sm flex flex-col\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2\">\r\n                        <svg className=\"w-5 h-5 text-[var(--accent-color)]\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\" /></svg>\r\n                        Attendees\r\n                        <Link to={`/admin/attendees/${event.slug}`} className=\"ml-auto text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded border border-blue-200 font-bold hover:bg-blue-100 transition-colors uppercase tracking-wide\">\r\n                            View List\r\n                        </Link>\r\n                    </h3>\r\n                    <div className=\"flex-1 flex flex-col justify-center\">\r\n                        <div className=\"text-5xl font-bold text-gray-900 mb-2 text-center\">{totalAttendees}</div>\r\n                        <div className=\"text-center text-gray-500 mb-6\">Total Registered</div>\r\n\r\n                        <div className=\"space-y-3\">\r\n                            {attendees.map(t => (\r\n                                <div key={t.ticket_name} className=\"flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors\">\r\n                                    <span className=\"text-gray-700 font-medium\">{t.ticket_name}</span>\r\n                                    <span className=\"text-gray-900 font-bold bg-white px-2 py-1 rounded text-sm border border-gray-200\">{t.count}</span>\r\n                                </div>\r\n                            ))}\r\n                            {attendees.length === 0 && <div className=\"text-gray-400 text-center italic\">No attendees yet.</div>}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* 2. CAMPING (Chart) */}\r\n                <div className=\"bg-white rounded-2xl p-6 border border-gray-200 shadow-sm flex flex-col\">\r\n                    <div className=\"flex justify-between items-center mb-6\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\r\n                                <svg className=\"w-5 h-5 text-[var(--accent-color)]\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\" /></svg>\r\n                                Camping\r\n                            </h3>\r\n                            <Link\r\n                                to=\"/admin/reports/camping\"\r\n                                className=\"text-[10px] bg-green-50 text-green-700 px-2 py-1 rounded border border-green-200 font-bold hover:bg-green-100 transition-colors uppercase tracking-wide\"\r\n                            >\r\n                                Availability Report\r\n                            </Link>\r\n                        </div>\r\n                        <select\r\n                            value={selectedCampgroundId}\r\n                            onChange={(e) => setSelectedCampgroundId(e.target.value)}\r\n                            className=\"bg-gray-50 border border-gray-300 rounded-lg px-3 py-1 text-sm text-gray-700 outline-none focus:border-[var(--accent-color)]\"\r\n                        >\r\n                            {camping.map(c => <option key={c.campground_id} value={c.campground_id}>{c.name}</option>)}\r\n                            {camping.length === 0 && <option>No Campgrounds</option>}\r\n                        </select>\r\n                    </div>\r\n\r\n                    {selectedCampground ? (\r\n                        <div className=\"flex-1 flex flex-col\">\r\n                            <div className=\"flex justify-between text-sm text-gray-500 mb-4\">\r\n                                <span>Capacity: <span className=\"text-gray-900 font-mono\">{selectedCampground.capacity}</span> sites</span>\r\n                                <span>Daily Occupancy</span>\r\n                            </div>\r\n\r\n                            {/* Bar Chart Container */}\r\n                            <div className=\"flex-1 flex items-end gap-2 h-48 pt-10 pb-2 overflow-x-auto\" style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}>\r\n                                <style>{`\r\n                                    div::-webkit-scrollbar {\r\n                                        display: none;\r\n                                    }\r\n                                `}</style>\r\n                                {selectedCampground.daily.map((day, i) => {\r\n                                    const percent = selectedCampground.capacity > 0\r\n                                        ? Math.min(100, (day.booked / selectedCampground.capacity) * 100)\r\n                                        : 0;\r\n                                    const dateLabel = new Date(day.date).toLocaleDateString(undefined, { weekday: 'short', day: 'numeric' });\r\n\r\n                                    return (\r\n                                        <div key={i} className=\"flex flex-col justify-end items-center group h-full relative min-w-[3rem]\">\r\n                                            {/* Tooltip */}\r\n                                            <div className=\"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50 pointer-events-none border border-white/10 shadow-lg\">\r\n                                                {day.booked} / {selectedCampground.capacity}\r\n                                                <div className=\"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-black\"></div>\r\n                                            </div>\r\n                                            {/* Bar */}\r\n                                            <div\r\n                                                className=\"w-full bg-[var(--accent-color)] opacity-60 group-hover:opacity-80 border-t border-x border-gray-300 rounded-t-sm transition-all relative\"\r\n                                                style={{ height: `${percent}%` }}\r\n                                            >\r\n                                                <div className=\"absolute bottom-0 w-full bg-black/5 h-full animate-pulse-slow\"></div>\r\n                                            </div>\r\n                                            {/* X Axis Label */}\r\n                                            <div className=\"text-[10px] text-gray-500 mt-2 rotate-0 truncate w-full text-center\">{dateLabel}</div>\r\n                                        </div>\r\n                                    )\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"text-center text-gray-500 py-10\">No camping data available.</div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* 3. SUBEVENTS (Progress Bars) */}\r\n                <div className=\"bg-white rounded-2xl p-6 border border-gray-200 shadow-sm\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2\">\r\n                        <svg className=\"w-5 h-5 text-[var(--accent-color)]\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" /></svg>\r\n                        Subevents\r\n                    </h3>\r\n\r\n\r\n\r\n                    <div className=\"space-y-5 max-h-[300px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-200\">\r\n                        {subevents.map(s => {\r\n                            const pct = s.capacity > 0 ? (s.registered / s.capacity) * 100 : 0;\r\n                            return (\r\n                                <div key={s.subevent_id} className=\"space-y-2\">\r\n                                    <div className=\"flex justify-between text-sm\">\r\n                                        <span className=\"text-gray-700\">{s.name}</span>\r\n                                        <span className=\"text-gray-500\">{s.registered} / {s.capacity}</span>\r\n                                    </div>\r\n                                    <div className=\"h-2 bg-gray-100 rounded-full overflow-hidden\">\r\n                                        <div\r\n                                            className=\"h-full bg-[var(--accent-color)] rounded-full transition-all duration-1000\"\r\n                                            style={{ width: `${pct}%` }}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                        {subevents.length === 0 && <div className=\"text-gray-400 text-center italic\">No subevents.</div>}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* 4. FINANCIALS / ASSETS */}\r\n                <div className=\"bg-white rounded-2xl p-6 border border-gray-200 shadow-sm flex flex-col gap-6\">\r\n                    {/* Merch */}\r\n                    <div className=\"flex-1 bg-gray-50 p-6 rounded-xl border border-gray-200 flex flex-col justify-center items-center text-center\">\r\n                        <h4 className=\"text-sm font-medium text-gray-500 uppercase tracking-widest mb-2\">Merchandise</h4>\r\n                        <div className=\"text-4xl font-bold text-gray-900 mb-1\">\r\n                            ${(merch.revenue || 0).toLocaleString()}\r\n                        </div>\r\n                        <div className=\"text-sm text-[var(--primary-color)] bg-[var(--accent-color)] px-4 py-1.5 rounded-full font-bold shadow-sm\">\r\n                            {merch.items_sold} Items Sold\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Assets */}\r\n                    <div className=\"flex-1 bg-gray-50 p-6 rounded-xl border border-gray-200 flex flex-col justify-center items-center text-center\">\r\n                        <h4 className=\"text-sm font-medium text-gray-500 uppercase tracking-widest mb-2\">Asset Hires</h4>\r\n                        <div className=\"text-4xl font-bold text-gray-900 mb-1\">\r\n                            {assets.total_hires}\r\n                        </div>\r\n                        <div className=\"text-sm text-[var(--primary-color)] bg-[var(--accent-color)] px-4 py-1.5 rounded-full font-bold shadow-sm\">\r\n                            Active Bookings\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* 5. AIR SHOW ATTENDEES (Public Registrations) */}\r\n                <div className=\"col-span-1 lg:col-span-2 bg-white rounded-2xl p-6 border border-gray-200 shadow-sm flex flex-col md:flex-row items-center justify-between gap-6\">\r\n                    <div>\r\n                        <h3 className=\"text-lg font-semibold text-gray-900 mb-2 flex items-center gap-2\">\r\n                            <svg className=\"w-5 h-5 text-[var(--accent-color)]\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\" /></svg>\r\n                            Air Show Attendees\r\n                        </h3>\r\n                        <p className=\"text-gray-500 text-sm\">Overview of public ticket registrations.</p>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-8\">\r\n                        <div className=\"text-center\">\r\n                            <div className=\"text-2xl font-bold text-gray-900\">{stats.publicRegistrations?.total_attendees || 0}</div>\r\n                            <div className=\"text-xs text-gray-500 uppercase\">Total</div>\r\n                        </div>\r\n                        <div className=\"text-center border-l border-gray-200 pl-8\">\r\n                            <div className=\"text-2xl font-bold text-gray-900\">{stats.publicRegistrations?.total_adults || 0}</div>\r\n                            <div className=\"text-xs text-gray-500 uppercase\">Adults</div>\r\n                        </div>\r\n                        <div className=\"text-center border-l border-gray-200 pl-8\">\r\n                            <div className=\"text-2xl font-bold text-gray-900\">{stats.publicRegistrations?.total_children || 0}</div>\r\n                            <div className=\"text-xs text-gray-500 uppercase\">Children</div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <Link\r\n                        to={`/admin/reports/public-registrations/${event.slug}`}\r\n                        className=\"bg-blue-600 text-white px-5 py-2.5 rounded-lg font-semibold hover:bg-blue-700 transition-colors shadow-sm\"\r\n                    >\r\n                        View Air Show Attendees\r\n                    </Link>\r\n                    <Link\r\n                        to={`/admin/reports/event-planes/${event.event_id}`}\r\n                        className=\"bg-white text-gray-700 border border-gray-300 px-5 py-2.5 rounded-lg font-semibold hover:bg-gray-50 hover:text-[var(--accent-color)] transition-colors shadow-sm ml-4\"\r\n                    >\r\n                        View Event Planes\r\n                    </Link>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default AdminDashboard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\AdminOrders.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'paid' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":107,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":107,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"paid"},"fix":{"range":[4008,4044],"text":""},"desc":"Remove unused variable 'paid'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { Search, Calendar, Filter, X, RefreshCw } from 'lucide-react';\r\n\r\nfunction AdminOrders() {\r\n    const { user } = useAuth();\r\n    const [orders, setOrders] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n\r\n    // Filter States\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [dateFrom, setDateFrom] = useState('');\r\n    const [dateTo, setDateTo] = useState('');\r\n    const [statusFilter, setStatusFilter] = useState('All');\r\n    const [eventFilter, setEventFilter] = useState('All');\r\n    const [events, setEvents] = useState([]);\r\n\r\n    // Fetch Events for Dropdown\r\n    useEffect(() => {\r\n        async function fetchEvents() {\r\n            try {\r\n                const response = await fetch('/api/events');\r\n                if (response.ok) {\r\n                    const data = await response.json();\r\n                    setEvents(data);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Failed to load events\", err);\r\n            }\r\n        }\r\n        fetchEvents();\r\n    }, []);\r\n\r\n    const fetchOrders = useCallback(async () => {\r\n        if (!user) return;\r\n        setLoading(true);\r\n        try {\r\n            const token = localStorage.getItem('token');\r\n\r\n            const params = new URLSearchParams();\r\n            if (searchTerm) params.append('search', searchTerm);\r\n            if (dateFrom) params.append('startDate', dateFrom);\r\n            if (dateTo) params.append('endDate', dateTo);\r\n            if (statusFilter && statusFilter !== 'All') params.append('status', statusFilter);\r\n            if (eventFilter && eventFilter !== 'All') params.append('eventId', eventFilter);\r\n\r\n            const response = await fetch(`/api/getAdminOrders?${params.toString()}`, {\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                }\r\n            });\r\n\r\n            if (response.status === 403) throw new Error(\"Access Denied: You are not an admin.\");\r\n            if (!response.ok) throw new Error('Failed to fetch orders');\r\n\r\n            const data = await response.json();\r\n            setOrders(data);\r\n        } catch (err) {\r\n            setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [user, searchTerm, dateFrom, dateTo, statusFilter, eventFilter]);\r\n\r\n    // Debounce Search & Auto-Fetch on Filter Change\r\n    useEffect(() => {\r\n        const timer = setTimeout(() => {\r\n            fetchOrders();\r\n        }, 500); // 500ms debounce\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [fetchOrders]);\r\n\r\n    const handleResetFilters = () => {\r\n        setSearchTerm('');\r\n        setDateFrom('');\r\n        setDateTo('');\r\n        setStatusFilter('All');\r\n        setEventFilter('All');\r\n    };\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status?.toLowerCase()) {\r\n            case 'paid': return 'bg-green-100 text-green-800 border-green-200';\r\n            case 'pending': return 'bg-yellow-100 text-yellow-800 border-yellow-200';\r\n            case 'failed': return 'bg-red-100 text-red-800 border-red-200';\r\n            default: return 'bg-gray-100 text-gray-800 border-gray-200';\r\n        }\r\n    };\r\n\r\n    // Payment Modal State\r\n    const [isPaymentModalOpen, setIsPaymentModalOpen] = useState(false);\r\n    const [selectedOrderForPayment, setSelectedOrderForPayment] = useState(null);\r\n    const [paymentForm, setPaymentForm] = useState({\r\n        amount: '',\r\n        date: new Date().toISOString().split('T')[0],\r\n        reference: '',\r\n        method: 'Direct Deposit'\r\n    });\r\n    const [processingPayment, setProcessingPayment] = useState(false);\r\n\r\n    const openPaymentModal = (order) => {\r\n        // Default amount to balance due\r\n        const paid = order.amount_paid || 0; // Need to ensure API returns this in list or calculate it\r\n        // Wait, list API might not have amount_paid. Schema added it to orders table.\r\n        // Assuming getAdminOrders returns SELECT * or includes amount_paid.\r\n        // If not, we might need to rely on what we have: total - (paid??)\r\n        // If API doesn't return amount_paid, we should default to total_amount for now or 0.\r\n        // Let's assume getAdminOrders DOES return amount_paid (schema update should flow through if using SELECT *)\r\n\r\n        const balance = order.total_amount - (order.amount_paid || 0);\r\n\r\n        setSelectedOrderForPayment(order);\r\n        setPaymentForm({\r\n            amount: balance > 0 ? balance.toFixed(2) : order.total_amount.toFixed(2),\r\n            date: new Date().toISOString().split('T')[0],\r\n            reference: '',\r\n            method: 'Direct Deposit'\r\n        });\r\n        setIsPaymentModalOpen(true);\r\n    };\r\n\r\n    const handleRecordPayment = async (e) => {\r\n        e.preventDefault();\r\n        if (!selectedOrderForPayment) return;\r\n        setProcessingPayment(true);\r\n\r\n        try {\r\n            const token = localStorage.getItem('token');\r\n            const res = await fetch(`/api/orders/${selectedOrderForPayment.order_id}/payments`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify(paymentForm)\r\n            });\r\n\r\n            if (!res.ok) {\r\n                const err = await res.json();\r\n                throw new Error(err.error || 'Payment failed');\r\n            }\r\n\r\n            // Success\r\n            setIsPaymentModalOpen(false);\r\n            fetchOrders(); // Refresh list\r\n        } catch (err) {\r\n            alert(err.message);\r\n        } finally {\r\n            setProcessingPayment(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"container mx-auto p-4 md:p-8\">\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4\">\r\n                <h1 className=\"text-3xl font-bold text-gray-900\">Admin: All Orders</h1>\r\n                <button\r\n                    onClick={fetchOrders}\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm font-medium\"\r\n                >\r\n                    <RefreshCw size={16} />\r\n                    Refresh\r\n                </button>\r\n            </div>\r\n\r\n            {/* Filter Bar */}\r\n            <div className=\"bg-white p-4 rounded-lg shadow-sm border border-gray-200 mb-6 space-y-4 md:space-y-0 md:flex md:items-end md:gap-4\">\r\n                {/* Search */}\r\n                <div className=\"flex-1\">\r\n                    <label className=\"block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1\">Search</label>\r\n                    <div className=\"relative\">\r\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" size={18} />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Name, Email, Order ID...\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Date Range */}\r\n                <div className=\"flex gap-2\">\r\n                    <div>\r\n                        <label className=\"block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1\">From</label>\r\n                        <input\r\n                            type=\"date\"\r\n                            value={dateFrom}\r\n                            onChange={(e) => setDateFrom(e.target.value)}\r\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1\">To</label>\r\n                        <input\r\n                            type=\"date\"\r\n                            value={dateTo}\r\n                            onChange={(e) => setDateTo(e.target.value)}\r\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Status Dropdown */}\r\n                <div className=\"w-40\">\r\n                    <label className=\"block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1\">Status</label>\r\n                    <select\r\n                        value={statusFilter}\r\n                        onChange={(e) => setStatusFilter(e.target.value)}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none bg-white\"\r\n                    >\r\n                        <option value=\"All\">All Statuses</option>\r\n                        <option value=\"Paid\">Paid</option>\r\n                        <option value=\"Partially Paid\">Partiailly Paid</option>\r\n                        <option value=\"Pending\">Pending</option>\r\n                        <option value=\"Failed\">Failed</option>\r\n                        <option value=\"Refunded\">Refunded</option>\r\n                    </select>\r\n                </div>\r\n\r\n                {/* Event Dropdown */}\r\n                <div className=\"w-48\">\r\n                    <label className=\"block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1\">Event</label>\r\n                    <select\r\n                        value={eventFilter}\r\n                        onChange={(e) => setEventFilter(e.target.value)}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none bg-white\"\r\n                    >\r\n                        <option value=\"All\">All Events</option>\r\n                        {events.map(ev => (\r\n                            <option key={ev.event_id} value={ev.event_id}>\r\n                                {ev.name}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n\r\n                {/* Reset Button */}\r\n                <button\r\n                    onClick={handleResetFilters}\r\n                    className=\"px-4 py-2 bg-gray-50 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-100 transition-colors mb-[1px]\"\r\n                    title=\"Reset Filters\"\r\n                >\r\n                    <X size={20} />\r\n                </button>\r\n            </div>\r\n\r\n            {loading && <div className=\"text-center py-10 text-gray-500\">Loading orders...</div>}\r\n            {error && <div className=\"p-4 bg-red-50 text-red-600 rounded-md mb-6\">{error}</div>}\r\n\r\n            {!loading && !error && (\r\n                <div className=\"bg-white rounded-lg shadow overflow-hidden\">\r\n                    <div className=\"overflow-x-auto\">\r\n                        <table className=\"w-full text-left border-collapse\">\r\n                            <thead>\r\n                                <tr className=\"bg-gray-50 border-b border-gray-200 text-xs uppercase text-gray-500 font-semibold tracking-wider\">\r\n                                    <th className=\"p-4\">ID / Invoice</th>\r\n                                    <th className=\"p-4\">Date</th>\r\n                                    <th className=\"p-4\">Event</th>\r\n                                    <th className=\"p-4\">Customer</th>\r\n                                    <th className=\"p-4\">Items</th>\r\n                                    <th className=\"p-4\">Total</th>\r\n                                    <th className=\"p-4\">Status</th>\r\n                                    <th className=\"p-4\">Action</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-gray-100\">\r\n                                {orders.map(order => (\r\n                                    <tr key={order.order_id} className=\"hover:bg-gray-50 transition-colors\">\r\n                                        <td className=\"p-4 font-mono text-sm text-gray-600\">\r\n                                            <div>#{order.order_id}</div>\r\n                                            {order.invoice_number && <div className=\"text-xs text-blue-600 font-bold\">{order.invoice_number}</div>}\r\n                                        </td>\r\n                                        <td className=\"p-4\">\r\n                                            <div className=\"font-medium text-gray-900\">{new Date(order.order_date).toLocaleDateString()}</div>\r\n                                            <div className=\"text-xs text-gray-500\">{new Date(order.order_date).toLocaleTimeString()}</div>\r\n                                        </td>\r\n                                        <td className=\"p-4 text-gray-700\">\r\n                                            {order.event_name || <span className=\"text-gray-400 italic\">N/A</span>}\r\n                                        </td>\r\n                                        <td className=\"p-4\">\r\n                                            <div className=\"font-bold text-gray-900\">{order.user_first_name} {order.user_last_name}</div>\r\n                                            <div className=\"text-sm text-gray-500\">{order.user_email}</div>\r\n                                        </td>\r\n                                        <td className=\"p-4 text-sm text-gray-600\">{order.item_count} items</td>\r\n                                        <td className=\"p-4 font-bold text-gray-900\">\r\n                                            ${order.total_amount.toFixed(2)}\r\n                                            {order.amount_paid > 0 && order.amount_paid < order.total_amount && (\r\n                                                <div className=\"text-xs text-orange-600 font-normal\">Paid: ${order.amount_paid.toFixed(2)}</div>\r\n                                            )}\r\n                                        </td>\r\n                                        <td className=\"p-4\">\r\n                                            <span className={`inline-block px-2 py-1 rounded text-xs font-bold uppercase border ${getStatusColor(order.payment_status)}`}>\r\n                                                {order.payment_status}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td className=\"p-4\">\r\n                                            <div className=\"flex sm:flex-col lg:flex-row gap-2\">\r\n                                                <Link\r\n                                                    to={`/orders/${order.order_id}`}\r\n                                                    className=\"inline-block px-3 py-1 bg-white border border-gray-300 rounded text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors shadow-sm text-center\"\r\n                                                >\r\n                                                    View\r\n                                                </Link>\r\n                                                {order.payment_status !== 'Paid' && (\r\n                                                    <button\r\n                                                        onClick={() => openPaymentModal(order)}\r\n                                                        className=\"inline-block px-3 py-1 bg-green-50 border border-green-200 rounded text-sm font-bold text-green-700 hover:bg-green-100 transition-colors shadow-sm text-center\"\r\n                                                    >\r\n                                                        Pay\r\n                                                    </button>\r\n                                                )}\r\n                                            </div>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Payment Modal */}\r\n            {isPaymentModalOpen && (\r\n                <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"bg-white rounded-lg shadow-xl w-full max-w-md\">\r\n                        <div className=\"px-6 py-4 border-b flex justify-between items-center\">\r\n                            <h3 className=\"text-lg font-bold\">Record Payment</h3>\r\n                            <button onClick={() => setIsPaymentModalOpen(false)} className=\"text-gray-400 hover:text-gray-600\"><X size={20} /></button>\r\n                        </div>\r\n                        <form onSubmit={handleRecordPayment} className=\"p-6 space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Amount ($)</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    step=\"0.01\"\r\n                                    required\r\n                                    className=\"w-full p-2 border rounded\"\r\n                                    value={paymentForm.amount}\r\n                                    onChange={e => setPaymentForm({ ...paymentForm, amount: e.target.value })}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Date Paid</label>\r\n                                <input\r\n                                    type=\"date\"\r\n                                    required\r\n                                    className=\"w-full p-2 border rounded\"\r\n                                    value={paymentForm.date}\r\n                                    onChange={e => setPaymentForm({ ...paymentForm, date: e.target.value })}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Reference (Optional)</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"w-full p-2 border rounded\"\r\n                                    placeholder=\"e.g. DD-12345\"\r\n                                    value={paymentForm.reference}\r\n                                    onChange={e => setPaymentForm({ ...paymentForm, reference: e.target.value })}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Method</label>\r\n                                <select\r\n                                    className=\"w-full p-2 border rounded\"\r\n                                    value={paymentForm.method}\r\n                                    onChange={e => setPaymentForm({ ...paymentForm, method: e.target.value })}\r\n                                >\r\n                                    <option value=\"Direct Deposit\">Direct Deposit</option>\r\n                                    <option value=\"Cash\">Cash</option>\r\n                                    <option value=\"EFT\">EFT</option>\r\n                                    <option value=\"Other\">Other</option>\r\n                                </select>\r\n                            </div>\r\n                            <div className=\"pt-4 flex justify-end gap-3\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => setIsPaymentModalOpen(false)}\r\n                                    className=\"px-4 py-2 border rounded text-gray-700 hover:bg-gray-50\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    disabled={processingPayment}\r\n                                    className=\"px-4 py-2 bg-green-600 text-white rounded font-bold hover:bg-green-700\"\r\n                                >\r\n                                    {processingPayment ? 'Recording...' : 'Record Payment'}\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default AdminOrders;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\AdminSettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\AdminSubevents.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\AssetDashboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\AttendeesList.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\CampingAvailabilityReport.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleSearch'. Either include it or remove the dependency array.","line":41,"column":8,"nodeType":"ArrayExpression","endLine":41,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [handleSearch, selectedEventId]","fix":{"range":[1570,1587],"text":"[handleSearch, selectedEventId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { useNotification } from '../../context/NotificationContext';\r\nimport { Link } from 'react-router-dom';\r\n\r\nfunction CampingAvailabilityReport() {\r\n    const { token } = useAuth();\r\n    const { notify } = useNotification();\r\n\r\n    // State\r\n    const [events, setEvents] = useState([]);\r\n    const [selectedEventId, setSelectedEventId] = useState('');\r\n    // Removed manual date state, will derive from selectedEvent\r\n    const [reportData, setReportData] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [hasSearched, setHasSearched] = useState(false);\r\n\r\n    // Initial Load: Get Events\r\n    useEffect(() => {\r\n        fetch('/api/events')\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                // Sort by start_date ascending\r\n                const sorted = data.sort((a, b) => new Date(a.start_date) - new Date(b.start_date));\r\n                setEvents(sorted);\r\n\r\n                if (sorted.length > 0) {\r\n                    // Default to first active/future event\r\n                    const active = sorted.find(e => new Date(e.end_date) >= new Date()) || sorted[sorted.length - 1];\r\n                    setSelectedEventId(active.event_id);\r\n                }\r\n            })\r\n            .catch(err => console.error(err));\r\n    }, []);\r\n\r\n    // Auto-fetch when event changes\r\n    useEffect(() => {\r\n        if (selectedEventId) {\r\n            handleSearch();\r\n        }\r\n    }, [selectedEventId]);\r\n\r\n    const handleSearch = async () => {\r\n        if (!selectedEventId) return;\r\n\r\n        const event = events.find(e => e.event_id == selectedEventId);\r\n        if (!event) return;\r\n\r\n        // Use Event Dates directly\r\n        const startDate = event.start_date.split('T')[0];\r\n        const endDate = event.end_date.split('T')[0];\r\n\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch(`/api/reports/camping-availability?eventId=${selectedEventId}&start_date=${startDate}&end_date=${endDate}`, {\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'x-auth-token': token\r\n                }\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setReportData(data);\r\n                setHasSearched(true);\r\n            } else {\r\n                console.error('API responded with error:', res.status, res.statusText);\r\n                notify('Failed to fetch report: ' + res.statusText, 'error');\r\n            }\r\n        } catch (e) {\r\n            console.error('Fetch error:', e);\r\n            notify('Error fetching report', 'error');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const selectedEvent = useMemo(() => events.find(e => e.event_id == selectedEventId), [events, selectedEventId]);\r\n\r\n    // Process Data for Grid\r\n    const processedData = useMemo(() => {\r\n        if (!hasSearched || !selectedEvent || !reportData.length) return [];\r\n\r\n        // 1. Calculate Total Event Nights\r\n        // Use YYYY-MM-DD to avoid time issues, matching CampingPage logic\r\n        const sStr = selectedEvent.start_date.split('T')[0];\r\n        const eStr = selectedEvent.end_date.split('T')[0];\r\n        const eventStart = new Date(sStr);\r\n        const eventEnd = new Date(eStr);\r\n        const totalEventNights = Math.max(1, Math.ceil((eventEnd - eventStart) / (1000 * 60 * 60 * 24)));\r\n\r\n        // 2. Group by Campsite\r\n        const sites = {};\r\n        reportData.forEach(row => {\r\n            if (!sites[row.campsite_id]) {\r\n                sites[row.campsite_id] = {\r\n                    campsite_id: row.campsite_id,\r\n                    site_number: row.site_number,\r\n                    is_powered: row.is_powered,\r\n                    bookings: []\r\n                };\r\n            }\r\n            if (row.booking_id) {\r\n                sites[row.campsite_id].bookings.push({\r\n                    booking_id: row.booking_id,\r\n                    check_in_date: row.check_in_date,\r\n                    check_out_date: row.check_out_date,\r\n                    first_name: row.first_name,\r\n                    last_name: row.last_name,\r\n                    order_id: row.order_id\r\n                });\r\n            }\r\n        });\r\n\r\n        // 3. Status Determination\r\n        const siteArray = Object.values(sites).map(site => {\r\n            let bookedNights = 0;\r\n\r\n            if (site.bookings && site.bookings.length > 0) {\r\n                site.bookings.forEach(b => {\r\n                    // Parse as dates (booking dates from API might be ISO with time, strict YYYY-MM-DD is safer)\r\n                    const bStart = new Date(b.check_in_date.split('T')[0]);\r\n                    const bEnd = new Date(b.check_out_date.split('T')[0]);\r\n\r\n                    // Clamp booking to event bounds\r\n                    const effectiveStart = bStart < eventStart ? eventStart : bStart;\r\n                    const effectiveEnd = bEnd > eventEnd ? eventEnd : bEnd;\r\n\r\n                    if (effectiveEnd > effectiveStart) {\r\n                        const nights = Math.ceil((effectiveEnd - effectiveStart) / (1000 * 60 * 60 * 24));\r\n                        bookedNights += nights;\r\n                    }\r\n                });\r\n            }\r\n\r\n            let status = 'Available';\r\n            // Allow for tiny floating point errors or overlaps by checking >= total\r\n            if (bookedNights >= totalEventNights) status = 'Full';\r\n            else if (bookedNights > 0) status = 'Partial';\r\n\r\n            return {\r\n                ...site,\r\n                status,\r\n                bookedNightsCount: bookedNights\r\n            };\r\n        });\r\n\r\n        // 4. Sort Naturally (e.g. 1, 2, 10 instead of 1, 10, 2)\r\n        return siteArray.sort((a, b) => {\r\n            return a.site_number.localeCompare(b.site_number, undefined, { numeric: true, sensitivity: 'base' });\r\n        });\r\n    }, [reportData, selectedEvent, hasSearched]);\r\n\r\n    // Grid Columns (Dates)\r\n    const gridDates = useMemo(() => {\r\n        if (!selectedEvent) return [];\r\n        // Generate array of dates for the header\r\n        const d = [];\r\n        // Use string splitting for safety\r\n        const sStr = selectedEvent.start_date.split('T')[0];\r\n        const eStr = selectedEvent.end_date.split('T')[0];\r\n\r\n        let curr = new Date(sStr);\r\n        const end = new Date(eStr);\r\n\r\n        // Logic \"Booking cannot start on last day\". \r\n        // We only show columns for \"Nights\". The night of the End Date is NOT part of the event.\r\n        while (curr < end) {\r\n            d.push(new Date(curr)); // Clone\r\n            curr.setDate(curr.getDate() + 1);\r\n        }\r\n        return d;\r\n    }, [selectedEvent]);\r\n\r\n    // Helper: Check if a date is booked for a specific site\r\n    const getBookingForDate = (site, dateObj) => {\r\n        // A night is booked if dateObj is >= checkIn AND dateObj < checkOut\r\n        // (Checkout day is not occupied)\r\n        return site.bookings.find(b => {\r\n            const checkIn = new Date(b.check_in_date.split('T')[0]);\r\n            const checkOut = new Date(b.check_out_date.split('T')[0]);\r\n\r\n            // Normalized comparison using timestamps of strict dates\r\n            const t = dateObj.getTime();\r\n            const ci = checkIn.getTime();\r\n            const co = checkOut.getTime();\r\n\r\n            return t >= ci && t < co;\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div style={{ padding: '20px', maxWidth: '100%', margin: '0 20px' }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '20px' }}>\r\n                <h1>Camping Availability Report</h1>\r\n                <Link to=\"/admin\" style={{ color: '#666', textDecoration: 'none' }}>‚Üê Back to Dashboard</Link>\r\n            </div>\r\n\r\n            {/* Simpler Toolbar */}\r\n            <div style={{ background: '#f5f5f5', padding: '20px', borderRadius: '8px', marginBottom: '30px', display: 'flex', gap: '20px', alignItems: 'center' }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\r\n                    <label style={{ fontWeight: 'bold' }}>Event:</label>\r\n                    <select\r\n                        value={selectedEventId}\r\n                        onChange={e => setSelectedEventId(e.target.value)}\r\n                        style={{ padding: '8px', borderRadius: '4px', border: '1px solid #ddd', minWidth: '250px' }}\r\n                    >\r\n                        {events.map(e => (\r\n                            <option key={e.event_id} value={e.event_id}>{e.name}</option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n                {loading && <span style={{ color: '#666', fontStyle: 'italic' }}>Loading grid...</span>}\r\n            </div>\r\n\r\n            {/* Key/Legend */}\r\n            <div style={{ marginBottom: '15px', display: 'flex', gap: '15px', fontSize: '0.9rem' }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                    <span style={{ width: '15px', height: '15px', background: 'red', display: 'inline-block', borderRadius: '3px' }}></span> Full\r\n                </div>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                    <span style={{ width: '15px', height: '15px', background: '#ff69b4', display: 'inline-block', borderRadius: '3px' }}></span> Partial\r\n                </div>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                    <span style={{ width: '15px', height: '15px', background: 'green', display: 'inline-block', borderRadius: '3px' }}></span> Available\r\n                </div>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                    <span style={{ width: '15px', height: '15px', background: '#e2e8f0', display: 'inline-block', borderRadius: '3px' }}></span> Booked Night\r\n                </div>\r\n            </div>\r\n\r\n            {/* Results Grid */}\r\n            {hasSearched && (\r\n                <div style={{ overflowX: 'auto', border: '1px solid #ddd', borderRadius: '4px' }}>\r\n                    {processedData.length === 0 ? (\r\n                        <p style={{ padding: '20px' }}>No data found.</p>\r\n                    ) : (\r\n                        <table style={{ width: '100%', borderCollapse: 'collapse', minWidth: '1000px' }}>\r\n                            <thead>\r\n                                <tr style={{ background: '#f9f9f9', borderBottom: '2px solid #ddd' }}>\r\n                                    <th style={{ textAlign: 'left', padding: '12px', width: '80px', position: 'sticky', left: 0, background: '#f9f9f9', zIndex: 10 }}>Site</th>\r\n                                    <th style={{ textAlign: 'left', padding: '12px', width: '100px' }}>Type</th>\r\n                                    <th style={{ textAlign: 'center', padding: '12px', width: '100px' }}>Status</th>\r\n                                    {gridDates.map((d, i) => (\r\n                                        <th key={i} style={{ textAlign: 'center', padding: '8px', minWidth: '40px', fontSize: '0.8rem' }}>\r\n                                            {d.getDate()}/{d.getMonth() + 1}\r\n                                        </th>\r\n                                    ))}\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                {processedData.map((site) => (\r\n                                    <tr key={site.campsite_id} style={{ borderBottom: '1px solid #eee' }}>\r\n                                        <td style={{ padding: '8px 12px', fontWeight: 'bold', position: 'sticky', left: 0, background: 'white', zIndex: 5, borderRight: '1px solid #eee' }}>\r\n                                            {site.site_number}\r\n                                        </td>\r\n                                        <td style={{ padding: '8px 12px', fontSize: '0.9rem' }}>\r\n                                            {site.is_powered ? 'Powered' : 'Unpowered'}\r\n                                        </td>\r\n                                        <td style={{ padding: '8px 12px', textAlign: 'center' }}>\r\n                                            <span style={{\r\n                                                padding: '4px 8px',\r\n                                                borderRadius: '4px',\r\n                                                fontSize: '0.75rem',\r\n                                                fontWeight: 'bold',\r\n                                                color: 'white',\r\n                                                background: site.status === 'Full' ? 'red' : site.status === 'Partial' ? '#ff69b4' : 'green',\r\n                                                display: 'block',\r\n                                                textAlign: 'center'\r\n                                            }}>\r\n                                                {site.status}\r\n                                            </span>\r\n                                        </td>\r\n                                        {gridDates.map((d, i) => {\r\n                                            const booking = getBookingForDate(site, d);\r\n                                            return (\r\n                                                <td key={i}\r\n                                                    title={booking ? `Booked by: ${booking.first_name} ${booking.last_name} (Order #${booking.order_id})` : 'Available'}\r\n                                                    style={{\r\n                                                        textAlign: 'center',\r\n                                                        padding: '2px',\r\n                                                        background: booking ? '#e2e8f0' : 'transparent',\r\n                                                        borderLeft: '1px solid #f0f0f0'\r\n                                                    }}\r\n                                                >\r\n                                                    {booking ? (\r\n                                                        <div style={{ width: '100%', height: '100%', minHeight: '20px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                                                            <span style={{ fontSize: '0.7rem', color: '#64748b' }}>x</span>\r\n                                                        </div>\r\n                                                    ) : null}\r\n                                                </td>\r\n                                            );\r\n                                        })}\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default CampingAvailabilityReport;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\EventForm.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\EventPlanesReport.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\FlightLineRoster.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'notify'. Either include it or remove the dependency array.","line":40,"column":8,"nodeType":"ArrayExpression","endLine":40,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [notify, slug, token]","fix":{"range":[1668,1681],"text":"[notify, slug, token]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchEligiblePilots', 'fetchFlightLines', and 'fetchRoster'. Either include them or remove the dependency array.","line":48,"column":8,"nodeType":"ArrayExpression","endLine":48,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [event, fetchEligiblePilots, fetchFlightLines, fetchRoster]","fix":{"range":[1872,1879],"text":"[event, fetchEligiblePilots, fetchFlightLines, fetchRoster]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'replaceExisting' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":217,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":217,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"replaceExisting"},"fix":{"range":[8077,8105],"text":""},"desc":"Remove unused variable 'replaceExisting'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { useNotification } from '../../context/NotificationContext';\r\n\r\nfunction FlightLineRoster() {\r\n    const { slug } = useParams();\r\n    const navigate = useNavigate();\r\n    const { notify, confirm } = useNotification();\r\n    const token = localStorage.getItem('token');\r\n\r\n    const [loading, setLoading] = useState(true);\r\n    const [event, setEvent] = useState(null);\r\n    const [roster, setRoster] = useState([]);\r\n    const [eligiblePilots, setEligiblePilots] = useState([]);\r\n    const [selectedDate, setSelectedDate] = useState('');\r\n    const [availableDates, setAvailableDates] = useState([]);\r\n    const [flightLines, setFlightLines] = useState([]);\r\n    const [selectedFlightLine, setSelectedFlightLine] = useState('all');\r\n\r\n    // Modals\r\n    const [assignModal, setAssignModal] = useState({ show: false, slot: null });\r\n    const [editTimeModal, setEditTimeModal] = useState({ show: false, slot: null, startTime: '', endTime: '' });\r\n\r\n    // Fetch event details\r\n    useEffect(() => {\r\n        const fetchEvent = async () => {\r\n            try {\r\n                const res = await fetch(`/api/events/${slug}`, {\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n                if (!res.ok) throw new Error('Event not found');\r\n                const data = await res.json();\r\n                setEvent(data);\r\n            } catch (err) {\r\n                notify(err.message, 'error');\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchEvent();\r\n    }, [slug, token]);\r\n\r\n    // Fetch roster and eligible pilots\r\n    useEffect(() => {\r\n        if (!event) return;\r\n        fetchRoster();\r\n        fetchEligiblePilots();\r\n        fetchFlightLines();\r\n    }, [event]);\r\n\r\n    const fetchRoster = async () => {\r\n        try {\r\n            const res = await fetch(`/api/events/${event.event_id}/flight-lines/roster`, {\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (!res.ok) throw new Error('Failed to fetch roster');\r\n            const data = await res.json();\r\n            setRoster(data);\r\n\r\n            // Extract unique dates\r\n            const dates = [...new Set(data.map(slot => slot.roster_date))].sort();\r\n            setAvailableDates(dates);\r\n\r\n            // Set first date as selected if not already set\r\n            if (!selectedDate && dates.length > 0) {\r\n                setSelectedDate(dates[0]);\r\n            }\r\n\r\n            setLoading(false);\r\n        } catch (err) {\r\n            notify(err.message, 'error');\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const fetchEligiblePilots = async () => {\r\n        try {\r\n            const res = await fetch(`/api/events/${event.event_id}/eligible-pilots`, {\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (!res.ok) throw new Error('Failed to fetch pilots');\r\n            const data = await res.json();\r\n            setEligiblePilots(data);\r\n        } catch (err) {\r\n            notify(err.message, 'error');\r\n        }\r\n    };\r\n\r\n    const fetchFlightLines = async () => {\r\n        try {\r\n            const res = await fetch(`/api/events/${event.event_id}/flight-lines`, {\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (!res.ok) throw new Error('Failed to fetch flight lines');\r\n            const data = await res.json();\r\n            setFlightLines(data);\r\n        } catch (err) {\r\n            notify(err.message, 'error');\r\n        }\r\n    };\r\n\r\n    const handleAssign = async (attendeeId) => {\r\n        try {\r\n            const res = await fetch(`/api/flight-line-roster/${assignModal.slot.roster_id}/assign`, {\r\n                method: 'PUT',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({ attendee_id: attendeeId })\r\n            });\r\n\r\n            if (!res.ok) {\r\n                const err = await res.json();\r\n                throw new Error(err.error || 'Assignment failed');\r\n            }\r\n\r\n            notify('Pilot assigned successfully', 'success');\r\n            setAssignModal({ show: false, slot: null });\r\n            await fetchRoster();\r\n        } catch (err) {\r\n            notify(err.message, 'error');\r\n        }\r\n    };\r\n\r\n    const handleUnassign = (slot) => {\r\n        confirm(`Unassign ${slot.first_name} ${slot.last_name} from this duty?`, async () => {\r\n            try {\r\n                const res = await fetch(`/api/flight-line-roster/${slot.roster_id}/unassign`, {\r\n                    method: 'PUT',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${token}`,\r\n                        'X-Auth-Token': token\r\n                    }\r\n                });\r\n\r\n                if (!res.ok) throw new Error('Unassignment failed');\r\n\r\n                notify('Pilot unassigned successfully', 'success');\r\n                await fetchRoster();\r\n            } catch (err) {\r\n                notify(err.message, 'error');\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleEditTimes = async () => {\r\n        const { startTime, endTime } = editTimeModal;\r\n\r\n        if (!startTime || !endTime) {\r\n            notify('Both start and end times are required', 'error');\r\n            return;\r\n        }\r\n\r\n        if (startTime >= endTime) {\r\n            notify('Start time must be before end time', 'error');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const res = await fetch(`/api/flight-line-roster/${editTimeModal.slot.roster_id}/times`, {\r\n                method: 'PUT',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({\r\n                    start_time: `${startTime}:00`,\r\n                    end_time: `${endTime}:00`\r\n                })\r\n            });\r\n\r\n            if (!res.ok) {\r\n                const err = await res.json();\r\n                throw new Error(err.error || 'Time update failed');\r\n            }\r\n\r\n            notify('Slot times updated successfully', 'success');\r\n            setEditTimeModal({ show: false, slot: null, startTime: '', endTime: '' });\r\n            await fetchRoster();\r\n        } catch (err) {\r\n            notify(err.message, 'error');\r\n        }\r\n    };\r\n\r\n    const handleClearDay = () => {\r\n        confirm(`Clear ALL assignments for ${new Date(selectedDate).toLocaleDateString()}? This will unassign all pilots for this date.`, async () => {\r\n            try {\r\n                const res = await fetch(`/api/events/${event.event_id}/flight-lines/roster/clear-date`, {\r\n                    method: 'DELETE',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'Authorization': `Bearer ${token}`,\r\n                        'X-Auth-Token': token\r\n                    },\r\n                    body: JSON.stringify({ date: selectedDate })\r\n                });\r\n\r\n                if (!res.ok) throw new Error('Clear failed');\r\n\r\n                const result = await res.json();\r\n                notify(`Cleared ${result.clearedCount} assignments`, 'success');\r\n                await fetchRoster();\r\n            } catch (err) {\r\n                notify(err.message, 'error');\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleAutoAssign = async () => {\r\n        try {\r\n            const checkRes = await fetch(`/api/events/${event.event_id}/flight-lines/roster-status`, {\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n\r\n            let replaceExisting = false;\r\n\r\n            if (checkRes.ok) {\r\n                const { hasAssignments } = await checkRes.json();\r\n                if (hasAssignments) {\r\n                    confirm(\r\n                        'Some flight line duties are already assigned. Do you want to replace ALL existing assignments with new auto-assignments?',\r\n                        async () => {\r\n                            await executeAutoAssign(true);\r\n                        }\r\n                    );\r\n                    return;\r\n                }\r\n            }\r\n\r\n            await executeAutoAssign(false);\r\n        } catch (err) {\r\n            notify(err.message, 'error');\r\n        }\r\n    };\r\n\r\n    const executeAutoAssign = async (replaceExisting) => {\r\n        try {\r\n            const res = await fetch(`/api/events/${event.event_id}/flight-lines/auto-assign`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({ replaceExisting })\r\n            });\r\n\r\n            if (!res.ok) {\r\n                const err = await res.json();\r\n                throw new Error(err.error || 'Auto-assign failed');\r\n            }\r\n\r\n            const result = await res.json();\r\n\r\n            notify(\r\n                `Auto-assign complete! ${result.assignedSlots} of ${result.totalSlots} slots assigned using ${result.pilotsUsed} pilots.` +\r\n                (result.unassignedSlots > 0 ? ` (${result.unassignedSlots} slots could not be filled)` : ''),\r\n                'success'\r\n            );\r\n\r\n            await fetchRoster();\r\n        } catch (err) {\r\n            notify(err.message, 'error');\r\n        }\r\n    };\r\n\r\n    const formatTime = (timeValue) => {\r\n        if (!timeValue) return '';\r\n        if (typeof timeValue === 'string' && timeValue.includes('T')) {\r\n            const timePart = timeValue.split('T')[1];\r\n            return timePart.substring(0, 5);\r\n        }\r\n        if (typeof timeValue === 'string') {\r\n            return timeValue.substring(0, 5);\r\n        }\r\n        if (timeValue instanceof Date) {\r\n            return timeValue.toTimeString().substring(0, 5);\r\n        }\r\n        return timeValue;\r\n    };\r\n\r\n    // Detect time overlaps for a slot with other slots on same flight line\r\n    const hasTimeOverlap = (slot) => {\r\n        const slotStart = formatTime(slot.start_time);\r\n        const slotEnd = formatTime(slot.end_time);\r\n\r\n        return filteredRoster.some(otherSlot => {\r\n            // Skip same slot\r\n            if (otherSlot.roster_id === slot.roster_id) return false;\r\n\r\n            // Only check same flight line\r\n            if (otherSlot.flight_line_id !== slot.flight_line_id) return false;\r\n\r\n            const otherStart = formatTime(otherSlot.start_time);\r\n            const otherEnd = formatTime(otherSlot.end_time);\r\n\r\n            // Check for overlap: slot starts before other ends AND slot ends after other starts\r\n            return slotStart < otherEnd && slotEnd > otherStart;\r\n        });\r\n    };\r\n\r\n    // Get row style based on slot conditions\r\n    const getRowStyle = (slot) => {\r\n        const baseStyle = { borderBottom: '1px solid #eee' };\r\n\r\n        // Priority: overlap takes precedence over unassigned\r\n        if (hasTimeOverlap(slot)) {\r\n            return {\r\n                ...baseStyle,\r\n                backgroundColor: '#fee2e2', // Light red for overlaps\r\n                borderLeft: '4px solid #dc2626'\r\n            };\r\n        }\r\n\r\n        if (!slot.attendee_id) {\r\n            return {\r\n                ...baseStyle,\r\n                backgroundColor: '#fef3c7', // Light yellow for unassigned\r\n                borderLeft: '4px solid #f59e0b'\r\n            };\r\n        }\r\n\r\n        return baseStyle;\r\n    };\r\n\r\n    const filteredRoster = roster.filter(slot =>\r\n        slot.roster_date === selectedDate &&\r\n        (selectedFlightLine === 'all' || slot.flight_line_id === parseInt(selectedFlightLine))\r\n    );\r\n\r\n    if (loading) return <div className=\"container\">Loading...</div>;\r\n    if (!event) return <div className=\"container\">Event not found</div>;\r\n\r\n    return (\r\n        <div className=\"container\" style={{ maxWidth: '1200px', margin: '2rem auto' }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>\r\n                <div>\r\n                    <h1>Flight Line Roster</h1>\r\n                    <p style={{ color: '#666', margin: '0.5rem 0 0' }}>Event: {event.name}</p>\r\n                </div>\r\n                <button className=\"secondary-button\" onClick={() => navigate(`/events/${slug}/edit`)}>\r\n                    Back to Event\r\n                </button>\r\n            </div>\r\n\r\n            {/* Controls */}\r\n            <div className=\"card\" style={{ padding: '1.5rem', marginBottom: '2rem' }}>\r\n                <div style={{ display: 'flex', gap: '1rem', alignItems: 'center', flexWrap: 'wrap' }}>\r\n                    <div style={{ flex: '1', minWidth: '200px' }}>\r\n                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Select Date:</label>\r\n                        <select\r\n                            value={selectedDate}\r\n                            onChange={(e) => setSelectedDate(e.target.value)}\r\n                            className=\"form-control\"\r\n                            style={{ width: '100%' }}\r\n                        >\r\n                            {availableDates.map(date => (\r\n                                <option key={date} value={date}>\r\n                                    {new Date(date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}\r\n                                </option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                    <div style={{ flex: '1', minWidth: '200px' }}>\r\n                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Filter by Flight Line:</label>\r\n                        <select\r\n                            value={selectedFlightLine}\r\n                            onChange={(e) => setSelectedFlightLine(e.target.value)}\r\n                            className=\"form-control\"\r\n                            style={{ width: '100%' }}\r\n                        >\r\n                            <option value=\"all\">All Flight Lines</option>\r\n                            {flightLines.map(fl => (\r\n                                <option key={fl.flight_line_id} value={fl.flight_line_id}>\r\n                                    {fl.flight_line_name}\r\n                                </option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                    <div style={{ display: 'flex', gap: '0.75rem', alignItems: 'flex-end' }}>\r\n                        <button\r\n                            className=\"secondary-button\"\r\n                            onClick={handleAutoAssign}\r\n                            style={{ background: '#059669', color: 'white', border: 'none' }}\r\n                        >\r\n                            üéØ Auto-Assign All\r\n                        </button>\r\n                        <button\r\n                            className=\"secondary-button\"\r\n                            onClick={handleClearDay}\r\n                            style={{ background: '#dc2626', color: 'white', border: 'none' }}\r\n                            disabled={filteredRoster.filter(s => s.attendee_id).length === 0}\r\n                        >\r\n                            Clear This Day\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Roster Table */}\r\n            <div className=\"card\" style={{ padding: '2rem' }}>\r\n                <h2 style={{ marginTop: 0, marginBottom: '1.5rem' }}>\r\n                    Roster for {selectedDate && new Date(selectedDate).toLocaleDateString()}\r\n                </h2>\r\n\r\n                {filteredRoster.length === 0 ? (\r\n                    <p style={{ color: '#666', fontStyle: 'italic' }}>No roster slots for this date.</p>\r\n                ) : (\r\n                    <table className=\"table\" style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                        <thead>\r\n                            <tr style={{ background: '#f9fafb', fontSize: '0.9rem', textAlign: 'left' }}>\r\n                                <th style={{ padding: '0.75rem' }}>Flight Line</th>\r\n                                <th style={{ padding: '0.75rem' }}>Time Slot</th>\r\n                                <th style={{ padding: '0.75rem' }}>Assigned Pilot</th>\r\n                                <th style={{ padding: '0.75rem', textAlign: 'right' }}>Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {filteredRoster.map(slot => (\r\n                                <tr key={slot.roster_id} style={getRowStyle(slot)}>\r\n                                    <td style={{ padding: '0.75rem', fontWeight: '500' }}>{slot.flight_line_name}</td>\r\n                                    <td style={{ padding: '0.75rem' }}>\r\n                                        {formatTime(slot.start_time)} - {formatTime(slot.end_time)}\r\n                                    </td>\r\n                                    <td style={{ padding: '0.75rem' }}>\r\n                                        {slot.attendee_id ? (\r\n                                            <span style={{ fontWeight: '500' }}>\r\n                                                {slot.first_name} {slot.last_name}\r\n                                            </span>\r\n                                        ) : (\r\n                                            <span style={{ color: '#999', fontStyle: 'italic' }}>-- Unassigned --</span>\r\n                                        )}\r\n                                    </td>\r\n                                    <td style={{ padding: '0.75rem', textAlign: 'right' }}>\r\n                                        <div style={{ display: 'flex', gap: '0.5rem', justifyContent: 'flex-end' }}>\r\n                                            <button\r\n                                                onClick={() => setAssignModal({ show: true, slot })}\r\n                                                style={{ background: 'none', border: 'none', color: '#2563eb', cursor: 'pointer' }}\r\n                                            >\r\n                                                {slot.attendee_id ? 'Reassign' : 'Assign'}\r\n                                            </button>\r\n                                            {slot.attendee_id && (\r\n                                                <button\r\n                                                    onClick={() => handleUnassign(slot)}\r\n                                                    style={{ background: 'none', border: 'none', color: '#dc2626', cursor: 'pointer' }}\r\n                                                >\r\n                                                    Unassign\r\n                                                </button>\r\n                                            )}\r\n                                            <button\r\n                                                onClick={() => setEditTimeModal({\r\n                                                    show: true,\r\n                                                    slot,\r\n                                                    startTime: formatTime(slot.start_time),\r\n                                                    endTime: formatTime(slot.end_time)\r\n                                                })}\r\n                                                style={{ background: 'none', border: 'none', color: '#059669', cursor: 'pointer' }}\r\n                                            >\r\n                                                Edit Times\r\n                                            </button>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                )}\r\n            </div>\r\n\r\n            {/* Assign Modal */}\r\n            {assignModal.show && (\r\n                <div className=\"modal-overlay\">\r\n                    <div className=\"modal-content\" style={{ maxWidth: '500px' }}>\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>\r\n                            <h3 style={{ margin: 0 }}>\r\n                                {assignModal.slot.attendee_id ? 'Reassign Pilot' : 'Assign Pilot'}\r\n                            </h3>\r\n                            <button\r\n                                onClick={() => setAssignModal({ show: false, slot: null })}\r\n                                style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer', color: '#666' }}\r\n                            >\r\n                                √ó\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div style={{ marginBottom: '1rem' }}>\r\n                            <p style={{ margin: '0 0 0.5rem', color: '#666' }}>\r\n                                <strong>Flight Line:</strong> {assignModal.slot.flight_line_name}<br />\r\n                                <strong>Time:</strong> {formatTime(assignModal.slot.start_time)} - {formatTime(assignModal.slot.end_time)}\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div style={{ marginBottom: '1.5rem' }}>\r\n                            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Select Pilot:</label>\r\n                            <select\r\n                                id=\"pilot-select\"\r\n                                className=\"form-control\"\r\n                                style={{ width: '100%' }}\r\n                                defaultValue=\"\"\r\n                            >\r\n                                <option value=\"\" disabled>-- Choose a pilot --</option>\r\n                                {eligiblePilots.map(pilot => (\r\n                                    <option key={pilot.attendee_id} value={pilot.attendee_id}>\r\n                                        {pilot.first_name} {pilot.last_name}\r\n                                        {pilot.arrival_date && pilot.departure_date &&\r\n                                            ` (${new Date(pilot.arrival_date).toLocaleDateString()} - ${new Date(pilot.departure_date).toLocaleDateString()})`\r\n                                        }\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '1rem' }}>\r\n                            <button className=\"secondary-button\" onClick={() => setAssignModal({ show: false, slot: null })}>\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                className=\"primary-button\"\r\n                                onClick={() => {\r\n                                    const selected = document.getElementById('pilot-select').value;\r\n                                    if (!selected) {\r\n                                        notify('Please select a pilot', 'error');\r\n                                        return;\r\n                                    }\r\n                                    handleAssign(parseInt(selected));\r\n                                }}\r\n                            >\r\n                                Assign\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Edit Time Modal */}\r\n            {editTimeModal.show && (\r\n                <div className=\"modal-overlay\">\r\n                    <div className=\"modal-content\" style={{ maxWidth: '500px' }}>\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>\r\n                            <h3 style={{ margin: 0 }}>Edit Slot Times</h3>\r\n                            <button\r\n                                onClick={() => setEditTimeModal({ show: false, slot: null, startTime: '', endTime: '' })}\r\n                                style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer', color: '#666' }}\r\n                            >\r\n                                √ó\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div style={{ marginBottom: '1rem' }}>\r\n                            <p style={{ margin: '0 0 0.5rem', color: '#666' }}>\r\n                                <strong>Flight Line:</strong> {editTimeModal.slot.flight_line_name}\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', marginBottom: '1.5rem' }}>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Start Time:</label>\r\n                                <input\r\n                                    type=\"time\"\r\n                                    value={editTimeModal.startTime}\r\n                                    onChange={(e) => setEditTimeModal({ ...editTimeModal, startTime: e.target.value })}\r\n                                    className=\"form-control\"\r\n                                    style={{ width: '100%' }}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>End Time:</label>\r\n                                <input\r\n                                    type=\"time\"\r\n                                    value={editTimeModal.endTime}\r\n                                    onChange={(e) => setEditTimeModal({ ...editTimeModal, endTime: e.target.value })}\r\n                                    className=\"form-control\"\r\n                                    style={{ width: '100%' }}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '1rem' }}>\r\n                            <button\r\n                                className=\"secondary-button\"\r\n                                onClick={() => setEditTimeModal({ show: false, slot: null, startTime: '', endTime: '' })}\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button className=\"primary-button\" onClick={handleEditTimes}>\r\n                                Save Times\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default FlightLineRoster;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\FlightLinesSetup.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":165,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":165,"endColumn":21},{"ruleId":"no-unused-vars","severity":2,"message":"'replaceExisting' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":281,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":281,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"replaceExisting"},"fix":{"range":[10204,10232],"text":""},"desc":"Remove unused variable 'replaceExisting'."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { useNotification } from '../../context/NotificationContext';\r\n\r\nfunction FlightLinesSetup() {\r\n    const { slug } = useParams(); // event slug\r\n    const navigate = useNavigate();\r\n    const { user, token } = useAuth();\r\n    const { notify, confirm } = useNotification();\r\n\r\n    const [loading, setLoading] = useState(true);\r\n    const [event, setEvent] = useState(null);\r\n    const [flightLines, setFlightLines] = useState([]);\r\n    const [selectedLine, setSelectedLine] = useState(null); // For viewing schedules\r\n    const [schedules, setSchedules] = useState([]);\r\n\r\n    // Flight Line Modal\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [editingLine, setEditingLine] = useState(null);\r\n    const [formData, setFormData] = useState({ flight_line_name: '' });\r\n\r\n    // Schedule Modal\r\n    const [showScheduleModal, setShowScheduleModal] = useState(false);\r\n    const [editingSchedule, setEditingSchedule] = useState(null);\r\n    const [scheduleForm, setScheduleForm] = useState({\r\n        schedule_date: '',\r\n        open_time: '09:00',\r\n        close_time: '17:00',\r\n        duty_duration_minutes: 60\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (user && user.role !== 'admin') {\r\n            navigate('/events');\r\n        }\r\n    }, [user, navigate]);\r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            try {\r\n                const headers = {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                };\r\n\r\n                // Fetch Event Details\r\n                const eventRes = await fetch(`/api/events/${slug}`, { headers });\r\n                if (!eventRes.ok) throw new Error('Failed to load event');\r\n                const eventData = await eventRes.json();\r\n                setEvent(eventData);\r\n\r\n                // Fetch Flight Lines\r\n                const linesRes = await fetch(`/api/events/${eventData.event_id}/flight-lines`, { headers });\r\n                if (linesRes.ok) {\r\n                    const linesData = await linesRes.json();\r\n                    setFlightLines(linesData);\r\n                }\r\n            } catch (err) {\r\n                notify(err.message, 'error');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchData();\r\n    }, [slug, token, notify]);\r\n\r\n    const handleInputChange = (e) => {\r\n        setFormData({ ...formData, [e.target.name]: e.target.value });\r\n    };\r\n\r\n    const openCreateModal = () => {\r\n        setEditingLine(null);\r\n        setFormData({ flight_line_name: '' });\r\n        setShowModal(true);\r\n    };\r\n\r\n    const openEditModal = (line) => {\r\n        setEditingLine(line);\r\n        setFormData({ flight_line_name: line.flight_line_name });\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        if (!formData.flight_line_name || !formData.flight_line_name.trim()) {\r\n            notify(\"Flight line name is required\", \"error\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const url = editingLine\r\n                ? `/api/flight-lines/${editingLine.flight_line_id}`\r\n                : `/api/events/${event.event_id}/flight-lines`;\r\n\r\n            const method = editingLine ? 'PUT' : 'POST';\r\n\r\n            const res = await fetch(url, {\r\n                method,\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify(formData)\r\n            });\r\n\r\n            if (!res.ok) {\r\n                const err = await res.json();\r\n                throw new Error(err.error || 'Failed to save flight line');\r\n            }\r\n\r\n            const savedLine = await res.json();\r\n\r\n            if (editingLine) {\r\n                setFlightLines(prev => prev.map(l => l.flight_line_id === savedLine.flight_line_id ? savedLine : l));\r\n                notify('Flight line updated', 'success');\r\n            } else {\r\n                setFlightLines(prev => [...prev, savedLine]);\r\n                notify('Flight line created', 'success');\r\n            }\r\n\r\n            setShowModal(false);\r\n            setEditingLine(null);\r\n            setFormData({ flight_line_name: '' });\r\n\r\n        } catch (err) {\r\n            notify(err.message, \"error\");\r\n        }\r\n    };\r\n\r\n    const handleDelete = (lineId, lineName) => {\r\n        confirm(`Delete flight line \"${lineName}\"? This will also delete all associated schedules and roster entries.`, async () => {\r\n            try {\r\n                const res = await fetch(`/api/flight-lines/${lineId}`, {\r\n                    method: 'DELETE',\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n\r\n                if (res.status === 409) {\r\n                    const err = await res.json();\r\n                    notify(err.error || \"Cannot delete flight line with existing data.\", \"error\");\r\n                    return;\r\n                }\r\n\r\n                if (!res.ok) throw new Error('Delete failed');\r\n\r\n                setFlightLines(prev => prev.filter(l => l.flight_line_id !== lineId));\r\n                notify('Flight line deleted', 'success');\r\n            } catch (err) {\r\n                notify(err.message, 'error');\r\n            }\r\n        });\r\n    };\r\n\r\n    // Schedule Functions\r\n    const fetchSchedules = async (lineId) => {\r\n        try {\r\n            const res = await fetch(`/api/flight-lines/${lineId}/schedule`, {\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setSchedules(data);\r\n            }\r\n        } catch (err) {\r\n            notify('Failed to load schedules', 'error');\r\n        }\r\n    };\r\n\r\n    const handleViewSchedules = async (line) => {\r\n        setSelectedLine(line);\r\n        await fetchSchedules(line.flight_line_id);\r\n    };\r\n\r\n    const handleScheduleInputChange = (e) => {\r\n        const { name, value } = e.target;\r\n        setScheduleForm({ ...scheduleForm, [name]: value });\r\n    };\r\n\r\n    const openCreateSchedule = () => {\r\n        setEditingSchedule(null);\r\n        setScheduleForm({\r\n            schedule_date: '',\r\n            open_time: '09:00',\r\n            close_time: '17:00',\r\n            duty_duration_minutes: 60\r\n        });\r\n        setShowScheduleModal(true);\r\n    };\r\n\r\n    const openEditSchedule = (schedule) => {\r\n        setEditingSchedule(schedule);\r\n        setScheduleForm({\r\n            schedule_date: schedule.schedule_date.split('T')[0],\r\n            open_time: schedule.open_time.substring(0, 5),\r\n            close_time: schedule.close_time.substring(0, 5),\r\n            duty_duration_minutes: schedule.duty_duration_minutes\r\n        });\r\n        setShowScheduleModal(true);\r\n    };\r\n\r\n    const handleSaveSchedule = async () => {\r\n        if (!scheduleForm.schedule_date || !scheduleForm.open_time || !scheduleForm.close_time) {\r\n            notify(\"All schedule fields are required\", \"error\");\r\n            return;\r\n        }\r\n\r\n        if (scheduleForm.open_time >= scheduleForm.close_time) {\r\n            notify(\"Close time must be after open time\", \"error\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Format times with seconds for SQL Server (HH:MM:SS)\r\n            const payload = {\r\n                schedule_date: scheduleForm.schedule_date,\r\n                open_time: `${scheduleForm.open_time}:00`,\r\n                close_time: `${scheduleForm.close_time}:00`,\r\n                duty_duration_minutes: parseInt(scheduleForm.duty_duration_minutes)\r\n            };\r\n\r\n            const res = await fetch(`/api/flight-lines/${selectedLine.flight_line_id}/schedule`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify(payload)\r\n            });\r\n\r\n            if (!res.ok) {\r\n                const err = await res.json();\r\n                throw new Error(err.error || 'Failed to save schedule');\r\n            }\r\n\r\n            const savedSchedule = await res.json();\r\n\r\n            notify(\r\n                editingSchedule\r\n                    ? `Schedule updated! ${savedSchedule.slotsGenerated} slots regenerated.`\r\n                    : `Schedule created! ${savedSchedule.slotsGenerated} slots generated.`,\r\n                'success'\r\n            );\r\n\r\n            await fetchSchedules(selectedLine.flight_line_id);\r\n            setShowScheduleModal(false);\r\n            setEditingSchedule(null);\r\n\r\n        } catch (err) {\r\n            notify(err.message, \"error\");\r\n        }\r\n    };\r\n\r\n    const handleDeleteSchedule = (scheduleId, date) => {\r\n        confirm(`Delete schedule for ${new Date(date).toLocaleDateString()}? This will remove all duty slots for this date.`, async () => {\r\n            try {\r\n                const res = await fetch(`/api/flight-line-schedule/${scheduleId}`, {\r\n                    method: 'DELETE',\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n\r\n                if (!res.ok) throw new Error('Delete failed');\r\n\r\n                await fetchSchedules(selectedLine.flight_line_id);\r\n                notify('Schedule deleted', 'success');\r\n            } catch (err) {\r\n                notify(err.message, 'error');\r\n            }\r\n        });\r\n    };\r\n\r\n    // Auto-Assign Handler\r\n    const handleAutoAssign = async () => {\r\n        // Check if any assignments already exist\r\n        try {\r\n            const checkRes = await fetch(`/api/events/${event.event_id}/flight-lines/roster-status`, {\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n\r\n            let replaceExisting = false;\r\n\r\n            if (checkRes.ok) {\r\n                const { hasAssignments } = await checkRes.json();\r\n                if (hasAssignments) {\r\n                    // Use custom confirm dialog instead of browser confirm\r\n                    confirm(\r\n                        'Some flight line duties are already assigned. Do you want to replace ALL existing assignments with new auto-assignments?',\r\n                        async () => {\r\n                            // User confirmed - proceed with replacement\r\n                            await executeAutoAssign(true);\r\n                        }\r\n                    );\r\n                    return; // Exit here, the confirm callback will handle the rest\r\n                }\r\n            }\r\n\r\n            // No existing assignments, proceed directly\r\n            await executeAutoAssign(false);\r\n\r\n        } catch (err) {\r\n            notify(err.message, 'error');\r\n        }\r\n    };\r\n\r\n    const executeAutoAssign = async (replaceExisting) => {\r\n        try {\r\n            const res = await fetch(`/api/events/${event.event_id}/flight-lines/auto-assign`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({ replaceExisting })\r\n            });\r\n\r\n            if (!res.ok) {\r\n                const err = await res.json();\r\n                throw new Error(err.error || 'Auto-assign failed');\r\n            }\r\n\r\n            const result = await res.json();\r\n\r\n            notify(\r\n                `Auto-assign complete! ${result.assignedSlots} of ${result.totalSlots} slots assigned using ${result.pilotsUsed} pilots.` +\r\n                (result.unassignedSlots > 0 ? ` (${result.unassignedSlots} slots could not be filled)` : ''),\r\n                'success'\r\n            );\r\n\r\n        } catch (err) {\r\n            notify(err.message, 'error');\r\n        }\r\n    };\r\n\r\n    // Helper to format time from SQL Server TIME column\r\n    const formatTime = (timeValue) => {\r\n        if (!timeValue) return '';\r\n\r\n        // If it's an ISO datetime string (e.g., \"1970-01-01T09:00:00.000Z\")\r\n        if (typeof timeValue === 'string' && timeValue.includes('T')) {\r\n            const timePart = timeValue.split('T')[1];\r\n            return timePart.substring(0, 5); // HH:MM\r\n        }\r\n\r\n        // If it's a simple time string (e.g., \"09:00:00\")\r\n        if (typeof timeValue === 'string') {\r\n            return timeValue.substring(0, 5);\r\n        }\r\n\r\n        // If it's a Date object\r\n        if (timeValue instanceof Date) {\r\n            return timeValue.toTimeString().substring(0, 5);\r\n        }\r\n\r\n        return timeValue;\r\n    };\r\n\r\n    if (loading) return <div className=\"container\">Loading...</div>;\r\n    if (!event) return <div className=\"container\">Event not found</div>;\r\n\r\n    return (\r\n        <div className=\"container\" style={{ maxWidth: '800px', margin: '2rem auto' }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>\r\n                <div>\r\n                    <h1>Flight Lines Setup</h1>\r\n                    <p style={{ color: '#666', margin: '0.5rem 0 0' }}>Event: {event.name}</p>\r\n                </div>\r\n                <div style={{ display: 'flex', gap: '0.75rem' }}>\r\n                    <button className=\"primary-button\" onClick={() => navigate(`/admin/events/${slug}/roster`)}>\r\n                        üìã Manage Roster\r\n                    </button>\r\n                    <button className=\"secondary-button\" onClick={() => navigate(`/events/${slug}/edit`)}>\r\n                        Back to Event\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"card\" style={{ padding: '2rem' }}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>\r\n                    <h2 style={{ margin: 0, fontSize: '1.2rem' }}>Flight Lines</h2>\r\n                    <button className=\"primary-button\" onClick={openCreateModal}>+ Add Flight Line</button>\r\n                </div>\r\n\r\n                {flightLines.length === 0 ? (\r\n                    <p style={{ color: '#666', fontStyle: 'italic' }}>No flight lines configured. Click \"Add Flight Line\" to get started.</p>\r\n                ) : (\r\n                    <table className=\"table\" style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                        <thead>\r\n                            <tr style={{ background: '#f9fafb', fontSize: '0.9rem', textAlign: 'left' }}>\r\n                                <th style={{ padding: '0.75rem' }}>Flight Line Name</th>\r\n                                <th style={{ padding: '0.75rem', textAlign: 'right' }}>Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {flightLines.map(line => (\r\n                                <tr\r\n                                    key={line.flight_line_id}\r\n                                    style={{\r\n                                        borderBottom: '1px solid #eee',\r\n                                        background: selectedLine?.flight_line_id === line.flight_line_id ? '#e0f2fe' : 'white'\r\n                                    }}\r\n                                >\r\n                                    <td style={{ padding: '0.75rem' }}>{line.flight_line_name}</td>\r\n                                    <td style={{ padding: '0.75rem', textAlign: 'right' }}>\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={() => handleViewSchedules(line)}\r\n                                            style={{ marginRight: '0.5rem', background: 'none', border: 'none', color: '#059669', cursor: 'pointer', fontWeight: selectedLine?.flight_line_id === line.flight_line_id ? 'bold' : 'normal' }}\r\n                                        >\r\n                                            View Schedules\r\n                                        </button>\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={() => openEditModal(line)}\r\n                                            style={{ marginRight: '0.5rem', background: 'none', border: 'none', color: '#2563eb', cursor: 'pointer' }}\r\n                                        >\r\n                                            Edit\r\n                                        </button>\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={() => handleDelete(line.flight_line_id, line.flight_line_name)}\r\n                                            style={{ background: 'none', border: 'none', color: '#dc2626', cursor: 'pointer' }}\r\n                                        >\r\n                                            Delete\r\n                                        </button>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                )}\r\n            </div>\r\n\r\n            {/* Schedules Section */}\r\n            {selectedLine && (\r\n                <div className=\"card\" style={{ padding: '2rem', marginTop: '2rem' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>\r\n                        <div>\r\n                            <h2 style={{ margin: 0, fontSize: '1.2rem' }}>Schedules for {selectedLine.flight_line_name}</h2>\r\n                            <p style={{ color: '#666', fontSize: '0.85rem', margin: '0.25rem 0 0' }}>\r\n                                Create flight line schedules. Duty slots will be auto-generated.\r\n                            </p>\r\n                        </div>\r\n                        <div style={{ display: 'flex', gap: '0.75rem' }}>\r\n                            {schedules.length > 0 && (\r\n                                <button\r\n                                    className=\"secondary-button\"\r\n                                    onClick={handleAutoAssign}\r\n                                    style={{ background: '#059669', color: 'white', border: 'none' }}\r\n                                >\r\n                                    üéØ Auto-Assign All\r\n                                </button>\r\n                            )}\r\n                            <button className=\"primary-button\" onClick={openCreateSchedule}>+ Add Schedule</button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {schedules.length === 0 ? (\r\n                        <p style={{ color: '#666', fontStyle: 'italic' }}>No schedules yet. Click \"Add Schedule\" to create one.</p>\r\n                    ) : (\r\n                        <table className=\"table\" style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                            <thead>\r\n                                <tr style={{ background: '#f9fafb', fontSize: '0.9rem', textAlign: 'left' }}>\r\n                                    <th style={{ padding: '0.75rem' }}>Date</th>\r\n                                    <th style={{ padding: '0.75rem' }}>Open Time</th>\r\n                                    <th style={{ padding: '0.75rem' }}>Close Time</th>\r\n                                    <th style={{ padding: '0.75rem' }}>Slot Duration</th>\r\n                                    <th style={{ padding: '0.75rem', textAlign: 'right' }}>Actions</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                {schedules.map(schedule => (\r\n                                    <tr key={schedule.schedule_id} style={{ borderBottom: '1px solid #eee' }}>\r\n                                        <td style={{ padding: '0.75rem' }}>\r\n                                            {new Date(schedule.schedule_date).toLocaleDateString()}\r\n                                        </td>\r\n                                        <td style={{ padding: '0.75rem' }}>{formatTime(schedule.open_time)}</td>\r\n                                        <td style={{ padding: '0.75rem' }}>{formatTime(schedule.close_time)}</td>\r\n                                        <td style={{ padding: '0.75rem' }}>{schedule.duty_duration_minutes} min</td>\r\n                                        <td style={{ padding: '0.75rem', textAlign: 'right' }}>\r\n                                            <button\r\n                                                type=\"button\"\r\n                                                onClick={() => openEditSchedule(schedule)}\r\n                                                style={{ marginRight: '0.5rem', background: 'none', border: 'none', color: '#2563eb', cursor: 'pointer' }}\r\n                                            >\r\n                                                Edit\r\n                                            </button>\r\n                                            <button\r\n                                                type=\"button\"\r\n                                                onClick={() => handleDeleteSchedule(schedule.schedule_id, schedule.schedule_date)}\r\n                                                style={{ background: 'none', border: 'none', color: '#dc2626', cursor: 'pointer' }}\r\n                                            >\r\n                                                Delete\r\n                                            </button>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Flight Line Modal */}\r\n            {showModal && (\r\n                <div className=\"modal-overlay\">\r\n                    <div className=\"modal-content\" style={{ maxWidth: '500px' }}>\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>\r\n                            <h3 style={{ margin: 0 }}>{editingLine ? 'Edit Flight Line' : 'New Flight Line'}</h3>\r\n                            <button\r\n                                onClick={() => setShowModal(false)}\r\n                                style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer', color: '#666' }}\r\n                            >\r\n                                √ó\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div style={{ marginBottom: '1.5rem' }}>\r\n                            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Flight Line Name *</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                name=\"flight_line_name\"\r\n                                value={formData.flight_line_name}\r\n                                onChange={handleInputChange}\r\n                                placeholder=\"e.g., North Line, South Line\"\r\n                                className=\"form-control\"\r\n                                style={{ width: '100%' }}\r\n                            />\r\n                        </div>\r\n\r\n                        <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '1rem' }}>\r\n                            <button className=\"secondary-button\" onClick={() => setShowModal(false)}>Cancel</button>\r\n                            <button className=\"primary-button\" onClick={handleSave}>\r\n                                {editingLine ? 'Update' : 'Create'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Schedule Modal */}\r\n            {showScheduleModal && (\r\n                <div className=\"modal-overlay\">\r\n                    <div className=\"modal-content\" style={{ maxWidth: '550px' }}>\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>\r\n                            <h3 style={{ margin: 0 }}>{editingSchedule ? 'Edit Schedule' : 'New Schedule'}</h3>\r\n                            <button\r\n                                onClick={() => setShowScheduleModal(false)}\r\n                                style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer', color: '#666' }}\r\n                            >\r\n                                √ó\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div style={{ marginBottom: '1.5rem' }}>\r\n                            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Date *</label>\r\n                            <input\r\n                                type=\"date\"\r\n                                name=\"schedule_date\"\r\n                                value={scheduleForm.schedule_date}\r\n                                onChange={handleScheduleInputChange}\r\n                                min={event?.start_date ? event.start_date.split('T')[0] : undefined}\r\n                                max={event?.end_date ? event.end_date.split('T')[0] : undefined}\r\n                                className=\"form-control\"\r\n                                style={{ width: '100%' }}\r\n                            />\r\n                        </div>\r\n\r\n                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', marginBottom: '1.5rem' }}>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Open Time *</label>\r\n                                <input\r\n                                    type=\"time\"\r\n                                    name=\"open_time\"\r\n                                    value={scheduleForm.open_time}\r\n                                    onChange={handleScheduleInputChange}\r\n                                    className=\"form-control\"\r\n                                    style={{ width: '100%' }}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Close Time *</label>\r\n                                <input\r\n                                    type=\"time\"\r\n                                    name=\"close_time\"\r\n                                    value={scheduleForm.close_time}\r\n                                    onChange={handleScheduleInputChange}\r\n                                    className=\"form-control\"\r\n                                    style={{ width: '100%' }}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{ marginBottom: '1.5rem' }}>\r\n                            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>Duty Duration (minutes) *</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                name=\"duty_duration_minutes\"\r\n                                value={scheduleForm.duty_duration_minutes}\r\n                                onChange={handleScheduleInputChange}\r\n                                min=\"15\"\r\n                                max=\"480\"\r\n                                step=\"15\"\r\n                                className=\"form-control\"\r\n                                style={{ width: '100%' }}\r\n                            />\r\n                            <p style={{ fontSize: '0.8rem', color: '#666', margin: '0.5rem 0 0' }}>\r\n                                Roster slots will be auto-generated based on this duration.\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '1rem' }}>\r\n                            <button className=\"secondary-button\" onClick={() => setShowScheduleModal(false)}>Cancel</button>\r\n                            <button className=\"primary-button\" onClick={handleSaveSchedule}>\r\n                                {editingSchedule ? 'Update & Regenerate Slots' : 'Create & Generate Slots'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default FlightLinesSetup;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\MerchandiseList.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":120,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { useNotification } from '../../context/NotificationContext';\r\nimport {\r\n    DndContext,\r\n    closestCenter,\r\n    KeyboardSensor,\r\n    PointerSensor,\r\n    useSensor,\r\n    useSensors,\r\n    DragOverlay\r\n} from '@dnd-kit/core';\r\nimport {\r\n    arrayMove,\r\n    SortableContext,\r\n    sortableKeyboardCoordinates,\r\n    verticalListSortingStrategy,\r\n    useSortable\r\n} from '@dnd-kit/sortable';\r\nimport { CSS } from '@dnd-kit/utilities';\r\n\r\nfunction MerchandiseList() {\r\n    const { token } = useAuth();\r\n    const navigate = useNavigate();\r\n    const { notify } = useNotification();\r\n    const [products, setProducts] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [showCreateModal, setShowCreateModal] = useState(false);\r\n    const [newProductName, setNewProductName] = useState('');\r\n    const [showArchived, setShowArchived] = useState(false);\r\n\r\n    const sensors = useSensors(\r\n        useSensor(PointerSensor),\r\n        useSensor(KeyboardSensor, {\r\n            coordinateGetter: sortableKeyboardCoordinates,\r\n        })\r\n    );\r\n\r\n    useEffect(() => {\r\n        fetchProducts();\r\n    }, []);\r\n\r\n    const handleDragEnd = async (event) => {\r\n        const { active, over } = event;\r\n\r\n        if (active.id !== over.id) {\r\n            setProducts((items) => {\r\n                const oldIndex = items.findIndex((i) => i.product_id === active.id);\r\n                const newIndex = items.findIndex((i) => i.product_id === over.id);\r\n                const newItems = arrayMove(items, oldIndex, newIndex);\r\n\r\n                // Prepare API update\r\n                // We need to send ALL items with their new order index\r\n                const updates = newItems.map((item, index) => ({\r\n                    id: item.product_id,\r\n                    sort_order: index\r\n                }));\r\n\r\n                // Call API in background\r\n                fetch('/api/manage/products/reorder', {\r\n                    method: 'PUT',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'Authorization': `Bearer ${token}`,\r\n                        'X-Auth-Token': token\r\n                    },\r\n                    body: JSON.stringify({ items: updates })\r\n                })\r\n                    .then(async res => {\r\n                        if (!res.ok) {\r\n                            const errData = await res.json();\r\n                            throw new Error(errData.error || 'Failed to save');\r\n                        }\r\n                        notify(\"Order saved\", \"success\");\r\n                    })\r\n                    .catch(err => {\r\n                        console.error(\"Failed to save order\", err);\r\n                        notify(\"Failed to save new order: \" + err.message, \"error\");\r\n                        // Revert? For now just notify.\r\n                    });\r\n\r\n                return newItems;\r\n            });\r\n        }\r\n    };\r\n\r\n    const fetchProducts = async () => {\r\n        try {\r\n            const res = await fetch('/api/products');\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setProducts(data);\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleCreate = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            const res = await fetch('/api/products', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({ name: newProductName })\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                navigate(`/admin/merchandise/${data.product_id}`);\r\n            } else {\r\n                notify('Failed to create product', 'error');\r\n            }\r\n        } catch (e) {\r\n            notify('Error creating product', 'error');\r\n        }\r\n    };\r\n\r\n    if (loading) return <div>Loading...</div>;\r\n\r\n    return (\r\n        <div style={{ padding: '20px', maxWidth: '1200px', margin: '0 auto' }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>\r\n                <h1 style={{ margin: 0 }}>Merchandise</h1>\r\n                <div style={{ display: 'flex', gap: '20px', alignItems: 'center' }}>\r\n                    <label style={{ display: 'flex', alignItems: 'center', gap: '5px', cursor: 'pointer' }}>\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            checked={showArchived}\r\n                            onChange={(e) => setShowArchived(e.target.checked)}\r\n                        />\r\n                        Show Archived\r\n                    </label>\r\n                    <Link to=\"/admin/suppliers\" style={{ background: '#2196F3', color: 'white', padding: '10px 20px', borderRadius: '4px', textDecoration: 'none', display: 'inline-block' }}>\r\n                        Suppliers\r\n                    </Link>\r\n                    <button\r\n                        onClick={() => setShowCreateModal(true)}\r\n                        style={{ background: 'black', color: 'white', padding: '10px 20px', borderRadius: '4px', cursor: 'pointer', border: 'none' }}\r\n                    >\r\n                        + New Product\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div style={{ overflowX: 'auto' }}>\r\n                <DndContext\r\n                    sensors={sensors}\r\n                    collisionDetection={closestCenter}\r\n                    onDragEnd={handleDragEnd}\r\n                >\r\n                    <table style={{ width: '100%', borderCollapse: 'collapse', borderRadius: '8px', overflow: 'hidden', boxShadow: '0 2px 8px rgba(0,0,0,0.1)' }}>\r\n                        <thead style={{ background: '#f5f5f5' }}>\r\n                            <tr>\r\n                                <th style={{ padding: '15px', width: '40px' }}></th>\r\n                                <th style={{ padding: '15px', textAlign: 'left' }}>Image</th>\r\n                                <th style={{ padding: '15px', textAlign: 'left' }}>Name</th>\r\n                                <th style={{ padding: '15px', textAlign: 'center' }}>Variants</th>\r\n                                <th style={{ padding: '15px', textAlign: 'center' }}>SKUs</th>\r\n                                <th style={{ padding: '15px', textAlign: 'center' }}>Total Stock</th>\r\n                                <th style={{ padding: '15px', textAlign: 'right' }}>Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            <SortableContext items={products.map(p => p.product_id)} strategy={verticalListSortingStrategy}>\r\n                                {products\r\n                                    .filter(p => showArchived ? true : p.is_active)\r\n                                    .map(p => (\r\n                                        <SortableRow key={p.product_id} p={p} />\r\n                                    ))}\r\n                            </SortableContext>\r\n                        </tbody>\r\n                    </table>\r\n                </DndContext>\r\n                {products.length === 0 && <p style={{ textAlign: 'center', marginTop: '20px' }}>No products found.</p>}\r\n            </div>\r\n\r\n            {/* Create Modal */}\r\n            {showCreateModal && (\r\n                <div style={{\r\n                    position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,\r\n                    background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000\r\n                }}>\r\n                    <form onSubmit={handleCreate} style={{ background: 'white', padding: '30px', borderRadius: '8px', width: '400px' }}>\r\n                        <h2>New Product</h2>\r\n                        <div style={{ marginBottom: '20px' }}>\r\n                            <label style={{ display: 'block', marginBottom: '5px' }}>Product Name</label>\r\n                            <input\r\n                                autoFocus\r\n                                value={newProductName}\r\n                                onChange={e => setNewProductName(e.target.value)}\r\n                                style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px' }}\r\n                                required\r\n                            />\r\n                        </div>\r\n                        <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px' }}>\r\n                            <button type=\"button\" onClick={() => setShowCreateModal(false)} style={{ padding: '8px 16px', background: 'transparent', border: '1px solid #ddd', cursor: 'pointer' }}>Cancel</button>\r\n                            <button type=\"submit\" style={{ padding: '8px 16px', background: 'black', color: 'white', border: 'none', cursor: 'pointer' }}>Create</button>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n// Separate Component for Sortable Row to avoid Hooks errors in loop\r\nfunction SortableRow({ p }) {\r\n    const {\r\n        attributes,\r\n        listeners,\r\n        setNodeRef,\r\n        transform,\r\n        transition,\r\n        isDragging\r\n    } = useSortable({ id: p.product_id });\r\n\r\n    const style = {\r\n        transform: CSS.Transform.toString(transform),\r\n        transition,\r\n        background: isDragging ? '#f0f0f0' : 'white',\r\n        zIndex: isDragging ? 2 : 1,\r\n        position: 'relative'\r\n    };\r\n\r\n    return (\r\n        <tr ref={setNodeRef} style={{ borderBottom: '1px solid #eee', ...style }}>\r\n            <td style={{ padding: '10px', width: '40px', cursor: 'grab' }} {...attributes} {...listeners}>\r\n                {/* Drag Handle Icon */}\r\n                <div style={{ color: '#aaa', display: 'flex', justifyContent: 'center' }}>\r\n                    ‚ò∞\r\n                </div>\r\n            </td>\r\n            <td style={{ padding: '10px' }}>\r\n                {p.base_image_url ? (\r\n                    <img src={p.base_image_url} alt={p.name} style={{ width: '50px', height: '50px', objectFit: 'cover', borderRadius: '4px' }} />\r\n                ) : (\r\n                    <div style={{ width: '50px', height: '50px', background: '#eee', borderRadius: '4px' }}></div>\r\n                )}\r\n            </td>\r\n            <td style={{ padding: '10px', fontWeight: 'bold' }}>\r\n                <Link to={`/admin/merchandise/${p.product_id}`} style={{ color: 'black', textDecoration: 'none' }}>\r\n                    {p.name}\r\n                </Link>\r\n                {!p.is_active && <span style={{ marginLeft: '10px', fontSize: '0.8rem', background: '#ccc', padding: '2px 6px', borderRadius: '4px' }}>Archived</span>}\r\n            </td>\r\n            <td style={{ padding: '10px', textAlign: 'center' }}>{p.variant_count}</td>\r\n            <td style={{ padding: '10px', textAlign: 'center' }}>{p.sku_count}</td>\r\n            <td style={{ padding: '10px', textAlign: 'center' }}>{p.total_stock || 0}</td>\r\n            <td style={{ padding: '10px', textAlign: 'right' }}>\r\n                <Link to={`/admin/merchandise/${p.product_id}`} style={{ color: 'blue', textDecoration: 'none', marginRight: '10px' }}>Edit</Link>\r\n            </td>\r\n        </tr>\r\n    );\r\n}\r\n\r\nexport default MerchandiseList;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\ProductEditor.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'newOptValue' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":24,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"newOptValue"},"fix":{"range":[1058,1069],"text":""},"desc":"Remove unused variable 'newOptValue'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'selectedVariantId' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":25,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":29,"suggestions":[{"messageId":"removeVar","data":{"varName":"selectedVariantId"},"fix":{"range":[1115,1132],"text":""},"desc":"Remove unused variable 'selectedVariantId'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setSelectedVariantId' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":25,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":51,"suggestions":[{"messageId":"removeVar","data":{"varName":"setSelectedVariantId"},"fix":{"range":[1132,1154],"text":""},"desc":"Remove unused variable 'setSelectedVariantId'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchDetails' and 'fetchSuppliers'. Either include them or remove the dependency array.","line":48,"column":8,"nodeType":"ArrayExpression","endLine":48,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [fetchDetails, fetchSuppliers, id]","fix":{"range":[1993,1997],"text":"[fetchDetails, fetchSuppliers, id]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":95,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":95,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":116,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":116,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":161,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":161,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":187,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":187,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":210,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":210,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'existingId' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":219,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":219,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"existingId"},"fix":{"range":[9559,9571],"text":""},"desc":"Remove unused variable 'existingId'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":248,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":248,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":265,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":265,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":287,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":287,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":307,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":307,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":324,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":324,"endColumn":33},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":329,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":329,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":396,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":396,"endColumn":19}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useParams, Link } from 'react-router-dom';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { useNotification } from '../../context/NotificationContext';\r\n\r\nfunction ProductEditor() {\r\n    const { id } = useParams();\r\n    const { token } = useAuth();\r\n    const { notify, confirm } = useNotification();\r\n    const [loading, setLoading] = useState(true);\r\n    const [activeTab, setActiveTab] = useState('info'); // info, options, skus\r\n\r\n    // Data State\r\n    const [product, setProduct] = useState({});\r\n    const [variants, setVariants] = useState([]); // [{ variant_id, name, options: [{id, value}] }]\r\n    const [skus, setSkus] = useState([]); // [{ id, code, price, stock, options: [], description }]\r\n    const [isArchived, setIsArchived] = useState(false);\r\n\r\n    // Edit State\r\n    const [formData, setFormData] = useState({ name: '', description: '', base_image_url: '', supplier_id: '' });\r\n\r\n    // Option State\r\n    const [newCatName, setNewCatName] = useState('');\r\n    const [newOptValue, setNewOptValue] = useState('');\r\n    const [selectedVariantId, setSelectedVariantId] = useState(null);\r\n\r\n    // Template State\r\n    const [isTemplateModalOpen, setIsTemplateModalOpen] = useState(false);\r\n    const [templates, setTemplates] = useState([]);\r\n    const [selectedTemplate, setSelectedTemplate] = useState(null);\r\n\r\n    // Bulk Update State\r\n    const [bulkCost, setBulkCost] = useState('');\r\n    const [bulkPrice, setBulkPrice] = useState('');\r\n\r\n    // Rename State\r\n    const [renameState, setRenameState] = useState({ open: false, variantId: null, name: '', existingId: null });\r\n\r\n    // Supplier State\r\n    const [suppliers, setSuppliers] = useState([]);\r\n    const [isSupplierModalOpen, setIsSupplierModalOpen] = useState(false);\r\n    const [newSupplierName, setNewSupplierName] = useState('');\r\n\r\n    // Initial Fetch\r\n    useEffect(() => {\r\n        fetchDetails();\r\n        fetchSuppliers();\r\n    }, [id]);\r\n\r\n    const fetchSuppliers = async () => {\r\n        try {\r\n            const res = await fetch('/api/suppliers', {\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (res.ok) setSuppliers(await res.json());\r\n        } catch (e) { console.error(e); }\r\n    };\r\n\r\n    const fetchDetails = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch(`/api/products/${id}`);\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setProduct(data.product);\r\n                setIsArchived(!data.product.is_active);\r\n                setVariants(data.variants);\r\n                setSkus(data.skus);\r\n                setFormData({\r\n                    name: data.product.name,\r\n                    description: data.product.description || '',\r\n                    base_image_url: data.product.base_image_url || '',\r\n                    supplier_id: data.product.supplier_id || ''\r\n                });\r\n            } else {\r\n                notify('Failed to load product', 'error');\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            notify('Error loading product', 'error');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // --- Tab 1: Info Handlers ---\r\n    const handleInfoSave = async () => {\r\n        try {\r\n            const res = await fetch(`/api/products/${id}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token },\r\n                body: JSON.stringify(formData)\r\n            });\r\n            if (res.ok) notify('Saved Details successfully!', 'success');\r\n        } catch (e) { notify('Error saving details', 'error'); }\r\n    };\r\n\r\n    const handleCreateSupplier = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            const res = await fetch('/api/suppliers', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token },\r\n                body: JSON.stringify({ name: newSupplierName })\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                notify('Supplier created', 'success');\r\n                setIsSupplierModalOpen(false);\r\n                setNewSupplierName('');\r\n                await fetchSuppliers(); // Refresh list\r\n                setFormData(prev => ({ ...prev, supplier_id: data.id })); // Select new supplier\r\n            } else {\r\n                notify('Failed to create supplier', 'error');\r\n            }\r\n        } catch (e) { notify('Error creating supplier', 'error'); }\r\n    };\r\n\r\n    // --- Tab 2: Options Handlers ---\r\n    const handleAddOption = async (categoryName, value) => {\r\n        // If categoryName is passed, we are creating a new variant category or adding to existing\r\n        try {\r\n            const res = await fetch(`/api/products/${id}/options`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token },\r\n                body: JSON.stringify({ categoryName, value })\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n\r\n                // Update Local State without Refetch\r\n                // 1. Check if variant category exists in state\r\n                setVariants(prev => {\r\n                    const existingVarIndex = prev.findIndex(v => v.name === categoryName);\r\n                    if (existingVarIndex >= 0) {\r\n                        // Add option to existing category\r\n                        const updated = [...prev];\r\n                        const existingVar = updated[existingVarIndex];\r\n                        // Avoid duplicates in UI if backend returned existing ID\r\n                        if (!existingVar.options.find(o => o.id === data.option.id)) {\r\n                            updated[existingVarIndex] = {\r\n                                ...existingVar,\r\n                                options: [...existingVar.options, { id: data.option.id, value: data.option.value }]\r\n                            };\r\n                        }\r\n                        return updated;\r\n                    } else {\r\n                        // Create new category\r\n                        return [...prev, {\r\n                            variant_id: data.option.variant_id,\r\n                            name: categoryName,\r\n                            options: data.option.value ? [{ id: data.option.id, value: data.option.value }] : []\r\n                        }];\r\n                    }\r\n                });\r\n\r\n                setNewCatName('');\r\n                setNewOptValue('');\r\n                notify('Option added', 'success');\r\n            }\r\n        } catch (e) { notify('Error adding option', 'error'); }\r\n    };\r\n\r\n    const handleDeleteOption = async (optionId) => {\r\n        confirm('Deleting this option will delete ALL SKUs that use it. This cannot be undone. Are you sure?', async () => {\r\n            try {\r\n                const res = await fetch(`/api/options/${optionId}`, {\r\n                    method: 'DELETE',\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n                if (res.ok) {\r\n                    const data = await res.json();\r\n                    notify(data.message || 'Option deleted', 'success');\r\n\r\n                    // Local Update\r\n                    setVariants(prev => prev.map(v => ({\r\n                        ...v,\r\n                        options: v.options.filter(o => o.id !== optionId)\r\n                    })));\r\n\r\n                    if (data.deletedSkuIds && data.deletedSkuIds.length > 0) {\r\n                        setSkus(prev => prev.filter(s => !data.deletedSkuIds.includes(s.id)));\r\n                    }\r\n                } else {\r\n                    notify('Failed to delete option', 'error');\r\n                }\r\n            } catch (e) { notify('Error deleting option', 'error'); }\r\n        });\r\n    };\r\n\r\n    const handleDeleteVariant = async (variantId) => {\r\n        confirm('Are you sure you want to remove this category from the product? You must delete all options first.', async () => {\r\n            try {\r\n                const res = await fetch(`/api/variants/${variantId}`, {\r\n                    method: 'DELETE',\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n\r\n                if (res.ok) {\r\n                    const data = await res.json();\r\n                    notify(data.message || 'Category removed', 'success');\r\n                    // Local Update\r\n                    setVariants(prev => prev.filter(v => v.variant_id !== variantId));\r\n                } else if (res.status === 409) {\r\n                    const data = await res.json();\r\n                    notify(data.error, 'error');\r\n                } else {\r\n                    notify('Failed to delete category', 'error');\r\n                }\r\n            } catch (e) { notify('Error deleting category', 'error'); }\r\n        });\r\n    };\r\n\r\n    const handleRenameClick = (variant) => {\r\n        setRenameState({ open: true, variantId: variant.category_id, name: variant.name, existingId: null });\r\n    };\r\n\r\n    const submitRename = async (shouldMerge = false) => {\r\n        const { variantId, name, existingId } = renameState;\r\n        console.log('submitRename', { variantId, name, shouldMerge });\r\n        try {\r\n            const res = await fetch(`/api/variant-categories/${variantId}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token },\r\n                body: JSON.stringify({ name, merge: shouldMerge })\r\n            });\r\n\r\n            const data = await res.json();\r\n\r\n            if (res.status === 409) {\r\n                // Conflict - Merge required\r\n                setRenameState(prev => ({ ...prev, existingId: data.target_id })); // Trigger merge UI in modal\r\n            } else if (res.ok) {\r\n                notify(data.message, 'success');\r\n                setRenameState({ open: false, variantId: null, name: '', existingId: null });\r\n                // Optimistic Update\r\n                if (shouldMerge) {\r\n                    // Start fresh as IDs changed\r\n                    fetchDetails();\r\n                } else {\r\n                    // Here 'variantId' is category_id. But variants state uses variant_id.\r\n                    // We need to loop and find the one with matching category_id\r\n                    setVariants(prev => prev.map(v => v.category_id === variantId ? { ...v, name } : v));\r\n                }\r\n            } else {\r\n                notify(data.error || 'Update failed', 'error');\r\n            }\r\n        } catch (e) { notify('Error updating category', 'error'); }\r\n    };\r\n\r\n    const handleGenerateSKUs = async () => {\r\n        confirm('This will generate all missing SKUs based on current options. Continue?', async () => {\r\n            try {\r\n                const res = await fetch(`/api/products/${id}/generate-skus`, {\r\n                    method: 'POST',\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n                if (res.ok) {\r\n                    const data = await res.json();\r\n                    notify(data.message, 'success');\r\n                    fetchDetails();\r\n                } else {\r\n                    notify('Failed to generate SKUs', 'error');\r\n                }\r\n            } catch (e) { notify('Error generating SKUs', 'error'); }\r\n        });\r\n    };\r\n\r\n    // --- Image Upload Handlers ---\r\n    const handleProductImageUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n        const uploadData = new FormData();\r\n        uploadData.append('file', file);\r\n\r\n        try {\r\n            const res = await fetch('/api/upload', {\r\n                method: 'POST',\r\n                body: uploadData,\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setFormData({ ...formData, base_image_url: data.url });\r\n                notify('Image uploaded', 'success');\r\n            } else { notify('Upload failed', 'error'); }\r\n        } catch (e) { notify('Upload error', 'error'); }\r\n    };\r\n\r\n    const handleSkuImageUpload = async (skuId, e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n        const uploadData = new FormData();\r\n        uploadData.append('file', file);\r\n\r\n        try {\r\n            const res = await fetch('/api/upload', {\r\n                method: 'POST',\r\n                body: uploadData,\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                handleSkuUpdate(skuId, 'image_url', data.url);\r\n                notify('SKU Image uploaded', 'success');\r\n            } else { notify('Upload failed', 'error'); }\r\n        } catch (e) { notify('Upload error', 'error'); }\r\n    };\r\n\r\n    const handleDeleteSku = async (skuId) => {\r\n        confirm('Are you sure you want to delete this SKU?', async () => {\r\n            try {\r\n                const res = await fetch(`/api/skus/${skuId}`, {\r\n                    method: 'DELETE',\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n                if (res.ok) {\r\n                    setSkus(prev => prev.filter(s => s.id !== skuId));\r\n                    notify('SKU deleted', 'success');\r\n                } else {\r\n                    let data;\r\n                    try {\r\n                        data = await res.json();\r\n                    } catch (err) {\r\n                        data = { error: 'Unknown server error' };\r\n                    }\r\n                    notify(data.error || 'Failed to delete SKU', 'error');\r\n                }\r\n            } catch (e) { notify('Error deleting SKU', 'error'); }\r\n        });\r\n    };\r\n\r\n    // --- Delete / Archive Handlers ---\r\n    const handleDeleteProduct = async (force = false) => {\r\n        const proceedWithDelete = async () => {\r\n            try {\r\n                const res = await fetch(`/api/products/${id}${force ? '?force=true' : ''}`, {\r\n                    method: 'DELETE',\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n\r\n                if (res.ok) {\r\n                    notify('Product deleted successfully', 'success');\r\n                    window.location.href = '/admin/merchandise';\r\n                    return;\r\n                }\r\n\r\n                let data;\r\n                try {\r\n                    data = await res.json();\r\n                } catch (err) {\r\n                    console.error('Failed to parse error response:', err);\r\n                    notify('An unexpected error occurred (Invalid JSON response)', 'error');\r\n                    return;\r\n                }\r\n\r\n                if (res.status === 409) {\r\n                    if (data.code === 'HAS_ORDERS') {\r\n                        confirm(`${data.error} \\n\\nWould you like to archive this product instead?`, () => handleToggleArchive(true));\r\n                    } else if (data.code === 'HAS_SKUS') {\r\n                        confirm(`${data.error} \\n\\nAre you sure you want to proceed? This will delete all SKUs and cannot be undone.`, () => handleDeleteProduct(true));\r\n                    } else {\r\n                        notify(data.error, 'error');\r\n                    }\r\n                } else {\r\n                    notify(data.error || 'Failed to delete product', 'error');\r\n                }\r\n\r\n            } catch (e) {\r\n                console.error(e);\r\n                notify('Error deleting product', 'error');\r\n            }\r\n        };\r\n\r\n        if (!force) {\r\n            confirm(\"Are you sure you want to delete this product? This action cannot be undone.\", proceedWithDelete);\r\n        } else {\r\n            proceedWithDelete();\r\n        }\r\n    };\r\n\r\n    const handleToggleArchive = async (archive) => {\r\n        try {\r\n            const res = await fetch(`/api/products/${id}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token },\r\n                body: JSON.stringify({ is_active: !archive }) // if archive=true, is_active=false\r\n            });\r\n            if (res.ok) {\r\n                setIsArchived(archive);\r\n                notify(archive ? 'Product Archived' : 'Product Unarchived', 'success');\r\n                setProduct({ ...product, is_active: !archive });\r\n            } else {\r\n                notify('Failed to update status', 'error');\r\n            }\r\n        } catch (e) { notify('Error updating status', 'error'); }\r\n    };\r\n\r\n\r\n    // --- Tab 3: SKU Handlers ---\r\n    const handleSkuUpdate = async (skuId, field, value) => {\r\n        // Optimistic update\r\n        setSkus(prev => prev.map(s => s.id === skuId ? { ...s, [field]: value } : s));\r\n\r\n        // Map state keys to API keys\r\n        let apiField = field;\r\n        if (field === 'stock') apiField = 'current_stock';\r\n        if (field === 'active') apiField = 'is_active';\r\n\r\n        try {\r\n            await fetch(`/api/skus/${skuId}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token },\r\n                body: JSON.stringify({ [apiField]: value })\r\n            });\r\n        } catch (e) { console.error('Failed to save SKU change', e); }\r\n    };\r\n\r\n    const handleBulkApply = (field, value) => {\r\n        confirm(`Apply this ${field === 'price' ? 'Sell Price' : 'Cost Price'} to ALL SKUs?`, async () => {\r\n            // Optimistic\r\n            setSkus(prev => prev.map(s => ({ ...s, [field]: value })));\r\n\r\n            // Bulk API Calls (Parallel)\r\n            const updates = skus.map(s => handleSkuUpdate(s.id, field, value));\r\n            await Promise.all(updates);\r\n            notify('Applied to all SKUs', 'success');\r\n        });\r\n    };\r\n\r\n    const fetchTemplates = async () => {\r\n        try {\r\n            const res = await fetch('/api/manage/variant-templates', {\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                }\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setTemplates(data);\r\n            }\r\n        } catch (e) { console.error(e); }\r\n    };\r\n\r\n    const handleApplyTemplate = async () => {\r\n        if (!selectedTemplate) return;\r\n\r\n        try {\r\n            // Get full template details with options\r\n            const res = await fetch(`/api/manage/variant-templates/${selectedTemplate.template_id}`, {\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                }\r\n            });\r\n            if (!res.ok) throw new Error('Failed to load template details');\r\n            const data = await res.json();\r\n\r\n            notify('Applying template options...', 'info');\r\n            setIsTemplateModalOpen(false);\r\n\r\n            // Sequentially add options to avoid race conditions or overwhelming server\r\n            for (const option of data.options) {\r\n                await handleAddOption(option.category_name, option.option_name);\r\n            }\r\n            notify('Template applied successfully!', 'success');\r\n        } catch (e) {\r\n            notify('Error applying template: ' + e.message, 'error');\r\n        }\r\n    };\r\n\r\n    if (loading) return <div>Loading...</div>;\r\n\r\n    return (\r\n        <div style={{ padding: '20px', maxWidth: '1200px', margin: '0 auto' }}>\r\n            {/* Quick Add Supplier Modal */}\r\n            {isSupplierModalOpen && (\r\n                <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 1200 }}>\r\n                    <form onSubmit={handleCreateSupplier} style={{ background: 'white', padding: '20px', borderRadius: '8px', width: '300px' }}>\r\n                        <h3 style={{ marginTop: 0 }}>Add Supplier</h3>\r\n                        <input\r\n                            autoFocus\r\n                            placeholder=\"Supplier Name\"\r\n                            value={newSupplierName}\r\n                            onChange={e => setNewSupplierName(e.target.value)}\r\n                            style={{ width: '100%', padding: '8px', marginBottom: '10px', border: '1px solid #ddd', borderRadius: '4px' }}\r\n                            required\r\n                        />\r\n                        <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px' }}>\r\n                            <button type=\"button\" onClick={() => setIsSupplierModalOpen(false)} style={{ padding: '6px 12px', background: 'transparent', border: '1px solid #ddd', borderRadius: '4px', cursor: 'pointer' }}>Cancel</button>\r\n                            <button type=\"submit\" style={{ padding: '6px 12px', background: 'black', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer' }}>Add</button>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n            )}\r\n            <Link to=\"/admin/merchandise\">‚Üê Back to List</Link>\r\n            <h1 style={{ marginTop: '10px' }}>Editing: {product.name}</h1>\r\n\r\n            {/* Tabs */}\r\n            <div style={{ display: 'flex', borderBottom: '1px solid #ddd', marginBottom: '20px' }}>\r\n                {['info', 'options', 'skus'].map(tab => (\r\n                    <button\r\n                        key={tab}\r\n                        onClick={() => setActiveTab(tab)}\r\n                        style={{\r\n                            padding: '10px 20px',\r\n                            background: activeTab === tab ? '#eee' : 'transparent',\r\n                            border: 'none', borderBottom: activeTab === tab ? '2px solid black' : 'none',\r\n                            cursor: 'pointer', fontWeight: 'bold', textTransform: 'capitalize'\r\n                        }}\r\n                    >\r\n                        {tab}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* TAB: INFO */}\r\n            {activeTab === 'info' && (\r\n                <div style={{ maxWidth: '600px' }}>\r\n                    <div style={{ marginBottom: '15px' }}>\r\n                        <label style={{ display: 'block', fontWeight: 'bold' }}>Name</label>\r\n                        <input\r\n                            style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px' }}\r\n                            value={formData.name}\r\n                            onChange={e => setFormData({ ...formData, name: e.target.value })}\r\n                        />\r\n                    </div>\r\n                    <div style={{ marginBottom: '15px' }}>\r\n                        <label style={{ display: 'block', fontWeight: 'bold' }}>Description</label>\r\n                        <textarea\r\n                            style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px', height: '100px' }}\r\n                            value={formData.description}\r\n                            onChange={e => setFormData({ ...formData, description: e.target.value })}\r\n                        />\r\n                    </div>\r\n                    <div style={{ marginBottom: '15px' }}>\r\n                        <label style={{ display: 'block', fontWeight: 'bold' }}>Supplier</label>\r\n                        <div style={{ display: 'flex', gap: '10px' }}>\r\n                            <select\r\n                                style={{ flex: 1, padding: '8px', border: '1px solid #ddd', borderRadius: '4px' }}\r\n                                value={formData.supplier_id}\r\n                                onChange={e => setFormData({ ...formData, supplier_id: e.target.value })}\r\n                            >\r\n                                <option value=\"\">-- Select Supplier --</option>\r\n                                {suppliers.map(s => (\r\n                                    <option key={s.supplier_id} value={s.supplier_id}>{s.name}</option>\r\n                                ))}\r\n                            </select>\r\n                            <button\r\n                                onClick={() => setIsSupplierModalOpen(true)}\r\n                                style={{ padding: '8px 12px', background: '#eee', border: 'none', borderRadius: '4px', cursor: 'pointer', fontWeight: 'bold' }}\r\n                                title=\"Add New Supplier\"\r\n                            >\r\n                                +\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                    <div style={{ marginBottom: '15px' }}>\r\n                        <label style={{ display: 'block', fontWeight: 'bold' }}>Base Image</label>\r\n                        <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>\r\n                            {formData.base_image_url ? (\r\n                                <img src={formData.base_image_url} alt=\"Preview\" style={{ width: '100px', height: '100px', objectFit: 'cover', borderRadius: '4px' }} />\r\n                            ) : (\r\n                                <div style={{ width: '100px', height: '100px', background: '#eee', borderRadius: '4px', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#666' }}>No Img</div>\r\n                            )}\r\n                            <input\r\n                                type=\"file\"\r\n                                onChange={handleProductImageUpload}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <button onClick={handleInfoSave} style={{ background: 'black', color: 'white', padding: '10px 20px', border: 'none', borderRadius: '4px', cursor: 'pointer' }}>\r\n                        Save Details\r\n                    </button>\r\n                    <div style={{ marginTop: '30px', paddingTop: '20px', borderTop: '1px solid #ddd' }}>\r\n                        <h3>Actions</h3>\r\n                        <div style={{ display: 'flex', gap: '10px' }}>\r\n                            {isArchived ? (\r\n                                <button\r\n                                    onClick={() => handleToggleArchive(false)}\r\n                                    style={{ background: '#4CAF50', color: 'white', padding: '10px 20px', border: 'none', borderRadius: '4px', cursor: 'pointer' }}\r\n                                >\r\n                                    Unarchive Product\r\n                                </button>\r\n                            ) : (\r\n                                <button\r\n                                    onClick={() => handleToggleArchive(true)}\r\n                                    style={{ background: '#FF9800', color: 'white', padding: '10px 20px', border: 'none', borderRadius: '4px', cursor: 'pointer' }}\r\n                                >\r\n                                    Archive Product\r\n                                </button>\r\n                            )}\r\n\r\n                            <button\r\n                                onClick={() => handleDeleteProduct(false)}\r\n                                style={{ background: '#F44336', color: 'white', padding: '10px 20px', border: 'none', borderRadius: '4px', cursor: 'pointer' }}\r\n                            >\r\n                                Delete Product\r\n                            </button>\r\n                        </div>\r\n                        <p style={{ color: '#666', fontSize: '0.9rem', marginTop: '10px' }}>\r\n                            <strong>Note:</strong> Archiving hides the product from the store but keeps historical data. Deleting permanently removes it.\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* TAB: OPTIONS */}\r\n            {activeTab === 'options' && (\r\n                <div>\r\n                    <div style={{ display: 'flex', gap: '20px', alignItems: 'flex-start', flexWrap: 'wrap' }}>\r\n                        {/* Existing Options */}\r\n                        {variants.map(v => (\r\n                            <div key={v.variant_id} style={{ border: '1px solid #ddd', borderRadius: '8px', padding: '15px', minWidth: '250px', background: '#fff' }}>\r\n                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '10px' }}>\r\n                                    <h3\r\n                                        style={{ margin: 0, cursor: 'pointer', borderBottom: '1px dashed #ccc' }}\r\n                                        onClick={() => handleRenameClick(v)}\r\n                                        title=\"Click to Rename\"\r\n                                    >\r\n                                        {v.name}\r\n                                    </h3>\r\n                                    <button\r\n                                        onClick={() => handleDeleteVariant(v.variant_id)}\r\n                                        style={{ color: '#999', background: 'none', border: 'none', cursor: 'pointer', fontSize: '1.2rem', padding: '0 5px' }}\r\n                                        title=\"Remove Category\"\r\n                                    >√ó</button>\r\n                                </div>\r\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '5px', marginBottom: '10px' }}>\r\n                                    {v.options.map(opt => (\r\n                                        <span key={opt.id} style={{ background: '#eee', padding: '4px 8px', borderRadius: '12px', fontSize: '0.9rem', display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                            {opt.value}\r\n                                            <button\r\n                                                onClick={() => handleDeleteOption(opt.id)}\r\n                                                style={{ border: 'none', background: 'none', color: '#999', cursor: 'pointer', padding: 0, fontSize: '1rem', lineHeight: 1 }}\r\n                                                title=\"Delete Option\"\r\n                                            >√ó</button>\r\n                                        </span>\r\n                                    ))}\r\n                                </div>\r\n                                <div style={{ display: 'flex', gap: '5px' }}>\r\n                                    <input\r\n                                        placeholder={`New ${v.name}...`}\r\n                                        style={{ flex: 1, padding: '5px', border: '1px solid #ddd', borderRadius: '4px' }}\r\n                                        id={`new-opt-${v.variant_id}`}\r\n                                    />\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            const val = document.getElementById(`new-opt-${v.variant_id}`).value;\r\n                                            if (val) handleAddOption(v.name, val);\r\n                                        }}\r\n                                        style={{ background: '#aaa', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer' }}>+</button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n\r\n                        {/* Add New Category */}\r\n                        <div style={{ border: '1px dashed #ccc', borderRadius: '8px', padding: '15px', minWidth: '250px' }}>\r\n                            <h3 style={{ marginTop: 0, color: '#666' }}>Add Variant Type</h3>\r\n                            <input\r\n                                placeholder=\"e.g. Size, Color\"\r\n                                value={newCatName}\r\n                                onChange={e => setNewCatName(e.target.value)}\r\n                                style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px', marginBottom: '10px' }}\r\n                            />\r\n                            <button\r\n                                onClick={() => { if (newCatName) handleAddOption(newCatName, null); }}\r\n                                disabled={!newCatName}\r\n                                style={{ width: '100%', background: 'black', color: 'white', padding: '8px', border: 'none', borderRadius: '4px', cursor: 'pointer', opacity: newCatName ? 1 : 0.5 }}>\r\n                                Create Category\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* Apply Template Button */}\r\n                        <div style={{ border: '1px dashed #ccc', borderRadius: '8px', padding: '15px', minWidth: '250px', display: 'flex', flexDirection: 'column', justifyContent: 'center', alignItems: 'center' }}>\r\n                            <h3 style={{ marginTop: 0, color: '#666', marginBottom: '15px' }}>Use Template</h3>\r\n                            <button\r\n                                onClick={() => { fetchTemplates(); setIsTemplateModalOpen(true); }}\r\n                                style={{ background: '#2196F3', color: 'white', padding: '10px 20px', border: 'none', borderRadius: '4px', cursor: 'pointer', fontWeight: 'bold' }}\r\n                            >\r\n                                Apply Template\r\n                            </button>\r\n                            <p style={{ fontSize: '0.8rem', color: '#888', textAlign: 'center', marginTop: '10px' }}>\r\n                                Pre-fill options from saved templates (e.g. Sizes)\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Template Modal */}\r\n                    {isTemplateModalOpen && (\r\n                        <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 1000 }}>\r\n                            <div style={{ background: 'white', padding: '20px', borderRadius: '8px', width: '90%', maxWidth: '500px', maxHeight: '80vh', overflowY: 'auto' }}>\r\n                                <h2 style={{ marginTop: 0 }}>Select Template</h2>\r\n                                {loading && <p>Loading templates...</p>}\r\n                                <div style={{ maxHeight: '300px', overflowY: 'auto', border: '1px solid #eee', marginBottom: '15px' }}>\r\n                                    {templates.map(t => (\r\n                                        <div\r\n                                            key={t.template_id}\r\n                                            onClick={() => setSelectedTemplate(t)}\r\n                                            style={{\r\n                                                padding: '10px',\r\n                                                borderBottom: '1px solid #eee',\r\n                                                cursor: 'pointer',\r\n                                                background: selectedTemplate?.template_id === t.template_id ? '#e3f2fd' : 'white'\r\n                                            }}\r\n                                        >\r\n                                            <div style={{ fontWeight: 'bold' }}>{t.name}</div>\r\n                                            <div style={{ fontSize: '0.8rem', color: '#666' }}>{t.option_count} options</div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                                <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px' }}>\r\n                                    <button onClick={() => setIsTemplateModalOpen(false)} style={{ padding: '8px 16px', background: '#eee', border: 'none', borderRadius: '4px', cursor: 'pointer' }}>Cancel</button>\r\n                                    <button\r\n                                        onClick={handleApplyTemplate}\r\n                                        disabled={!selectedTemplate}\r\n                                        style={{ padding: '8px 16px', background: 'blue', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', opacity: selectedTemplate ? 1 : 0.5 }}\r\n                                    >\r\n                                        Apply\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div style={{ marginTop: '30px', borderTop: '1px solid #eee', paddingTop: '20px' }}>\r\n                        <p style={{ color: '#666' }}>Once you have configured all options (e.g. Sizes: S, M, L and Colors: Red, Blue), click the button below to generate inventory items (SKUs) for selling.</p>\r\n                        <button\r\n                            onClick={handleGenerateSKUs}\r\n                            style={{ background: 'blue', color: 'white', padding: '12px 24px', border: 'none', borderRadius: '4px', cursor: 'pointer', fontWeight: 'bold' }}\r\n                        >\r\n                            Regenerate SKUs\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Rename Modal */}\r\n                    {renameState.open && (\r\n                        <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 1100 }}>\r\n                            <div style={{ background: 'white', padding: '20px', borderRadius: '8px', width: '400px' }}>\r\n                                <h3 style={{ marginTop: 0 }}>Rename Category</h3>\r\n                                {renameState.existingId ? (\r\n                                    <div style={{ marginBottom: '20px', color: '#B71C1C', background: '#FFEBEE', padding: '10px', borderRadius: '4px' }}>\r\n                                        <strong>Conflict Detected:</strong> A category named \"{renameState.name}\" already exists.\r\n                                        <br /><br />\r\n                                        Do you want to <strong>Merge</strong> this category into the existing one?\r\n                                    </div>\r\n                                ) : (\r\n                                    <div style={{ marginBottom: '15px' }}>\r\n                                        <input\r\n                                            value={renameState.name}\r\n                                            onChange={e => setRenameState(prev => ({ ...prev, name: e.target.value }))}\r\n                                            style={{ width: '100%', padding: '10px', fontSize: '1rem', border: '1px solid #ddd', borderRadius: '4px' }}\r\n                                        />\r\n                                    </div>\r\n                                )}\r\n\r\n                                <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px' }}>\r\n                                    <button\r\n                                        onClick={() => setRenameState({ open: false, variantId: null, name: '', existingId: null })}\r\n                                        style={{ padding: '8px 16px', background: '#eee', border: 'none', borderRadius: '4px', cursor: 'pointer' }}\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    {renameState.existingId ? (\r\n                                        <button\r\n                                            onClick={() => submitRename(true)}\r\n                                            style={{ padding: '8px 16px', background: '#D32F2F', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer' }}\r\n                                        >\r\n                                            Confirm Merge\r\n                                        </button>\r\n                                    ) : (\r\n                                        <button\r\n                                            onClick={() => submitRename(false)}\r\n                                            style={{ padding: '8px 16px', background: 'blue', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer' }}\r\n                                        >\r\n                                            Save\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* TAB: SKUS */}\r\n            {activeTab === 'skus' && (\r\n                <div>\r\n                    <table style={{ width: '100%', borderCollapse: 'collapse', borderRadius: '8px', overflow: 'hidden', boxShadow: '0 2px 8px rgba(0,0,0,0.1)' }}>\r\n                        <thead style={{ background: '#f5f5f5' }}>\r\n                            <tr>\r\n                                <th style={{ padding: '10px', textAlign: 'left', width: '60px' }}>Active</th>\r\n                                <th style={{ padding: '10px', textAlign: 'left' }}>SKU Info</th>\r\n                                <th style={{ padding: '10px', textAlign: 'left' }}>Image URL</th>\r\n                                <th style={{ padding: '10px', textAlign: 'left', width: '150px' }}>\r\n                                    Cost ($)\r\n                                    <div style={{ display: 'flex', gap: '5px', marginTop: '5px' }}>\r\n                                        <input\r\n                                            placeholder=\"Bulk\"\r\n                                            value={bulkCost}\r\n                                            onChange={e => setBulkCost(e.target.value)}\r\n                                            style={{ width: '60px', padding: '4px', fontSize: '0.8rem', border: '1px solid #ccc', borderRadius: '4px' }}\r\n                                        />\r\n                                        <button\r\n                                            onClick={() => handleBulkApply('cost_price', bulkCost)}\r\n                                            style={{ fontSize: '0.7rem', padding: '4px', background: '#ddd', border: 'none', borderRadius: '4px', cursor: 'pointer' }}\r\n                                        >\r\n                                            Apply\r\n                                        </button>\r\n                                    </div>\r\n                                </th>\r\n                                <th style={{ padding: '10px', textAlign: 'left', width: '150px' }}>\r\n                                    Price ($)\r\n                                    <div style={{ display: 'flex', gap: '5px', marginTop: '5px' }}>\r\n                                        <input\r\n                                            placeholder=\"Bulk\"\r\n                                            value={bulkPrice}\r\n                                            onChange={e => setBulkPrice(e.target.value)}\r\n                                            style={{ width: '60px', padding: '4px', fontSize: '0.8rem', border: '1px solid #ccc', borderRadius: '4px' }}\r\n                                        />\r\n                                        <button\r\n                                            onClick={() => handleBulkApply('price', bulkPrice)}\r\n                                            style={{ fontSize: '0.7rem', padding: '4px', background: '#ddd', border: 'none', borderRadius: '4px', cursor: 'pointer' }}\r\n                                        >\r\n                                            Apply\r\n                                        </button>\r\n                                    </div>\r\n                                </th>\r\n                                <th style={{ padding: '10px', textAlign: 'left', width: '100px' }}>Stock</th>\r\n\r\n                                <th style={{ padding: '10px', width: '60px' }}></th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {skus.map((sku) => (\r\n                                <tr key={sku.id} style={{ borderBottom: '1px solid #eee' }}>\r\n                                    <td style={{ padding: '10px', textAlign: 'center' }}>\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            checked={sku.active}\r\n                                            onChange={e => handleSkuUpdate(sku.id, 'active', e.target.checked)}\r\n                                        />\r\n                                    </td>\r\n                                    <td style={{ padding: '10px' }}>\r\n                                        <div style={{ fontWeight: 'bold' }}>{sku.description || 'Base Item'}</div>\r\n                                        <div style={{ fontSize: '0.8rem', color: '#666' }}>{sku.code}</div>\r\n                                    </td>\r\n                                    <td style={{ padding: '10px' }}>\r\n                                        <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>\r\n                                            {sku.image_url ? <img src={sku.image_url} alt=\"product\" style={{ width: '40px', height: '40px', borderRadius: '4px', objectFit: 'cover' }} /> :\r\n                                                <div style={{ width: '40px', height: '40px', background: '#eee', borderRadius: '4px' }}></div>}\r\n                                            <label style={{ cursor: 'pointer', background: '#eee', padding: '4px 8px', borderRadius: '4px', fontSize: '0.8rem' }}>\r\n                                                Upload\r\n                                                <input type=\"file\" style={{ display: 'none' }} onChange={(e) => handleSkuImageUpload(sku.id, e)} />\r\n                                            </label>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td style={{ padding: '10px' }}>\r\n                                        <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                value={sku.cost_price ?? ''}\r\n                                                onChange={e => handleSkuUpdate(sku.id, 'cost_price', e.target.value)}\r\n                                                style={{ width: '70px', padding: '5px', border: '1px solid #ddd', borderRadius: '4px' }}\r\n                                            />\r\n                                        </div>\r\n                                    </td>\r\n                                    <td style={{ padding: '10px' }}>\r\n                                        <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                value={sku.price ?? ''}\r\n                                                onChange={e => handleSkuUpdate(sku.id, 'price', e.target.value)}\r\n                                                style={{ width: '70px', padding: '5px', border: '1px solid #ddd', borderRadius: '4px' }}\r\n                                            />\r\n                                        </div>\r\n                                    </td>\r\n                                    <td style={{ padding: '10px' }}>\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            value={sku.stock}\r\n                                            onChange={e => handleSkuUpdate(sku.id, 'stock', e.target.value)}\r\n                                            style={{ width: '80px', padding: '5px', border: '1px solid #ddd', borderRadius: '4px' }}\r\n                                        />\r\n                                    </td>\r\n\r\n                                    <td style={{ padding: '10px' }}>\r\n                                        <button\r\n                                            onClick={() => handleDeleteSku(sku.id)}\r\n                                            style={{ color: 'red', background: 'none', border: 'none', cursor: 'pointer', fontWeight: 'bold', fontSize: '1.2rem' }}\r\n                                            title=\"Delete SKU\"\r\n                                        >√ó</button>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                    {skus.length === 0 && <p style={{ textAlign: 'center', marginTop: '20px' }}>No SKUs generated yet. Go to \"Options\" tab to generate.</p>}\r\n                </div>\r\n            )}\r\n        </div >\r\n    );\r\n}\r\n\r\nexport default ProductEditor;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\PublicRegistrationsReport.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\SupplierList.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\VariantTemplates.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":7,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":17,"suggestions":[{"messageId":"removeVar","data":{"varName":"user"},"fix":{"range":[295,300],"text":""},"desc":"Remove unused variable 'user'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTemplates'. Either include it or remove the dependency array.","line":21,"column":8,"nodeType":"ArrayExpression","endLine":21,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTemplates]","fix":{"range":[887,889],"text":"[fetchTemplates]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { useNotification } from '../../context/NotificationContext';\r\nimport { Loader2, Trash2, X, Edit } from 'lucide-react';\r\n\r\nexport default function VariantTemplates() {\r\n    const { user, token } = useAuth();\r\n    const { notify } = useNotification();\r\n    const [templates, setTemplates] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n    const [newTemplate, setNewTemplate] = useState({ name: '', options: [] });\r\n    const [editingId, setEditingId] = useState(null);\r\n\r\n    // For new option input\r\n    const [newOptionCategory, setNewOptionCategory] = useState('');\r\n    const [newOptionValue, setNewOptionValue] = useState('');\r\n\r\n    useEffect(() => {\r\n        fetchTemplates();\r\n    }, []);\r\n\r\n    const fetchTemplates = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const res = await fetch('/api/manage/variant-templates', {\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                }\r\n            });\r\n            if (!res.ok) throw new Error('Failed to fetch templates');\r\n            const data = await res.json();\r\n            setTemplates(data);\r\n        } catch (error) {\r\n            notify('Error loading templates: ' + error.message, 'error');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (id) => {\r\n        if (!confirm('Are you sure you want to delete this template?')) return;\r\n\r\n        try {\r\n            const res = await fetch(`/api/manage/variant-templates/${id}`, {\r\n                method: 'DELETE',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                }\r\n            });\r\n            if (!res.ok) throw new Error('Failed to delete template');\r\n\r\n            notify('Template deleted successfully', 'success');\r\n            setTemplates(templates.filter(t => t.template_id !== id));\r\n            if (editingId === id) {\r\n                setEditingId(null);\r\n                setNewTemplate({ name: '', options: [] });\r\n                setIsModalOpen(false);\r\n            }\r\n        } catch (error) {\r\n            notify('Error deleting template: ' + error.message, 'error');\r\n        }\r\n    };\r\n\r\n    const handleEdit = async (template) => {\r\n        try {\r\n            setLoading(true);\r\n            const res = await fetch(`/api/manage/variant-templates/${template.template_id}`, {\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                }\r\n            });\r\n            if (!res.ok) throw new Error('Failed to load template details');\r\n            const data = await res.json();\r\n\r\n            setNewTemplate({\r\n                name: data.name,\r\n                options: data.options || []\r\n            });\r\n            setEditingId(template.template_id);\r\n            setIsModalOpen(true);\r\n        } catch (error) {\r\n            notify('Error loading template for edit: ' + error.message, 'error');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const openCreateModal = () => {\r\n        setEditingId(null);\r\n        setNewTemplate({ name: '', options: [] });\r\n        setIsModalOpen(true);\r\n    };\r\n\r\n    const handleAddOption = () => {\r\n        if (!newOptionCategory || !newOptionValue) {\r\n            notify('Category and Option Name are required', 'error');\r\n            return;\r\n        }\r\n        setNewTemplate({\r\n            ...newTemplate,\r\n            options: [...newTemplate.options, {\r\n                category_name: newOptionCategory,\r\n                option_name: newOptionValue\r\n            }]\r\n        });\r\n        setNewOptionValue('');\r\n        // Keep category for rapid entry\r\n    };\r\n\r\n    const handleRemoveOption = (index) => {\r\n        const updated = [...newTemplate.options];\r\n        updated.splice(index, 1);\r\n        setNewTemplate({ ...newTemplate, options: updated });\r\n    };\r\n\r\n    const handleCreateTemplate = async () => {\r\n        if (!newTemplate.name) {\r\n            notify('Template Name is required', 'error');\r\n            return;\r\n        }\r\n        if (newTemplate.options.length === 0) {\r\n            notify('Add at least one option', 'error');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const url = editingId\r\n                ? `/api/manage/variant-templates/${editingId}`\r\n                : '/api/manage/variant-templates';\r\n\r\n            const method = editingId ? 'PUT' : 'POST';\r\n\r\n            const res = await fetch(url, {\r\n                method: method,\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify(newTemplate),\r\n            });\r\n            if (!res.ok) throw new Error(`Failed to ${editingId ? 'update' : 'create'} template`);\r\n\r\n            notify(`Template ${editingId ? 'updated' : 'created'} successfully`, 'success');\r\n            setIsModalOpen(false);\r\n            setNewTemplate({ name: '', options: [] });\r\n            setNewOptionCategory('');\r\n            setNewOptionValue('');\r\n            setEditingId(null);\r\n            fetchTemplates();\r\n        } catch (error) {\r\n            notify(`Error ${editingId ? 'updating' : 'creating'} template: ` + error.message, 'error');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-6\">\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n                <h1 className=\"text-2xl font-bold\">Variant Templates</h1>\r\n                <button\r\n                    onClick={openCreateModal}\r\n                    className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 font-bold\"\r\n                >\r\n                    New Template\r\n                </button>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div className=\"flex justify-center p-8\"><Loader2 className=\"animate-spin\" /></div>\r\n            ) : (\r\n                <div className=\"bg-white rounded shadow overflow-hidden\">\r\n                    <table className=\"w-full text-left\">\r\n                        <thead className=\"bg-gray-50 border-b\">\r\n                            <tr>\r\n                                <th className=\"p-4\">Template Name</th>\r\n                                <th className=\"p-4\">Option Count</th>\r\n                                <th className=\"p-4 text-right\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {templates.length === 0 ? (\r\n                                <tr><td colSpan=\"3\" className=\"p-8 text-center text-gray-500\">No templates found. Create one to get started.</td></tr>\r\n                            ) : (\r\n                                templates.map(t => (\r\n                                    <tr key={t.template_id} className=\"border-b hover:bg-gray-50\">\r\n                                        <td className=\"p-4 font-medium\">{t.name}</td>\r\n                                        <td className=\"p-4\">{t.option_count}</td>\r\n                                        <td className=\"p-4 text-right\">\r\n                                            <button\r\n                                                onClick={() => handleEdit(t)}\r\n                                                className=\"text-blue-600 hover:text-blue-800 p-1 mr-2\"\r\n                                                title=\"Edit Template\"\r\n                                            >\r\n                                                <Edit size={18} />\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => handleDelete(t.template_id)}\r\n                                                className=\"text-red-600 hover:text-red-800 p-1\"\r\n                                                title=\"Delete Template\"\r\n                                            >\r\n                                                <Trash2 size={18} />\r\n                                            </button>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            )}\r\n\r\n            {/* CREATE MODAL */}\r\n            {isModalOpen && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\r\n                    <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n                        <div className=\"p-6 border-b flex justify-between items-center\">\r\n                            <h2 className=\"text-xl font-bold\">{editingId ? 'Edit Variant Template' : 'Create Variant Template'}</h2>\r\n                            <button onClick={() => setIsModalOpen(false)} className=\"text-gray-500 hover:text-gray-700\">\r\n                                <X size={24} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"p-6 space-y-6\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium mb-1\">Template Name</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={newTemplate.name}\r\n                                    onChange={e => setNewTemplate({ ...newTemplate, name: e.target.value })}\r\n                                    className=\"w-full border rounded p-2\"\r\n                                    placeholder=\"e.g. Mens T-Shirt Sizes\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium mb-2\">Options</label>\r\n\r\n                                {/* Add Option Inputs */}\r\n                                <div className=\"flex gap-2 mb-4 items-end bg-gray-50 p-3 rounded\">\r\n                                    <div className=\"flex-1\">\r\n                                        <label className=\"text-xs text-gray-500 mb-1 block\">Category</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={newOptionCategory}\r\n                                            onChange={e => setNewOptionCategory(e.target.value)}\r\n                                            className=\"w-full border rounded p-1\"\r\n                                            placeholder=\"Size\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"flex-1\">\r\n                                        <label className=\"text-xs text-gray-500 mb-1 block\">Value</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={newOptionValue}\r\n                                            onChange={e => setNewOptionValue(e.target.value)}\r\n                                            className=\"w-full border rounded p-1\"\r\n                                            placeholder=\"S, M, L...\"\r\n                                            onKeyDown={e => { if (e.key === 'Enter') handleAddOption(); }}\r\n                                        />\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={handleAddOption}\r\n                                        className=\"bg-green-600 text-white p-2 rounded hover:bg-green-700 h-[34px] font-bold\"\r\n                                    >\r\n                                        ADD\r\n                                    </button>\r\n                                </div>\r\n\r\n                                {/* Option List */}\r\n                                <div className=\"border rounded bg-white\">\r\n                                    {newTemplate.options.length === 0 ? (\r\n                                        <div className=\"p-4 text-center text-gray-400 italic\">No options added yet.</div>\r\n                                    ) : (\r\n                                        <table className=\"w-full text-sm\">\r\n                                            <thead className=\"bg-gray-50\">\r\n                                                <tr>\r\n                                                    <th className=\"p-2 text-left\">Category</th>\r\n                                                    <th className=\"p-2 text-left\">Option</th>\r\n                                                    <th className=\"p-2 w-10\"></th>\r\n                                                </tr>\r\n                                            </thead>\r\n                                            <tbody>\r\n                                                {newTemplate.options.map((opt, idx) => (\r\n                                                    <tr key={idx} className=\"border-t\">\r\n                                                        <td className=\"p-2\">{opt.category_name}</td>\r\n                                                        <td className=\"p-2\">{opt.option_name}</td>\r\n                                                        <td className=\"p-2 text-right\">\r\n                                                            <button onClick={() => handleRemoveOption(idx)} className=\"text-red-500 hover:text-red-700\">\r\n                                                                <X size={16} />\r\n                                                            </button>\r\n                                                        </td>\r\n                                                    </tr>\r\n                                                ))}\r\n                                            </tbody>\r\n                                        </table>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                        </div>\r\n\r\n                        <div className=\"p-6 border-t bg-gray-50 flex justify-end gap-3\">\r\n                            <button\r\n                                onClick={() => setIsModalOpen(false)}\r\n                                className=\"px-4 py-2 text-gray-600 hover:text-gray-800\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={handleCreateTemplate}\r\n                                className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 font-bold\"\r\n                            >\r\n                                {editingId ? 'Update Template' : 'Save Template'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\assets\\AssetCategoryManager.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCategories'. Either include it or remove the dependency array.","line":39,"column":8,"nodeType":"ArrayExpression","endLine":39,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [eventId, fetchCategories]","fix":{"range":[1137,1146],"text":"[eventId, fetchCategories]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":82,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":82,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":103,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":103,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":155,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":155,"endColumn":23}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../../context/AuthContext';\r\nimport { useNotification } from '../../../context/NotificationContext';\r\nimport {\r\n    DndContext,\r\n    closestCenter,\r\n    KeyboardSensor,\r\n    PointerSensor,\r\n    useSensor,\r\n    useSensors,\r\n} from '@dnd-kit/core';\r\nimport {\r\n    arrayMove,\r\n    SortableContext,\r\n    sortableKeyboardCoordinates,\r\n    verticalListSortingStrategy,\r\n    useSortable\r\n} from '@dnd-kit/sortable';\r\nimport { CSS } from '@dnd-kit/utilities';\r\n\r\nfunction AssetCategoryManager({ eventId, onClose, onUpdate }) {\r\n    const { token } = useAuth();\r\n    const { notify, confirm } = useNotification();\r\n    const [categories, setCategories] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [newCategoryName, setNewCategoryName] = useState('');\r\n\r\n    const sensors = useSensors(\r\n        useSensor(PointerSensor),\r\n        useSensor(KeyboardSensor, {\r\n            coordinateGetter: sortableKeyboardCoordinates,\r\n        })\r\n    );\r\n\r\n    useEffect(() => {\r\n        if (eventId) {\r\n            fetchCategories();\r\n        }\r\n    }, [eventId]);\r\n\r\n    const fetchCategories = async () => {\r\n        try {\r\n            const res = await fetch(`/api/assets/categories?eventId=${eventId}`);\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setCategories(data);\r\n            }\r\n        } catch (e) {\r\n            console.error('Failed to load categories', e);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleCreate = async (e) => {\r\n        e.preventDefault();\r\n        if (!newCategoryName.trim()) return;\r\n\r\n        try {\r\n            const res = await fetch('/api/assets/categories', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({\r\n                    event_id: eventId,\r\n                    name: newCategoryName,\r\n                    sort_order: categories.length + 1\r\n                })\r\n            });\r\n\r\n            if (res.ok) {\r\n                setNewCategoryName('');\r\n                fetchCategories();\r\n                notify('Category created', 'success');\r\n                if (onUpdate) onUpdate();\r\n            } else {\r\n                notify('Failed to create category', 'error');\r\n            }\r\n        } catch (e) {\r\n            notify('Error creating category', 'error');\r\n        }\r\n    };\r\n\r\n    const handleDelete = (id) => {\r\n        confirm('Are you sure? This will fail if the category contains assets.', async () => {\r\n            try {\r\n                const res = await fetch(`/api/assets/categories/${id}`, {\r\n                    method: 'DELETE',\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n\r\n                if (res.ok) {\r\n                    fetchCategories();\r\n                    notify('Category deleted', 'success');\r\n                    if (onUpdate) onUpdate();\r\n                } else {\r\n                    const err = await res.json();\r\n                    notify(err.error || 'Delete failed', 'error');\r\n                }\r\n            } catch (e) {\r\n                notify('Delete failed', 'error');\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleDragEnd = async (event) => {\r\n        const { active, over } = event;\r\n\r\n        if (active.id !== over.id) {\r\n\r\n            const oldIndex = categories.findIndex((i) => i.asset_category_id === active.id);\r\n            const newIndex = categories.findIndex((i) => i.asset_category_id === over.id);\r\n\r\n            if (oldIndex === -1 || newIndex === -1) return;\r\n\r\n            const newItems = arrayMove(categories, oldIndex, newIndex);\r\n\r\n            // Assign new sort order locally for UI stability if needed, \r\n            // but for categories we generally trust the array order.\r\n            // However, let's update the sort_order property too.\r\n            const updatedItems = newItems.map((item, index) => ({\r\n                ...item,\r\n                sort_order: index\r\n            }));\r\n\r\n            // Update State\r\n            setCategories(updatedItems);\r\n\r\n            // API Update\r\n            const updates = updatedItems.map((item, index) => ({\r\n                id: item.asset_category_id,\r\n                sort_order: index\r\n            }));\r\n\r\n            try {\r\n                const res = await fetch('/api/assets/categories/reorder', {\r\n                    method: 'PUT',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'Authorization': `Bearer ${token}`,\r\n                        'X-Auth-Token': token\r\n                    },\r\n                    body: JSON.stringify(updates)\r\n                });\r\n\r\n                if (res.ok) {\r\n                    notify('Order saved', 'success');\r\n                    if (onUpdate) onUpdate();\r\n                } else {\r\n                    notify('Failed to save order', 'error');\r\n                }\r\n            } catch (e) {\r\n                notify('Failed to save order', 'error');\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n            <div className=\"bg-white p-6 rounded shadow-lg w-full max-w-lg max-h-[90vh] flex flex-col\">\r\n                <div className=\"flex justify-between items-center mb-4\">\r\n                    <h3 className=\"text-xl font-bold\">Manage Categories</h3>\r\n                    <button onClick={onClose} className=\"text-gray-500 hover:text-gray-700\">‚úï</button>\r\n                </div>\r\n\r\n                <div className=\"mb-4\">\r\n                    <form onSubmit={handleCreate} className=\"flex gap-2\">\r\n                        <input\r\n                            className=\"flex-1 border border-gray-300 rounded p-2\"\r\n                            placeholder=\"New Category Name\"\r\n                            value={newCategoryName}\r\n                            onChange={e => setNewCategoryName(e.target.value)}\r\n                        />\r\n                        <button type=\"submit\" className=\"bg-black text-white px-4 py-2 rounded\">Add</button>\r\n                    </form>\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-y-auto min-h-[200px] border rounded p-2 bg-gray-50\">\r\n                    {loading ? <div className=\"p-4 text-center\">Loading...</div> : (\r\n                        <DndContext\r\n                            sensors={sensors}\r\n                            collisionDetection={closestCenter}\r\n                            onDragEnd={handleDragEnd}\r\n                        >\r\n                            <SortableContext\r\n                                items={categories.map(c => c.asset_category_id)}\r\n                                strategy={verticalListSortingStrategy}\r\n                            >\r\n                                <div className=\"space-y-2\">\r\n                                    {categories.map(cat => (\r\n                                        <SortableItem\r\n                                            key={cat.asset_category_id}\r\n                                            id={cat.asset_category_id}\r\n                                            category={cat}\r\n                                            onDelete={handleDelete}\r\n                                        />\r\n                                    ))}\r\n                                    {categories.length === 0 && <p className=\"text-gray-400 text-center py-4\">No categories yet.</p>}\r\n                                </div>\r\n                            </SortableContext>\r\n                        </DndContext>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"mt-4 flex justify-end\">\r\n                    <button onClick={onClose} className=\"px-4 py-2 border rounded hover:bg-gray-100\">Close</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction SortableItem({ id, category, onDelete }) {\r\n    const {\r\n        attributes,\r\n        listeners,\r\n        setNodeRef,\r\n        transform,\r\n        transition,\r\n        isDragging\r\n    } = useSortable({ id });\r\n\r\n    const style = {\r\n        transform: CSS.Transform.toString(transform),\r\n        transition,\r\n        zIndex: isDragging ? 10 : 1,\r\n        opacity: isDragging ? 0.8 : 1\r\n    };\r\n\r\n    return (\r\n        <div\r\n            ref={setNodeRef}\r\n            style={style}\r\n            className={`bg-white p-3 rounded border shadow-sm flex items-center justify-between ${isDragging ? 'shadow-lg border-blue-500' : ''}`}\r\n        >\r\n            <div className=\"flex items-center gap-3 flex-1\">\r\n                <div {...attributes} {...listeners} className=\"cursor-grab text-gray-400 hover:text-gray-600 px-1\">\r\n                    ‚ò∞\r\n                </div>\r\n                <span className=\"font-medium\">{category.name}</span>\r\n            </div>\r\n            <button\r\n                onClick={() => onDelete(id)}\r\n                className=\"text-red-500 hover:text-red-700 text-sm px-2\"\r\n            >\r\n                Delete\r\n            </button>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default AssetCategoryManager;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\assets\\AssetHires.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchHires'. Either include it or remove the dependency array.","line":13,"column":8,"nodeType":"ArrayExpression","endLine":13,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchHires]","fix":{"range":[441,443],"text":"[fetchHires]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":23,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":75,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../../context/AuthContext';\r\nimport { useNotification } from '../../../context/NotificationContext';\r\n\r\nfunction AssetHires() {\r\n    const { token } = useAuth();\r\n    const { notify, confirm } = useNotification();\r\n    const [hires, setHires] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        fetchHires();\r\n    }, []);\r\n\r\n    const fetchHires = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch('/api/assets/hires');\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setHires(data);\r\n            }\r\n        } catch (e) { notify('Error loading hires', 'error'); }\r\n        finally { setLoading(false); }\r\n    };\r\n\r\n    const handleSeedTestData = async () => {\r\n        confirm('Generate a test hire record? This requires at least one active Asset Item and one existing Order.', async () => {\r\n            // 1. Get an item\r\n            const itemRes = await fetch('/api/assets/items');\r\n            const items = await itemRes.json();\r\n            if (items.length === 0) { notify('No asset items found to hire.', 'error'); return; }\r\n            const randomItem = items[0]; // Just pick first\r\n\r\n            // 2. We need a valid order_item_id. Ideally we query DB, but for quick hack we might guess or need an endpoint.\r\n            // Let's assume there is at least one order_item in the DB.\r\n            // I'll skip the 'fetch orders' step for simplicity and rely on user having data OR fail gracefully.\r\n            // Actually, let's try to fetch orders to get a valid ID.\r\n            const ordersRes = await fetch('/api/orders/all', { headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token } });\r\n            if (!ordersRes.ok) { notify('Could not fetch orders to link hire to.', 'error'); return; }\r\n            const orders = await ordersRes.json();\r\n            if (orders.length === 0) { notify('No orders found.', 'error'); return; }\r\n\r\n            // We need an *order_item_id*. \"orders\" usually returns order-level info.\r\n            // We might need to fetch details of an order.\r\n            const orderId = orders[0].order_id;\r\n            const detailRes = await fetch(`/api/orders/${orderId}`, { headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token } });\r\n            const orderDetail = await detailRes.json();\r\n\r\n            if (!orderDetail.items || orderDetail.items.length === 0) { notify('Chosen order has no items.', 'error'); return; }\r\n            const randomOrderItem = orderDetail.items[0];\r\n\r\n            // 3. Create Hire\r\n            try {\r\n                const res = await fetch('/api/assets/hires', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'Authorization': `Bearer ${token}`,\r\n                        'X-Auth-Token': token\r\n                    },\r\n                    body: JSON.stringify({\r\n                        asset_item_id: randomItem.asset_item_id,\r\n                        order_item_id: randomOrderItem.order_item_id,\r\n                        start_date: new Date().toISOString(),\r\n                        end_date: new Date(Date.now() + 86400000).toISOString() // +1 day\r\n                    })\r\n                });\r\n                if (res.ok) {\r\n                    notify('Test Hire created!', 'success');\r\n                    fetchHires();\r\n                } else {\r\n                    notify('Failed to create test hire', 'error');\r\n                }\r\n            } catch (e) { notify('Error creating hire', 'error'); }\r\n        });\r\n    };\r\n\r\n    if (loading) return <div>Loading hires...</div>;\r\n\r\n    return (\r\n        <div>\r\n            <div className=\"flex justify-between mb-4\">\r\n                <h2 className=\"text-xl font-bold\">Current Hires</h2>\r\n                <button onClick={handleSeedTestData} className=\"text-sm bg-gray-200 px-3 py-1 rounded hover:bg-gray-300\">\r\n                    + Seed Test Data\r\n                </button>\r\n            </div>\r\n\r\n            <table className=\"w-full text-left border-collapse\">\r\n                <thead>\r\n                    <tr className=\"bg-gray-100 border-b\">\r\n                        <th className=\"p-3\">Asset</th>\r\n                        <th className=\"p-3\">Hirer / Order</th>\r\n                        <th className=\"p-3\">Duration</th>\r\n                        <th className=\"p-3\">Status</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    {hires.map(hire => (\r\n                        <tr key={hire.asset_hire_id} className=\"border-b hover:bg-gray-50\">\r\n                            <td className=\"p-3\">\r\n                                <div className=\"font-bold\">{hire.asset_type_name}</div>\r\n                                <div className=\"text-sm text-gray-500\">{hire.identifier}</div>\r\n                            </td>\r\n                            <td className=\"p-3\">\r\n                                <div className=\"font-medium\">{hire.hirer_name || 'Guest'}</div>\r\n                                <div className=\"text-xs text-blue-600\">Order #{hire.order_id}</div>\r\n                            </td>\r\n                            <td className=\"p-3\">\r\n                                <div className=\"text-sm\">\r\n                                    {new Date(hire.hire_start_date).toLocaleDateString()} - {new Date(hire.hire_end_date).toLocaleDateString()}\r\n                                </div>\r\n                            </td>\r\n                            <td className=\"p-3\">\r\n                                {hire.returned_at ? (\r\n                                    <span className=\"bg-gray-200 text-gray-700 px-2 py-1 rounded text-xs\">Returned</span>\r\n                                ) : (\r\n                                    <span className=\"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs\">Active</span>\r\n                                )}\r\n                            </td>\r\n                        </tr>\r\n                    ))}\r\n                    {hires.length === 0 && (\r\n                        <tr>\r\n                            <td colSpan=\"4\" className=\"p-8 text-center text-gray-500\">\r\n                                No active hires. Use \"Seed Test Data\" to test.\r\n                            </td>\r\n                        </tr>\r\n                    )}\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default AssetHires;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\assets\\AssetItems.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchItems'. Either include it or remove the dependency array.","line":40,"column":8,"nodeType":"ArrayExpression","endLine":40,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [fetchItems, selectedType]","fix":{"range":[1285,1299],"text":"[fetchItems, selectedType]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":50,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":103,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":103,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":120,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":144,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":144,"endColumn":19}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../../context/AuthContext';\r\nimport { useNotification } from '../../../context/NotificationContext';\r\n\r\nfunction AssetItems() {\r\n    const { token } = useAuth();\r\n    const { notify, confirm } = useNotification();\r\n\r\n    const [items, setItems] = useState([]);\r\n    const [types, setTypes] = useState([]);\r\n    const [selectedType, setSelectedType] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Modal\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [editMode, setEditMode] = useState(false);\r\n    const [editId, setEditId] = useState(null);\r\n    const [formData, setFormData] = useState({\r\n        identifier: '',\r\n        serial_number: '',\r\n        status: 'Active',\r\n        notes: '',\r\n        asset_type_id: '',\r\n        image_url: ''\r\n    });\r\n\r\n    // Load Types first\r\n    useEffect(() => {\r\n        fetch('/api/assets')\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                setTypes(data);\r\n                if (data.length > 0) setSelectedType(data[0].asset_type_id);\r\n            });\r\n    }, []);\r\n\r\n    // Load Items when Type changes\r\n    useEffect(() => {\r\n        if (selectedType) fetchItems(selectedType);\r\n    }, [selectedType]);\r\n\r\n    const fetchItems = async (typeId) => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch(`/api/assets/items?typeId=${typeId}`);\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setItems(data);\r\n            }\r\n        } catch (e) {\r\n            notify('Error loading items', 'error');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleCreate = () => {\r\n        setFormData({\r\n            identifier: '',\r\n            serial_number: '',\r\n            status: 'Active',\r\n            notes: '',\r\n            asset_type_id: selectedType,\r\n            image_url: ''\r\n        });\r\n        setEditMode(false);\r\n        setEditId(null);\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleEdit = (item) => {\r\n        setFormData({\r\n            identifier: item.identifier,\r\n            serial_number: item.serial_number || '',\r\n            status: item.status,\r\n            notes: item.notes || '',\r\n            asset_type_id: item.asset_type_id,\r\n            image_url: item.image_url || ''\r\n        });\r\n        setEditMode(true);\r\n        setEditId(item.asset_item_id);\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleSave = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            const url = editMode ? `/api/assets/items/${editId}` : '/api/assets/items';\r\n            const method = editMode ? 'PUT' : 'POST';\r\n\r\n            const res = await fetch(url, {\r\n                method,\r\n                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token },\r\n                body: JSON.stringify(formData)\r\n            });\r\n            if (res.ok) {\r\n                notify(editMode ? 'Item updated' : 'Item added', 'success');\r\n                setShowModal(false);\r\n                fetchItems(selectedType);\r\n            } else {\r\n                notify('Failed to save item', 'error');\r\n            }\r\n        } catch (e) { notify('Error saving item', 'error'); }\r\n    };\r\n\r\n    const handleDelete = async (id) => {\r\n        confirm('Delete this item?', async () => {\r\n            try {\r\n                const res = await fetch(`/api/assets/items/${id}`, {\r\n                    method: 'DELETE',\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n                if (res.ok) {\r\n                    notify('Item deleted', 'success');\r\n                    setItems(prev => prev.filter(i => i.asset_item_id !== id));\r\n                } else {\r\n                    const err = await res.json();\r\n                    notify(err.error || 'Delete failed', 'error');\r\n                }\r\n            } catch (e) { notify('Error deleting', 'error'); }\r\n        });\r\n    };\r\n\r\n    const handleImageUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        const uploadData = new FormData();\r\n        uploadData.append('file', file);\r\n\r\n        try {\r\n            const res = await fetch('/api/upload', {\r\n                method: 'POST',\r\n                body: uploadData,\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setFormData(prev => ({ ...prev, image_url: data.url }));\r\n                notify('Image uploaded', 'success');\r\n            } else {\r\n                notify('Upload failed', 'error');\r\n            }\r\n        } catch (e) {\r\n            notify('Upload error', 'error');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <div className=\"flex gap-4 mb-6\">\r\n                <select\r\n                    className=\"border p-2 rounded w-64\"\r\n                    value={selectedType}\r\n                    onChange={e => setSelectedType(e.target.value)}\r\n                >\r\n                    {types.map(t => <option key={t.asset_type_id} value={t.asset_type_id}>{t.name}</option>)}\r\n                </select>\r\n                <button onClick={handleCreate} className=\"bg-black text-white px-4 py-2 rounded\">+ Add Item</button>\r\n            </div>\r\n\r\n            {loading ? <div>Loading items...</div> : (\r\n                <table className=\"w-full text-left border-collapse\">\r\n                    <thead>\r\n                        <tr className=\"bg-gray-100 border-b\">\r\n                            <th className=\"p-3\">Image</th>\r\n                            <th className=\"p-3\">Identifier</th>\r\n                            <th className=\"p-3\">Serial</th>\r\n                            <th className=\"p-3\">Status</th>\r\n                            <th className=\"p-3\">Notes</th>\r\n                            <th className=\"p-3\">Actions</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {items.map(item => (\r\n                            <tr key={item.asset_item_id} className=\"border-b hover:bg-gray-50\">\r\n                                <td className=\"p-3\">\r\n                                    {item.image_url ? (\r\n                                        <img src={item.image_url} alt={item.identifier} className=\"w-10 h-10 object-cover rounded\" />\r\n                                    ) : (\r\n                                        <div className=\"w-10 h-10 bg-gray-200 rounded flex items-center justify-center text-xs text-gray-400\">No Img</div>\r\n                                    )}\r\n                                </td>\r\n                                <td className=\"p-3 font-medium\">{item.identifier}</td>\r\n                                <td className=\"p-3 font-mono text-sm\">{item.serial_number}</td>\r\n                                <td className=\"p-3\">\r\n                                    <span className={`px-2 py-1 rounded text-xs ${item.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-gray-200'}`}>\r\n                                        {item.status}\r\n                                    </span>\r\n                                </td>\r\n                                <td className=\"p-3 text-sm text-gray-500\">{item.notes}</td>\r\n                                <td className=\"p-3\">\r\n                                    <button onClick={() => handleEdit(item)} className=\"text-blue-600 hover:underline mr-3\">Edit</button>\r\n                                    <button onClick={() => handleDelete(item.asset_item_id)} className=\"text-red-600 hover:underline\">Delete</button>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                        {items.length === 0 && (\r\n                            <tr><td colSpan=\"6\" className=\"p-8 text-center text-gray-500\">No items found for this type.</td></tr>\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n            )}\r\n\r\n            {showModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n                    <div className=\"bg-white p-6 rounded shadow-lg w-full max-w-sm\">\r\n                        <h3 className=\"text-lg font-bold mb-4\">{editMode ? 'Edit Item' : 'Add Item'}</h3>\r\n                        <form onSubmit={handleSave}>\r\n                            <div className=\"mb-3\">\r\n                                <label className=\"block text-sm font-medium mb-1\">Identifier (e.g. #01) *</label>\r\n                                <input required className=\"w-full border p-2 rounded\" value={formData.identifier} onChange={e => setFormData({ ...formData, identifier: e.target.value })} />\r\n                            </div>\r\n                            <div className=\"mb-3\">\r\n                                <label className=\"block text-sm font-medium mb-1\">Serial Number</label>\r\n                                <input className=\"w-full border p-2 rounded\" value={formData.serial_number} onChange={e => setFormData({ ...formData, serial_number: e.target.value })} />\r\n                            </div>\r\n                            <div className=\"mb-3\">\r\n                                <label className=\"block text-sm font-medium mb-1\">Status</label>\r\n                                <select className=\"w-full border p-2 rounded\" value={formData.status} onChange={e => setFormData({ ...formData, status: e.target.value })}>\r\n                                    <option value=\"Active\">Active</option>\r\n                                    <option value=\"Servicing\">Servicing</option>\r\n                                    <option value=\"Retired\">Retired</option>\r\n                                </select>\r\n                            </div>\r\n                            <div className=\"mb-3\">\r\n                                <label className=\"block text-sm font-medium mb-1\">Notes</label>\r\n                                <textarea className=\"w-full border p-2 rounded\" value={formData.notes} onChange={e => setFormData({ ...formData, notes: e.target.value })} />\r\n                            </div>\r\n                            <div className=\"mb-6\">\r\n                                <label className=\"block text-sm font-medium mb-1\">Image</label>\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    {formData.image_url ? (\r\n                                        <img src={formData.image_url} alt=\"Preview\" className=\"w-16 h-16 object-cover rounded border\" />\r\n                                    ) : (\r\n                                        <div className=\"w-16 h-16 bg-gray-100 border rounded\"></div>\r\n                                    )}\r\n                                    <input type=\"file\" onChange={handleImageUpload} className=\"text-sm max-w-[200px]\" />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex justify-end gap-2\">\r\n                                <button type=\"button\" onClick={() => setShowModal(false)} className=\"px-4 py-2 border rounded\">Cancel</button>\r\n                                <button type=\"submit\" className=\"px-4 py-2 bg-black text-white rounded\">Save</button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default AssetItems;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\assets\\AssetTypes.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":31,"column":8,"nodeType":"ArrayExpression","endLine":31,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData]","fix":{"range":[1033,1035],"text":"[fetchData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../../context/AuthContext';\r\nimport { useNotification } from '../../../context/NotificationContext';\r\n\r\nfunction AssetTypes() {\r\n    const { token } = useAuth();\r\n    const { notify, confirm } = useNotification();\r\n\r\n    const [types, setTypes] = useState([]);\r\n    const [categories, setCategories] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Modal State\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [editMode, setEditMode] = useState(false);\r\n    const [editId, setEditId] = useState(null);\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        description: '',\r\n        asset_category_id: '',\r\n        base_hire_cost: '', // Daily Price\r\n        full_event_cost: '',\r\n        show_daily_cost: true,\r\n        show_full_event_cost: false,\r\n        stock_quantity: 0, // [NEW] Pooled Inventory\r\n        image_url: ''\r\n    });\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, []);\r\n\r\n    const fetchData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const [typesRes, catsRes] = await Promise.all([\r\n                fetch('/api/assets'),\r\n                fetch('/api/assets/categories') // Fetch all categories? Or per event? Assuming global for now or needing eventId\r\n            ]);\r\n\r\n            // Note: Categories usually need eventId, so we might need to get it from somewhere or API handles it.\r\n            // Let's assume generic fetch for now or we might need to pass eventId if available.\r\n            // Actually, usually admin dashboard has a selected event context? \r\n            // AssetDashboard seems to specific to general assets or event specific?\r\n            // The AssetDashboard didn't seem to take props.\r\n\r\n            if (typesRes.ok) {\r\n                const data = await typesRes.json();\r\n                setTypes(data);\r\n            }\r\n            if (catsRes.ok) {\r\n                const data = await catsRes.json();\r\n                setCategories(data);\r\n            }\r\n        } catch {\r\n            notify('Failed to load data', 'error');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleCreate = () => {\r\n        setFormData({\r\n            name: '',\r\n            description: '',\r\n            asset_category_id: categories.length > 0 ? categories[0].asset_category_id : '',\r\n            base_hire_cost: '',\r\n            full_event_cost: '',\r\n            show_daily_cost: true,\r\n            show_full_event_cost: false,\r\n            stock_quantity: 0,\r\n            image_url: ''\r\n        });\r\n        setEditMode(false);\r\n        setEditId(null);\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleEdit = (type) => {\r\n        setFormData({\r\n            name: type.name,\r\n            description: type.description || '',\r\n            asset_category_id: type.asset_category_id || '',\r\n            base_hire_cost: type.base_hire_cost || '',\r\n            full_event_cost: type.full_event_cost || '',\r\n            show_daily_cost: type.show_daily_cost || false,\r\n            show_full_event_cost: type.show_full_event_cost || false,\r\n            stock_quantity: type.stock_quantity || 0,\r\n            image_url: type.image_url || ''\r\n        });\r\n        setEditMode(true);\r\n        setEditId(type.asset_type_id);\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleSave = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            const url = editMode ? `/api/assets/types/${editId}` : '/api/assets/types';\r\n            const method = editMode ? 'PUT' : 'POST';\r\n\r\n            const payload = {\r\n                ...formData,\r\n                base_hire_cost: formData.base_hire_cost === '' ? 0 : parseFloat(formData.base_hire_cost),\r\n                full_event_cost: formData.full_event_cost === '' ? null : parseFloat(formData.full_event_cost),\r\n                stock_quantity: parseInt(formData.stock_quantity) || 0\r\n            };\r\n\r\n            const res = await fetch(url, {\r\n                method,\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify(payload)\r\n            });\r\n\r\n            if (res.ok) {\r\n                notify(editMode ? 'Asset Type updated' : 'Asset Type created', 'success');\r\n                setShowModal(false);\r\n                fetchData(); // Reload\r\n            } else {\r\n                const err = await res.json();\r\n                notify(err.error || 'Failed to save', 'error');\r\n            }\r\n        } catch {\r\n            notify('Error saving asset type', 'error');\r\n        }\r\n    };\r\n\r\n    const handleDelete = (id) => {\r\n        confirm('Delete this Asset Type?', async () => {\r\n            try {\r\n                const res = await fetch(`/api/assets/types/${id}`, {\r\n                    method: 'DELETE',\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n                if (res.ok) {\r\n                    notify('Asset Type deleted', 'success');\r\n                    setTypes(prev => prev.filter(t => t.asset_type_id !== id));\r\n                } else {\r\n                    notify('Delete failed', 'error');\r\n                }\r\n            } catch {\r\n                notify('Delete failed', 'error');\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleImageUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n        const uploadData = new FormData();\r\n        uploadData.append('file', file);\r\n\r\n        try {\r\n            const res = await fetch('/api/upload', {\r\n                method: 'POST',\r\n                body: uploadData,\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setFormData(prev => ({ ...prev, image_url: data.url }));\r\n                notify('Image uploaded', 'success');\r\n            } else {\r\n                notify('Upload failed', 'error');\r\n            }\r\n        } catch {\r\n            notify('Upload error', 'error');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <div className=\"flex justify-between mb-6\">\r\n                <h2 className=\"text-xl font-bold\">Asset Types</h2>\r\n                <button onClick={handleCreate} className=\"bg-black text-white px-4 py-2 rounded\">+ Add Asset Type</button>\r\n            </div>\r\n\r\n            {loading ? <div>Loading...</div> : (\r\n                <div className=\"grid gap-4\">\r\n                    {types.map(type => (\r\n                        <div key={type.asset_type_id} className=\"bg-white border p-4 rounded flex items-center gap-4\">\r\n                            <div className=\"w-16 h-16 bg-gray-100 rounded overflow-hidden flex-shrink-0\">\r\n                                {type.image_url ? (\r\n                                    <img src={type.image_url} alt={type.name} className=\"w-full h-full object-cover\" />\r\n                                ) : (\r\n                                    <div className=\"flex items-center justify-center h-full text-gray-400 text-xs\">No Img</div>\r\n                                )}\r\n                            </div>\r\n                            <div className=\"flex-1\">\r\n                                <h3 className=\"font-bold text-lg\">{type.name}</h3>\r\n                                <p className=\"text-sm text-gray-600\">{type.description}</p>\r\n                                <div className=\"mt-1 flex gap-4 text-sm\">\r\n                                    <span className=\"bg-blue-100 text-blue-800 px-2 py-0.5 rounded\">\r\n                                        Stock: {type.stock_quantity ?? 'Unset'}\r\n                                    </span>\r\n                                    <span>Daily: ${type.base_hire_cost || 0}</span>\r\n                                    <span>Full: ${type.full_event_cost || 0}</span>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex gap-2\">\r\n                                <button onClick={() => handleEdit(type)} className=\"px-3 py-1 border rounded hover:bg-gray-50\">Edit</button>\r\n                                <button onClick={() => handleDelete(type.asset_type_id)} className=\"px-3 py-1 border rounded text-red-600 hover:bg-red-50\">Delete</button>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                    {types.length === 0 && <p className=\"text-center text-gray-500 py-10\">No Asset Types found.</p>}\r\n                </div>\r\n            )}\r\n\r\n            {showModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n                    <div className=\"bg-white p-6 rounded shadow-lg w-full max-w-lg max-h-[90vh] overflow-y-auto\">\r\n                        <h3 className=\"text-xl font-bold mb-4\">{editMode ? 'Edit Asset Type' : 'Create Asset Type'}</h3>\r\n                        <form onSubmit={handleSave} className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium mb-1\">Name</label>\r\n                                <input required className=\"w-full border p-2 rounded\" value={formData.name} onChange={e => setFormData({ ...formData, name: e.target.value })} />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium mb-1\">Category</label>\r\n                                <select className=\"w-full border p-2 rounded\" value={formData.asset_category_id} onChange={e => setFormData({ ...formData, asset_category_id: e.target.value })}>\r\n                                    <option value=\"\">Select Category...</option>\r\n                                    {categories.map(c => (\r\n                                        <option key={c.asset_category_id} value={c.asset_category_id}>{c.name}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium mb-1\">Description</label>\r\n                                <textarea className=\"w-full border p-2 rounded h-20\" value={formData.description} onChange={e => setFormData({ ...formData, description: e.target.value })} />\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium mb-1\">Stock Quantity</label>\r\n                                    <input type=\"number\" min=\"0\" className=\"w-full border p-2 rounded\" value={formData.stock_quantity} onChange={e => setFormData({ ...formData, stock_quantity: e.target.value })} />\r\n                                    <p className=\"text-xs text-gray-500 mt-1\">Total pool size available.</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4 border-t pt-4\">\r\n                                <div>\r\n                                    <label className=\"flex items-center gap-2 mb-1\">\r\n                                        <input type=\"checkbox\" checked={formData.show_daily_cost} onChange={e => setFormData({ ...formData, show_daily_cost: e.target.checked })} />\r\n                                        <span className=\"text-sm font-medium\">Daily Hire</span>\r\n                                    </label>\r\n                                    <input type=\"number\" step=\"0.01\" className=\"w-full border p-2 rounded\" placeholder=\"Price per day\" value={formData.base_hire_cost} onChange={e => setFormData({ ...formData, base_hire_cost: e.target.value })} disabled={!formData.show_daily_cost} />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"flex items-center gap-2 mb-1\">\r\n                                        <input type=\"checkbox\" checked={formData.show_full_event_cost} onChange={e => setFormData({ ...formData, show_full_event_cost: e.target.checked })} />\r\n                                        <span className=\"text-sm font-medium\">Full Event</span>\r\n                                    </label>\r\n                                    <input type=\"number\" step=\"0.01\" className=\"w-full border p-2 rounded\" placeholder=\"Price for event\" value={formData.full_event_cost} onChange={e => setFormData({ ...formData, full_event_cost: e.target.value })} disabled={!formData.show_full_event_cost} />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"border-t pt-4\">\r\n                                <label className=\"block text-sm font-medium mb-1\">Image</label>\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    {formData.image_url ? (\r\n                                        <img src={formData.image_url} alt=\"Preview\" className=\"w-16 h-16 object-cover rounded border\" />\r\n                                    ) : (\r\n                                        <div className=\"w-16 h-16 bg-gray-100 border rounded flex items-center justify-center text-xs text-gray-400\">No Img</div>\r\n                                    )}\r\n                                    <input type=\"file\" onChange={handleImageUpload} className=\"text-sm\" />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex justify-end gap-2 pt-4 border-t\">\r\n                                <button type=\"button\" onClick={() => setShowModal(false)} className=\"px-4 py-2 border rounded hover:bg-gray-100\">Cancel</button>\r\n                                <button type=\"submit\" className=\"px-4 py-2 bg-black text-white rounded hover:bg-gray-800\">Save Asset Type</button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default AssetTypes;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\settings\\AdminList.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAdmins'. Either include it or remove the dependency array.","line":17,"column":8,"nodeType":"ArrayExpression","endLine":17,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAdmins]","fix":{"range":[681,683],"text":"[fetchAdmins]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../../context/AuthContext';\r\nimport { useNotification } from '../../../context/NotificationContext';\r\nimport AdminModal from './AdminModal';\r\n\r\nfunction AdminList() {\r\n    const { user, token } = useAuth(); // Logged in user info\r\n    const { notify, confirm } = useNotification();\r\n    const [admins, setAdmins] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n    const [selectedAdmin, setSelectedAdmin] = useState(null);\r\n\r\n    useEffect(() => {\r\n        fetchAdmins();\r\n    }, []);\r\n\r\n    const fetchAdmins = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const res = await fetch('/api/manage/admins', {\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                }\r\n            });\r\n            if (!res.ok) throw new Error('Failed to load admins');\r\n            const data = await res.json();\r\n            setAdmins(data);\r\n        } catch (err) {\r\n            setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleCreate = () => {\r\n        setSelectedAdmin(null); // Clear selection for new\r\n        setIsModalOpen(true);\r\n    };\r\n\r\n    const handleEdit = (admin) => {\r\n        setSelectedAdmin(admin);\r\n        setIsModalOpen(true);\r\n    };\r\n\r\n    const handleDelete = (adminId) => {\r\n        confirm('Are you sure you want to delete this admin? This action cannot be undone.', async () => {\r\n            try {\r\n                const res = await fetch(`/api/manage/admins/${adminId}`, {\r\n                    method: 'DELETE',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${token}`,\r\n                        'X-Auth-Token': token\r\n                    }\r\n                });\r\n\r\n                if (!res.ok) {\r\n                    const err = await res.json().catch(() => ({}));\r\n                    throw new Error(err.error || 'Failed to delete admin');\r\n                }\r\n\r\n                setAdmins(prev => prev.filter(a => a.admin_user_id !== adminId));\r\n                notify(\"Admin deleted successfully\", \"success\");\r\n            } catch (err) {\r\n                notify(err.message, \"error\");\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleSave = (savedAdmin) => {\r\n        if (selectedAdmin) {\r\n            // Update list\r\n            setAdmins(prev => prev.map(a => a.admin_user_id === savedAdmin.admin_user_id ? savedAdmin : a));\r\n        } else {\r\n            // Add new\r\n            setAdmins(prev => [savedAdmin, ...prev]);\r\n        }\r\n        setIsModalOpen(false);\r\n    };\r\n\r\n    if (loading) return <div>Loading admins...</div>;\r\n    if (error) return <div className=\"error\">{error}</div>;\r\n\r\n    return (\r\n        <div className=\"card\" style={{ padding: '2rem' }}>\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n                <h2 className=\"text-xl font-bold\">Admin Users</h2>\r\n                <button\r\n                    onClick={handleCreate}\r\n                    className=\"bg-primary text-secondary px-4 py-2 rounded font-bold text-sm hover:brightness-110 transition-all\"\r\n                >\r\n                    + Add Admin\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"overflow-x-auto\">\r\n                <table className=\"w-full text-left border-collapse\">\r\n                    <thead>\r\n                        <tr className=\"border-b\">\r\n                            <th className=\"py-2 px-3 font-semibold text-gray-600\">Name</th>\r\n                            <th className=\"py-2 px-3 font-semibold text-gray-600\">Email</th>\r\n                            <th className=\"py-2 px-3 font-semibold text-gray-600\">Role</th>\r\n                            <th className=\"py-2 px-3 font-semibold text-gray-600\">Status</th>\r\n                            <th className=\"py-2 px-3 font-semibold text-gray-600 text-right\">Actions</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {admins.map(admin => (\r\n                            <tr key={admin.admin_user_id} className=\"border-b hover:bg-gray-50\">\r\n                                <td className=\"py-3 px-3\">\r\n                                    <div className=\"font-bold text-gray-800\">{admin.first_name} {admin.last_name}</div>\r\n                                </td>\r\n                                <td className=\"py-3 px-3 text-gray-600\">{admin.email}</td>\r\n                                <td className=\"py-3 px-3\">\r\n                                    <span className=\"bg-gray-200 text-gray-700 py-1 px-2 rounded text-xs font-bold uppercase\">\r\n                                        {admin.role}\r\n                                    </span>\r\n                                </td>\r\n                                <td className=\"py-3 px-3\">\r\n                                    {admin.is_active ? (\r\n                                        <span className=\"text-green-600 font-bold text-xs\">Active</span>\r\n                                    ) : (\r\n                                        <span className=\"text-red-500 font-bold text-xs\">Inactive</span>\r\n                                    )}\r\n                                </td>\r\n                                <td className=\"py-3 px-3 text-right\">\r\n                                    <button\r\n                                        onClick={() => handleEdit(admin)}\r\n                                        className=\"text-blue-600 hover:text-blue-800 text-sm font-semibold mr-3\"\r\n                                    >\r\n                                        Edit\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleDelete(admin.admin_user_id)}\r\n                                        className={`text-sm font-semibold ${admin.admin_user_id === user?.id ? 'text-gray-400 cursor-not-allowed' : 'text-red-600 hover:text-red-800'}`}\r\n                                        disabled={admin.admin_user_id === user?.id}\r\n                                        title={admin.admin_user_id === user?.id ? \"You cannot delete yourself\" : \"Delete Admin\"}\r\n                                    >\r\n                                        Delete\r\n                                    </button>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {isModalOpen && (\r\n                <AdminModal\r\n                    admin={selectedAdmin}\r\n                    onClose={() => setIsModalOpen(false)}\r\n                    onSave={handleSave}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default AdminList;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\settings\\AdminModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\settings\\FAQManager.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchFaqs'. Either include it or remove the dependency array.","line":25,"column":8,"nodeType":"ArrayExpression","endLine":25,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchFaqs]","fix":{"range":[811,813],"text":"[fetchFaqs]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":39,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":85,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":85,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":110,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":110,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":140,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":140,"endColumn":19}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../../context/AuthContext';\r\nimport { useNotification } from '../../../context/NotificationContext';\r\nimport { Edit, Trash2, Plus, Upload, X } from 'lucide-react';\r\n\r\nfunction FAQManager() {\r\n    const { token } = useAuth();\r\n    const { notify, confirm } = useNotification();\r\n    const [faqs, setFaqs] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [currentFaq, setCurrentFaq] = useState(null);\r\n\r\n    // Form State\r\n    const [formData, setFormData] = useState({\r\n        question: '',\r\n        answer: '',\r\n        image_url: '',\r\n        display_order: 0,\r\n        is_active: true\r\n    });\r\n\r\n    useEffect(() => {\r\n        fetchFaqs();\r\n    }, []);\r\n\r\n    const fetchFaqs = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch('/api/manage/faqs', {\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setFaqs(data);\r\n            } else {\r\n                notify('Failed to load FAQs', 'error');\r\n            }\r\n        } catch (e) {\r\n            notify('Error loading FAQs', 'error');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setFormData({\r\n            question: '',\r\n            answer: '',\r\n            image_url: '',\r\n            display_order: faqs.length > 0 ? Math.max(...faqs.map(f => f.display_order)) + 10 : 10,\r\n            is_active: true\r\n        });\r\n        setCurrentFaq(null);\r\n        setIsEditing(false);\r\n    };\r\n\r\n    const handleEdit = (faq) => {\r\n        setCurrentFaq(faq);\r\n        setFormData({\r\n            question: faq.question,\r\n            answer: faq.answer,\r\n            image_url: faq.image_url || '',\r\n            display_order: faq.display_order,\r\n            is_active: faq.is_active\r\n        });\r\n        setIsEditing(true);\r\n        // Scroll to form\r\n        window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    };\r\n\r\n    const handleDelete = (id) => {\r\n        confirm('Are you sure you want to delete this FAQ?', async () => {\r\n            try {\r\n                const res = await fetch(`/api/manage/faqs/${id}`, {\r\n                    method: 'DELETE',\r\n                    headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n                });\r\n                if (res.ok) {\r\n                    notify('FAQ deleted successfully', 'success');\r\n                    fetchFaqs();\r\n                } else {\r\n                    notify('Failed to delete FAQ', 'error');\r\n                }\r\n            } catch (e) {\r\n                notify('Error deleting FAQ', 'error');\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleImageUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n        const uploadData = new FormData();\r\n        uploadData.append('file', file);\r\n\r\n        try {\r\n            const res = await fetch('/api/upload', {\r\n                method: 'POST',\r\n                body: uploadData,\r\n                headers: { 'Authorization': `Bearer ${token}`, 'X-Auth-Token': token }\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setFormData(prev => ({ ...prev, image_url: data.url }));\r\n                notify('Image uploaded', 'success');\r\n            } else {\r\n                notify('Upload failed', 'error');\r\n            }\r\n        } catch (e) {\r\n            notify('Upload error', 'error');\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n\r\n        const url = isEditing ? `/api/manage/faqs/${currentFaq.id}` : '/api/manage/faqs';\r\n        const method = isEditing ? 'PUT' : 'POST';\r\n\r\n        try {\r\n            const res = await fetch(url, {\r\n                method: method,\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify(formData)\r\n            });\r\n\r\n            if (res.ok) {\r\n                notify(isEditing ? 'FAQ updated' : 'FAQ created', 'success');\r\n                fetchFaqs();\r\n                resetForm();\r\n            } else {\r\n                const data = await res.json();\r\n                notify(data.error || 'Operation failed', 'error');\r\n            }\r\n        } catch (e) {\r\n            notify('Error saving FAQ', 'error');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <div className=\"bg-white p-6 rounded-lg shadow-sm border border-gray-100\">\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                    <h2 className=\"text-xl font-bold\">{isEditing ? 'Edit FAQ' : 'Add New FAQ'}</h2>\r\n                    {isEditing && (\r\n                        <button onClick={resetForm} className=\"text-gray-500 hover:text-gray-700 flex items-center gap-1 text-sm\">\r\n                            <X size={16} /> Cancel Edit\r\n                        </button>\r\n                    )}\r\n                </div>\r\n\r\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                        <div className=\"md:col-span-2 space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Question</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={formData.question}\r\n                                    onChange={e => setFormData({ ...formData, question: e.target.value })}\r\n                                    className=\"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-accent focus:border-transparent outline-none\"\r\n                                    required\r\n                                    placeholder=\"e.g., What time do gates open?\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Answer</label>\r\n                                <textarea\r\n                                    value={formData.answer}\r\n                                    onChange={e => setFormData({ ...formData, answer: e.target.value })}\r\n                                    className=\"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-accent focus:border-transparent outline-none min-h-[120px]\"\r\n                                    required\r\n                                    placeholder=\"Enter the answer here...\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Display Order</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={formData.display_order}\r\n                                    onChange={e => setFormData({ ...formData, display_order: parseInt(e.target.value) || 0 })}\r\n                                    className=\"w-full p-2 border border-gray-300 rounded\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-2 pt-6\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    id=\"is_active\"\r\n                                    checked={formData.is_active}\r\n                                    onChange={e => setFormData({ ...formData, is_active: e.target.checked })}\r\n                                    className=\"h-4 w-4 text-accent border-gray-300 rounded focus:ring-accent\"\r\n                                />\r\n                                <label htmlFor=\"is_active\" className=\"text-sm font-medium text-gray-700 select-none\">Active / Visible</label>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Image (Optional)</label>\r\n                                <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:bg-gray-50 transition-colors relative\">\r\n                                    {formData.image_url ? (\r\n                                        <div className=\"relative z-10\"> {/* Lift container above input if needed, or just button */}\r\n                                            <img src={formData.image_url} alt=\"Preview\" className=\"max-h-32 mx-auto rounded\" />\r\n                                            <button\r\n                                                type=\"button\"\r\n                                                onClick={(e) => {\r\n                                                    e.stopPropagation();\r\n                                                    e.preventDefault();\r\n                                                    setFormData({ ...formData, image_url: '' });\r\n                                                }}\r\n                                                className=\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow hover:bg-red-600 z-20\"\r\n                                            >\r\n                                                <X size={12} />\r\n                                            </button>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div className=\"text-gray-500 pointer-events-none\">\r\n                                            <Upload className=\"mx-auto mb-2 opacity-50\" size={24} />\r\n                                            <span className=\"text-xs\">Click to upload</span>\r\n                                        </div>\r\n                                    )}\r\n                                    <input\r\n                                        type=\"file\"\r\n                                        className=\"absolute inset-0 opacity-0 cursor-pointer w-full h-full\"\r\n                                        accept=\"image/*\"\r\n                                        onChange={handleImageUpload}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"pt-4 border-t border-gray-100 flex justify-end\">\r\n                        <button\r\n                            type=\"submit\"\r\n                            className=\"bg-black text-white px-6 py-2 rounded hover:bg-gray-800 transition-colors flex items-center gap-2 font-medium\"\r\n                        >\r\n                            {isEditing ? <Edit size={16} /> : <Plus size={16} />}\r\n                            {isEditing ? 'Update FAQ' : 'Add FAQ'}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden\">\r\n                <div className=\"p-4 bg-gray-50 border-b border-gray-200 font-bold text-gray-700\">\r\n                    Existing FAQs\r\n                </div>\r\n\r\n                {loading ? (\r\n                    <div className=\"p-8 text-center text-gray-500\">Loading...</div>\r\n                ) : faqs.length === 0 ? (\r\n                    <div className=\"p-8 text-center text-gray-500\">No FAQs found. Create one above.</div>\r\n                ) : (\r\n                    <div className=\"divide-y divide-gray-100\">\r\n                        {faqs.map(faq => (\r\n                            <div key={faq.id} className={`p-4 hover:bg-gray-50 transition-colors flex gap-4 items-start ${!faq.is_active ? 'opacity-60 bg-gray-50' : ''}`}>\r\n                                <div className=\"font-mono text-xs text-gray-400 mt-1 w-8 text-center bg-gray-100 rounded p-1\">\r\n                                    {faq.display_order}\r\n                                </div>\r\n\r\n                                {faq.image_url && (\r\n                                    <img src={faq.image_url} alt=\"Thumbnail\" className=\"w-16 h-16 object-cover rounded bg-gray-200 flex-shrink-0\" />\r\n                                )}\r\n\r\n                                <div className=\"flex-grow min-w-0\">\r\n                                    <div className=\"flex items-start justify-between gap-4\">\r\n                                        <h3 className=\"font-bold text-gray-900 truncate pr-4\">{faq.question}</h3>\r\n                                        {!faq.is_active && <span className=\"text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded font-medium\">Inactive</span>}\r\n                                    </div>\r\n                                    <p className=\"text-sm text-gray-600 line-clamp-2 mt-1 whitespace-pre-line\">{faq.answer}</p>\r\n                                </div>\r\n\r\n                                <div className=\"flex flex-col gap-2\">\r\n                                    <button\r\n                                        onClick={() => handleEdit(faq)}\r\n                                        className=\"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-50\"\r\n                                        title=\"Edit\"\r\n                                    >\r\n                                        <Edit size={18} />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleDelete(faq.id)}\r\n                                        className=\"text-red-500 hover:text-red-700 p-1 rounded hover:bg-red-50\"\r\n                                        title=\"Delete\"\r\n                                    >\r\n                                        <Trash2 size={18} />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default FAQManager;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\settings\\OrgSettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\admin\\settings\\UserList.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchUsers'. Either include it or remove the dependency array.","line":14,"column":8,"nodeType":"ArrayExpression","endLine":14,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchUsers]","fix":{"range":[485,487],"text":"[fetchUsers]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../../context/AuthContext';\r\nimport { useNotification } from '../../../context/NotificationContext';\r\n\r\nfunction UserList() {\r\n    const { token } = useAuth();\r\n    const { notify, confirm } = useNotification();\r\n    const [users, setUsers] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n\r\n    useEffect(() => {\r\n        fetchUsers();\r\n    }, []);\r\n\r\n    const fetchUsers = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const res = await fetch('/api/manage/users', {\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                }\r\n            });\r\n            if (!res.ok) throw new Error('Failed to load users');\r\n            const data = await res.json();\r\n            setUsers(data);\r\n        } catch (err) {\r\n            setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const toggleLock = (user) => {\r\n        const newStatus = !user.is_locked;\r\n        const confirmMsg = newStatus\r\n            ? `Are you sure you want to LOCK ${user.email}? They will not be able to log in.`\r\n            : `Are you sure you want to UNLOCK ${user.email}?`;\r\n\r\n        confirm(confirmMsg, async () => {\r\n            try {\r\n                const res = await fetch(`/api/manage/users/${user.user_id}/status`, {\r\n                    method: 'PUT',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'Authorization': `Bearer ${token}`,\r\n                        'X-Auth-Token': token\r\n                    },\r\n                    body: JSON.stringify({ is_locked: newStatus })\r\n                });\r\n\r\n                if (!res.ok) throw new Error('Failed to update status');\r\n\r\n                // Optimistic update\r\n                setUsers(prev => prev.map(u =>\r\n                    u.user_id === user.user_id ? { ...u, is_locked: newStatus } : u\r\n                ));\r\n                notify(`User ${newStatus ? 'locked' : 'unlocked'} successfully`, \"success\");\r\n\r\n            } catch (err) {\r\n                notify(err.message, \"error\");\r\n            }\r\n        });\r\n    };\r\n\r\n    if (loading) return <div className=\"p-8\">Loading users...</div>;\r\n    if (error) return <div className=\"p-8 text-red-500\">{error}</div>;\r\n\r\n    return (\r\n        <div className=\"card\" style={{ padding: '2rem' }}>\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n                <h2 className=\"text-xl font-bold\">Registered Users</h2>\r\n                <div className=\"text-sm text-gray-500\">\r\n                    Total: {users.length}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"overflow-x-auto\">\r\n                <table className=\"w-full text-left border-collapse\">\r\n                    <thead>\r\n                        <tr className=\"border-b\">\r\n                            <th className=\"py-2 px-3 font-semibold text-gray-600\">Name</th>\r\n                            <th className=\"py-2 px-3 font-semibold text-gray-600\">Email</th>\r\n                            <th className=\"py-2 px-3 font-semibold text-gray-600\">Verified</th>\r\n                            <th className=\"py-2 px-3 font-semibold text-gray-600\">Status</th>\r\n                            <th className=\"py-2 px-3 font-semibold text-gray-600 text-right\">Actions</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {users.map(user => (\r\n                            <tr key={user.user_id} className={`border-b hover:bg-gray-50 ${user.is_locked ? 'bg-red-50' : ''}`}>\r\n                                <td className=\"py-3 px-3\">\r\n                                    <div className=\"font-bold text-gray-800\">{user.first_name} {user.last_name}</div>\r\n                                </td>\r\n                                <td className=\"py-3 px-3 text-gray-600\">{user.email}</td>\r\n                                <td className=\"py-3 px-3\">\r\n                                    {user.is_email_verified ? (\r\n                                        <span className=\"text-green-600 text-xs font-bold uppercase border border-green-200 bg-green-50 px-2 py-1 rounded\">Yes</span>\r\n                                    ) : (\r\n                                        <span className=\"text-orange-500 text-xs font-bold uppercase border border-orange-200 bg-orange-50 px-2 py-1 rounded\">Pending</span>\r\n                                    )}\r\n                                </td>\r\n                                <td className=\"py-3 px-3\">\r\n                                    {user.is_locked ? (\r\n                                        <span className=\"text-red-600 font-bold text-sm\">LOCKED</span>\r\n                                    ) : (\r\n                                        <span className=\"text-green-600 font-bold text-sm\">Active</span>\r\n                                    )}\r\n                                </td>\r\n                                <td className=\"py-3 px-3 text-right\">\r\n                                    <button\r\n                                        onClick={() => toggleLock(user)}\r\n                                        className={`text-sm font-semibold px-3 py-1 rounded border transition-colors ${user.is_locked\r\n                                            ? 'border-gray-300 text-gray-700 hover:bg-gray-100'\r\n                                            : 'border-red-200 text-red-600 hover:bg-red-50'\r\n                                            }`}\r\n                                    >\r\n                                        {user.is_locked ? 'Unlock' : 'Lock Account'}\r\n                                    </button>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                        {users.length === 0 && (\r\n                            <tr>\r\n                                <td colSpan=\"5\" className=\"py-8 text-center text-gray-400 italic\">\r\n                                    No registered users found.\r\n                                </td>\r\n                            </tr>\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default UserList;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\camping\\AdminMapTool.jsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":21,"column":33,"nodeType":"Identifier","endLine":21,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":22,"column":51,"nodeType":"Identifier","endLine":22,"endColumn":59},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":23,"column":43,"nodeType":"Identifier","endLine":23,"endColumn":51},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":24,"column":61,"nodeType":"Identifier","endLine":24,"endColumn":69},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":28,"column":41,"nodeType":"Identifier","endLine":28,"endColumn":49},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":29,"column":31,"nodeType":"Identifier","endLine":29,"endColumn":39},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":30,"column":35,"nodeType":"Identifier","endLine":30,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":31,"column":49,"nodeType":"Identifier","endLine":31,"endColumn":57},{"ruleId":"no-unused-vars","severity":2,"message":"'tempCoords' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":32,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"tempCoords"},"fix":{"range":[1174,1184],"text":""},"desc":"Remove unused variable 'tempCoords'."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":32,"column":41,"nodeType":"Identifier","endLine":32,"endColumn":49},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":33,"column":43,"nodeType":"Identifier","endLine":33,"endColumn":51},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":34,"column":49,"nodeType":"Identifier","endLine":34,"endColumn":57},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":37,"column":51,"nodeType":"Identifier","endLine":37,"endColumn":59},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":38,"column":43,"nodeType":"Identifier","endLine":38,"endColumn":51},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":39,"column":45,"nodeType":"Identifier","endLine":39,"endColumn":53},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":40,"column":39,"nodeType":"Identifier","endLine":40,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":43,"column":47,"nodeType":"Identifier","endLine":43,"endColumn":55},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":44,"column":37,"nodeType":"Identifier","endLine":44,"endColumn":45},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":45,"column":37,"nodeType":"Identifier","endLine":45,"endColumn":45},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":48,"column":5,"nodeType":"Identifier","endLine":48,"endColumn":14},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchEvents'. Either include it or remove the dependency array.","line":51,"column":8,"nodeType":"ArrayExpression","endLine":51,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchEvents]","fix":{"range":[1966,1968],"text":"[fetchEvents]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":54,"column":5,"nodeType":"Identifier","endLine":54,"endColumn":14},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":65,"column":5,"nodeType":"Identifier","endLine":65,"endColumn":14},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":140,"column":31,"nodeType":"Identifier","endLine":140,"endColumn":39},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":191,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":191,"endColumn":31},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":350,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":350,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":376,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":376,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":859,"column":90,"nodeType":"Identifier","messageId":"unusedVar","endLine":859,"endColumn":91}],"suppressedMessages":[],"errorCount":27,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { useNotification } from '../../context/NotificationContext';\r\n\r\nfunction AdminMapTool() {\r\n    const { user, token } = useAuth();\r\n    const { notify, confirm } = useNotification();\r\n    const navigate = useNavigate();\r\n\r\n    // Route Protection\r\n    useEffect(() => {\r\n        if (!user || user.role !== 'admin') {\r\n            navigate('/login');\r\n        }\r\n    }, [user, navigate]);\r\n\r\n    if (!user || user.role !== 'admin') return null; // Prevent flicker\r\n\r\n    // Selection State\r\n    const [events, setEvents] = useState([]);\r\n    const [selectedEventId, setSelectedEventId] = useState('');\r\n    const [campgrounds, setCampgrounds] = useState([]);\r\n    const [selectedCampgroundId, setSelectedCampgroundId] = useState(null);\r\n\r\n    // Map/Editor State\r\n    // Map/Editor State\r\n    const [campground, setCampground] = useState(null);\r\n    const [sites, setSites] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [selectedSiteId, setSelectedSiteId] = useState(null);\r\n    const [tempCoords, setTempCoords] = useState(null);\r\n    const [orgSettings, setOrgSettings] = useState(null);\r\n    const [nextSiteNumber, setNextSiteNumber] = useState(1);\r\n\r\n    // Create Campground Modal State\r\n    const [showCreateModal, setShowCreateModal] = useState(false);\r\n    const [newCampName, setNewCampName] = useState('');\r\n    const [selectedFile, setSelectedFile] = useState(null);\r\n    const [uploading, setUploading] = useState(false);\r\n\r\n    // Edit Modal State\r\n    const [showEditModal, setShowEditModal] = useState(false);\r\n    const [editData, setEditData] = useState({ id: null, name: '' });\r\n    const [editFile, setEditFile] = useState(null);\r\n\r\n    // Initial Load: Fetch Events & Settings\r\n    useEffect(() => {\r\n        fetchSettings();\r\n        fetchEvents();\r\n    }, []);\r\n\r\n    // When Event Changes: Fetch Campgrounds\r\n    useEffect(() => {\r\n        if (selectedEventId) {\r\n            fetchCampgrounds(selectedEventId);\r\n        } else {\r\n            setCampgrounds([]);\r\n            setSelectedCampgroundId(null);\r\n            setCampground(null);\r\n        }\r\n    }, [selectedEventId]);\r\n\r\n    // When Campground Changes: Fetch Map Data\r\n    useEffect(() => {\r\n        if (selectedCampgroundId) {\r\n            fetchCampgroundData(selectedCampgroundId);\r\n        } else {\r\n            setCampground(null);\r\n            setSites([]);\r\n        }\r\n    }, [selectedCampgroundId]);\r\n\r\n    const fetchSettings = async () => {\r\n        try {\r\n            const res = await fetch('/api/getOrganization');\r\n            if (res.ok) setOrgSettings(await res.json());\r\n        } catch (e) { console.error(e); }\r\n    };\r\n\r\n    const fetchEvents = async () => {\r\n        try {\r\n            const headers = {};\r\n            if (token) {\r\n                headers['Authorization'] = `Bearer ${token}`;\r\n                headers['X-Auth-Token'] = token;\r\n            }\r\n\r\n            const res = await fetch('/api/events', { headers });\r\n            if (res.ok) {\r\n                const list = await res.json();\r\n\r\n                // Sort by start_date ascending\r\n                const sorted = list.sort((a, b) => new Date(a.start_date) - new Date(b.start_date));\r\n                setEvents(sorted);\r\n\r\n                // Auto-select: First event where end_date >= today, or the last one (most recent)\r\n                if (sorted.length > 0) {\r\n                    const today = new Date();\r\n                    const active = sorted.find(e => new Date(e.end_date) >= today) || sorted[sorted.length - 1];\r\n                    // Only set if not already set (though this runs on mount, so it's fine)\r\n                    if (active) setSelectedEventId(active.event_id);\r\n                }\r\n            }\r\n        } catch (e) { console.error(e); }\r\n    };\r\n\r\n    const fetchCampgrounds = async (eventId) => {\r\n        try {\r\n            // Note: We need an endpoint to get campgrounds by Event ID. \r\n            // Reuse the public one: /api/events/:id/campgrounds (ignoring dates for admin view? or just listing them)\r\n            // Or assume /api/campgrounds lists all? The original code used /api/campgrounds.\r\n            // Let's assume we want to filter by event.\r\n            // If /api/campgrounds returns ALL, we filter client side.\r\n            // If /api/events/:id/campgrounds needs dates, we might need to fake them or make them optional.\r\n            // Let's try /api/events/:id/campgrounds first with wide dates, OR check if there's a simpler list endpoint.\r\n            // Actually, let's use the one we used in CampingPage: /api/events/:id/campgrounds\r\n            // But that requires dates to check availability.\r\n            // Admin just wants the STRUCTURE.\r\n\r\n            // Allow fallback: Fetch ALL /api/campgrounds and filter client side if the API supports it.\r\n            // Based on previous code: fetch('/api/campgrounds') returned a list.\r\n            const res = await fetch('/api/campgrounds');\r\n            if (res.ok) {\r\n                const list = await res.json();\r\n                // Filter by event_id if the API returns it.\r\n                // If not, we might show all. Let's inspect the `list` structure assumption.\r\n                // Assuming list has event_id.\r\n                const filtered = list.filter(c => c.event_id === parseInt(eventId));\r\n                setCampgrounds(filtered);\r\n                if (filtered.length > 0) {\r\n                    setSelectedCampgroundId(filtered[0].campground_id);\r\n                } else {\r\n                    setSelectedCampgroundId(null);\r\n                }\r\n            }\r\n        } catch (e) { console.error(e); }\r\n    };\r\n\r\n    const [error, setError] = useState(null);\r\n\r\n    // ... (existing code)\r\n\r\n    const fetchCampgroundData = async (id) => {\r\n        setLoading(true);\r\n        setError(null);\r\n        try {\r\n            const res = await fetch(`/api/campgrounds/${id}/sites`);\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setCampground(data.campground);\r\n\r\n                setSites(data.sites);\r\n                if (data.next_site_number) setNextSiteNumber(data.next_site_number);\r\n            } else {\r\n                const err = await res.json().catch(() => ({}));\r\n                setError(err.error || `Failed to load data (Status: ${res.status})`);\r\n                setCampground(null);\r\n            }\r\n        } catch (err) {\r\n            console.error(err);\r\n            setError(\"Network error: \" + err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDeleteCampground = async (id) => {\r\n        confirm(\"Are you sure you want to delete this campground? This cannot be undone.\", async () => {\r\n            try {\r\n                const res = await fetch(`/api/campgrounds/${id}`, {\r\n                    method: 'DELETE',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${token}`,\r\n                        'X-Auth-Token': token\r\n                    }\r\n                });\r\n                if (res.ok) {\r\n                    setCampgrounds(prev => prev.filter(c => c.campground_id !== id));\r\n                    if (selectedCampgroundId === id) {\r\n                        setSelectedCampgroundId(null);\r\n                        setCampground(null);\r\n                    }\r\n                    notify(\"Campground deleted\", \"success\");\r\n                } else {\r\n                    const text = await res.text();\r\n                    let errMsg = 'Failed to delete campground';\r\n                    try {\r\n                        const json = JSON.parse(text);\r\n                        errMsg = json.error || errMsg;\r\n                    } catch (e) {\r\n                        errMsg += ` (${res.status} ${res.statusText})`;\r\n                    }\r\n                    notify(errMsg, \"error\");\r\n                }\r\n            } catch (e) {\r\n                console.error(e);\r\n                notify('Error deleting campground', \"error\");\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleEditCampground = (id, currentName) => {\r\n        setEditData({ id, name: currentName });\r\n        setEditFile(null);\r\n        setShowEditModal(true);\r\n    };\r\n\r\n    const submitEdit = async () => {\r\n        if (!editData.name || !editData.id) return;\r\n\r\n        setUploading(true);\r\n        try {\r\n            let mapUrl = undefined;\r\n\r\n            if (editFile) {\r\n                const formData = new FormData();\r\n                formData.append('file', editFile);\r\n                const uploadRes = await fetch('/api/upload', {\r\n                    method: 'POST',\r\n                    body: formData\r\n                });\r\n                if (!uploadRes.ok) throw new Error('Upload failed');\r\n                const data = await uploadRes.json();\r\n                mapUrl = data.url;\r\n            }\r\n\r\n            const body = { name: editData.name };\r\n            if (mapUrl) body.map_image_url = mapUrl;\r\n\r\n            const res = await fetch(`/api/campgrounds/${editData.id}`, {\r\n                method: 'PUT',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify(body)\r\n            });\r\n\r\n            if (res.ok) {\r\n                setCampgrounds(prev => prev.map(c => c.campground_id === editData.id ? { ...c, name: editData.name } : c));\r\n                // If current campground, Refresh data to show new map\r\n                if (selectedCampgroundId === editData.id && mapUrl) {\r\n                    fetchCampgroundData(editData.id);\r\n                }\r\n                setShowEditModal(false);\r\n            } else {\r\n                const err = await res.json();\r\n                notify('Failed to update: ' + (err.error || 'Unknown error'), \"error\");\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            notify('Error updating campground', \"error\");\r\n        } finally {\r\n            setUploading(false);\r\n        }\r\n    };\r\n\r\n    const handleCreateCampground = async () => {\r\n        if (!newCampName || !selectedEventId) {\r\n            notify('Name and Event are required', \"error\");\r\n            return;\r\n        }\r\n\r\n        if (!selectedFile) {\r\n            notify('Please select a map image', \"error\");\r\n            return;\r\n        }\r\n\r\n        setUploading(true);\r\n        try {\r\n            // 1. Upload Image\r\n            const formData = new FormData();\r\n            formData.append('file', selectedFile);\r\n\r\n            const uploadRes = await fetch('/api/upload', {\r\n                method: 'POST',\r\n                body: formData\r\n            });\r\n\r\n            if (!uploadRes.ok) {\r\n                const err = await uploadRes.json();\r\n                throw new Error(err.error || 'Upload failed');\r\n            }\r\n\r\n            const { url } = await uploadRes.json();\r\n\r\n            // 2. Create Campground\r\n            const res = await fetch('/api/campgrounds', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({\r\n                    event_id: selectedEventId,\r\n                    name: newCampName,\r\n                    map_image_url: url\r\n                })\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setShowCreateModal(false);\r\n                setNewCampName('');\r\n                setSelectedFile(null);\r\n                await fetchCampgrounds(selectedEventId);\r\n                if (data.campground_id) {\r\n                    setSelectedCampgroundId(data.campground_id);\r\n                }\r\n            } else {\r\n                notify('Failed to create campground', \"error\");\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            notify('Error: ' + e.message, \"error\");\r\n        } finally {\r\n            setUploading(false);\r\n        }\r\n    };\r\n\r\n    // --- Editor Handlers (Same as before) ---\r\n\r\n    const handleBulkAdd = async (qty, prefix, startNum) => {\r\n        if (!selectedCampgroundId) return;\r\n        try {\r\n            const res = await fetch(`/api/campgrounds/${selectedCampgroundId}/sites`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({\r\n                    count: parseInt(qty),\r\n                    prefix,\r\n                    start_number: startNum,\r\n                    price: parseFloat(document.getElementById('addPrice').value) || 0,\r\n                    full_event_price: parseFloat(document.getElementById('addFullPrice').value) || 0,\r\n                    extra_adult_price_per_night: parseFloat(document.getElementById('addExtraDaily').value) || 0,\r\n                    extra_adult_full_event_price: parseFloat(document.getElementById('addExtraFull').value) || 0\r\n                })\r\n            });\r\n            if (res.ok) {\r\n                fetchCampgroundData(selectedCampgroundId);\r\n                // Clear inputs\r\n                document.getElementById('addQty').value = '1';\r\n            } else { alert('Failed to add sites'); }\r\n        } catch (e) { alert('Error adding sites'); }\r\n    };\r\n\r\n    const handleSingleAdd = async (name, price) => {\r\n        if (!selectedCampgroundId || !name) return;\r\n        try {\r\n            const res = await fetch(`/api/campgrounds/${selectedCampgroundId}/sites`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({\r\n                    count: 1, // Dummy\r\n                    price: parseFloat(price) || 0,\r\n                    full_event_price: parseFloat(document.getElementById('singleFullPrice').value) || 0,\r\n                    extra_adult_price_per_night: parseFloat(document.getElementById('singleExtraDaily').value) || 0,\r\n                    extra_adult_full_event_price: parseFloat(document.getElementById('singleExtraFull').value) || 0,\r\n                    specific_names: [name]\r\n                })\r\n            });\r\n            if (res.ok) {\r\n                fetchCampgroundData(selectedCampgroundId);\r\n                document.getElementById('singleName').value = '';\r\n            } else { alert('Failed to add site'); }\r\n        } catch (e) { alert('Error adding site'); }\r\n    };\r\n\r\n    const handleRename = (id, newName) => {\r\n        setSites(prev => prev.map(s => s.campsite_id === id ? { ...s, site_number: newName } : s));\r\n    };\r\n\r\n    const handleNameBlur = async (id, newName) => {\r\n        try {\r\n            await fetch(`/api/campsites/${id}`, {\r\n                method: 'PUT',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({ site_number: newName })\r\n            });\r\n        } catch (e) { console.error(e); }\r\n    };\r\n\r\n    const handlePriceChange = (id, newPrice) => {\r\n        setSites(prev => prev.map(s => s.campsite_id === id ? { ...s, price_per_night: newPrice } : s));\r\n    };\r\n\r\n    const handlePriceBlur = async (id, newPrice) => {\r\n        try {\r\n            await fetch(`/api/campsites/${id}`, {\r\n                method: 'PUT',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({ price_per_night: parseFloat(newPrice) })\r\n            });\r\n        } catch (e) { console.error(e); }\r\n    };\r\n\r\n    const handleFullPriceChange = (id, newPrice) => {\r\n        setSites(prev => prev.map(s => s.campsite_id === id ? { ...s, full_event_price: newPrice } : s));\r\n    };\r\n\r\n    const handleFullPriceBlur = async (id, newPrice) => {\r\n        try {\r\n            await fetch(`/api/campsites/${id}`, {\r\n                method: 'PUT',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({ full_event_price: parseFloat(newPrice) })\r\n            });\r\n        } catch (e) { console.error(e); }\r\n    };\r\n\r\n    const handleExtraAdultPriceChange = (id, newPrice) => {\r\n        setSites(prev => prev.map(s => s.campsite_id === id ? { ...s, extra_adult_price_per_night: newPrice } : s));\r\n    };\r\n\r\n    const handleExtraAdultPriceBlur = async (id, newPrice) => {\r\n        try {\r\n            await fetch(`/api/campsites/${id}`, {\r\n                method: 'PUT',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({ extra_adult_price_per_night: parseFloat(newPrice) })\r\n            });\r\n        } catch (e) { console.error(e); }\r\n    };\r\n\r\n    const handleExtraAdultFullPriceChange = (id, newPrice) => {\r\n        setSites(prev => prev.map(s => s.campsite_id === id ? { ...s, extra_adult_full_event_price: newPrice } : s));\r\n    };\r\n\r\n    const handleExtraAdultFullPriceBlur = async (id, newPrice) => {\r\n        try {\r\n            await fetch(`/api/campsites/${id}`, {\r\n                method: 'PUT',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({ extra_adult_full_event_price: parseFloat(newPrice) })\r\n            });\r\n        } catch (e) { console.error(e); }\r\n    };\r\n\r\n\r\n\r\n    const handleDelete = async (id) => {\r\n        confirm('Delete this site?', async () => {\r\n            try {\r\n                const res = await fetch(`/api/campsites/${id}`, {\r\n                    method: 'DELETE',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${token}`,\r\n                        'X-Auth-Token': token\r\n                    }\r\n                });\r\n                if (res.ok) {\r\n                    setSites(prev => prev.filter(s => s.campsite_id !== id));\r\n                    setSelectedSiteId(null);\r\n                    notify(\"Site deleted\", \"success\");\r\n                }\r\n            } catch (e) { console.error(e); }\r\n        });\r\n    };\r\n\r\n    const handleMapClick = (e) => {\r\n        if (!selectedSiteId) return;\r\n        const rect = e.target.getBoundingClientRect();\r\n        const x = ((e.clientX - rect.left) / rect.width) * 100;\r\n        const y = ((e.clientY - rect.top) / rect.height) * 100;\r\n        const xFixed = parseFloat(x.toFixed(1));\r\n        const yFixed = parseFloat(y.toFixed(1));\r\n        setTempCoords({ x: xFixed, y: yFixed });\r\n        saveCoords(selectedSiteId, { x: xFixed, y: yFixed });\r\n    };\r\n\r\n    const saveCoords = async (siteId, coords) => {\r\n        try {\r\n            const res = await fetch(`/api/campsites/${siteId}/coords`, {\r\n                method: 'PUT',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'X-Auth-Token': token\r\n                },\r\n                body: JSON.stringify({ map_coordinates: coords })\r\n            });\r\n            if (res.ok) {\r\n                setSites(prev => prev.map(s => s.campsite_id === siteId ? { ...s, map_coordinates: coords ? JSON.stringify(coords) : null } : s));\r\n                setTempCoords(null);\r\n            } else {\r\n                const err = await res.json();\r\n                notify(`Failed to save: ${err.error || 'Unknown error'}`, \"error\");\r\n            }\r\n        } catch (err) { notify('Error saving: ' + err.message, \"error\"); }\r\n    };\r\n\r\n    return (\r\n        <div style={{ display: 'flex', flexDirection: 'column', height: 'calc(100vh - 140px)' }}>\r\n            {/* Top Toolbar */}\r\n            <div style={{ padding: '15px', borderBottom: '1px solid #ddd', background: '#fff', display: 'flex', gap: '20px', alignItems: 'center' }}>\r\n                <h2 style={{ margin: 0 }}>Admin Map Tool</h2>\r\n                <select\r\n                    value={selectedEventId}\r\n                    onChange={e => setSelectedEventId(e.target.value)}\r\n                    style={{ padding: '8px', fontSize: '1rem' }}\r\n                >\r\n                    <option value=\"\">-- Select Event --</option>\r\n                    {events.map(e => (\r\n                        <option key={e.event_id} value={e.event_id}>{e.name}</option>\r\n                    ))}\r\n                </select>\r\n\r\n                {selectedEventId && (\r\n                    <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>\r\n                        {campgrounds.length > 0 && campgrounds.map(cg => (\r\n                            <div key={cg.campground_id} style={{ position: 'relative', display: 'flex' }}>\r\n                                <button\r\n                                    onClick={() => setSelectedCampgroundId(cg.campground_id)}\r\n                                    style={{\r\n                                        padding: '8px 16px',\r\n                                        background: selectedCampgroundId === cg.campground_id ? 'var(--primary-color, black)' : '#eee',\r\n                                        color: selectedCampgroundId === cg.campground_id ? 'white' : 'black',\r\n                                        border: 'none',\r\n                                        borderRadius: '4px 0 0 4px',\r\n                                        cursor: 'pointer'\r\n                                    }}\r\n                                >\r\n                                    {cg.name}\r\n                                </button>\r\n                                {selectedCampgroundId === cg.campground_id && (\r\n                                    <>\r\n                                        <button\r\n                                            onClick={() => handleEditCampground(cg.campground_id, cg.name)}\r\n                                            style={{\r\n                                                padding: '8px 10px',\r\n                                                background: '#ffc107',\r\n                                                color: 'black',\r\n                                                border: 'none',\r\n                                                cursor: 'pointer',\r\n                                                borderLeft: '1px solid rgba(0,0,0,0.1)'\r\n                                            }}\r\n                                            title=\"Edit Campground\"\r\n                                        >\r\n                                            ‚úèÔ∏è\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => handleDeleteCampground(cg.campground_id)}\r\n                                            style={{\r\n                                                padding: '8px 10px',\r\n                                                background: '#dc3545',\r\n                                                color: 'white',\r\n                                                border: 'none',\r\n                                                borderRadius: '0 4px 4px 0',\r\n                                                cursor: 'pointer',\r\n                                                borderLeft: '1px solid rgba(0,0,0,0.1)'\r\n                                            }}\r\n                                            title=\"Delete Campground\"\r\n                                        >\r\n                                            üóëÔ∏è\r\n                                        </button>\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                        ))}\r\n                        <button\r\n                            onClick={() => setShowCreateModal(true)}\r\n                            style={{ padding: '8px 12px', background: '#28a745', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '1.2rem', lineHeight: '1', marginLeft: '5px' }}\r\n                            title=\"Add Campground\"\r\n                        >\r\n                            +\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Main Content */}\r\n            {!selectedCampgroundId ? (\r\n                <div style={{ padding: '50px', textAlign: 'center', color: '#666' }}>\r\n                    {selectedEventId ? 'Select a campground to edit.' : 'Please select an event to get started.'}\r\n                </div>\r\n            ) : loading ? (\r\n                <div style={{ padding: '50px' }}>Loading Data...</div>\r\n            ) : error ? (\r\n                <div style={{ padding: '50px', color: 'red' }}>\r\n                    <h3>Error</h3>\r\n                    <p>{error}</p>\r\n                </div>\r\n            ) : !campground ? (\r\n                <div style={{ padding: '50px' }}>Campground not found.</div>\r\n            ) : (\r\n                <div style={{ flex: 1, display: 'flex', overflow: 'hidden', minHeight: 0 }}>\r\n\r\n                    {/* Sidebar Editor */}\r\n                    <div style={{ width: '320px', minWidth: '320px', borderRight: '1px solid #eee', display: 'flex', flexDirection: 'column', background: '#fafafa', flexShrink: 0, zIndex: 20, position: 'relative', boxShadow: '2px 0 5px rgba(0,0,0,0.1)', overflowY: 'auto' }}>\r\n\r\n                        {/* Bulk Add (Styled with Labels) */}\r\n                        <div style={{ padding: '15px', borderBottom: '1px solid #ddd', background: '#fff' }}>\r\n                            {/* Bulk Create Section */}\r\n                            <h4 style={{ marginTop: 0, marginBottom: '10px', color: '#333' }}>Bulk Create</h4>\r\n                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '10px', marginBottom: '10px' }}>\r\n                                <div>\r\n                                    <label style={{ fontSize: '0.75rem', fontWeight: 'bold', display: 'block', marginBottom: '4px' }}>Qty</label>\r\n                                    <input id=\"addQty\" type=\"number\" defaultValue=\"1\" style={{ width: '100%', padding: '6px', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n                                </div>\r\n                                <div>\r\n                                    <label style={{ fontSize: '0.75rem', fontWeight: 'bold', display: 'block', marginBottom: '4px' }}>Prefix (Opt)</label>\r\n                                    <input id=\"addPrefix\" type=\"text\" style={{ width: '100%', padding: '6px', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n                                </div>\r\n                                <div>\r\n                                    <label style={{ fontSize: '0.75rem', fontWeight: 'bold', display: 'block', marginBottom: '4px' }}>Start #</label>\r\n                                    <input id=\"addStartNum\" type=\"number\" defaultValue={nextSiteNumber} key={nextSiteNumber} style={{ width: '100%', padding: '6px', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px', marginBottom: '10px' }}>\r\n                                <div>\r\n                                    <label style={{ fontSize: '0.75rem', fontWeight: 'bold', display: 'block', marginBottom: '4px' }}>Ex. Adult Daily</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '8px', top: '50%', transform: 'translateY(-50%)', color: '#666' }}>$</span>\r\n                                        <input id=\"addExtraDaily\" type=\"number\" defaultValue=\"0\" style={{ width: '100%', padding: '6px 6px 6px 20px', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <label style={{ fontSize: '0.75rem', fontWeight: 'bold', display: 'block', marginBottom: '4px' }}>Ex. Adult Full</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '8px', top: '50%', transform: 'translateY(-50%)', color: '#666' }}>$</span>\r\n                                        <input id=\"addExtraFull\" type=\"number\" defaultValue=\"0\" style={{ width: '100%', padding: '6px 6px 6px 20px', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px', marginBottom: '10px' }}>\r\n                                <div>\r\n                                    <label style={{ fontSize: '0.75rem', fontWeight: 'bold', display: 'block', marginBottom: '4px' }}>Daily Price</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '8px', top: '50%', transform: 'translateY(-50%)', color: '#666' }}>$</span>\r\n                                        <input id=\"addPrice\" type=\"number\" defaultValue=\"0\" style={{ width: '100%', padding: '6px 6px 6px 20px', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <label style={{ fontSize: '0.75rem', fontWeight: 'bold', display: 'block', marginBottom: '4px' }}>Full Event Price</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '8px', top: '50%', transform: 'translateY(-50%)', color: '#666' }}>$</span>\r\n                                        <input id=\"addFullPrice\" type=\"number\" defaultValue=\"0\" style={{ width: '100%', padding: '6px 6px 6px 20px', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <button\r\n                                onClick={() => handleBulkAdd(\r\n                                    document.getElementById('addQty').value,\r\n                                    document.getElementById('addPrefix').value,\r\n                                    document.getElementById('addStartNum').value\r\n                                )}\r\n                                style={{ width: '100%', background: '#333', color: 'white', border: 'none', padding: '8px', borderRadius: '4px', cursor: 'pointer', fontWeight: 'bold' }}\r\n                            >\r\n                                Add Sites\r\n                            </button>\r\n\r\n                            <hr style={{ margin: '20px 0', border: 'none', borderTop: '1px solid #eee' }} />\r\n\r\n                            {/* Single Site Section */}\r\n                            <h4 style={{ marginTop: 0, marginBottom: '10px', color: '#333' }}>Single Site</h4>\r\n                            <div style={{ marginBottom: '10px' }}>\r\n                                <label style={{ fontSize: '0.75rem', fontWeight: 'bold', display: 'block', marginBottom: '4px' }}>Site Name</label>\r\n                                <input id=\"singleName\" type=\"text\" placeholder=\"e.g. 5A\" style={{ width: '100%', padding: '6px', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n                            </div>\r\n                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px', marginBottom: '10px' }}>\r\n                                <div>\r\n                                    <label style={{ fontSize: '0.75rem', fontWeight: 'bold', display: 'block', marginBottom: '4px' }}>Ex. Adult Daily</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '8px', top: '50%', transform: 'translateY(-50%)', color: '#666' }}>$</span>\r\n                                        <input id=\"singleExtraDaily\" type=\"number\" defaultValue=\"0\" style={{ width: '100%', padding: '6px 6px 6px 20px', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <label style={{ fontSize: '0.75rem', fontWeight: 'bold', display: 'block', marginBottom: '4px' }}>Ex. Adult Full</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '8px', top: '50%', transform: 'translateY(-50%)', color: '#666' }}>$</span>\r\n                                        <input id=\"singleExtraFull\" type=\"number\" defaultValue=\"0\" style={{ width: '100%', padding: '6px 6px 6px 20px', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px', marginBottom: '10px' }}>\r\n                                <div>\r\n                                    <label style={{ fontSize: '0.75rem', fontWeight: 'bold', display: 'block', marginBottom: '4px' }}>Daily Price</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '8px', top: '50%', transform: 'translateY(-50%)', color: '#666' }}>$</span>\r\n                                        <input id=\"singlePrice\" type=\"number\" defaultValue=\"0\" style={{ width: '100%', padding: '6px 6px 6px 20px', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <label style={{ fontSize: '0.75rem', fontWeight: 'bold', display: 'block', marginBottom: '4px' }}>Full Event Price</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '8px', top: '50%', transform: 'translateY(-50%)', color: '#666' }}>$</span>\r\n                                        <input id=\"singleFullPrice\" type=\"number\" defaultValue=\"0\" style={{ width: '100%', padding: '6px 6px 6px 20px', border: '1px solid #ccc', borderRadius: '4px' }} />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <button\r\n                                onClick={() => handleSingleAdd(\r\n                                    document.getElementById('singleName').value,\r\n                                    document.getElementById('singlePrice').value\r\n                                )}\r\n                                style={{ width: '100%', background: '#007bff', color: 'white', border: 'none', padding: '8px', borderRadius: '4px', cursor: 'pointer', fontWeight: 'bold' }}\r\n                            >\r\n                                Add Site\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* Selected Site Editor */}\r\n                        {selectedSiteId && (\r\n                            <div style={{ padding: '20px', background: '#eef', borderBottom: '1px solid #dde' }}>\r\n                                <h4 style={{ marginTop: 0 }}>Editing Site</h4>\r\n                                <div style={{ marginBottom: '10px' }}>\r\n                                    <label style={{ fontSize: '0.8rem', fontWeight: 'bold' }}>Name</label>\r\n                                    <input\r\n                                        style={{ width: '100%', padding: '5px', border: '1px solid #ced4da', borderRadius: '4px' }}\r\n                                        value={sites.find(s => s.campsite_id === selectedSiteId)?.site_number || ''}\r\n                                        onChange={e => handleRename(selectedSiteId, e.target.value)}\r\n                                        onBlur={e => handleNameBlur(selectedSiteId, e.target.value)}\r\n                                    />\r\n                                </div>\r\n                                <div style={{ marginBottom: '10px' }}>\r\n                                    <label style={{ fontSize: '0.8rem', fontWeight: 'bold' }}>Price (Daily)</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '10px', top: '50%', transform: 'translateY(-50%)', color: '#666' }}>$</span>\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            style={{ width: '100%', padding: '5px 5px 5px 25px', border: '1px solid #ced4da', borderRadius: '4px' }}\r\n                                            value={sites.find(s => s.campsite_id === selectedSiteId)?.price_per_night || ''}\r\n                                            onChange={e => handlePriceChange(selectedSiteId, e.target.value)}\r\n                                            onBlur={e => handlePriceBlur(selectedSiteId, e.target.value)}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div style={{ marginBottom: '10px' }}>\r\n                                    <label style={{ fontSize: '0.8rem', fontWeight: 'bold' }}>Full Event Price</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '10px', top: '50%', transform: 'translateY(-50%)', color: '#666' }}>$</span>\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            style={{ width: '100%', padding: '5px 5px 5px 25px', border: '1px solid #ced4da', borderRadius: '4px' }}\r\n                                            value={sites.find(s => s.campsite_id === selectedSiteId)?.full_event_price || ''}\r\n                                            onChange={e => handleFullPriceChange(selectedSiteId, e.target.value)}\r\n                                            onBlur={e => handleFullPriceBlur(selectedSiteId, e.target.value)}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div style={{ marginBottom: '10px' }}>\r\n                                    <label style={{ fontSize: '0.8rem', fontWeight: 'bold' }}>Extra Adult (Daily)</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '10px', top: '50%', transform: 'translateY(-50%)', color: '#666' }}>$</span>\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            style={{ width: '100%', padding: '5px 5px 5px 25px', border: '1px solid #ced4da', borderRadius: '4px' }}\r\n                                            value={sites.find(s => s.campsite_id === selectedSiteId)?.extra_adult_price_per_night || ''}\r\n                                            onChange={e => handleExtraAdultPriceChange(selectedSiteId, e.target.value)}\r\n                                            onBlur={e => handleExtraAdultPriceBlur(selectedSiteId, e.target.value)}\r\n                                            placeholder=\"0.00\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div style={{ marginBottom: '10px' }}>\r\n                                    <label style={{ fontSize: '0.8rem', fontWeight: 'bold' }}>Extra Adult (Full)</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '10px', top: '50%', transform: 'translateY(-50%)', color: '#666' }}>$</span>\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            style={{ width: '100%', padding: '5px 5px 5px 25px', border: '1px solid #ced4da', borderRadius: '4px' }}\r\n                                            value={sites.find(s => s.campsite_id === selectedSiteId)?.extra_adult_full_event_price || ''}\r\n                                            onChange={e => handleExtraAdultFullPriceChange(selectedSiteId, e.target.value)}\r\n                                            onBlur={e => handleExtraAdultFullPriceBlur(selectedSiteId, e.target.value)}\r\n                                            placeholder=\"0.00\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div style={{ display: 'flex', gap: '10px' }}>\r\n                                    <button onClick={() => handleDelete(selectedSiteId)} style={{ cursor: 'pointer', padding: '5px 10px', color: 'red' }}>Delete</button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Site List */}\r\n                        <div style={{ padding: '10px' }}>\r\n                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '5px' }}>\r\n                                {sites.map(site => {\r\n                                    const hasCoords = !!site.map_coordinates;\r\n                                    const isSelected = selectedSiteId === site.campsite_id;\r\n                                    const bg = hasCoords ? (orgSettings?.accent_color || '#d4edda') : '#fff3cd';\r\n\r\n                                    return (\r\n                                        <div\r\n                                            key={site.campsite_id}\r\n                                            onClick={() => setSelectedSiteId(site.campsite_id)}\r\n                                            style={{\r\n                                                aspectRatio: '1',\r\n                                                display: 'flex',\r\n                                                alignItems: 'center',\r\n                                                justifyContent: 'center',\r\n                                                fontSize: '0.8rem',\r\n                                                background: bg,\r\n                                                border: isSelected ? '2px solid blue' : '1px solid #ddd',\r\n                                                borderRadius: '4px',\r\n                                                cursor: 'pointer',\r\n                                                textAlign: 'center'\r\n                                            }}\r\n                                        >\r\n                                            {site.site_number}\r\n                                        </div>\r\n                                    )\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n\r\n                    {/* Map Area */}\r\n                    <div style={{ flex: 1, position: 'relative', background: '#ccc', overflow: 'hidden', minHeight: 0 }}>\r\n                        <div style={{ width: '100%', height: '100%', overflow: 'auto', position: 'relative' }}>\r\n                            <div style={{ position: 'relative', display: 'block', minWidth: '1500px', width: '100%' }}>\r\n                                <img\r\n                                    src={campground.map_image_url}\r\n                                    onClick={handleMapClick}\r\n                                    alt=\"Map\"\r\n                                    style={{\r\n                                        display: 'block',\r\n                                        cursor: selectedSiteId ? 'crosshair' : 'default',\r\n                                        width: '100%',\r\n                                        height: 'auto'\r\n                                    }}\r\n                                />\r\n                                {sites.map(site => {\r\n                                    if (!site.map_coordinates) return null;\r\n                                    let c;\r\n                                    try { c = JSON.parse(site.map_coordinates); } catch (e) { return null; }\r\n                                    if (!c) return null;\r\n                                    return (\r\n                                        <div\r\n                                            key={site.campsite_id}\r\n                                            onClick={(e) => { e.stopPropagation(); setSelectedSiteId(site.campsite_id); }}\r\n                                            style={{\r\n                                                position: 'absolute',\r\n                                                left: `${c.x}%`,\r\n                                                top: `${c.y}%`,\r\n                                                width: '20px',\r\n                                                height: '20px',\r\n                                                background: orgSettings?.primary_color || 'blue',\r\n                                                borderRadius: '50%',\r\n                                                transform: selectedSiteId === site.campsite_id ? 'translate(-50%, -50%) scale(1.3)' : 'translate(-50%, -50%)',\r\n                                                border: selectedSiteId === site.campsite_id ? '3px solid #FFD700' : '2px solid white',\r\n                                                cursor: 'pointer',\r\n                                                zIndex: selectedSiteId === site.campsite_id ? 100 : 1,\r\n                                                boxShadow: selectedSiteId === site.campsite_id ? '0 0 15px #FFD700, 0 0 5px black' : '0 2px 4px rgba(0,0,0,0.5)'\r\n                                            }}\r\n                                            title={site.site_number}\r\n                                        />\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Overlay Instructions */}\r\n\r\n                    </div>\r\n\r\n\r\n                </div>\r\n            )}\r\n\r\n            {/* Create Campground Modal */}\r\n            {\r\n                showCreateModal && (\r\n                    <div style={{\r\n                        position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,\r\n                        background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 9999\r\n                    }}>\r\n                        <div style={{ background: 'white', padding: '20px', borderRadius: '8px', width: '400px' }}>\r\n                            <h3>Add Campground</h3>\r\n                            <div style={{ marginBottom: '10px' }}>\r\n                                <label>Name:</label>\r\n                                <input\r\n                                    style={{ width: '100%', padding: '5px' }}\r\n                                    value={newCampName}\r\n                                    onChange={e => setNewCampName(e.target.value)}\r\n                                    placeholder=\"e.g. North Field\"\r\n                                />\r\n                            </div>\r\n                            <div style={{ marginBottom: '10px' }}>\r\n                                <label>Map Image:</label>\r\n                                <input\r\n                                    type=\"file\"\r\n                                    accept=\"image/*\"\r\n                                    onChange={e => setSelectedFile(e.target.files[0])}\r\n                                    style={{ width: '100%', padding: '5px' }}\r\n                                />\r\n                            </div>\r\n                            <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px', marginTop: '20px' }}>\r\n                                <button onClick={() => setShowCreateModal(false)} disabled={uploading} style={{ padding: '8px 16px' }}>Cancel</button>\r\n                                <button onClick={handleCreateCampground} disabled={uploading} style={{ padding: '8px 16px', background: 'var(--primary-color, black)', color: 'white', border: 'none' }}>\r\n                                    {uploading ? 'Uploading...' : 'Create'}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n            {/* Edit Campground Modal */}\r\n            {\r\n                showEditModal && (\r\n                    <div style={{\r\n                        position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,\r\n                        background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 9999\r\n                    }}>\r\n                        <div style={{ background: 'white', padding: '20px', borderRadius: '8px', width: '400px' }}>\r\n                            <h3>Edit Campground</h3>\r\n                            <div style={{ marginBottom: '10px' }}>\r\n                                <label>Name:</label>\r\n                                <input\r\n                                    style={{ width: '100%', padding: '8px', border: '1px solid #ccc', borderRadius: '4px' }}\r\n                                    value={editData.name}\r\n                                    onChange={e => setEditData({ ...editData, name: e.target.value })}\r\n                                />\r\n                            </div>\r\n                            <div style={{ marginBottom: '10px' }}>\r\n                                <label>Update Map Image (Optional):</label>\r\n                                <input\r\n                                    type=\"file\"\r\n                                    accept=\"image/*\"\r\n                                    onChange={e => setEditFile(e.target.files[0])}\r\n                                    style={{ width: '100%', padding: '5px' }}\r\n                                />\r\n                            </div>\r\n                            <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px', marginTop: '20px' }}>\r\n                                <button onClick={() => setShowEditModal(false)} disabled={uploading} style={{ padding: '8px 16px' }}>Cancel</button>\r\n                                <button onClick={submitEdit} disabled={uploading} style={{ padding: '8px 16px', background: 'var(--primary-color, black)', color: 'white', border: 'none' }}>\r\n                                    {uploading ? 'Saving...' : 'Save'}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default AdminMapTool;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\pages\\camping\\CampingPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'token' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":12,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"token"},"fix":{"range":[481,488],"text":""},"desc":"Remove unused variable 'token'."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":24,"column":39,"nodeType":"Identifier","endLine":24,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":27,"column":35,"nodeType":"Identifier","endLine":27,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":28,"column":39,"nodeType":"Identifier","endLine":28,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":29,"column":31,"nodeType":"Identifier","endLine":29,"endColumn":39},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":30,"column":43,"nodeType":"Identifier","endLine":30,"endColumn":51},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":31,"column":55,"nodeType":"Identifier","endLine":31,"endColumn":63},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":32,"column":43,"nodeType":"Identifier","endLine":32,"endColumn":51},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":33,"column":57,"nodeType":"Identifier","endLine":33,"endColumn":65},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":34,"column":37,"nodeType":"Identifier","endLine":34,"endColumn":45},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":36,"column":35,"nodeType":"Identifier","endLine":36,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":37,"column":45,"nodeType":"Identifier","endLine":37,"endColumn":53},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":38,"column":43,"nodeType":"Identifier","endLine":38,"endColumn":51},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":41,"column":33,"nodeType":"Identifier","endLine":41,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":42,"column":37,"nodeType":"Identifier","endLine":42,"endColumn":45},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":45,"column":5,"nodeType":"Identifier","endLine":45,"endColumn":14},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchEventDetails'. Either include it or remove the dependency array.","line":67,"column":8,"nodeType":"ArrayExpression","endLine":67,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [slug, isIndex, embedded, event, fetchEventDetails]","fix":{"range":[2629,2661],"text":"[slug, isIndex, embedded, event, fetchEventDetails]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":70,"column":5,"nodeType":"Identifier","endLine":70,"endColumn":14},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAvailability'. Either include it or remove the dependency array.","line":74,"column":8,"nodeType":"ArrayExpression","endLine":74,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [eventId, dates, isIndex, fetchAvailability]","fix":{"range":[2862,2887],"text":"[eventId, dates, isIndex, fetchAvailability]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":133,"column":5,"nodeType":"Identifier","endLine":133,"endColumn":14},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":351,"column":110,"nodeType":"Identifier","messageId":"unusedVar","endLine":351,"endColumn":111}],"suppressedMessages":[],"errorCount":19,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate, Link } from 'react-router-dom';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { useCart } from '../../context/CartContext';\r\nimport CampingListView from '../../components/CampingListView';\r\n\r\nimport AdminMapTool from './AdminMapTool';\r\n\r\nfunction CampingPage({ embedded = false, event = null }) {\r\n    const { slug } = useParams();\r\n    const navigate = useNavigate();\r\n    const { user, token } = useAuth();\r\n    const { addToCart, cart, cartTotal } = useCart();\r\n\r\n    // Mode: \"Index\" (no slug) vs \"Detail\" (slug)\r\n    const isIndex = !slug;\r\n\r\n    // Admin View Redirect (Dashboard)\r\n    if (isIndex && user?.role === 'admin') {\r\n        return <AdminMapTool />;\r\n    }\r\n\r\n    // Index State\r\n    const [allEvents, setAllEvents] = useState([]);\r\n\r\n    // Detail State\r\n    const [eventId, setEventId] = useState(null);\r\n    const [eventName, setEventName] = useState('');\r\n    const [dates, setDates] = useState({ start: '', end: '' });\r\n    const [eventBounds, setEventBounds] = useState({ start: '', end: '' });\r\n    const [useFullEventPrice, setUseFullEventPrice] = useState(false);\r\n    const [campgrounds, setCampgrounds] = useState([]); // [{ id, name, sites: [] }]\r\n    const [activeCampgroundId, setActiveCampgroundId] = useState(null);\r\n    const [viewMode, setViewMode] = useState('map'); // 'map' | 'list'\r\n\r\n    const [loading, setLoading] = useState(true);\r\n    const [selectedSite, setSelectedSite] = useState(null); // { campsite_id, ... }\r\n    const [cartMessage, setCartMessage] = useState('');\r\n\r\n    // Guest State\r\n    const [adults, setAdults] = useState(1);\r\n    const [children, setChildren] = useState(0);\r\n\r\n    // --- EFFECT: Load Data ---\r\n    useEffect(() => {\r\n        setLoading(true);\r\n        if (isIndex && !embedded) {\r\n            fetchEventsIndex();\r\n        } else if (embedded && event) {\r\n            // Use passed event data\r\n            setEventId(event.event_id || event.id || event.eventId);\r\n            setEventName(event.name || event.eventName);\r\n\r\n            const s = event.start_date || event.eventStartDate;\r\n            const e = event.end_date || event.eventEndDate;\r\n\r\n            if (s && e) {\r\n                const startRaw = s.split('T')[0];\r\n                const endRaw = e.split('T')[0];\r\n                setDates({ start: startRaw, end: endRaw });\r\n                setEventBounds({ start: startRaw, end: endRaw });\r\n            }\r\n            // Don't set loading false yet, we need availability\r\n        } else {\r\n            fetchEventDetails();\r\n        }\r\n    }, [slug, isIndex, embedded, event]);\r\n\r\n    // --- EFFECT: Load Availability (Detail Mode) ---\r\n    useEffect(() => {\r\n        if (!isIndex && eventId && dates.start && dates.end) {\r\n            fetchAvailability();\r\n        }\r\n    }, [eventId, dates, isIndex]);\r\n\r\n    // --- API: Index ---\r\n    const fetchEventsIndex = async () => {\r\n        try {\r\n            const res = await fetch('/api/events');\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                // Filter for Current & Upcoming\r\n                const now = new Date();\r\n                const relevant = data.filter(e => new Date(e.end_date) >= now);\r\n                setAllEvents(relevant);\r\n            }\r\n        } catch (e) { console.error(e); }\r\n        finally { setLoading(false); }\r\n    };\r\n\r\n    // --- API: Details ---\r\n    const fetchEventDetails = async () => {\r\n        try {\r\n            const res = await fetch(`/api/events/${slug}`);\r\n            if (res.ok) {\r\n                const event = await res.json();\r\n                if (event) {\r\n                    setEventId(event.event_id);\r\n                    setEventName(event.name);\r\n                    const startRaw = event.start_date.split('T')[0];\r\n                    const endRaw = event.end_date.split('T')[0];\r\n                    setDates({ start: startRaw, end: endRaw });\r\n                    setEventBounds({ start: startRaw, end: endRaw });\r\n                }\r\n            }\r\n        } catch (e) { console.error(e); }\r\n        // Loading continues until availability ensures campgrounds are loaded\r\n    };\r\n\r\n    const fetchAvailability = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch(`/api/events/${eventId}/campgrounds?start_date=${dates.start}&end_date=${dates.end}`);\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setCampgrounds(data.campgrounds);\r\n                // Store the full event period from API (for date grid columns)\r\n                if (data.event_start && data.event_end) {\r\n                    setEventBounds({ start: data.event_start, end: data.event_end });\r\n                }\r\n                // Set default active tab\r\n                if (data.campgrounds.length > 0) {\r\n                    setActiveCampgroundId(data.campgrounds[0].campground_id);\r\n                }\r\n            }\r\n        } catch (e) { console.error(e); }\r\n        finally { setLoading(false); }\r\n    };\r\n\r\n    // --- EFFECT: Auto-Check Full Event ---\r\n    // REMOVED: Defaulting to full event dates on package selection.\r\n    // We now allow custom dates even with full event package (as requested).\r\n    useEffect(() => {\r\n        if (selectedSite?.full_event_price && eventBounds.start && eventBounds.end) {\r\n            // Check if user has manually selected full duration\r\n            const isFullDuration = dates.start === eventBounds.start && dates.end === eventBounds.end;\r\n            if (isFullDuration) {\r\n                // Optional: We could auto-check it if they match, but let's leave it manual or sticky.\r\n                // setUseFullEventPrice(true); \r\n            }\r\n        }\r\n    }, [dates, eventBounds, selectedSite]);\r\n\r\n    // --- HANDLERS ---\r\n    const handleSiteClick = (site) => {\r\n        if (!site.is_available) return;\r\n        setSelectedSite(site);\r\n    };\r\n\r\n    const handleAddToCart = () => {\r\n        if (!selectedSite) return;\r\n\r\n        // Calculate nights\r\n        const s = new Date(dates.start);\r\n        const e = new Date(dates.end);\r\n        const nights = Math.max(1, Math.ceil((e - s) / (1000 * 60 * 60 * 24)));\r\n        const extraAdults = Math.max(0, adults - 1);\r\n\r\n        let price = 0;\r\n        if (useFullEventPrice && selectedSite.full_event_price) {\r\n            price = parseFloat(selectedSite.full_event_price) + (extraAdults * (selectedSite.extra_adult_full_event_price || 0));\r\n        } else {\r\n            price = ((selectedSite.price_per_night || 0) * nights) + (extraAdults * (selectedSite.extra_adult_price_per_night || 0) * nights);\r\n        }\r\n\r\n        const item = {\r\n            type: 'CAMPSITE',\r\n            id: selectedSite.campsite_id,\r\n            name: `Site ${selectedSite.site_number}`,\r\n            price: price, // Total Price\r\n            checkIn: dates.start,\r\n            checkOut: dates.end,\r\n            details: selectedSite,\r\n            eventId: eventId,\r\n            adults: adults,\r\n            children: children\r\n        };\r\n\r\n        addToCart(item);\r\n        console.log('Added to Cart:', item);\r\n        setCartMessage(`Added Site ${selectedSite.site_number} to cart! $${price.toFixed(2)}`);\r\n        setTimeout(() => setCartMessage(''), 3000);\r\n        setSelectedSite(null);\r\n    };\r\n\r\n    // --- RENDER: Index View ---\r\n    if (isIndex && !embedded) {\r\n        if (loading) return <div style={{ padding: '20px' }}>Loading events...</div>;\r\n        return (\r\n            <div style={{ maxWidth: '1200px', margin: '0 auto', padding: '20px' }}>\r\n                <h1>Camping Registration</h1>\r\n                <p>Select an event below to book a campsite.</p>\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))', gap: '20px', marginTop: '20px' }}>\r\n                    {allEvents.map(event => (\r\n                        <div key={event.event_id} style={{ border: '1px solid #ddd', borderRadius: '8px', overflow: 'hidden', boxShadow: '0 2px 8px rgba(0,0,0,0.05)', display: 'flex', flexDirection: 'column' }}>\r\n                            {event.banner_url ? (\r\n                                <img src={event.banner_url} alt={event.name} style={{ width: '100%', height: '150px', objectFit: 'cover' }} />\r\n                            ) : (\r\n                                <div style={{ width: '100%', height: '150px', background: 'var(--primary-color, black)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontWeight: 'bold', fontSize: '1.2rem' }}>\r\n                                    {event.name}\r\n                                </div>\r\n                            )}\r\n                            <div style={{ padding: '15px', display: 'flex', flexDirection: 'column', flex: 1 }}>\r\n                                <h3 style={{ marginTop: '0' }}>{event.name}</h3>\r\n                                <p style={{ color: '#666', fontSize: '0.9rem', marginBottom: '15px' }}>\r\n                                    {new Date(event.start_date).toLocaleDateString()} - {new Date(event.end_date).toLocaleDateString()}\r\n                                </p>\r\n                                <div style={{ marginTop: 'auto' }}>\r\n                                    <Link to={`/events/${event.slug}/camping`}>\r\n                                        <button style={{ width: '100%', padding: '10px', background: 'var(--primary-color, black)', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer' }}>\r\n                                            Book Camping\r\n                                        </button>\r\n                                    </Link>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                    {allEvents.length === 0 && <p>No upcoming events with camping found.</p>}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // --- RENDER: Detail View ---\r\n    if (!eventId) return <div style={{ padding: '20px' }}>Loading Event...</div>;\r\n\r\n    const activeCampground = campgrounds.find(cg => cg.campground_id === activeCampgroundId);\r\n\r\n    return (\r\n        <div style={{ maxWidth: '1200px', margin: '0 auto', padding: embedded ? '0' : '20px' }}>\r\n            {!embedded && (\r\n                <div style={{ marginBottom: '20px' }}>\r\n                    <Link to=\"/camping\" style={{ color: '#666', textDecoration: 'none' }}>‚Üê Back to Events</Link>\r\n                    <h1>{eventName}: Camping</h1>\r\n                </div>\r\n            )}\r\n\r\n\r\n\r\n            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\r\n\r\n                {/* Tabs for Multiple Campgrounds */}\r\n                {campgrounds.length > 1 && (\r\n                    <div style={{ display: 'flex', gap: '10px', borderBottom: '1px solid #ddd', paddingBottom: '10px' }}>\r\n                        {campgrounds.map(cg => (\r\n                            <button\r\n                                key={cg.campground_id}\r\n                                onClick={() => { setActiveCampgroundId(cg.campground_id); setSelectedSite(null); }}\r\n                                style={{\r\n                                    padding: '10px 20px',\r\n                                    background: activeCampgroundId === cg.campground_id ? 'var(--primary-color, black)' : '#eee',\r\n                                    color: activeCampgroundId === cg.campground_id ? 'white' : 'black',\r\n                                    border: 'none',\r\n                                    borderRadius: '4px',\r\n                                    cursor: 'pointer',\r\n                                    fontWeight: activeCampgroundId === cg.campground_id ? 'bold' : 'normal'\r\n                                }}\r\n                            >\r\n                                {cg.name}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                <div style={{ display: 'flex', flexDirection: viewMode === 'list' ? 'column' : 'row', gap: '20px' }}>\r\n                    {/* Map / Grid View */}\r\n                    {/* Map / List View Container */}\r\n                    <div style={{ flex: viewMode === 'list' ? 'none' : '2 1 0', minWidth: 0, width: viewMode === 'list' ? '100%' : 'auto' }}>\r\n                        {loading ? (\r\n                            <div style={{ height: '400px', display: 'flex', alignItems: 'center', justifyContent: 'center', background: '#f9f9f9', border: '1px solid #eee', borderRadius: '8px' }}>\r\n                                <h3>Checking availability...</h3>\r\n                            </div>\r\n                        ) : (\r\n                            <>\r\n                                {/* View Toggle & Legend Header */}\r\n                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '10px' }}>\r\n                                    {/* Legend (Map Mode Only, or simplified for List) */}\r\n                                    {viewMode === 'map' ? (\r\n                                        <div style={{ display: 'flex', gap: '15px', fontSize: '0.9rem', padding: '10px', background: '#fff', border: '1px solid #eee', borderRadius: '4px' }}>\r\n                                            <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                                <div style={{ width: '15px', height: '15px', borderRadius: '50%', background: 'var(--accent-color, gold)', border: '1px solid #ccc' }}></div>\r\n                                                <span>Available</span>\r\n                                            </div>\r\n                                            <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                                <div style={{ width: '15px', height: '15px', borderRadius: '50%', background: '#ff69b4', border: '1px solid #ccc' }}></div>\r\n                                                <span>Partial</span>\r\n                                            </div>\r\n                                            <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                                <div style={{ width: '15px', height: '15px', borderRadius: '50%', background: 'var(--primary-color, blue)', border: '2px solid white', outline: '1px solid #ccc' }}></div>\r\n                                                <span>Selected</span>\r\n                                            </div>\r\n                                            <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                                <div style={{ width: '15px', height: '15px', borderRadius: '50%', background: 'red', opacity: 0.6 }}></div>\r\n                                                <span>Unavailable</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div style={{ display: 'flex', gap: '10px', fontSize: '0.8rem' }}>\r\n                                            <span><span style={{ color: 'red', fontWeight: 'bold' }}>X</span> = Booked</span>\r\n                                            <span><span style={{ color: '#ccc' }}>-</span> = Available</span>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {/* Toggle Buttons */}\r\n                                    <div style={{ display: 'flex', background: '#eee', borderRadius: '4px', padding: '4px' }}>\r\n                                        <button\r\n                                            onClick={() => setViewMode('map')}\r\n                                            style={{\r\n                                                padding: '6px 15px',\r\n                                                border: 'none',\r\n                                                borderRadius: '4px',\r\n                                                background: viewMode === 'map' ? 'white' : 'transparent',\r\n                                                fontWeight: viewMode === 'map' ? 'bold' : 'normal',\r\n                                                boxShadow: viewMode === 'map' ? '0 1px 3px rgba(0,0,0,0.1)' : 'none',\r\n                                                cursor: 'pointer'\r\n                                            }}\r\n                                        >\r\n                                            Map\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => setViewMode('list')}\r\n                                            style={{\r\n                                                padding: '6px 15px',\r\n                                                border: 'none',\r\n                                                borderRadius: '4px',\r\n                                                background: viewMode === 'list' ? 'white' : 'transparent',\r\n                                                fontWeight: viewMode === 'list' ? 'bold' : 'normal',\r\n                                                boxShadow: viewMode === 'list' ? '0 1px 3px rgba(0,0,0,0.1)' : 'none',\r\n                                                cursor: 'pointer'\r\n                                            }}\r\n                                        >\r\n                                            List\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Content */}\r\n                                {activeCampground ? (\r\n                                    <div>\r\n                                        {campgrounds.length <= 1 && <h3>{activeCampground.name}</h3>}\r\n\r\n                                        {viewMode === 'map' ? (\r\n                                            <div style={{ position: 'relative', border: '1px solid #ddd', background: '#ccc', overflow: 'auto', maxHeight: '75vh' }}>\r\n                                                <div style={{ position: 'relative', minWidth: '1000px', width: '100%' }}>\r\n                                                    <img src={activeCampground.map_image_url} alt={activeCampground.name} style={{ width: '100%', display: 'block' }} />\r\n\r\n                                                    {/* Render Pins */}\r\n                                                    {activeCampground.sites.map(site => {\r\n                                                        if (!site.map_coordinates) return null;\r\n                                                        let c;\r\n                                                        try { c = JSON.parse(site.map_coordinates); } catch (e) { return null; }\r\n\r\n                                                        const isSelected = selectedSite?.campsite_id === site.campsite_id;\r\n\r\n                                                        // Calculate Booking Status\r\n                                                        // 1. Calculate total nights in event\r\n                                                        const eStart = new Date(eventBounds.start);\r\n                                                        const eEnd = new Date(eventBounds.end);\r\n                                                        const totalEventNights = Math.max(1, Math.ceil((eEnd - eStart) / (1000 * 60 * 60 * 24)));\r\n\r\n                                                        // 2. Calculate total nights booked for this site\r\n                                                        let bookedNights = 0;\r\n                                                        if (site.bookings && site.bookings.length > 0) {\r\n                                                            site.bookings.forEach(b => {\r\n                                                                const bStart = new Date(b.check_in);\r\n                                                                const bEnd = new Date(b.check_out);\r\n                                                                // Clamp booking to event bounds to avoid over-counting (though DB shouldn't allow it)\r\n                                                                const effectiveStart = bStart < eStart ? eStart : bStart;\r\n                                                                const effectiveEnd = bEnd > eEnd ? eEnd : bEnd;\r\n                                                                if (effectiveEnd > effectiveStart) {\r\n                                                                    bookedNights += Math.ceil((effectiveEnd - effectiveStart) / (1000 * 60 * 60 * 24));\r\n                                                                }\r\n                                                            });\r\n                                                        }\r\n\r\n                                                        const isFullyBooked = bookedNights >= totalEventNights;\r\n                                                        const isPartiallyBooked = bookedNights > 0 && bookedNights < totalEventNights;\r\n\r\n                                                        // Map Pin Color Logic:\r\n                                                        // 1. Selected -> Blue\r\n                                                        // 2. Fully Booked -> Red\r\n                                                        // 3. Partially Booked -> Pink\r\n                                                        // 4. Empty (Available) -> Gold\r\n                                                        let color = 'var(--accent-color, gold)'; // Default Empty/Available\r\n                                                        if (isSelected) {\r\n                                                            color = 'var(--primary-color, blue)';\r\n                                                        } else if (isFullyBooked) {\r\n                                                            color = 'red';\r\n                                                        } else if (isPartiallyBooked) {\r\n                                                            color = '#ff69b4'; // Hot Pink\r\n                                                        }\r\n\r\n                                                        // Availability indicated by opacity/cursor\r\n                                                        // If site is completely unavailable (e.g. fully booked or conflicts), opacity is lower\r\n                                                        const zIndex = isSelected ? 10 : 1;\r\n\r\n                                                        return (\r\n                                                            <div\r\n                                                                key={site.campsite_id}\r\n                                                                onClick={() => handleSiteClick(site)}\r\n                                                                style={{\r\n                                                                    position: 'absolute',\r\n                                                                    left: `${c.x}%`,\r\n                                                                    top: `${c.y}%`,\r\n                                                                    width: '20px',\r\n                                                                    height: '20px',\r\n                                                                    background: color,\r\n                                                                    borderRadius: '50%',\r\n                                                                    transform: 'translate(-50%, -50%)',\r\n                                                                    border: '2px solid white',\r\n                                                                    cursor: site.is_available ? 'pointer' : 'not-allowed',\r\n                                                                    zIndex: zIndex,\r\n                                                                    opacity: site.is_available ? 1 : 0.6\r\n                                                                }}\r\n                                                                title={`Site ${site.site_number} - ${isFullyBooked ? 'Booked' : (isPartiallyBooked ? 'Partially Booked' : 'Available')}`}\r\n                                                            />\r\n                                                        );\r\n                                                    })}\r\n                                                </div>\r\n                                            </div>\r\n                                        ) : (\r\n                                            <CampingListView\r\n                                                activeCampground={activeCampground}\r\n                                                selectedSite={selectedSite}\r\n                                                onSiteSelect={handleSiteClick}\r\n                                                eventStartDate={eventBounds.start}\r\n                                                eventEndDate={eventBounds.end}\r\n                                                compactMode={true}\r\n                                            />\r\n                                        )}\r\n                                    </div>\r\n                                ) : (\r\n                                    <p>No campgrounds found for this event.</p>\r\n                                )}\r\n                            </>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Sidebar / Info Panel */}\r\n                    <div style={{ flex: viewMode === 'list' ? 'none' : '0 0 350px', minWidth: viewMode === 'list' ? 'auto' : '300px', width: viewMode === 'list' ? '100%' : 'auto' }}>\r\n                        <div style={{ position: viewMode === 'list' ? 'static' : 'sticky', top: '20px', padding: '20px', border: '1px solid #eee', borderRadius: '8px', boxShadow: '0 4px 12px rgba(0,0,0,0.05)', backgroundColor: 'white' }}>\r\n                            <div style={{ marginBottom: '20px', paddingBottom: '20px', borderBottom: '1px solid #eee' }}>\r\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '15px' }}>\r\n                                    <div>\r\n                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', fontSize: '0.9rem' }}>Check In</label>\r\n                                        <input\r\n                                            type=\"date\"\r\n                                            value={dates.start}\r\n                                            min={eventBounds.start}\r\n                                            max={eventBounds.end}\r\n                                            onChange={e => setDates({ ...dates, start: e.target.value })}\r\n                                            style={{ width: '100%', padding: '10px', background: '#f5f5f5', border: '1px solid #ddd', borderRadius: '4px' }}\r\n                                        />\r\n                                    </div>\r\n                                    <div>\r\n                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', fontSize: '0.9rem' }}>Check Out</label>\r\n                                        <input\r\n                                            type=\"date\"\r\n                                            value={dates.end}\r\n                                            min={eventBounds.start}\r\n                                            max={eventBounds.end}\r\n                                            onChange={e => setDates({ ...dates, end: e.target.value })}\r\n                                            style={{ width: '100%', padding: '10px', background: '#f5f5f5', border: '1px solid #ddd', borderRadius: '4px' }}\r\n                                        />\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={fetchAvailability}\r\n                                        style={{ width: '100%', padding: '12px', background: 'black', color: 'white', border: 'none', borderRadius: '4px', cursor: loading ? 'wait' : 'pointer', fontWeight: 'bold', opacity: loading ? 0.7 : 1 }}\r\n                                    >\r\n                                        {loading ? 'Checking...' : 'Check Availability'}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                            <h2>Booking Details</h2>\r\n                            {selectedSite ? (\r\n                                <div>\r\n                                    <div style={{ fontSize: '1.5rem', fontWeight: 'bold', marginBottom: '10px' }}>Site {selectedSite.site_number}</div>\r\n                                    <p><strong>Power:</strong> {selectedSite.is_powered ? 'Yes' : 'No'}</p>\r\n                                    <p><strong>Price:</strong> ${selectedSite.price_per_night} / night</p>\r\n                                    {selectedSite.full_event_price && (\r\n                                        <div style={{ marginTop: '5px', padding: '10px', background: '#e0f7fa', borderRadius: '4px' }}>\r\n                                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                                                <input\r\n                                                    type=\"checkbox\"\r\n                                                    id=\"fullEventCheck\"\r\n                                                    checked={useFullEventPrice}\r\n                                                    onChange={e => {\r\n                                                        setUseFullEventPrice(e.target.checked);\r\n                                                        if (e.target.checked) setDates({ ...eventBounds });\r\n                                                    }}\r\n                                                    style={{ width: '18px', height: '18px', cursor: 'pointer' }}\r\n                                                />\r\n                                                <label htmlFor=\"fullEventCheck\" style={{ cursor: 'pointer', fontWeight: 'bold', flex: 1 }}>\r\n                                                    Full Event Package (${selectedSite.full_event_price})\r\n                                                </label>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    <div style={{ display: 'flex', gap: '10px', marginTop: '10px' }}>\r\n                                        <div style={{ flex: 1 }}>\r\n                                            <label style={{ display: 'block', fontSize: '0.8rem', fontWeight: 'bold' }}>Adults</label>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                min=\"1\"\r\n                                                value={adults}\r\n                                                onChange={e => setAdults(parseInt(e.target.value) || 1)}\r\n                                                style={{ width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '4px' }}\r\n                                            />\r\n                                        </div>\r\n                                        <div style={{ flex: 1 }}>\r\n                                            <label style={{ display: 'block', fontSize: '0.8rem', fontWeight: 'bold' }}>Children</label>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                min=\"0\"\r\n                                                value={children}\r\n                                                onChange={e => setChildren(parseInt(e.target.value) || 0)}\r\n                                                style={{ width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '4px' }}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                    <hr style={{ margin: '15px 0', border: 'none', borderTop: '1px solid #eee' }} />\r\n\r\n                                    {/* Price Calc */}\r\n                                    {(() => {\r\n                                        const s = new Date(dates.start);\r\n                                        const e = new Date(dates.end);\r\n                                        const nights = Math.max(1, Math.ceil((e - s) / (1000 * 60 * 60 * 24)));\r\n                                        const extraAdults = Math.max(0, adults - 1);\r\n                                        let total = 0;\r\n                                        let feeConfig = null;\r\n\r\n                                        // Override if Full Event\r\n                                        if (useFullEventPrice && selectedSite.full_event_price) {\r\n                                            const base = parseFloat(selectedSite.full_event_price);\r\n                                            const extra = parseFloat(selectedSite.extra_adult_full_event_price || 0);\r\n                                            // const info = `(Includes $${extra} per extra adult)`;\r\n                                            total = base + (extraAdults * extra);\r\n                                            if (extraAdults > 0 && extra > 0) feeConfig = { count: extraAdults, rate: extra, total: extraAdults * extra, label: 'Full Event Extra Adult' };\r\n                                        } else {\r\n                                            const base = (selectedSite.price_per_night || 0);\r\n                                            const extra = parseFloat(selectedSite.extra_adult_price_per_night || 0);\r\n                                            // const info = `(+$${extra}/night per extra adult)`; // Unused\r\n                                            total = (base * nights) + (extraAdults * extra * nights);\r\n                                            if (extraAdults > 0 && extra > 0) feeConfig = { count: extraAdults, rate: extra, total: extraAdults * extra * nights, label: 'Extra Adult Fees' };\r\n                                        }\r\n\r\n                                        return (\r\n                                            <div style={{ marginBottom: '20px' }}>\r\n                                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '5px' }}>\r\n                                                    <span>{useFullEventPrice ? 'Full Event Package' : `${nights} Night${nights > 1 ? 's' : ''}`}</span>\r\n                                                    <span>${total.toFixed(2)}</span>\r\n                                                </div>\r\n\r\n                                                {feeConfig && (\r\n                                                    <div style={{ display: 'flex', justifyContent: 'space-between', color: '#666', fontSize: '0.9rem', marginBottom: '5px' }}>\r\n                                                        <span>+ {feeConfig.count} Extra Adult{feeConfig.count > 1 ? 's' : ''} ({useFullEventPrice ? `$${feeConfig.rate}` : `$${feeConfig.rate}/n`})</span>\r\n                                                        <span>+${feeConfig.total.toFixed(2)}</span>\r\n                                                    </div>\r\n                                                )}\r\n\r\n                                                <div style={{ fontSize: '1.2rem', fontWeight: 'bold', marginTop: '10px', textAlign: 'right' }}>\r\n                                                    Total: ${total.toFixed(2)}\r\n                                                </div>\r\n                                                <div style={{ fontSize: '0.8rem', color: '#999', textAlign: 'right', marginTop: '4px' }}>\r\n                                                    (1 Adult included in base price)\r\n                                                </div>\r\n                                            </div>\r\n                                        );\r\n                                    })()}\r\n\r\n                                    <button\r\n                                        onClick={handleAddToCart}\r\n                                        style={{ width: '100%', padding: '12px', background: 'gold', border: 'none', borderRadius: '4px', fontSize: '1rem', fontWeight: 'bold', cursor: 'pointer', color: 'black', marginBottom: '10px' }}\r\n                                    >\r\n                                        Add to Cart\r\n                                    </button>\r\n\r\n                                    <button\r\n                                        onClick={() => navigate('/checkout')}\r\n                                        style={{ width: '100%', padding: '12px', background: 'black', border: 'none', borderRadius: '4px', fontSize: '1rem', fontWeight: 'bold', cursor: 'pointer', color: 'white' }}\r\n                                    >\r\n                                        Proceed to Checkout\r\n                                    </button>\r\n                                </div>\r\n                            ) : (\r\n                                <p style={{ color: '#666' }}>Select a campsite on the map to view details and book.</p>\r\n                            )}\r\n\r\n                            {cartMessage && (\r\n                                <div style={{ marginTop: '15px', padding: '10px', background: '#e6ffe6', color: 'green', borderRadius: '4px', textAlign: 'center' }}>\r\n                                    {cartMessage}\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Persistent Cart Summary */}\r\n                            {cart.length > 0 && (\r\n                                <div style={{ marginTop: '30px', borderTop: '2px solid #eee', paddingTop: '20px' }}>\r\n                                    <h3>Your Cart</h3>\r\n                                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '15px' }}>\r\n                                        <span>{cart.length} Item{cart.length !== 1 ? 's' : ''}</span>\r\n                                        <strong>${cartTotal.toFixed(2)}</strong>\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={() => navigate('/checkout')}\r\n                                        style={{ width: '100%', padding: '12px', background: 'var(--primary-color, black)', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontWeight: 'bold' }}\r\n                                    >\r\n                                        View Cart & Checkout\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default CampingPage;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\src\\utils\\dateHelpers.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\laragon\\www\\AERO-Project\\client\\vite.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]